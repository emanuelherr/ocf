{"version":3,"sources":["commons/services/languageSelector/languageSelector.service.js","passwordMgmt/forgotPassword/forgotPassword.service.js","passwordMgmt/forgotPassword/forgotPassword.controller.js","passwordMgmt/changePassword/changePasswordSuccess.controller.js","passwordMgmt/changePassword/changePassword.service.js","passwordMgmt/changePassword/changePassword.controller.js","commons/services/scan.service.js","commons/services/SampleDefinitionService.js","commons/services/InputValidationService.js","commons/services/DataLayerService.js","commons/services/ConfigurationService.js","home/home.state.js","commons/LocationSelector/locationSelector.state.js","commons/LocationSelector/locationSelector.controller.js","commons/js/limitTo.filter.js","noConnectivityPopUp/noConnectivityPopup.service.js","home/home.controller.js","autoLogoutPopUp/autoLogoutPopup.service.js","commons/js/services.js","passwordMgmt/forgotPassword/forgotPassword.state.js","passwordMgmt/changePassword/changePassword.state.js","login/controllers/LoginController.js","commons/js/modules.js","commons/js/interceptors.js","commons/js/filters.js","commons/js/directives.js","commons/js/constants.js","ocf.js"],"names":["LanguageSelectorService","$q","$ionicModal","lodash","$log","$rootScope","$ionicBackdrop","$translate","UserPreferenceService","close","lss","language","hide","release","$broadcast","create","template","options","attributes","q","defer","languageTemplate","merge","languagePopupOptions","selected","fromTemplateUrl","then","popup","debug","resolve","catch","fail","reject","promise","destroy","remove","open","undefined","userConfiguration","preferences","find","lang","value","key","show","retain","isShown","selectLangf","selectedLanguage","setUserPreference","user","id","use","this","animation","focusFirstInput","backdropClickToClose","hardwareBackButtonClose","languagePopupAttributes","message","ForgotPasswordService","$resource","URLManager","recoverPassword","username","passwordRecover","getUrl","recover","method","headers","ZestSessionId","fps","ForgotPasswordController","$scope","navigateTo","$ionicPlatform","LoadingService","goToPreviousState","e","preventDefault","login","resetPassword","pm","successPasswordRecover","handleErrors","finally","resetFormStates","status","genericError","removeErrors","hasError","defaultPasswordManagement","label","deregisterGoToPreviousState","$on","registerBackButtonAction","heightScreen","document","getElementById","addEventListener","$","attr","setTimeout","blur","removeAttr","placeholder","angular","copy","ChangePasswordSuccessController","$state","$window","$timeout","toaster","$ionicViewSwitcher","$ionicSideMenuDelegate","ChangePasswordService","nextDirection","cameFromStateName","go","home","getPasswordRules","rules","passwordRules","error","type","canDragContent","EnvironmentConfig","encode","passRulesFail","passwordRulesFail","failMessage","passwordChange","passwordChangeRules","timeout","requestTimeout","organizationId","cps","info","setNewPassword","currentPassword","newPassword","encodedCredentials","encodeCredentials","currentUser","password","userPassword","setPassword","Authorization","ChangePasswordController","changePassword","processing","passwordRulesErrors","finalMessage","noErrorsFinalMessage","newConfirm","passwords","new","labels","errorNoMatchPass","current","successPasswordChange","css","errorInvalidPass","hasErrors","errors","data","match","length","i","indexOf","dictionary","dictWord","split","txt","errorMessage","replace","errorIncorrectPass","errorNoConnection","previousStateName","previousStateParams","display","togglePasswordVisibility","buildRules","getPrepend","rule","prepend","finishStringBuild","event","spanLength","push","forEach","span","toLocaleLowerCase","rulesMessageMapper","dynamicContainAtLeast","dynamicAnd","join","minDigit","dynamicMinDigit","minUppercase","dynamicMinUppercase","minLowercase","dynamicMinLowercase","minSpecial","dynamicMinSpecial","minLength","number","deregisterPasswordStrengthMeter","legendMust","legendMustNot","legendUsed","dynamicBeAtLeastMultiple","digit","lowercase","special","uppercase","previously","meter","max","description","screen","height","loading","legend","dynamic","pR","JSON","parse","toJson","$watch","strength","zxcvbn","score","ScanService","initialize","activityName","console","log","window","datawedge","start","registerForBarcode","barcode","ss","SampleDefinitionService","SessionService","cleanDataModel","isBulkInfo","groups","screens","pictures","title","dataContainer","dataModel","ds","getSampleDefinitionId","product","configObject","ocfManager","getApplicationConfig","selectedLocation","locationId","app","appCacheName","config","lots","profileLocation","pl","produceProfileId","sampleDefinitionId","dynamicDataStructure","evalOptions","option","opt","mode","s","adjustedValue","isPercentage","isOptional","addEnums","groupIndex","groupCategory","valueType","reference","default_value","dataObj","group","name","validity","default","Number","adjusted","gc","attribute","optional","acceptedValidityTypes","subgroupIndexer","ispicturegroup","header","j","values","vType","_index","substr","vName","isEol","eolChecked","reasons","descriptors","reason","k","percentage","range","getInitialStructure","clearDataModel","InputValidationService","setParameters","tagMask","tagShortMask","tagValidFormat","isValidInputTag","isLongFormat","isShortFormat","isValidScannedTag","setMask","isScannedShortFormat","isInputShortFormat","removeMask","isLongScan","isShortScan","cs","DataLayerService","ConfigurationService","CouchDbConfig","setupConfig","done","setupDb","db","cb","get","err","res","put","cblite","getURL","url","server","coax","dls","dbName","localServerUrl","localDbUrl","usePouchDB","equals","adapter","sqlitePlugin","PouchDB","stringify","autoSync","sync","getAllDocuments","allDocs","include_docs","docs","getDocument","documentId","doc","addDocument","post","ok","updateDocument","_id","DBdoc","_rev","success","removeDocument","_deleted","addAttachment","attachment","_attachments","last_revision","Date","getTime","getAttachment","attachments","getLocalUrl","removeAttachment","attachmentName","compact","toString","purge","triggerSync","source","target","syncUrl","Cookie","getZestSessionId","continuous","pull","pushSync","syncManager","pullSync","on","serverUrl","syncDefinition","callHandlers","handlers","h","doCancelPost","cancelDef","cancel","doStartPost","pollForStatus","wait","tooLate","processTaskInfo","session_id","callBack","taskInfo","task","publicAPI","test","tasks","me","prefix","replicateToCouchDB","cHost","host","cdb","replicate","to","live","stopSync","getLoggedUserConfig","require","service","CouchBaseConfig","setLoggedUserConfig","userId","ConfigureHomeController","$stateProvider","state","views","ocf","controller","templateUrl","ConfigureLocationSelecion","LocationSelectorController","_","LoggingService","locations","getUserLocations","loadingMessage","result","logMessage","CONSTANTS","APP","OCF_LOGIN","CONTEXT","LOCATION_CONTROLLER","locationSelected","checkDevice","ocfConfigs","filterAppListByDeviceModel","selectLocation","subApps","appName","supportedDevice","supplierApps","appsList","map","apps","filter","appLocations","application","index","subApp","deviceModel","device","model","isValidApp","RegExp","userLogout","availableApp","appIndex","findIndex","toUpperCase","isPilot","appLocationId","idUUID","LOGIN_CONTROLLER","toLowerCase","selectListLocationItem","item","list","LimitString","input","limit","inputString","inputLength","outputString","formatter","substring","NoConnectivityPopupService","asps","noConnectivity","removeClass","retry","noConnectivityTemplate","noConnectivityPopupOptions","HomeController","isOpen","toggleRight","hideBackButton","appPosition","lastApp","OCF_APP_SELECTOR","offHardwareBackButton","selectApp","selectListAppItem","AutoLogoutPopupService","autoLogout","localStorage","setItem","autoLogoutTemplate","autoLogoutPopupOptions","module","factory","$location","OCFConfig","StagingConfig","PutAwayConfig","environmentHost","apiPath","ocfHost","servicePath","stagingConfig","putAwayConfig","resources","session","applications","ocfConfigurations","todayOrders","selectOrders","getSelectedOrders","closeOrder","removePallet","assignPallet","unassignPallet","overridePallet","stagingConfiguration","pallet","palletDetail","assignPOTag","reopenOrder","apiLogMessage","grayLogMessage","putAwayConfigurations","palletInfo","confirmSA","unassignSA","storageAreaValid","unknown","resource","forgotPassword","gdc","reload","g10","g04","stagingFillOrders","locationSelector","retailer","credentials","btoa","decodeCredentials","atob","decodeCredentialsAsObject","usr","$ionicLoading","messages","information","warning","clear","addMessage","clearPrevious","getCurrentMessages","addSuccessMessage","addInformationMessage","addWarningMessage","addErrorMessage","$http","SessionConfig","Session","loginWS","SessionID","request","Applications","getApps","loginData","setHeaderLogin","headerOk","loginSuccess","userInformation","loginFail","getSessionID","loginInfo","setHeaderCommon","sessionSuccess","sessionID","sessionFail","userID","getItem","setSessionID","setHeader","encoded","defaults","common","when","ZestAppName","userData","getUserData","sessionId","isSignedIn","cookieName","setLoggedUserId","clearLoggedUser","getLoggedUserId","getApplicationsList","appsSuccess","userApps","appsFail","setUserApplications","setUserData","getUserApplications","clearCredentials","cleaner","removeItem","setCredentials","sessionInfo","createdDate","now","getSessionData","usersData","userInfo","foundUserIndex","setSession","updateSessionStatus","sessionData","setLoggedOffline","setSessionExpired","setLoggedOnline","setLoggingOut","setLoggedOut","applicationConfig","appList","locationsList","makeRequest","storeAppConfig","configArray","appConfigSuccess","appConfig","appConfigFail","initialConfig","getConfigs","appId","promises","location","allSettled","remoteStorage","userExist","encodedData","checkSession","userCanAccessDatabase","orgId","database","cDbHost","localDB","deferred","set","initialization","PersistenceConfig","pouchLocalDB","ReplicationService","updateStatus","$apply","isSynchronized","retryReplication","sessionInformation","_db_name","liveReplicate","garbageCollector","descending","response","todayTime","rows","element","lastDocDate","createDate","daysDiff","daysToLive","StagingConfigurationService","getStagingConfiguration","configuration","getUserPreference","$interval","logMessageGrayLog","context","action","metadata","version","env","short_message","full_message","_environment","_facility","_context","jQuery","ajax","logsBlocked","saveLogToSend","Object","prototype","call","cordova","serial","android","navigator","appVersion","deviceMetadata","appVersionMetadata","logsToSend","OCF_DATA_RECOVER","OCF_LOCATION_SELECTOR","G10","G04","ON_PAUSE","ON_RESUME","ON_DEVICE_READY","ON_DATA_RECOVERING","TODAY_ORDER_CONTROLLER","FILL_ORDER_CONTROLLER","ASSIGN_PALLET_POPUP","REMOVE_PALLET_POPUP","REOPEN_ORDER_POPUP","SELECT_ORDER_POPUP","EVENT_HANDLER_SERVICE","PUT_AWAY_CONTROLLER","sendLog","shift","toZest","_fields","_methods","lockList","lock","isLocked","splice","lockItem","lockLookup","areLocked","isArray","_enqueue","_queue","_loggingStates","agnostic","execState","_currentState","_clearQueue","_setCurrentState","currentState","_trigger","trigger","_setLoggingState","setCurrentState","enqueue","setLoggingState","serviceName","lastLock","getLockTimeout","lockTimeout","displayAppBusyToaster","pop","body","showCloseButton","_retrieveConfigs","_success","_fail","OCFConfigs","_getOcfConfigs","configs","retrieveConfigs","getOcfConfigs","validStorageArea","barCode","validateStorageArea","valid","$promise","storageService","$inject","MessageService","OCFConfigurationService","backupUsername","backupPassword","form","autoLogoutPopup","scope","placeholders","_onTouchEnd","touches","changedTouches","_touchesInput","usernameInputBlock","passwordInputBlock","inputBoundaries","left","clientX","right","top","clientY","bottom","getBoundingClientRect","arrayInputs","$element","doLogin","successLoginInfo","userRecoverData","accountTypeId","applicationsSuccess","readableMessage","dataRecover","dataRecoverParam","hasToRecover","currentTime","pausedDate","createdDateTime","logoutTimeoutMilliseconds","userInactivityTimeout","$emit","selectedApp","locToSelect","selectedAppIndex","t","n","r","o","u","a","Error","f","exports","ZeJ/60","pax","hoax","coaxPax","extend","params","keys","Coax","makeHoax","opts","self","feed","listener","code","changes","sep","eom","msg","remaining","emit","json","results","row","since","last_seq","api","old","channels","x","3","objToQuery","v","ks","query","encodeURIComponent","processPath","path","empty","hasOwnProperty","mergePaths","newPath","merged","concat","methods","getQuery","makeToString","first","p","qobj","extenderizer","fun","addExtensions","makeNextPathFun","nextPax","nextPath","arguments","growPax","arg","T81WCk","FastClick","layer","oldOnClick","trackingClick","trackingClickStart","targetElement","touchStartX","touchStartY","lastTouchIdentifier","touchBoundary","nodeType","TypeError","onClick","apply","onMouse","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel","notNeeded","deviceIsAndroid","Event","stopImmediatePropagation","removeEventListener","callback","capture","rmv","Node","hijacked","adv","propagationStopped","onclick","userAgent","deviceIsIOS","deviceIsIOS4","deviceIsIOSWithBadTarget","needsClick","nodeName","disabled","className","needsFocus","readOnly","sendClick","clickEvent","touch","activeElement","createEvent","initMouseEvent","determineEventType","screenX","screenY","forwardedTouchEvent","dispatchEvent","tagName","focus","setSelectionRange","updateScrollParent","scrollParent","parentElement","fastClickScrollParent","contains","scrollHeight","offsetHeight","fastClickLastScrollTop","scrollTop","getTargetElementFromEventTarget","eventTarget","TEXT_NODE","parentNode","selection","targetTouches","getSelection","rangeCount","isCollapsed","identifier","timeStamp","pageX","pageY","lastClickTime","touchHasMoved","boundary","Math","abs","findControl","labelElement","control","htmlFor","querySelector","forElement","targetTagName","cancelNextClick","elementFromPoint","pageXOffset","pageYOffset","cancelable","stopPropagation","permitted","detail","metaViewport","ontouchstart","content","style","msTouchAction","attach","define","amd","fastclick","6","core","./hoax-core","browser-request","7","makeHoaxCallback","verb","statusCode","processArguments","myPax","urlOrOpts","newPax","uri","content-type","oldHoax","newHoax","xcb","args","reqOpts","Hoax","8","options_onResponse","onResponse","verbose","getLogger","unsupported_options","DEFAULT_TIMEOUT","accept","noop","authorization","auth","b64_enc","run_xhr","too_late","timed_out","er","duration","xhr","milliseconds","on_state_change","readyState","XHR","OPENED","setRequestHeader","HEADERS_RECEIVED","on_response","LOADING","on_loading","DONE","on_end","did","clearTimeout","timeoutTimer","is_cors","cors_err","cors","end","responseText","is_crossDomain","supports_cors","req_seq","seq_id","onreadystatechange","withCredentials","send","level","logger","levels","formatted","obj","formatted_logger","str","ajaxLocation","rurl","href","createElement","ajaxLocParts","exec","parts","o1","o2","o3","h1","h2","h3","h4","bits","b64","ac","enc","tmp_arr","charCodeAt","charAt","slice","XMLHttpRequest","trace","warn","requester","def","d","de","head","shortcuts","shortcut","func","Array","couch","couch_handler","resp","9","mustache","4JMXRT","root","Mustache","testRe","re","string","isWhitespace","nonSpaceRe","escapeRe","escapeHtml","String","entityMap","Scanner","tail","pos","Context","view","parent","clearCache","Writer","compileTokens","tokens","subRender","subRenders","fn","writer","token","sectionText","buffer","len","_section","_inverted","_partial","_name","_escaped","nestTokens","tree","collector","sections","section","squashTokens","lastToken","squashedTokens","escapeTags","tags","whiteRe","spaceRe","eqRe","curlyRe","tagRe","&","<",">","\"","'","/","escape","eos","scan","scanUntil","search","make","_cache","lookup","names","_partialCache","compile","compilePartial","partials","_loadPartial","render","text","scopedRender","stripSpace","hasTag","nonSpace","spaces","chr","tagRes","scanner","closeRe","_writer","to_html","responseError","rejection","isNaN","$sce","trustAsHtml","font","fontSize","maxSize","canvas","ctx","getContext","width","measureText","newText","count","directive","restrict","link","iElm","iAttrs","priority","$attr","slideBox","rangeLength","currentPage","belongsToCurrentPage","currPageRange","selectImage","children","pIndex","classList","add","pagerClick","onPagerClick","numSlides","slidesCount","isFirstPage","isLastPage","total","ceil","prevGalleryPage","nextGalleryPage","attrs","bind","which","$eval","ngEnter","constant","envName","requestTimeoutLong","access","cookieLifeTime","cookiePath","userApplications","pouchdbName","replicationRetries","translateProvider","run","$cordovaKeyboard","$httpBackend","EventHandlerService","debugging","storageAreas","headerColor","bodyColor","tagEpc","ziprCode","putAway","storageArea","storageAreaValidation","restMessages","G04201","G04202","G04401","defaultErrorMessage","errorCode","G04402","whenGET","respond","extract_epc_phId","epc_phId","floor","random","whenPOST","onLine","passThrough","ready","handleTouch","lastMove","Xpos","Ypos","is","plugins","Keyboard","click","triggerHandler","refresh","StatusBar","removeKeyboardOpen","isVisible","autoStart","enable","hockeyapp","hideAccessoryBar","getAppVersion","backgroundMode","stop","timer","onactivate","today","timeout_date","today_interval","now_interval","replicationHandler","ondeactivate","styleDefault","isOnline","onPauseEvent","toISOString","onResumeEvent","appResumed","onDeviceReadyEvent","navigationbar","setUp","isMC","cancelEvent","moveEvent","$provide","$urlRouterProvider","$ionicConfigProvider","$compileProvider","$httpProvider","$translatePartialLoaderProvider","$translateProvider","interceptors","debugInfoEnabled","maxCache","swipeBackEnabled","backButton","previousTitleText","tabs","position","navBar","alignTitle","addPart","useLoader","urlTemplate","registerAvailableLanguageKeys","en_*","es_*","preferredLanguage","fallbackLanguage","determinePreferredLanguage","decorator","$delegate","states","didAPromiseFail","checkStates","failed","allFinished","delegate","abstract","otherwise","$ionicHistory","$ionicPopup","$ionicSlideBoxDelegate","InitializationService","$cordovaDialogs","$cordovaBarcodeScanner","scannerAllowed","wasAtNewSample","isNewSample","regexp","saveState","savedState","savedStateParams","toState","toParams","fromState","fromParams","parseDate","date","dateFormat","timezoneOffset","moment","utcOffset","format","calculateTimeOffset","utc","getCurrentDate","sessionOver","fromInterceptor","languagePopup","selectLanguage","viewConfig","unfoundState","noConnectivityPopup"],"mappings":"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","file":"ocf-main.js","sourcesContent":["/**\n * Created by Henry Suarez on 18/1/2017.\n */\n\nangular\n  .module('ocf.services')\n  .service('LanguageSelectorService', LanguageSelectorService);\n\nLanguageSelectorService.$inject = [\n  '$q',\n  '$ionicModal',\n  'lodash',\n  '$log',\n  '$rootScope',\n  '$ionicBackdrop',\n  '$translate',\n  'UserPreferenceService'\n];\n\nfunction LanguageSelectorService($q,\n                           $ionicModal,\n                           lodash,\n                           $log,\n                           $rootScope,\n                           $ionicBackdrop,\n                           $translate,\n                           UserPreferenceService) {\n  var lss = this;\n\n  lss.selectLangf = selectLangf;\n  lss.close = close;\n  lss.create = create;\n  lss.destroy = destroy;\n  lss.open = open;\n  lss.isShown = isShown;\n  lss.selected = undefined;\n  lss.language = undefined;\n  lss.lang = [\n    {'key':'Spanish', 'value': 'es'},\n    {'key':'English', 'value':'en'}\n  ];\n  lss.languageTemplate = 'apps/supplier/commons/services/languageSelector/languageSelector.html';\n  lss.languagePopupOptions = {\n    animation: 'none',\n    focusFirstInput: false,\n    backdropClickToClose: false,\n    hardwareBackButtonClose: false\n  };\n  lss.languagePopupAttributes = {\n    message: ''\n  };\n\n  return lss;\n\n  ////////////////////\n  /**\n   * Closes the popup\n   */\n  function close() {\n    lss.language.hide();\n    $ionicBackdrop.release();\n    $rootScope.$broadcast('languagePopupClose', true);\n  }\n\n  /**\n   * Creates template and stores the pointer to it\n   * @param template {String}\n   * @param {Object} [options]\n   * @param {Object} [attributes]\n   */\n  function create(template, options, attributes) {\n    var q = $q.defer();\n    template = template || lss.languageTemplate;\n\n    if (options) {\n      lodash.merge(lss.languagePopupOptions, options);\n    }\n    lss.selected = \"English\";\n\n    $ionicModal.fromTemplateUrl(template, lss.languagePopupOptions)\n      .then(function (popup) {\n        $log.debug(\"Language Popup created\", popup);\n        lss.language = popup;\n        q.resolve(\"Popup Created\");\n      })\n      .catch(function (fail) {\n        $log.language(\"Language Popup failed to load\", fail);\n        q.reject(fail);\n      });\n\n    return q.promise;\n  }\n\n  /**\n   * Removes popup from DOM\n   */\n  function destroy() {\n    lss.language.remove();\n    $log.debug(\"Error removed from DOM\");\n  }\n\n  /**\n   * Called when open is needed\n   */\n  function open() {\n    if ($rootScope.userConfiguration != undefined && $rootScope.userConfiguration.preferences != undefined && $rootScope.userConfiguration.preferences.language != undefined){\n      lss.selected = (lodash.find(lss.lang, {value: $rootScope.userConfiguration.preferences.language})).key ;//$rootScope.selectedLanguage;\n    }else{\n      lss.selected = \"English\";\n    }\n    lss.language.show();\n    $ionicBackdrop.retain();\n    $log.debug(\"Error Open button clicked\");\n  }\n\n  function isShown() {\n    return lss.language.isShown();\n  }\n  function selectLangf(language){\n    lss.selected = language;\n\n    $rootScope.selectedLanguage =language;\n\n    $rootScope.userConfiguration.preferences.language = (lodash.find(lss.lang, {key: language})).value;\n\n    var preferences = {\"preferences\": {\"language\": $rootScope.userConfiguration.preferences.language } };\n\n    UserPreferenceService.setUserPreference($rootScope.user.id, preferences);\n\n    $translate.use($rootScope.userConfiguration.preferences.language);\n    lss.close();\n  }\n}\n","/**\n  * Created by FMG on 27/04/2016.\n  */\nangular\n  .module('ocf.services')\n  .service('ForgotPasswordService', ForgotPasswordService);\n\nForgotPasswordService.$inject = [\n  '$q',\n  '$resource',\n  'URLManager'\n];\n\nfunction ForgotPasswordService($q,\n                               $resource,\n                               URLManager) {\n  var fps = this;\n\n  fps.recoverPassword = recoverPassword;\n\n  return fps;\n\n  /**\n   * Calls password_change resource with required parameters\n   * @param username\n   * @returns {*}\n   */\n  function recoverPassword(username) {\n    var q = $q.defer();\n\n    var user = {\n      username: username\n    };\n\n    var passwordRecover = $resource(URLManager.getUrl('passwordRecover'), {}, {\n      recover: {\n        method: 'POST',\n        headers: {\n          // removing Zest* headers from the request as to avoid errors: { \"status\": 500, \"message\": \"Bad Headers\" }\n          //'ZestAppName': undefined,\n          'ZestSessionId': undefined\n        }\n      }\n    });\n\n    // Call to action\n    passwordRecover.recover(user, q.resolve, q.reject);\n\n    return q.promise;\n  }\n\n\n}\n","/**\n * Created by FMG on 27/04/2016.\n */\nangular\n  .module('ocf.forgotPassword',[])\n  .controller('ForgotPasswordController', ForgotPasswordController);\n\nForgotPasswordController.$inject =\n  [\n    '$scope',\n    'navigateTo',\n    '$ionicPlatform',\n    'ForgotPasswordService',\n    'LoadingService',\n    '$translate'\n  ];\n\nfunction ForgotPasswordController($scope,\n                                  navigateTo,\n                                  $ionicPlatform,\n                                  ForgotPasswordService,\n                                  LoadingService,\n                                  $translate) {\n  var deregisterGoToPreviousState;\n  var defaultPasswordManagement = {\n    username: '',\n    label: '',\n    hasError: false,\n    genericError: '',\n    successPasswordRecover: false\n  };\n\n  $scope.goToPreviousState = goToPreviousState;\n  $scope.resetPassword = resetPassword;\n  $scope.removeErrors = removeErrors;\n\n  ///////////////\n  /// Scope Events\n  $scope.$on('$ionicView.beforeEnter', function () {\n\n\n    deregisterGoToPreviousState = $ionicPlatform.registerBackButtonAction(goToPreviousState, 501);\n\n    if ($scope.heightScreen < 480) {\n      document.getElementById(\"changePasswordInput\").addEventListener('touchend', function () {\n        $(\"#changePasswordInput\").attr('readonly', 'readonly'); // Force keyboard to hide on input field.\n        $(\"#changePasswordInput\").attr('disabled', 'true');\n\n        setTimeout(function () {\n          $(\"#changePasswordInput\").blur();  //actually close the keyboard\n          // Remove readonly attribute after keyboard is hidden.\n          $(\"#changePasswordInput\").removeAttr('readonly');\n          $(\"#changePasswordInput\").removeAttr('disabled');\n        }, 100);\n      });\n    }\n    $translate('OCF.PASSWORD.FORGOT.USERNAME_PLACEHOLDER').then(function (placeholder) {\n      defaultPasswordManagement.label = placeholder;\n      // pm for PasswordManagement, shortened for readability\n      $scope.pm = angular.copy(defaultPasswordManagement);\n    });\n  });\n\n  //noinspection JSUnusedAssignment\n  $scope.$on('$destroy', deregisterGoToPreviousState);\n\n\n  ///////////////\n  /**\n   * Handles the goBack action triggered by menu or HW Back Button\n   */\n  function goToPreviousState(e) {\n    if (!!e) {\n      e.preventDefault();\n    }\n\n    navigateTo.login();\n\n  }\n\n  /**\n   * Sends the request for a password reset\n   */\n  function resetPassword() {\n    if ($scope.pm.username) {\n      LoadingService.show(\"Processing username...\");\n      ForgotPasswordService.recoverPassword($scope.pm.username)\n        .then(function () {\n          $scope.pm.successPasswordRecover = true;\n        })\n        .catch(handleErrors)\n        .finally(resetFormStates);\n    }\n  }\n\n  /**\n   * Error processing function to display messages accordingly.\n   *\n   * Expected errors:\n   *  412 - Password rules failed.\n   *  500 - Internal Server error (error returned when user:password basic auth isn't correct)\n   *    0 - No internet connection\n   *\n   *  @param fail\n   */\n  function handleErrors(fail) {\n    if (fail.status == 412) {\n      // TODO: due to the type of successful message, to inform of an invalid user is not necessary. Success screen will be displayed instead.\n      //$scope.pm.label = fail.data.message;\n      //$scope.pm.hasError = true;\n      $scope.pm.successPasswordRecover = true;\n    }\n\n    if (fail.status == 500) {\n      $scope.pm.genericError = \"Server Error.\";\n    }\n\n    if (fail.status == 0) {\n      $scope.pm.genericError = \"No connection available.\";\n    }\n  }\n\n\n  /**\n   * Resets error state\n   */\n  function removeErrors() {\n    $scope.pm.hasError = defaultPasswordManagement.hasError;\n    $scope.pm.label = defaultPasswordManagement.label;\n  }\n\n\n  /**\n   * Resets passwords and sets to hidden the passwords\n   */\n  function resetFormStates() {\n    $scope.pm.username = defaultPasswordManagement.username;\n    LoadingService.hide();\n  }\n}\n","/**\n* Created by PC-055 on 03/05/2016.\n*/\nangular\n  .module('ocf.changePassword.success',[])\n  .controller('ChangePasswordSuccessController', ChangePasswordSuccessController);\n\nChangePasswordSuccessController.$inject =\n  [\n    '$scope',\n    '$state',\n    '$log',\n    'navigateTo',\n    '$window',\n    '$timeout',\n    'toaster',\n    '$ionicViewSwitcher',\n    '$ionicSideMenuDelegate',\n    '$ionicPlatform',\n    'ChangePasswordService'\n  ];\n\n//noinspection JSUnusedLocalSymbols\nfunction ChangePasswordSuccessController($scope,\n                                  $state,\n                                  $log,\n                                  navigateTo,\n                                  $window,\n                                  $timeout,\n                                  toaster,\n                                  $ionicViewSwitcher,\n                                  $ionicSideMenuDelegate,\n                                  $ionicPlatform,\n                                  ChangePasswordService) {\n  var deregisterGoToPreviousState;\n\n  //$scope.pm = {\n  //  passwordRules: {\n  //    \"minDigit\": 1,\n  //    \"minLength\": 8,\n  //    \"minLowercase\": 1,\n  //    \"minSpecial\": 1,\n  //    \"minUppercase\": 1\n  //  },\n  //  meter: {\n  //    value: 0,\n  //    max: 4,\n  //    description: [\"\", \"Weak\", \"Moderate\", \"Moderate\", \"Strong\"]\n  //  },\n  //  showNewPassword: false,\n  //  showConfirmPassword: false,\n  //  newError: false,\n  //  confirmError: false,\n  //  current: '',\n  //  new: '',\n  //  newConfirm: ''\n  //};\n\n  //$scope.changePassword = changePassword;\n  $scope.goToPreviousState = goToPreviousState;\n  //$scope.togglePasswordVisibility = togglePasswordVisibility;\n\n  ///////////////\n  /// Scope Events\n  $scope.$on('$ionicView.beforeEnter', function () {\n    ChangePasswordService.getPasswordRules()\n      .then(function (rules) {\n        $scope.pm.passwordRules = rules;\n      })\n      .catch(function (fail) {\n        $log.error(fail.status, fail.message, fail.type);\n      });\n\n    $ionicSideMenuDelegate.canDragContent(true);\n    deregisterGoToPreviousState = $ionicPlatform.registerBackButtonAction(goToPreviousState, 501);\n  });\n\n  //noinspection JSUnusedAssignment\n  $scope.$on('$destroy', deregisterGoToPreviousState);\n\n  //$scope.$watch('pm.new', function (password) {\n  //  // updates the password strength meter value based on dropbox's library\n  //  $scope.pm.meter.value = zxcvbn(password).score;\n  //});\n\n  ///////////////\n  /**\n   * Request to change password\n   */\n  function changePassword() {\n    ChangePasswordService.setNewPassword($scope.pm.current, $scope.pm.new)\n      .then(function (s) {\n        $log.debug(s);\n      })\n      .catch(function (f) {\n        // Show errors\n        $log.debug(f);\n      });\n  }\n\n\n  /**\n   * Handles the goBack action triggered by menu or HW Back Button\n   */\n  function goToPreviousState() {\n    $ionicViewSwitcher.nextDirection('back');\n\n    if ($scope.cameFromStateName) {\n      $state.go($scope.cameFromStateName);\n\n    } else {\n      navigateTo.home();\n\n    }\n  }\n\n  /**\n   * Toggles password visibility\n   * @param password\n   */\n  function togglePasswordVisibility(password) {\n    if ('new' == password) {\n      $scope.pm.showNewPassword = !$scope.pm.showNewPassword;\n\n    } else if ('confirm' == password) {\n      $scope.pm.showConfirmPassword = !$scope.pm.showConfirmPassword;\n\n    }\n  }\n}\n","/**\n * Created by FMG on 27/04/2016.\n */\nangular\n  .module('ocf.services')\n  .factory('ChangePasswordService', ChangePasswordService);\n\nChangePasswordService.$inject = [\n  '$q',\n  '$resource',\n  '$rootScope',\n  'EnvironmentConfig',\n  'URLManager',\n  'encode'\n];\n\nfunction ChangePasswordService($q,\n                               $resource,\n                               $rootScope,\n                               EnvironmentConfig,\n                               URLManager,\n                               encode) {\n  var cps = this;\n\n  cps.info = {\n    currentUser: $rootScope.user.username || '',\n    organizationId: $rootScope.user.organizationId || 0\n  };\n\n  cps.getPasswordRules = getPasswordRules;\n  cps.setNewPassword = setNewPassword;\n\n  return cps;\n\n  /**\n   * Retrieves password rules for current organization\n   */\n  function getPasswordRules() {\n    var q = $q.defer();\n    var passwordChange = $resource(URLManager.getUrl('passwordChange'), {}, {\n      passwordChangeRules: {\n        method: 'GET',\n        timeout: EnvironmentConfig.requestTimeout\n      }\n    });\n\n    // Call to action\n    passwordChange.passwordChangeRules({organizationId: cps.info.organizationId}, q.resolve, passRulesFail);\n\n    function passRulesFail(passwordRulesFail) {\n      var failMessage = {\n        status: passwordRulesFail.status,\n        message: passwordRulesFail.message,\n        type: 'passwordRules'\n      };\n\n      if (passwordRulesFail.status !== 0) {\n        // net::ERR_CONNECTION_TIMED_OUT\n        failMessage.message = \"No internet connection.\";\n      }\n\n      q.reject(failMessage);\n    }\n\n    return q.promise;\n\n  }\n\n  /**\n   * Calls password_change resource with required parameters\n   * @param currentPassword\n   * @param newPassword\n   * @returns {*}\n   */\n  function setNewPassword(currentPassword, newPassword) {\n    var q = $q.defer();\n\n    var encodedCredentials = encode.encodeCredentials({username: cps.info.currentUser, password: currentPassword});\n    var userPassword = {\n      username: cps.info.currentUser,\n      password: newPassword\n    };\n\n    var passwordChange = $resource(URLManager.getUrl('passwordChange'), {}, {\n      setPassword: {\n        method: 'POST',\n        headers: {\n          'Authorization': \"Basic \" + encodedCredentials, // Credentials based on password entered by the user\n          // removing Zest* headers from the request as to avoid errors: { \"status\": 500, \"message\": \"Bad Headers\" }\n          //'ZestAppName': undefined,\n          'ZestSessionId': undefined\n        }\n      }\n    });\n\n    // Call to action\n    passwordChange.setPassword(userPassword, q.resolve, q.reject);\n\n    return q.promise;\n  }\n}\n","/**\n * Created by FMG on 27/04/2016.\n */\nangular\n  .module('ocf.changePassword')\n  .controller('ChangePasswordController', ChangePasswordController);\n\nChangePasswordController.$inject =\n  [\n    '$scope',\n    '$state',\n    '$log',\n    'navigateTo',\n    'lodash',\n    '$ionicViewSwitcher',\n    '$ionicPlatform',\n    '$translate',\n    'ChangePasswordService',\n    'LoadingService',\n    '$window'\n  ];\n\nfunction ChangePasswordController($scope,\n                                  $state,\n                                  $log,\n                                  navigateTo,\n                                  lodash,\n                                  $ionicViewSwitcher,\n                                  $ionicPlatform,\n                                  $translate,\n                                  ChangePasswordService,\n                                  LoadingService,\n                                  $window) {\n  var deregisterGoToPreviousState;\n  var deregisterPasswordStrengthMeter;\n\n  var processing;\n  var legendMust;\n  var legendMustNot;\n  var legendUsed;\n  var dynamicMinDigit;\n  var dynamicMinUppercase;\n  var dynamicMinLowercase;\n  var dynamicMinSpecial;\n  var dynamicBeAtLeastMultiple;\n  var dynamicContainAtLeast;\n  var dynamicAnd;\n  var errorInvalidPass;\n  var errorIncorrectPass;\n  var errorNoMatchPass;\n  var errorNoConnection;\n\n  var defaultPasswordManagement = {\n    passwordRules: {\n      \"minDigit\": 0,\n      \"minLength\": 0,\n      \"minLowercase\": 0,\n      \"minSpecial\": 0,\n      \"minUppercase\": 0\n    },\n    passwordRulesErrors: {\n      \"digit\": false,\n      \"length\": false,\n      \"lowercase\": false,\n      \"special\": false,\n      \"uppercase\": false,\n      \"previously\": false,\n      \"dictionary\": false,\n      \"dictWord\": '',\n      \"genericError\": ''\n    },\n    meter: {\n      value: 0,\n      max: 4,\n      description: [\"\", \"Weak\", \"Fair\", \"Fair\", \"Strong\"]\n    },\n    labels: {\n      current: 'Current Password',\n      new: 'New Password',\n      newConfirm: 'Confirm New Password'\n    },\n    passwords: {\n      current: '',\n      new: '',\n      newConfirm: ''\n    },\n    hasError: {\n      current: false,\n      new: false,\n      newConfirm: false\n    },\n    display: {\n      current: false,\n      new: false,\n      newConfirm: false\n    }\n  };\n  $scope.heightScreen = $window.screen.height;\n  $scope.changePassword = changePassword;\n  $scope.goToPreviousState = goToPreviousState;\n  $scope.removeErrors = removeErrors;\n  $scope.togglePasswordVisibility = togglePasswordVisibility;\n\n  ///////////////\n  /// Scope Events\n  $scope.$on('$ionicView.beforeEnter', function () {\n    $scope.dictWord = {errorMessage: ''};\n    $scope.pm = angular.copy(defaultPasswordManagement);\n\n    /**\n     * Meter\n     */\n    $translate([\n      'OCF.PASSWORD.CHANGE.STRENGTH_METER.WEAK',\n      'OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR',\n      'OCF.PASSWORD.CHANGE.STRENGTH_METER.STRONG'\n    ]).then(function (meter) {\n      $scope.pm.meter.description[1] = meter['OCF.PASSWORD.CHANGE.STRENGTH_METER.WEAK'];\n      $scope.pm.meter.description[2] = meter['OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR'];\n      $scope.pm.meter.description[3] = meter['OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR'];\n      $scope.pm.meter.description[4] = meter['OCF.PASSWORD.CHANGE.STRENGTH_METER.STRONG'];\n    });\n\n    /**\n     * Placeholders\n     */\n    $translate([\n      'OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER',\n      'OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER',\n      'OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER'\n    ]).then(function (labels) {\n      $scope.pm.labels.current = labels['OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER'];\n      $scope.pm.labels.new = labels['OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER'];\n      $scope.pm.labels.newConfirm = labels['OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER'];\n\n      // Required for resetting object model\n      defaultPasswordManagement.labels.current = labels['OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER'];\n      defaultPasswordManagement.labels.new = labels['OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER'];\n      defaultPasswordManagement.labels.newConfirm = labels['OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER'];\n    });\n\n    /**\n     * Loading service\n     */\n    $translate('OCF.PASSWORD.CHANGE.PROCESSING').then(function (loading) {\n      processing = loading;\n    });\n\n    /**\n     * Legends\n     */\n    $translate([\n      'OCF.PASSWORD.CHANGE.LEGEND.MUST',\n      'OCF.PASSWORD.CHANGE.LEGEND.MUST_NOT',\n      'OCF.PASSWORD.CHANGE.LEGEND.USED'/*,\n       'OCF.PASSWORD.CHANGE.LEGEND.DICT_WORD'*/\n    ]).then(function (legend) {\n      legendMust = legend['OCF.PASSWORD.CHANGE.LEGEND.MUST'];\n      legendMustNot = legend['OCF.PASSWORD.CHANGE.LEGEND.MUST_NOT'];\n      legendUsed = legend['OCF.PASSWORD.CHANGE.LEGEND.USED'];\n      //legendDictWord = legend['OCF.PASSWORD.CHANGE.LEGEND.DICT_WORD'];\n    });\n\n    /**\n     * Dynamic text\n     */\n    $translate([\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_DIGIT',\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_UPPERCASE',\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_LOWERCASE',\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_SPECIAL',\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.CONTAIN_AT_LEAST',\n      'OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.AND'\n    ]).then(function (dynamic) {\n      dynamicMinDigit = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_DIGIT'];\n      dynamicMinUppercase = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_UPPERCASE'];\n      dynamicMinLowercase = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_LOWERCASE'];\n      dynamicMinSpecial = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_SPECIAL'];\n      dynamicContainAtLeast = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.CONTAIN_AT_LEAST'];\n      dynamicAnd = dynamic['OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.AND'];\n    });\n\n    /**\n     * Dynamic text with variables\n     */\n    $translate('OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_MULTIPLE', {\n      number: $scope.pm.passwordRules.minLength\n    }).then(function (txt) {\n      dynamicBeAtLeastMultiple = txt;\n    });\n\n    /**\n     * Error Messages\n     */\n    $translate([\n      'OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INVALID_PASSWORD',\n      'OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INCORRECT_PASSWORD',\n      'OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_MATCH_PASSWORD',\n      'OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_CONNECTION'\n    ]).then(function (errors) {\n      errorInvalidPass = errors['OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INVALID_PASSWORD'];\n      errorIncorrectPass = errors['OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INCORRECT_PASSWORD'];\n      errorNoMatchPass = errors['OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_MATCH_PASSWORD'];\n      errorNoConnection = errors['OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_CONNECTION'];\n    });\n\n    // pm for PasswordManagement, shortened for readability\n    $scope.pm = angular.copy(defaultPasswordManagement);\n    $scope.successPasswordChange = false;\n    if ($scope.heightScreen < 480){\n      $(\"ion-content\").css(\"height\", \"auto\")\n    }\n    ChangePasswordService.getPasswordRules()\n      .then(function (rules) {\n        // Sets rules (removes promises related attributes)\n        $scope.pm.pR = JSON.parse(angular.toJson(rules));\n        $scope.pm.passwordRules = {minDigit: $scope.pm.pR.minDigit,\n          minLength: $scope.pm.pR.minLength,\n          minUppercase: $scope.pm.pR.minUppercase,\n          minLowercase: $scope.pm.pR.minLowercase,\n          minSpecial: $scope.pm.pR.minSpecial\n        };\n        // Builds the \"MUST\" message\n        buildRules();\n      })\n      .catch(function (fail) {\n        $scope.pm.passwordRulesErrors.genericError = fail.message;\n        $log.error(fail.status, fail.message, fail.type);\n      });\n\n    deregisterGoToPreviousState = $ionicPlatform.registerBackButtonAction(goToPreviousState, 501);\n\n    deregisterPasswordStrengthMeter = $scope.$watch('pm.passwords.new', function (password) {\n      // updates the password strength meter value based on dropbox's library\n      var strength = zxcvbn(password).score;\n      $scope.pm.meter.value = strength ? strength : password.length ? 1 : 0;\n    });\n  });\n\n  $scope.$on('$ionicView.beforeLeave', function () {\n    deregisterGoToPreviousState();\n    deregisterPasswordStrengthMeter();\n    $scope.pm = angular.copy(defaultPasswordManagement); // resets pm\n  });\n\n\n  ///////////////\n  // Scope Methods\n  /**\n   * Request to change password\n   */\n  function changePassword() {\n    LoadingService.show(processing);\n\n    // Resets errors\n    $scope.pm.passwordRulesErrors = angular.copy(defaultPasswordManagement.passwordRulesErrors);\n    // Resets description\n    $scope.pm.finalMessage = angular.copy($scope.pm.noErrorsFinalMessage);\n    // newConfirm must match new\n    $scope.pm.hasError.newConfirm = $scope.pm.passwords.new !== $scope.pm.passwords.newConfirm;\n\n    if (!$scope.pm.hasError.newConfirm) {\n      ChangePasswordService.setNewPassword($scope.pm.passwords.current, $scope.pm.passwords.new)\n        .then(function () {\n          $scope.successPasswordChange = true;\n        })\n        .catch(handleErrors)\n        .finally(resetFormStates);\n\n    } else {\n      LoadingService.hide();\n      // Error for the new Confirmation password, there's no action to validate\n      $scope.pm.passwords = angular.copy(defaultPasswordManagement.passwords); // Cleans passwords\n      $scope.pm.labels.newConfirm = errorNoMatchPass;\n    }\n    if ($scope.heightScreen < 480){\n      $(\"ion-content\").css(\"height\", \"auto\")\n    }\n    if ($scope.heightScreen < 480){\n      $(\"ion-content\").css(\"height\", \"auto\")\n    }\n  }\n\n  /**\n   * Error processing function to display messages accordingly.\n   *\n   * Expected errors:\n   *  412 - Password rules failed.\n   *  401 - Unauthorized. Basic Auth failed. Current username/password does not match.\n   *  500 - Internal Server error (error returned when user:password basic auth isn't correct)\n   *    0 - No internet connection\n   *\n   *  @param fail\n   */\n  function handleErrors(fail) {\n    if (fail.status == 412) {\n      $scope.pm.hasError.new = true;\n      $scope.pm.labels.new = errorInvalidPass;\n\n      var hasErrors = /length|uppercase|lowercase|digit|special|previously|dictionary.*'/g;\n      var errors = fail.data.message.match(hasErrors);\n\n      if (errors.length) {\n        // Sets corresponding error flags to true\n        for (var i = 0; i < errors.length; i++) {\n          var error = errors[i];\n\n          if (error.indexOf(\"dictionary\") !== -1) {\n            // extracts the dictWord from the sentence\n            $scope.pm.passwordRulesErrors.dictionary = true;\n            $scope.pm.passwordRulesErrors.dictWord = error.split(\"'\")[1];\n            $translate('OCF.PASSWORD.CHANGE.LEGEND.DICT_WORD', {\n              dictWord: $scope.pm.passwordRulesErrors.dictWord\n            }).then(function (txt) {\n              $scope.dictWord.errorMessage = txt;\n            });\n\n\n          } else {\n            $scope.pm.passwordRulesErrors[error] = true;\n\n            if (error.indexOf(\"previously\") == -1) {\n              $scope.pm.finalMessage = $scope.pm.finalMessage.replace(error, 'error');\n            }\n          }\n        }\n      }\n    }\n\n    if (fail.status == 401 || fail.status == 500) {\n      $scope.pm.hasError.current = true;\n      $scope.pm.labels.current = errorIncorrectPass;\n    }\n\n    if (fail.status == 0) {\n      $scope.pm.passwordRulesErrors.genericError = errorNoConnection;\n    }\n  }\n\n  /**\n   * Handles the goBack action triggered by menu or HW Back Button\n   */\n  function goToPreviousState(e) {\n    if (!!e) {\n      e.preventDefault();\n    }\n\n    $ionicViewSwitcher.nextDirection('back');\n\n    if ($scope.successPasswordChange) {\n      return false;\n\n    } else {\n      if ($scope.previousStateName) {\n        $state.go($scope.previousStateName, $scope.previousStateParams);\n\n      } else {\n        navigateTo.home();\n      }\n    }\n  }\n\n  /**\n   * Resets error state for the specified password\n   * @param password\n   */\n  function removeErrors(password) {\n    if ('current' == password && $scope.pm.hasError.current) {\n      $scope.pm.display.current = defaultPasswordManagement.display.current;\n      $scope.pm.hasError.current = defaultPasswordManagement.hasError.current;\n      $scope.pm.labels.current = defaultPasswordManagement.labels.current;\n\n    } else if ('new' == password && $scope.pm.hasError.new) {\n      $scope.pm.display.new = defaultPasswordManagement.display.new;\n      $scope.pm.hasError.new = defaultPasswordManagement.hasError.new;\n      $scope.pm.labels.new = defaultPasswordManagement.labels.new;\n\n    } else if ('newConfirm' == password && $scope.pm.hasError.newConfirm) {\n      $scope.pm.display.newConfirm = defaultPasswordManagement.display.newConfirm;\n      $scope.pm.hasError.newConfirm = defaultPasswordManagement.hasError.newConfirm;\n      $scope.pm.labels.newConfirm = defaultPasswordManagement.labels.newConfirm;\n\n    }\n  }\n\n  /**\n   * Resets passwords and sets to hidden the passwords\n   */\n  function resetFormStates() {\n    LoadingService.hide();\n    $scope.pm.passwords = angular.copy(defaultPasswordManagement.passwords);\n    $scope.pm.display = angular.copy(defaultPasswordManagement.display);\n  }\n\n\n  /**\n   * Toggles password visibility\n   * @param password\n   */\n  function togglePasswordVisibility(password) {\n    if ('current' == password) {\n      $scope.pm.display.current = !$scope.pm.display.current;\n\n    } else if ('new' == password) {\n      $scope.pm.display.new = !$scope.pm.display.new;\n\n    } else if ('newConfirm' == password) {\n      $scope.pm.display.newConfirm = !$scope.pm.display.newConfirm;\n\n    }\n  }\n\n\n  /**\n   * Builds the rules' based string to inform the user\n   */\n  function buildRules() {\n    var rulesMessageMapper = {\n      minDigit: dynamicMinDigit,\n      minUppercase: dynamicMinUppercase,\n      minLowercase: dynamicMinLowercase,\n      minSpecial: dynamicMinSpecial\n    };\n    var message = [];\n    var spanLength = '<span class=\"length\">';\n\n    // Always starts with the minimum length\n    if ($scope.pm.passwordRules.minLength > 1) {\n      $translate('OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_MULTIPLE', {\n        number: $scope.pm.passwordRules.minLength\n      }).then(function (txt) {\n        $scope.$broadcast('minLengthRetrieved', txt);\n      });\n      // spanLength += 'be at least ' + $scope.pm.passwordRules.minLength + ' characters, ';\n\n    } else {\n      $translate('OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_SINGLE')\n        .then(function (txt) {\n          $scope.$broadcast('minLengthRetrieved', txt);\n        });\n      // spanLength += 'be at least one character long, ';\n    }\n\n\n    $scope.$on('minLengthRetrieved', finishStringBuild);\n\n\n    function getPrepend(rule){\n      var prepend='';\n\n      switch ($translate.use()){\n        case 'es':\n          prepend = 'una ';\n          if (rule === 'minDigit' || rule === 'minSpecial') {\n            prepend = 'un ';\n          }\n          break;\n        default:\n        case 'en':\n          prepend = 'a ';\n          if (rule === 'minUppercase') {\n            prepend = 'an ';\n          }\n          break;\n      }\n      return prepend;\n    }\n\n    //noinspection JSUnusedLocalSymbols\n    /**\n     * Builds dynamic string after retrieving i18n fragment\n     * @param event\n     * @param txt\n     */\n    function finishStringBuild(event, txt) {\n      spanLength += txt;\n      spanLength += '</span>';\n      message.push(spanLength);\n\n      // Recursively adds valid rules\n      lodash.forEach($scope.pm.passwordRules, function (value, rule) {\n        if (rule != 'minLength') {\n          if (value) {\n            var span = '<span class=\"' + rule.split(\"min\")[1].toLocaleLowerCase() + '\">';\n\n            if (value > 1) {\n              span += value + ' ' + rulesMessageMapper[rule] + 's';\n\n            } else {\n              var prepend = getPrepend(rule);\n              span += prepend + rulesMessageMapper[rule];\n            }\n\n            span += '</span>';\n            message.push(span);\n          }\n        }\n      });\n\n      message[1] = dynamicContainAtLeast + \" \" + message[1];\n      message[message.length - 1] = dynamicAnd + \" \" + message[message.length - 1];\n\n      var finalMessage = message.join(\", \");\n      finalMessage += \".\";\n\n      // converts it to string and copies it to the object that will be binded in the template\n      $scope.pm.finalMessage = finalMessage;\n      $scope.pm.noErrorsFinalMessage = angular.copy(finalMessage); // useful to recover string status on submit\n    }\n\n    // spanLength += '</span><br/>';\n    // message.push(spanLength);\n    //\n    // // Recursively adds valid rules\n    // lodash.forEach($scope.pm.passwordRules, function (value, rule) {\n    //   if (rule != 'minLength') {\n    //     if (value) {\n    //       var span = '<span class=\"' + rule.split(\"min\")[1].toLocaleLowerCase() + '\">';\n    //\n    //       if (value > 1) {\n    //         span += value + ' ' + rulesMessageMapper[rule] + 's';\n    //\n    //       } else {\n    //         var prepend =\"\";\n    //         if (rule != \"minDigit\"){\n    //           prepend = 'a ';\n    //\n    //           if (rule === 'minUppercase') {\n    //             prepend = 'an ';\n    //           }\n    //         }\n    //         span += prepend + rulesMessageMapper[rule];\n    //       }\n    //       span += '</span>';\n    //       message.push(span);\n    //     }\n    //   }\n    // });\n    //\n    // message[1] = \" \" + message[1];\n    // message[message.length - 1] = \"and \" + message[message.length - 1];\n    //\n    // message[0] = message[0] + message[1]+\", \";\n    // message.splice(1,1);\n    // message[1] += \",<br/>\";\n    // var finalMessage = message.join(\" \");\n    // finalMessage += \".\";\n    //\n    // // converts it to string and copies it to the object that will be binded in the template\n    // $scope.pm.finalMessage = finalMessage;\n    // $scope.pm.noErrorsFinalMessage = angular.copy(finalMessage); // useful to recover string status on submit\n  }\n}\n","angular\n  .module('ocf.services')\n  .service('ScanService', ScanService);\n\nScanService.$inject = ['$rootScope', '$timeout'];\n\nfunction ScanService($rootScope, $timeout) {\n\n  var ss = this;\n\n  ss.initialize = initialize;\n\n  /**\n   * Initializes the scan and sets the activity to send the intent to\n   * @param activityName\n   */\n  function initialize(activityName) {\n\n    console.log(window.datawedge);\n\n    if (window.datawedge) {\n\n      var activity = activityName ? activityName : \"com.bluefletch.motorola.datawedge.ACTION\"; //default activity name\n\n      console.log(activityName);\n\n      datawedge.start();\n\n      $timeout(function () {\n\n        datawedge.registerForBarcode(function (data) {\n\n          console.log(\"dataWedgeScan - broadcast\");\n          $rootScope.$broadcast('dataWedgeScan', data.barcode);\n\n        });\n\n      }, 300)\n\n    }\n  }\n\n  return ss;\n}\n\n","angular\n  .module('ocf.services')\n  .service('SampleDefinitionService', SampleDefinitionService);\n\nSampleDefinitionService.$inject = ['lodash', 'SessionService', '$rootScope'];\n\nfunction SampleDefinitionService(lodash, SessionService, $rootScope) {\n  var cleanDataModel = {\n    isBulkInfo: false,\n    groups: [],\n    screens: {\n      pictures: {\n        display: false,\n        title: \"\"\n      },\n      dataContainer: []\n    }\n  };\n\n  var dataModel = {\n    ds: angular.copy(cleanDataModel)\n  };\n\n\n\n  dataModel.getSampleDefinitionId = function (product) {\n\n    var configObject = SessionService.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId, $rootScope.app.appCacheName).config;\n\n    //match the productProfile-sampleDefinition pair with the corresponding sampleDefinition\n    if (configObject.lots[0] && configObject.lots[0] && configObject.lots[0].profileLocation && configObject.lots[0].profileLocation.length) {\n      var profileLocation =  lodash.find(configObject.lots[0].profileLocation, function (pl) {\n        return pl.produceProfileId == product.id;\n      });\n    }\n\n    if (profileLocation){\n      return profileLocation.sampleDefinitionId;\n    }\n  }\n\n  dataModel.dynamicDataStructure = function (product) {\n\n    var configObject = {};\n\n    configObject = SessionService.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId, $rootScope.app.appCacheName).config;\n    var gc = [];\n\n    //match the productProfile-sampleDefinition pair with the corresponding sampleDefinition\n    if (configObject.attributes.length) {\n      gc = lodash.find(configObject.attributes, function (attribute) {\n        return attribute.sampleDefinitionId == product.sampleDefinitionId;\n      });\n    }\n\n    var dataObj = {\n      title: '',\n      group: '',\n      name: '',\n      value: '',\n      screen: '',\n      validity: {},\n      reference: '',\n      default: '',\n      adjusted: false,\n      optional: false\n    };\n\n    var acceptedValidityTypes = [\"_enum\", \"_limit\", \"range\", \"enum\", 'Eol'];\n    var subgroupIndexer = {};\n    dataModel.ds.data = [];\n\n    ////for each attribute group, make a new screen/tab\n    //for (var i = 0; i < gc.values.length; i++) {\n    var screen = gc;\n\n    if (typeof screen.ispicturegroup == \"undefined\") {\n      $rootScope.$broadcast('noAttributes');\n      return;\n    }\n\n    dataModel.ds.header = {};\n\n    // Picture Screen is defined in the controller after this data initialization\n    if (!screen.ispicturegroup) {\n\n      for (var j = 0; j < screen.values.length; j++) {\n\n        var value = screen.values[j];\n        var vType = value.type;\n        var _index = vType.indexOf(\"_\");\n        var valueType = _index !== -1 ? vType.substr(_index).toLocaleLowerCase() : vType.toLocaleLowerCase();\n        var data = angular.copy(dataObj);\n        var vName = value.name;\n        var reference = value.reference;\n        var default_value = value.default;\n        var options = value.options;\n\n        var s = undefined;\n        var adjustedValue = undefined;\n        var mode = undefined;\n        var isPercentage = false;\n        var isOptional = false;\n\n        if (options !== undefined) {\n          evalOptions(options);\n        }\n\n\n        if (acceptedValidityTypes.indexOf(valueType) === -1) {\n          // count or text\n          // Considers the type as a parent of _enum and _limit types\n          if (typeof subgroupIndexer[valueType] === \"undefined\") {\n            subgroupIndexer[valueType] = 0;\n          }\n          data.title = vName;\n          data.group = valueType;\n          data.name = valueType + \"_0\";\n          data.validity.type = \"relatives\";\n          data.default = default_value;\n          data.optional = isOptional;\n\n          //TEMPORAL CODE FOR EOL SUPPORT\n          if (valueType == \"eol\") {\n\n            data.validity.type = \"enum\";\n            data.isEol = true;\n            data.eolChecked = false;\n            data.validity.options = [\n              {\"value\": \"No\"},\n              {\"value\": \"Yes\"}];\n\n            data.reasons = value.descriptors;\n\n            lodash.forEach(data.reasons, function (reason) {\n              if (reason.value == data.default) {\n                reason.selected = true;\n              }\n            });\n\n          }\n\n          //if (s != undefined && previousSamples.length > 0) {\n          //  data.value = calculateAvg(s, data.name);\n          //}\n          //else\n          if (default_value !== undefined) {\n            data.value = Number(default_value);\n          }\n\n          if (dataModel.ds.groups.indexOf(valueType) === -1) {\n            this.ds.groups.push(valueType);\n          }\n          dataModel.ds.data.push(data);\n\n        } else if (_index !== -1) {\n          // _enum or _limit\n          var groupCategory = vType.substr(0, _index).toLocaleLowerCase();\n\n          //check if it needs to add a new index for the group\n          if (typeof subgroupIndexer[groupCategory] === \"undefined\") {\n            subgroupIndexer[groupCategory] = 0;\n          }\n\n          if (valueType === \"_enum\") {\n\n            for (var k = 0; k < value.descriptors.length; k++) {\n              addEnums(value.descriptors[k].value, ++subgroupIndexer[groupCategory], groupCategory, valueType, reference, value.descriptors[k].default, adjustedValue, s);\n            }\n\n          } else {\n            data.title = vName;\n            //data.screen = screenIndex;\n            data.group = groupCategory;\n            data.name = groupCategory + \"_\" + ++subgroupIndexer[groupCategory];\n            data.validity.type = valueType;\n            data.reference = reference;\n            data.default = default_value;\n            data.optional = isOptional;\n            //\n            //if (s != undefined && previousSamples.length > 0) {\n            //  data.value = calculateAvg(s, data.name);\n            //}\n            //else\n            if (default_value !== undefined) {\n              data.value = Number(default_value);\n            }\n\n            dataModel.ds.data.push(data);\n          }\n\n        } else {\n          data.title = vName;\n          //data.screen = screenIndex;\n          data.group = \"\";\n          data.name = vName.toLocaleLowerCase();\n          data.validity.type = valueType;\n          data.optional = isOptional;\n\n          if (valueType == \"enum\") {\n            //enum\n            data.validity.options = value.descriptors;\n\n            //if (s != undefined && previousSamples.length > 0) {\n            //  data.value = calculateEnumAvg(s, data.name, value.descriptors, mode);\n            //}\n            //else\n            if (default_value !== undefined) {\n              data.value = default_value;\n            }\n\n          } else {\n            //range\n\n            //if (s != undefined && previousSamples.length > 0) {\n            //  data.value = calculateAvg(s, data.name);\n            //}\n            //else\n            if (default_value !== undefined) {\n              data.value = Number(default_value);\n            }\n\n            data.validity.percentage = isPercentage;\n\n            data.validity.range = value.descriptors;\n          }\n\n          dataModel.ds.data.push(data);\n        }\n      }\n    }\n\n    /**\n     * Eval the given options and set the corresponding parameters\n     * @param options\n     */\n    function evalOptions(options) {\n\n      if (options !== undefined) {\n\n        options.forEach(function (option) {\n\n          var opt = option.split(' ');\n\n          if (opt[0] === 'avg' || opt[0] === 'mode') {\n            mode = opt[0];\n            s = opt[1];\n          }\n\n          if (opt[0] === 'adjust') {\n            adjustedValue = opt[1];\n          }\n\n          if (opt[0] === 'percentage') {\n            isPercentage = true;\n          }\n\n          if (opt[0] === 'optional') {\n            isOptional = true;\n          }\n\n        });\n      }\n    }\n\n    /**\n     * Calculates the average of the given family value using s amount of previous samples\n     * @param s\n     * @param family\n     * @returns {number}\n     */\n    function calculateAvg(s, family) {\n\n      var total = 0;\n\n      previousSamples.sort(function (a, b) {\n        return (new Date(b.creationDate)).getTime() - (new Date(a.creationDate)).getTime()\n      });\n\n      for (var i = 0; i <= Math.min(s - 1, previousSamples.length - 1); i++) {\n        for (var j = 0; j <= previousSamples[i].properties.length - 1; j++) {\n          if (previousSamples[i].properties[j].family !== undefined && previousSamples[i].properties[j].family === family) {\n            total = total + previousSamples[i].properties[j].value;\n          }\n        }\n      }\n\n      return Math.round(total / (Math.min(s, previousSamples.length)));\n    }\n\n    /**\n     * Calculates the average of the given family value using s amount of previous samples\n     * @param s\n     * @param family\n     * @param descriptors\n     * @param mode\n     * @returns {*}\n     */\n    function calculateEnumAvg(s, family, descriptors, mode) {\n\n      var i = 0, j = 0, total = 0;\n      var totals = [];\n\n      previousSamples.sort(function (a, b) {\n        return (new Date(b.creationDate)).getTime() - (new Date(a.creationDate)).getTime()\n      });\n\n      //assign a value from 1 to descriptors.length to each enum list's member , then calculates the avg using this value\n      if (mode === 'avg') {\n\n        for (i = 0; i <= Math.min(s - 1, previousSamples.length - 1); i++) {\n          for (j = 0; j <= previousSamples[i].properties.length - 1; j++) {\n            if (previousSamples[i].properties[j].family !== undefined && previousSamples[i].properties[j].family === family) {\n              total = total + lodash.findIndex(descriptors, {\"value\": previousSamples[i].properties[j].value}) + 1;\n            }\n          }\n        }\n\n        return Math.round(total / (Math.min(s, previousSamples.length))) - 1;\n\n      }\n\n      //looks for the most used enum list's member\n      if (mode === 'mode') {\n\n        for (i = 0; i <= Math.min(s - 1, previousSamples.length - 1); i++) {\n          for (j = 0; j <= previousSamples[i].properties.length - 1; j++) {\n            if (previousSamples[i].properties[j].family !== undefined && previousSamples[i].properties[j].family === family) {\n              if (totals.map(function (e) {\n                  return e[0];\n                }).indexOf(previousSamples[i].properties[j].value) == -1) {\n                totals.push([previousSamples[i].properties[j].value, 1]);\n              }\n              else {\n                totals[totals.map(function (e) {\n                  return e[0];\n                }).indexOf(previousSamples[i].properties[j].value)][1]++;\n              }\n            }\n          }\n        }\n\n        totals.sort(function (a, b) {\n          return b[1] - a[1]\n        });\n        return lodash.findIndex(descriptors, {\"value\": totals[0][0]});\n\n      }\n\n    }\n\n    /**\n     * Adds an enum value\n     * @param value\n     * @param groupIndex\n     * @param groupCategory\n     * @param valueType\n     * @param reference\n     * @param default_value\n     * @param adjustedValue\n     * @param s\n     */\n    function addEnums(value, groupIndex, groupCategory, valueType, reference, default_value, adjustedValue, s) {\n      var data = angular.copy(dataObj);\n      data.title = value;\n      //data.screen = screenIndex;\n      data.group = groupCategory;\n      data.name = groupCategory + \"_\" + groupIndex;\n      data.validity.type = valueType;\n      data.reference = reference;\n      data.default = default_value;\n\n      //if (s != undefined && previousSamples.length > 0) {\n      //  data.value = calculateAvg(s, data.name);\n      //}\n      //else\n      if (default_value !== undefined) {\n        data.value = Number(default_value);\n      }\n\n      if (value === adjustedValue) {\n        data.adjusted = true;\n      }\n\n      dataModel.ds.data.push(data);\n    }\n\n  };\n\n  dataModel.getInitialStructure = function (product) {\n\n    this.dynamicDataStructure(product);\n    return dataModel.ds;\n  };\n\n  dataModel.clearDataModel = function () {\n    dataModel.ds = angular.copy(cleanDataModel);\n  };\n\n  return dataModel;\n}\n\n","angular\n  .module('ocf.services')\n  .service('InputValidationService', InputValidationService);\n\nInputValidationService.$inject = ['$rootScope'];\n\nfunction InputValidationService() {\n\n  var cs = this;\n\n  cs.isValidInputTag = isValidInputTag;\n  cs.isValidScannedTag = isValidScannedTag;\n  cs.setMask = setMask;\n  cs.setParameters = setParameters;\n  cs.removeMask = removeMask;\n  cs.isLongScan = isLongScan;\n  cs.isShortScan = isShortScan;\n  cs.tagMask = undefined;\n  cs.tagShortMask = undefined;\n  cs.tagValidFormat = undefined;\n\n  function setParameters(tagMask, tagShortMask, tagValidFormat) {\n    this.tagMask = tagMask;\n    this.tagShortMask = tagShortMask;\n    this.tagValidFormat = tagValidFormat;\n  }\n\n  function isValidInputTag(value) {\n\n    var isLongFormat = value && value.length == 24 && (value.indexOf(this.tagMask) == 0);\n    var isShortFormat = value && value.length == 8;\n\n    return (this.tagValidFormat == 'long' && isLongFormat) || (this.tagValidFormat == 'short' && isShortFormat)\n      || (this.tagValidFormat == 'short-long' && (isLongFormat || isShortFormat));\n  }\n\n  function isValidScannedTag(value) {\n\n    var isLongFormat = value && value.length == 24 && (value.indexOf(this.tagMask) == 0);\n    var isShortFormat = value && value.length == (8 + this.tagShortMask.length) && (value.indexOf(this.tagShortMask) == 0);\n\n    return (this.tagValidFormat == 'long' && isLongFormat) || (this.tagValidFormat == 'short' && isShortFormat)\n      || (this.tagValidFormat == 'short-long' && (isLongFormat || isShortFormat));\n  }\n\n  function setMask(value) {\n\n    var isScannedShortFormat = value && value.length == (8 + this.tagShortMask.length) && (value.indexOf(this.tagShortMask) == 0);\n    var isInputShortFormat = value && value.length == 8;\n\n    if(isInputShortFormat) {\n      return this.tagMask + value;\n    } else if(isScannedShortFormat) {\n      return this.tagMask + this.removeMask(value);\n    } else {\n      return value;\n    }\n  }\n\n  function removeMask(value) {\n    return value.substr(-8);\n  }\n\n  function isLongScan(value) {\n    return (value && value.length == 24 && (value.indexOf(this.tagMask) == 0));\n  }\n\n  function isShortScan(value) {\n    return (value && value.length == (8 + this.tagShortMask.length) && (value.indexOf(this.tagShortMask) == 0));\n  }\n\n  return cs;\n}\n","angular\n  .module('ocf.services')\n  .service('DataLayerService', DataLayerService);\n\nDataLayerService.$inject = ['$q', 'ConfigurationService', '$window', '$log', 'CouchDbConfig', '$rootScope', 'SessionService'];\n\nfunction DataLayerService($q, ConfigurationService, $window, $log, CouchDbConfig, $rootScope, SessionService) {\n\n  var dls = this;\n  var config = ConfigurationService.getLoggedUserConfig();\n  var coax = require(\"coax\");\n\n  dls.db = {};\n  dls.dbName = \"\";\n\n  var service = {\n    initialize: initialize,\n    getAllDocuments: getAllDocuments,\n    getDocument: getDocument,\n    addDocument: addDocument,\n    updateDocument: updateDocument,\n    removeDocument: removeDocument,\n    addAttachment: addAttachment,\n    getAttachment: getAttachment,\n    getLocalUrl: getLocalUrl,\n    removeAttachment: removeAttachment,\n    compact: compact,\n    purge: purge,\n    sync: sync,\n    stopSync: stopSync\n  };\n\n  return service;\n\n  function initialize() {\n    var q = $q.defer();\n    if (config && config.dbName) {\n      dls.dbName = config.dbName + $rootScope.user.id;\n\n      if (config.usePouchDB) {\n        if (angular.equals(dls.db, {}) || typeof dls.db !== \"undefined\") {\n          var adapter = $window.sqlitePlugin ? {adapter: 'websql'} : {};\n          dls.db = new PouchDB(config.dbName, adapter);\n\n          q.resolve();\n\n          //TODO: uncomment this to allow pouchDB sync with Sync Gateway NOT WORKING\n          //if(config.autoSync){\n          //  $log.debug(\"Sync enabled\");\n          //  sync();\n          //}\n        }\n      }\n      else {\n        function setupConfig(done) {\n          // check if CBLite is available\n          if (!$window.cblite) {\n            return done('Couchbase Lite not installed');\n          }\n\n          //get the CBL server url\n          cblite.getURL(function (err, url) {\n            if (err) {\n              return done(err);\n            }\n            //set the url for coax\n\n            url = url.replace('localhost', '127.0.0.1');\n\n            $window.server = coax(url);\n\n            var db = coax([url, dls.dbName]);\n            setupDb(db, function (err, info) {\n              if (err) {\n                return done(err);\n              }\n              dls.db = db;\n              config.localServerUrl = url;\n              config.localDbUrl = url + dls.dbName;\n              return done(null, info);\n            })\n          });\n\n          function setupDb(db, cb) {\n            db.get(function (err, res) {\n              //couldn't find the db, will try to create\n              if (err) {\n                if (err.status == 404) {\n                  db.put(function (err) {\n                    if (err) {\n                      return cb(err);\n                    }\n                    db.get(cb);\n                  })\n                }\n                else {\n                  //uncaptured error\n                  return cb(err);\n                }\n              }\n              else {\n                return cb(null, res);\n              }\n            })\n          }\n        }\n\n        setupConfig(function (err, info) {\n          if (err) {\n            return $log.debug(\"error: \" + JSON.stringify(err));\n          }\n          else {\n            $log.debug(\"Database created correctly\" + info);\n            q.resolve();\n\n            if (config.autoSync) {\n              $log.debug(\"Sync enabled\");\n              sync();\n            }\n          }\n        });\n      }\n    }\n    else {\n      $log.debug(\"error: could not initialize db\");\n      q.reject();\n    }\n    return q.promise;\n  }\n\n\n  function getAllDocuments() {\n    var q = $q.defer();\n    if (config.usePouchDB) {\n      dls.db.allDocs({include_docs: true})\n        .then(function (docs) {\n          $log.debug(\"All docs retreived\");\n          q.resolve(docs);\n        })\n        .catch(function (err) {\n          $log.debug(\"Error retreiving all docs\");\n          q.reject(err);\n        })\n    }\n    else {\n      dls.db.get(['_all_docs', {'include_docs': 'true'}], function (err, docs) {\n        if (!err) {\n          $log.debug(\"All docs retreived\");\n          q.resolve(docs);\n        }\n        else {\n          $log.debug(\"Error retreiving all docs\");\n          q.reject(err);\n        }\n      })\n    }\n\n    return q.promise;\n  }\n\n  function getDocument(documentId) {\n    var q = $q.defer();\n    dls.db.get(documentId, function (err, doc) {\n      if (!err) {\n        q.resolve(doc);\n      }\n      else {\n        q.reject(err);\n      }\n    });\n\n    return q.promise;\n  }\n\n  function addDocument(doc) {\n    var q = $q.defer();\n    dls.db.post(doc, function (err, ok) {\n      if (!err) {\n        $log.debug(\"Doc added: \" + ok);\n        q.resolve(ok.id);\n      }\n      else {\n        $log.debug(\"Error adding doc: \" + err);\n        q.reject(err);\n      }\n    });\n\n    return q.promise;\n  }\n\n  function updateDocument(doc) {\n    var q = $q.defer();\n    if (config.usePouchDB) {\n      getDocument(doc._id)\n        .then(function (DBdoc) {\n          return dls.db.put(doc, DBdoc._id, DBdoc._rev)\n        })\n        .then(function (success) {\n          $log.debug(\"Updating doc success: \" + success);\n          q.resolve(success);\n        })\n        .catch(function (err) {\n          $log.debug(\"Updating doc failure: \" + err);\n          q.reject(err);\n        })\n    }\n    else {\n      dls.db.put(doc._id, doc, function (err, ok) {\n        if (!err) {\n          $log.debug(\"Updating doc success: \" + ok);\n          q.resolve(ok);\n        }\n        else {\n          $log.debug(\"Updating doc failure: \" + err);\n          q.reject(err);\n        }\n      });\n    }\n    return q.promise;\n  }\n\n  function removeDocument(documentId) {\n    var q = $q.defer();\n    getDocument(documentId)\n      .then(function (doc) {\n        doc._deleted = true;\n        return updateDocument(doc);\n      })\n      .then(function (success) {\n        $log.debug(\"Removing doc success: \" + success);\n        q.resolve(success);\n      })\n      .catch(function (err) {\n        $log.debug(\"Removing doc failure: \" + err);\n        q.reject(err);\n      });\n\n    return q.promise;\n  }\n\n  function addAttachment(documentId, attachment) {\n    var q = $q.defer();\n    dls.db.get(documentId, function (err, doc) {\n      doc._attachments = attachment;\n      doc.last_revision = new Date().getTime();\n\n      dls.db.put(documentId, doc, function (err, ok) {\n        if (!err) {\n          $log.debug(\"Adding attachment success: \" + ok);\n          q.resolve();\n        }\n        else {\n          $log.debug(\"Adding attachment failure: \" + err);\n          q.reject(err);\n        }\n      })\n    });\n    return q.promise;\n  }\n\n  function getAttachment(documentId) {\n    var q = $q.defer();\n    dls.db.get([documentId, {\"attachments\": \"true\"}], function (err, doc) {\n      if (!err) {\n        $log.debug(\"Retrieving attachment success: \" + doc);\n        q.resolve(doc._attachments.attachment.data);\n        //q.resolve(doc);\n      }\n      else {\n        $log.debug(\"Retrieving attachment failure: \" + err);\n        q.reject(err);\n      }\n    });\n    return q.promise;\n  }\n\n  function getLocalUrl() {\n    return config.localDbUrl || \"\";\n  }\n\n  function removeAttachment(documentId, attachmentName) {\n    var q = $q.defer();\n    dls.db.get(documentId, function (err, doc) {\n      if (!err) {\n        delete doc._attachments[attachmentName];\n        updateDocument(doc)\n          .then(function (success) {\n            $log.debug(\"Removing attachment success: \" + success);\n            q.resolve();\n          })\n          .catch(function (error) {\n            $log.debug(\"Removing attachment failure: \" + success);\n            q.reject(error);\n          })\n      }\n      else {\n        q.reject(err);\n      }\n    });\n    return q.promise;\n  }\n\n  function compact() {\n    var q = $q.defer();\n\n    if (config.usePouchDB) {\n      dls.db.compact().then(function (info) {\n        $log.debug('Compact result: ' + info.toString());\n        q.resolve(info);\n      }).catch(function (err) {\n        $log.debug('Compact failed: ' + err.toString());\n        q.reject(err);\n      });\n    }\n    else {\n      dls.db.post(['_compact'], function (err, ok) {\n        if (!err) {\n          $log.debug('Compact result: ' + ok);\n          q.resolve(ok);\n        }\n        else {\n          $log.debug('Compact failed: ' + err);\n          q.reject(err);\n        }\n      })\n    }\n\n    return q.promise;\n  }\n\n  function purge() {\n    var q = $q.defer();\n    if (!config.usePouchDB) {\n      dls.db.post(['_purge'], function (err, ok) {\n        if (!err) {\n          $log.debug('Purge result: ' + ok);\n          q.resolve(ok);\n        }\n        else {\n          $log.debug('Purge failed: ' + err);\n          q.reject(err);\n        }\n      })\n    }\n    else {\n      $log.debug(\"Purge not available in PouchDB\");\n      q.reject(\"Purge not available in PouchDB\");\n    }\n\n    return q.promise;\n  }\n\n  function sync() {\n\n    if (config.usePouchDB && dls.db.prefix && dls.db.prefix == \"_pouch_\") {\n      if (config.replicateToCouchDB) {\n\n        //TODO: once the login is in place, there should be a cookie to use for authentication\n        var cHost = CouchDbConfig.host.split(\"//\");\n        var cdb = cHost[0] + \"//\" + config.username + \":\" + config.password + \"@\" + cHost[1];\n\n        //TODO: once the login is in place, set the correct replication target\n        dls.db.replicate.to(cdb + \"lotqc_\" + config.organizationId,\n          {\n            live: true\n          }).on('error', function (err) {\n          $log.debug(\"Error replicating to CouchDB: \" + err);\n        });\n      }\n      else {\n        //TODO: once the login is in place, verify the replication parameters\n        dls.db.sync(config.syncUrl, {live: true}).on('error', function (err) {\n          $log.debug(\"Error replicating to SG: \" + err);\n        });\n      }\n    }\n    else {\n      triggerSync(function (res) {\n        $log.debug(\"Synced:\" + res);\n      })\n    }\n\n    function triggerSync(cb) {\n\n      var push = {\n        source: {\n          url: dls.dbName\n        },\n        target: {\n          url: config.syncUrl,\n          \"headers\": {\n            \"Cookie\": 'SyncGatewaySession=' + SessionService.getZestSessionId()\n          }\n        },\n        continuous: true\n      };\n      var pull = {\n        target: dls.dbName,\n        source: {\n          url: config.syncUrl,\n          \"headers\": {\n            \"Cookie\": 'SyncGatewaySession=' + SessionService.getZestSessionId()\n          }\n        },\n        continuous: true\n      };\n\n      dls.pushSync = syncManager(config.localServerUrl, push);\n      dls.pullSync = syncManager(config.localServerUrl, pull);\n\n      //push sync catchs\n      dls.pushSync.on(\"error\", function (err) {\n        $log.debug(err);\n      });\n      dls.pushSync.on(\"connected\", function () {\n        dls.pullSync.start();\n      });\n\n      //pull sync catchs\n      dls.pullSync.on(\"error\", function (err) {\n        $log.debug(err);\n      });\n      dls.pullSync.on(\"connected\", function () {\n        cb(true);\n      });\n      // setTimeout(function(){\n      dls.pushSync.start();\n      // }, 10000)\n    }\n\n    function syncManager(serverUrl, syncDefinition) {\n      var handlers = {};\n\n      function callHandlers(name, data) {\n        (handlers[name] || []).forEach(function (h) {\n          h(data);\n        })\n      }\n\n      function doCancelPost(cb) {\n        var cancelDef = JSON.parse(JSON.stringify(syncDefinition));\n        cancelDef.cancel = true;\n        coax.post([serverUrl, \"_replicate\"], cancelDef, function (err, info) {\n          if (err) {\n            callHandlers(\"error\", err);\n            if (cb) {\n              cb(err, info);\n            }\n          } else {\n            callHandlers(\"cancelled\", info);\n            if (cb) {\n              cb(err, info);\n            }\n          }\n        })\n      }\n\n      function doStartPost() {\n        var tooLate;\n\n        function pollForStatus(info, wait) {\n          if (wait) {\n            setTimeout(function () {\n              tooLate = true;\n            }, wait)\n          }\n          processTaskInfo(info.session_id, function (done, err) {\n            if (!done && !tooLate) {\n              setTimeout(function () {\n                pollForStatus(info);\n              }, 5000)\n            } else if (tooLate) {\n              callHandlers(\"error\", \"timeout\");\n            }\n          })\n        }\n\n        var callBack;\n        if (syncDefinition.continuous) {\n          callBack = function (err, info) {\n            //$log.debug(\"continuous sync callBack\", err, info, syncDefinition);\n            if (err) {\n              callHandlers(\"error\", err);\n            } else {\n              pollForStatus(info, 10000);\n              callHandlers(\"started\", info);\n            }\n          }\n        } else { // non-continuous\n          callBack = function (err, info) {\n            //$log.debug(\"sync callBack\", err, info, syncDefinition);\n            if (err) {\n              if (info.status == 401) {\n                err.status = info.status;\n                callHandlers(\"auth-challenge\", err);\n              } else {\n                err.status = info.status;\n                callHandlers(\"error\", err);\n              }\n            } else {\n              callHandlers(\"connected\", info);\n            }\n\n          }\n        }\n        //$log.debug(\"start sync\" + JSON.stringify(syncDefinition));\n        coax.post([serverUrl, \"_replicate\"], syncDefinition, callBack);\n      }\n\n      function processTaskInfo(id, cb) {\n        taskInfo(id, function (err, task) {\n          if (err) {\n            return cb(true, err);\n          }\n          //check that the task exists\n          else if (angular.equals(task, {})) {\n            return cb(true, \"no task\");\n          }\n\n          publicAPI.task = task;\n          if (task.error && task.error[0] == 400) {\n            cb(true, task.error);\n            callHandlers(\"error\", {status: 400, error: task.error[1]})\n          } else if (task.error && task.error[0] == 401) {\n            cb(true, task.error);\n            callHandlers(\"auth-challenge\", {status: 401, error: task.error[1]})\n          } else if (task.error && task.error[0] == 502) {\n            cb(true, task.error);\n            callHandlers(\"auth-challenge\", {status: 502, error: task.error[1]})\n          } else if (task.status == \"Idle\" || task.status == \"Stopped\" || (/Processed/.test(task.status) && !/Processed 0/.test(task.status))) {\n            cb(true);\n            callHandlers(\"connected\", task)\n          } else if (/Processed 0 \\/ 0 changes/.test(task.status)) {\n            cb(false); // keep polling? (or does this mean we are connected?)\n            //cb(true)\n            callHandlers(\"connected\", task)\n          } else {\n            $log.debug(\"not done\")\n            cb(false); // not done\n          }\n\n\n        })\n      }\n\n      function taskInfo(id, cb) {\n        //get the active tasks (replications processes alive)\n        coax([serverUrl, \"_active_tasks\"], function (err, tasks) {\n          var me = {};\n          for (var i = tasks.length - 1; i >= 0; i--) {\n            if (tasks[i].task == id) {\n              me = tasks[i];\n            }\n          }\n          cb(false, me);\n        })\n      }\n\n      var publicAPI = {\n        start: doStartPost,\n        cancel: doCancelPost,\n        on: function (name, cb) {\n          handlers[name] = handlers[name] || [];\n          handlers[name].push(cb);\n        }\n      };\n      return publicAPI;\n    }\n  }\n\n  function stopSync() {\n    if (dls.pullSync && dls.pushSync) {\n      dls.pullSync.cancel();\n      dls.pushSync.cancel();\n    }\n  }\n\n}\n","angular\n  .module('ocf.services')\n  .service('ConfigurationService', ConfigurationService);\n\nConfigurationService.$inject = ['$rootScope', 'CouchBaseConfig', 'URLManager', 'EnvironmentConfig'];\n\nfunction ConfigurationService($rootScope, CouchBaseConfig, URLManager, EnvironmentConfig) {\n\n  var cs = this;\n\n  cs.getLoggedUserConfig = getLoggedUserConfig;\n  cs.setLoggedUserConfig = setLoggedUserConfig;\n\n  function setLoggedUserConfig(userId, configObject) {\n    //TODO\n  }\n\n  function getLoggedUserConfig() {\n    //TODO: return a real config\n    /*********************************************************************************\n    /* WARNING, CBLite databases names should always begin with a lowercase letter  **\n    *********************************************************************************/\n    return {\n      \"dbName\": \"user_\",\n      \"syncUrl\": CouchBaseConfig.host + CouchBaseConfig.name, //sync gateway url\n      \"usePouchDB\": true,\n      \"autoSync\": true,\n      \"tagMask\": ['330C4DE261100280']\n    };\n  }\n\n\n\n  return cs;\n}\n","angular\n  .module('ocf.controllers',[])\n  .config(ConfigureHomeController);\n\nConfigureHomeController.$inject = ['$stateProvider'];\n\nfunction ConfigureHomeController($stateProvider) {\n  $stateProvider\n    .state('ocf.home', {\n      url: \"/home\",\n      views: {\n        \"ocf\": {\n          controller: 'HomeController',\n          templateUrl: 'home/ocfHome.html'\n        }\n      },\n      resolve: {},\n      data: {}\n    })\n  ;\n}\n","angular\n  .module('ocf.controllers')\n  .config(ConfigureLocationSelecion);\n\nConfigureLocationSelecion.$inject = ['$stateProvider'];\n\n/**\n * Apps states/routes definition\n * @param $stateProvider\n */\nfunction ConfigureLocationSelecion($stateProvider) {\n  $stateProvider\n    .state('ocf.locationSelector', {\n      url: '/locationSelector',\n      views: {\n        \"ocf\": {\n          controller: 'LocationSelectorController',\n          templateUrl: 'commons/LocationSelector/locationSelector.html'\n        }\n      }\n    })\n  ;\n}\n","angular\r\n  .module('ocf.controllers')\r\n  .controller('LocationSelectorController', LocationSelectorController);\r\n\r\nLocationSelectorController.$inject = [\r\n  '$scope',\r\n  'SessionService',\r\n  'navigateTo',\r\n  '$rootScope',\r\n  'lodash',\r\n  '$log',\r\n  'LoggingService',\r\n  '$translate',\r\n  'LoadingService'\r\n];\r\n\r\nfunction LocationSelectorController($scope,\r\n                                    SessionService,\r\n                                    navigateTo,\r\n                                    $rootScope,\r\n                                    _,\r\n                                    $log,\r\n                                    LoggingService,\r\n                                    $translate,\r\n                                    LoadingService) {\r\n  $scope.locations = SessionService.getUserLocations($rootScope.user.id);\r\n\r\n  $scope.loadingMessage = \"loading\";\r\n\r\n  $scope.$on('$ionicView.beforeEnter', function () {\r\n    $log.debug('Location Selector - $ionicView.beforeEnter');\r\n\r\n    $translate('OCF.MESSAGES.LOADING').then(function (result) {\r\n      $scope.loadingMessage = result;\r\n    });\r\n\r\n    LoggingService.logMessage(\r\n      LoggingService.CONSTANTS.APP.OCF_LOGIN,\r\n      LoggingService.CONSTANTS.CONTEXT.LOCATION_CONTROLLER,\r\n      'entering_location_screen',\r\n      'Location screen displayed',\r\n      'success',\r\n      {}\r\n    );\r\n\r\n    var locationSelected = _.find($scope.locations, {selected: true});\r\n\r\n    if (!locationSelected) {\r\n      $scope.locations[0].selected = true;\r\n    }\r\n\r\n    $scope.checkDevice = !!$rootScope.ocfConfigs.filterAppListByDeviceModel;\r\n\r\n    if ($scope.locations.length == 1) {\r\n      $scope.selectLocation();\r\n    }\r\n\r\n  });\r\n\r\n  $scope.selectLocation = function () {\r\n    LoadingService.show($scope.loadingMessage);\r\n    $rootScope.selectedLocation = _.find($scope.locations, {\"selected\": true});\r\n\r\n    $scope.subApps = [\r\n      {\r\n        appName: \"Shipping\",\r\n        appCacheName: 'G10',\r\n        supportedDevice: /^TC7.+/\r\n      },\r\n      {\r\n        appName: \"PutAway\",\r\n        appCacheName: 'G04',\r\n        supportedDevice: /^MC92N0$/\r\n      }\r\n    ];\r\n\r\n    var supplierApps = [];\r\n\r\n    _.remove($scope.subApps, function (app) {\r\n      return !_.find($rootScope.appsList, {\"appName\": app.appCacheName});\r\n    });\r\n\r\n    supplierApps =_.map($scope.subApps, 'appCacheName');\r\n\r\n    $rootScope.apps = _.filter($rootScope.selectedLocation.appLocations, function (app) {\r\n      return supplierApps.indexOf(app.application) != -1;\r\n    });\r\n\r\n    _.forEach($rootScope.apps, function (app, index) {\r\n      var subApp = _.find($scope.subApps, {\"appCacheName\": app.application});\r\n      $rootScope.apps[index].supportedDevice = subApp.supportedDevice;\r\n    });\r\n\r\n    if (!$scope.deviceModel && window.device){\r\n      $scope.deviceModel = window.device.model;\r\n    }\r\n\r\n    // Filters app that do not belong to the current Device\r\n    if ($scope.deviceModel && $scope.checkDevice) _.remove($rootScope.apps, function (app) {\r\n      var isValidApp = new RegExp(app.supportedDevice);\r\n      return !$scope.deviceModel.match(isValidApp);\r\n    });\r\n\r\n    if ($rootScope.apps.length != 1) {\r\n      if ($rootScope.apps.length) {\r\n        $log.debug('Location Selector - More than an app, going to app selection screen', JSON.stringify($rootScope.apps));\r\n        navigateTo.home();\r\n      } else {\r\n        $log.debug('Location Selector - No apps available');\r\n        $scope.userLogout();\r\n      }\r\n    } else {\r\n      var availableApp = $rootScope.apps[0];\r\n      var appIndex = _.findIndex($scope.subApps, {\"appCacheName\": availableApp.application});\r\n\r\n      if (appIndex == -1) {\r\n        $log.debug('Location Selector - No valid app available for the current user');\r\n        $scope.userLogout();\r\n\r\n      } else {\r\n        $scope.subApps[appIndex].selected = true;\r\n        $rootScope.app = angular.copy($scope.subApps[appIndex]);\r\n        $rootScope.app.appCacheName = $rootScope.app.appCacheName.toUpperCase();\r\n        $rootScope.isPilot = $rootScope.app.appName == \"Shipping\";\r\n        $rootScope.appLocationId = availableApp.idUUID;\r\n\r\n        LoggingService.logMessage(\r\n          LoggingService.CONSTANTS.APP.OCF_LOGIN,\r\n          LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\r\n          'auto_select_location',\r\n          'Only one location, skipping screen',\r\n          'success',\r\n          [{'key': 'location', 'value': JSON.stringify($rootScope.selectedLocation)}]\r\n        );\r\n\r\n        navigateTo[availableApp.application.toLowerCase()]();\r\n      }\r\n    }\r\n\r\n    LoggingService.logMessage(\r\n      LoggingService.CONSTANTS.APP.OCF_LOGIN,\r\n      LoggingService.CONSTANTS.CONTEXT.LOCATION_CONTROLLER,\r\n      'location_selection',\r\n      'Selected location',\r\n      'success',\r\n      [{'key': 'location', 'value': JSON.stringify($rootScope.selectedLocation)}]\r\n    );\r\n  };\r\n\r\n  $scope.selectListLocationItem = function (item, list) {\r\n    for (var i = 0; i < list.length; i++) {\r\n      if (list[i] == item) {\r\n        if (!list[i].selected) {\r\n          list[i].selected = true;\r\n        }\r\n      }\r\n      else {\r\n        list[i].selected = false;\r\n      }\r\n    }\r\n  };\r\n}\r\n","/**\r\n * Created by FMG on 10/03/2016.\r\n */\r\nangular\r\n  .module('limitStringFilter', [])\r\n  .filter(\"limitString\", function () {\r\n    return LimitString\r\n  });\r\n\r\n\r\n/**\r\n * Returns the input value shrunken up to 'limit', counting from right.\r\n * @return {string}\r\n */\r\nfunction LimitString(input, limit) {\r\n  var inputString = input + \"\"; // cast to string\r\n  var prepend = \"&hellip;\";\r\n  var inputLength = inputString.length;\r\n  var outputString = inputString;\r\n\r\n  limit = limit.toString();\r\n\r\n  if (limit.indexOf(\"-\") != -1) {\r\n    var formatter = limit.split(\"-\");\r\n    limit = formatter[0];\r\n    prepend = formatter[1];\r\n  }\r\n\r\n  if (inputLength > limit) {\r\n    return prepend + inputString.substring(inputLength - limit, inputLength);\r\n  }\r\n\r\n  return outputString;\r\n\r\n}\r\n","/**\n  * Created by FMG on 11/03/2016.\n  */\nangular\n  .module('ocf.services')\n  .service('NoConnectivityPopupService', NoConnectivityPopupService);\n\nNoConnectivityPopupService.$inject = [\n  '$q',\n  '$ionicModal',\n  'lodash',\n  '$log',\n  '$rootScope',\n  '$timeout',\n  '$ionicBackdrop',\n  '$translate'\n];\n\nfunction NoConnectivityPopupService($q,\n                                    $ionicModal,\n                                    lodash,\n                                    $log,\n                                    $rootScope,\n                                    $timeout,\n                                    $ionicBackdrop,\n                                    $translate) {\n  var asps = this;\n\n  asps.close = close;\n  asps.retry = retry;\n  asps.create = create;\n  asps.destroy = destroy;\n  asps.open = open;\n  asps.isShown = isShown;\n\n\n  asps.noConnectivity = undefined;\n  asps.noConnectivityTemplate = 'noConnectivityPopUp/noConnectivityPopup.html';\n  asps.noConnectivityPopupOptions = {\n    animation: 'none',\n    focusFirstInput: false,\n    backdropClickToClose: false,\n    hardwareBackButtonClose: false\n  };\n\n  return asps;\n\n  ////////////////////\n  /**\n   * Closes the popup\n   */\n  function close() {\n    asps.noConnectivity.hide();\n    $timeout(function() {\n      $ionicBackdrop.release();\n      $('body').removeClass('modal-open');\n    }, 1000);\n    $rootScope.$broadcast('noConnectivityClose', true);\n    $log.debug(\"No Connectivity Close button clicked\");\n  }\n\n\n  /**\n   * Confirm button clicked\n   */\n  function retry() {\n    asps.noConnectivity.hide();\n    $timeout(function() {\n      $ionicBackdrop.release();\n      $('body').removeClass('modal-open');\n    }, 1000);\n    $rootScope.$broadcast('noConnectivityRetry', true);\n    $log.debug(\"No Connectivity retry button clicked\");\n  }\n\n\n  /**\n   * Creates template and stores the pointer to it\n   * @param template {String}\n   * @param {Object} [options]\n   */\n  function create(template, options) {\n    var q = $q.defer();\n    template = template || asps.noConnectivityTemplate;\n\n    if (options) {\n      lodash.merge(asps.noConnectivityPopupOptions, options);\n    }\n\n    $ionicModal.fromTemplateUrl(template, asps.noConnectivityPopupOptions)\n      .then(function (popup) {\n        $log.debug(\"No Connectivity Popup created\", popup);\n        asps.noConnectivity = popup;\n        q.resolve(\"Popup Created\");\n      })\n      .catch(function (fail) {\n        $log.error(\"No Connectivity Popup failed to load\", fail);\n        q.reject(fail);\n      });\n\n    return q.promise;\n  }\n\n\n  /**\n   * Removes popup from DOM\n   */\n  function destroy() {\n    $timeout(function() {\n      $ionicBackdrop.release();\n    }, 1000);\n    asps.noConnectivity.remove();\n    $log.debug(\"No Connectivity removed from DOM\");\n  }\n\n\n  /**\n   * Called when open is needed\n   */\n  function open() {\n    $timeout(function() {\n      asps.noConnectivity.show();\n      $ionicBackdrop.retain();\n    }, 1000);\n    $log.debug(\"No Connectivitye Open button clicked\");\n  }\n\n  function isShown() {\n    return  asps.noConnectivity.isShown();\n  }\n}\n","angular\n  .module('ocf.controllers')\n  .controller('HomeController', HomeController);\n\nHomeController.$inject = [\n  'SessionService',\n  'navigateTo',\n  '$rootScope',\n  '$scope',\n  '$ionicPlatform',\n  '$log',\n  'lodash',\n  'LoggingService',\n  '$ionicViewSwitcher',\n  '$ionicSideMenuDelegate',\n  '$translate',\n  'LoadingService'\n];\n\nfunction HomeController(SessionService,\n                        navigateTo,\n                        $rootScope,\n                        $scope,\n                        $ionicPlatform,\n                        $log,\n                        _,\n                        LoggingService,\n                        $ionicViewSwitcher,\n                        $ionicSideMenuDelegate,\n                        $translate,\n                        LoadingService) {\n  $scope.goToPreviousState = goToPreviousState;\n  var deregisterGoToPreviousState;\n  $scope.loadingMessage = \"loading\";\n  $scope.$on('$ionicView.beforeEnter', function () {\n    LoadingService.hide();\n  });\n\n\n  $scope.$on('$ionicView.beforeEnter', function () {\n\n    $translate('OCF.MESSAGES.LOADING').then(function (result) {\n      $scope.loadingMessage = result;\n    });\n\n    $scope.checkDevice = !!$rootScope.ocfConfigs.filterAppListByDeviceModel;\n\n    deregisterGoToPreviousState = $ionicPlatform.registerBackButtonAction(goToPreviousState, 501);\n\n    $rootScope.app = null;\n    $rootScope.isPilot = false;\n\n    $scope.locations = SessionService.getUserLocations($rootScope.user.id);\n    $scope.hideBackButton = $scope.locations.length == 1;\n    $scope.subApps = [\n      {\n        appName: \"Shipping\",\n        appCacheName: 'G10',\n        selected: false\n      },\n      {\n        appName: \"Put Away\",\n        appCacheName: 'G04',\n        selected: false\n      }\n    ];\n\n    var appPosition = _.findIndex($scope.subApps, {\"appCacheName\": $rootScope.lastApp});\n\n    if (appPosition == -1) {\n      $scope.subApps[0].selected = true;\n    } else {\n      $scope.subApps[appPosition].selected = true;\n    }\n\n    var supplierApps = [];\n\n    _.remove($scope.subApps, function (app) {\n      return !_.find($rootScope.appsList, {\"appName\": app.appCacheName});\n    });\n\n    supplierApps =_.map($scope.subApps, 'appCacheName');\n\n    $rootScope.apps = _.filter($rootScope.selectedLocation.appLocations, function (app) {\n      return supplierApps.indexOf(app.application) != -1;\n    });\n\n    _.forEach($rootScope.apps, function (app, index) {\n      var subApp = _.find($scope.subApps, {\"appCacheName\": app.application});\n      $rootScope.apps[index].supportedDevice = subApp.supportedDevice;\n    });\n\n    if (!$scope.deviceModel && window.device){\n      $scope.deviceModel = window.device.model;\n    }\n\n    // Filters app that do not belong to the current Device\n    if ($scope.deviceModel && $scope.checkDevice) _.remove($rootScope.apps, function (app) {\n      var isValidApp = new RegExp(app.supportedDevice);\n      return !$scope.deviceModel.match(isValidApp);\n    });\n\n    if ($rootScope.apps.length == 1) {\n      var availableApp = $rootScope.apps[0];\n      var appIndex = _.findIndex($scope.subApps, {\"appCacheName\": availableApp.application});\n      $scope.subApps[appIndex].selected = true;\n      $rootScope.app = angular.copy($scope.subApps[appIndex]);\n      $rootScope.app.appCacheName = $rootScope.app.appCacheName.toUpperCase();\n      $rootScope.isPilot = $rootScope.app.appName == \"Shipping\";\n      $rootScope.appLocationId = availableApp.idUUID;\n\n      LoggingService.logMessage(\n        LoggingService.CONSTANTS.APP.OCF_LOGIN,\n        LoggingService.CONSTANTS.CONTEXT.OCF_APP_SELECTOR,\n        'auto_select_application',\n        'Only one application, skipping screen',\n        'success',\n        [{'key': 'application', 'value': JSON.stringify(availableApp)}]\n      );\n\n      navigateTo[availableApp.application.toLowerCase()]();\n    }\n  });\n\n  $scope.$on('$ionicView.beforeLeave', function () {\n    $log.debug('$ionicView.beforeLeave');\n    $ionicPlatform.offHardwareBackButton(goToPreviousState);\n  });\n\n  $scope.selectApp = function () {\n\n    LoadingService.show($scope.loadingMessage);\n\n    $rootScope.app = _.find($scope.subApps, {\"selected\": true});\n\n    var availableApp = _.find($rootScope.selectedLocation.appLocations, {\"application\": $rootScope.app.appCacheName});\n    $rootScope.app.appCacheName = $rootScope.app.appCacheName.toUpperCase();\n    $rootScope.isPilot = $rootScope.app.appName == \"Shipping\";\n    $rootScope.appLocationId = availableApp.idUUID;\n    $rootScope.lastApp = $rootScope.app.appCacheName;\n    LoggingService.logMessage(\n      LoggingService.CONSTANTS.APP.OCF_LOGIN,\n      LoggingService.CONSTANTS.CONTEXT.OCF_APP_SELECTOR,\n      'auto_select_application',\n      'Only one application, skipping screen',\n      'success',\n      [{'key': 'application', 'value': JSON.stringify(availableApp)}]\n    );\n\n    navigateTo[availableApp.application.toLowerCase()]();\n  };\n\n  $scope.selectListAppItem = function (item, list) {\n    for (var i = 0; i < list.length; i++) {\n      if (list[i] == item) {\n        if (!list[i].selected) {\n          list[i].selected = true;\n        }\n      } else {\n        list[i].selected = false;\n      }\n    }\n  };\n\n  $scope.$on('$destroy', function () {\n    $log.debug(\"$destroy\");\n    deregisterGoToPreviousState();\n  });\n\n  /**\n   * Function that overrides the hardware back button behavior\n   */\n  function goToPreviousState() {\n    $ionicViewSwitcher.nextDirection('back');\n\n    if ($ionicSideMenuDelegate.isOpen()) {\n      $ionicSideMenuDelegate.toggleRight(false);\n    }\n  }\n}\n\n","/**\n * Created by FMG on 11/03/2016.\n */\nangular\n  .module('ocf.services')\n  .service('AutoLogoutPopupService', AutoLogoutPopupService);\n\nAutoLogoutPopupService.$inject = ['$q', '$ionicModal', 'lodash', '$log', '$rootScope', '$ionicBackdrop', '$window'];\n\nfunction AutoLogoutPopupService($q, $ionicModal, lodash, $log, $rootScope, $ionicBackdrop, $window) {\n  var asps = this;\n\n  asps.close = close;\n  asps.create = create;\n  asps.destroy = destroy;\n  asps.open = open;\n  asps.isShown = isShown;\n\n  asps.autoLogout = undefined;\n  asps.autoLogoutTemplate = 'autoLogoutPopUp/autoLogoutPopup.html';\n  asps.autoLogoutPopupOptions = {\n    animation: 'none',\n    focusFirstInput: false,\n    backdropClickToClose: false,\n    hardwareBackButtonClose: false\n  };\n\n  return asps;\n\n  ////////////////////\n  /**\n   * Closes the popup\n   */\n  function close() {\n    asps.autoLogout.remove();\n    $ionicBackdrop.release();\n    $rootScope.$broadcast('autoLogoutClose', true);\n\n    $window.localStorage.setItem('sessionExpired', 'false');\n  }\n\n  /**\n   * Creates template and stores the pointer to it\n   * @param template {String}\n   * @param {Object} [options]\n   */\n  function create(template, options) {\n    var q = $q.defer();\n    template = template || asps.autoLogoutTemplate;\n\n    if (options) {\n      lodash.merge(asps.autoLogoutPopupOptions, options);\n    }\n\n    $ionicModal.fromTemplateUrl(template, asps.autoLogoutPopupOptions)\n      .then(function (popup) {\n        $log.debug(\"AutoLogout Popup created\", popup);\n        asps.autoLogout = popup;\n        q.resolve(\"Popup Created\");\n      })\n      .catch(function (fail) {\n        $log.error(\"AutoLogout Popup failed to load\", fail);\n        q.reject(fail);\n      });\n\n    return q.promise;\n  }\n\n  /**\n   * Removes popup from DOM\n   */\n  function destroy() {\n    asps.autoLogout.remove();\n    $log.debug(\"AutoLogout removed from DOM\");\n  }\n\n  /**\n   * Called when open is needed\n   */\n  function open() {\n    asps.autoLogout.show();\n    $ionicBackdrop.retain();\n    $log.debug(\"AutoLogout Open button clicked\");\n  }\n\n  function isShown() {\n    return asps.autoLogout.isShown();\n  }\n}\n","angular.module('ocf.services', ['toaster'])\r\n  //\r\n  //.factory('DocumentService', function (SessionService, $rootScope) {\r\n  //\r\n  //\r\n  //  //TODO:set app and type\r\n  //  var baseDocument = {\r\n  //    _id: '', // string\r\n  //    author: '', // string\r\n  //    creationDate: '', // timestamp\r\n  //    lastUpdate: '', // timestamp\r\n  //    type: '', // string lotqc\r\n  //    appName: '', // string LotQC\r\n  //    organizationId: '', // int\r\n  //    locationId: '', // 1546 <-- comes in the configuration document (PH Location)\r\n  //    lastVersion: '', // int 1\r\n  //    content: {},\r\n  //    _deleted: false\r\n  //  };\r\n  //  var document = this;\r\n  //\r\n  //  document.createId = function (docId, docType, appName) {\r\n  //    var user = $rootScope.user;\r\n  //    var sessionID = SessionService.sessionID().sessionId;\r\n  //\r\n  //    return appName + \"_\" + docType + \"_\" + docId + \"_\" + user.username + \"-\" + sessionID;\r\n  //  };\r\n  //\r\n  //  document.createDocument = function (doc, docType, appName) {\r\n  //    var configObject = SessionService.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId, appName);\r\n  //    var newDocument = this.baseDocument();\r\n  //    var user = $rootScope.user;\r\n  //\r\n  //    newDocument._id = this.createId(docType,appName);\r\n  //    newDocument.author = user.username;\r\n  //    newDocument.content = angular.copy(doc);\r\n  //    newDocument.creationDate = new Date().getTime();\r\n  //    newDocument.lastUpdate = newDocument.creationDate;\r\n  //    newDocument.lastVersion = 1;\r\n  //    newDocument.organizationId = user.organizationId;\r\n  //    newDocument.type = docType;\r\n  //    newDocument.appName = appName;\r\n  //    newDocument.locationId = $rootScope.selectedLocation.locationId;\r\n  //\r\n  //    return newDocument;\r\n  //  };\r\n  //\r\n  //  document.baseDocument = function () {\r\n  //    return angular.copy(baseDocument);\r\n  //  };\r\n  //\r\n  //  document.generateDocId = function(docType,appName) {\r\n  //    return appName + '_' + docType + '_01';\r\n  //  }\r\n  //\r\n  //  return document;\r\n  //})\r\n\r\n\r\n  .factory('URLManager', function ($location, EnvironmentConfig, CouchDbConfig, OCFConfig, StagingConfig, PutAwayConfig) {\r\n    var environmentHost = EnvironmentConfig.host + EnvironmentConfig.apiPath;\r\n    var ocfHost = OCFConfig.host + OCFConfig.apiPath + OCFConfig.servicePath;\r\n    //var couchDbHost = CouchDbConfig.host;\r\n    var stagingConfig = StagingConfig.host + StagingConfig.apiPath;\r\n    var putAwayConfig = PutAwayConfig.host + PutAwayConfig.apiPath;\r\n\r\n    var resources = {\r\n      session: environmentHost + 'authentication/session',\r\n      //sessionID: ocfHost + 'application/getSessionId/:userID',\r\n      //couchDbSession: couchDbHost + '_session',\r\n      //initialConfig: ocfHost + \"application/load/:appId/:locationId\",\r\n      applications: ocfHost + \"application/access\",\r\n      //couchDbUser: couchDbHost + \"_users/org.couchdb.user\",\r\n      //tagProcess: environmentHost + 'resources/e20receiving/:tagEpc',\r\n      //tagInfo: environmentHost + 'resources/product_profile/produceProfileIdByEPC/:tagEpc',\r\n      //binInfo: environmentHost + 'resources/tag/tagType/:tagEpc',\r\n      ocfConfigurations: ocfHost + 'application/ocf/configurations',\r\n      passwordChange: environmentHost + 'resources/password_change/:organizationId',\r\n      passwordRecover: environmentHost + 'resources/password_recover',\r\n      todayOrders: stagingConfig + 'resource/staging/order/:packhouseId/:appLocationId/:isRefresh',\r\n      selectOrders: stagingConfig + 'resource/staging/selectedOrders',\r\n      getSelectedOrders: stagingConfig + 'resource/staging/product/order/:packhouseId/:appLocationId/:isRefresh',\r\n      closeOrder: stagingConfig + 'resource/staging/order/close/:packhouseId/:appLocationId/:orderId',\r\n      removePallet: stagingConfig + 'resource/staging/pallet/remove/:packhouseId/:appLocationId/:tagEpc/:reason',\r\n      assignPallet: stagingConfig + 'resource/staging/pallet/assign/:packhouseId/:appLocationId/:tagEpc/:assignRemovedPallet',\r\n      unassignPallet: stagingConfig + 'resource/staging/pallet/unassign',\r\n      overridePallet: stagingConfig + 'resource/staging/pallet/override/:packhouseId/:appLocationId/:tagEpc/:orderId',\r\n      stagingConfiguration: stagingConfig + 'resource/staging/configuration',\r\n      pallet: stagingConfig + 'resource/staging/pallet/:packhouseId/:appLocationId/:isRefresh',\r\n      palletDetail: stagingConfig + 'resource/staging/pallet/detail/:packhouseId/:appLocationId/:tagEpc',\r\n      assignPOTag: stagingConfig + 'resource/staging/order/assign/tag/:packhouseId/:appLocationId/:orderId/:tagEpc',\r\n      reopenOrder: stagingConfig + 'resource/staging/order/reopen',\r\n      apiLogMessage : environmentHost + 'resources/app_data_logging',\r\n      grayLogMessage: 'http://192.168.6.38:12201/gelf',\r\n      putAwayConfigurations: putAwayConfig + 'resource/pap/configurations',\r\n      palletInfo: putAwayConfig + 'resource/pap/storage/area/assign/pallet/:tagEpc/packhouse/:packhouseId',\r\n      confirmSA: putAwayConfig + 'resource/pap/storage/area/confirm',\r\n      unassignSA: putAwayConfig + 'resource/pap/storage/area/unassign/pallet',\r\n      language: environmentHost+ 'resources/user/preferences/:userId',\r\n      storageAreaValid: putAwayConfig + 'resource/pap/storage/area/:barCode',\r\n      unknown: environmentHost + 'UNKNOWN_URL'\r\n    };\r\n\r\n    return {\r\n      getUrl: function (resource) {\r\n        return resources[resource] ? resources[resource] : resources.unknown;\r\n      }\r\n    };\r\n  })\r\n\r\n\r\n  .factory('navigateTo', function ($state,$rootScope) {\r\n    return {\r\n      login: function () {\r\n        $state.go('ocf.login');\r\n      },\r\n\r\n      home: function () {\r\n        $state.go('ocf.home');\r\n      },\r\n\r\n      forgotPassword: function () {\r\n        $state.go('ocf.forgotPassword');\r\n      },\r\n\r\n      changePassword: function () {\r\n        $state.go('ocf.changePassword');\r\n      },\r\n\r\n      gdc: function () {\r\n        $state.go('ocf.retailer.gdcSelector', {}, { reload: true });\r\n      },\r\n\r\n      g10: function () {\r\n        $state.go('ocf.supplier.staging.todayOrders', {}, { reload: true });\r\n      },\r\n\r\n      g04: function () {\r\n        $state.go('ocf.supplier.g4.palletDetails', {}, { reload: true });\r\n      },\r\n\r\n      stagingFillOrders: function () {\r\n        $state.go('ocf.supplier.staging.fillOrders', {}, { reload: true });\r\n      },\r\n\r\n      locationSelector:function () {\r\n        $state.go('ocf.locationSelector', {}, { reload: true });\r\n      },\r\n\r\n      retailer: function () {\r\n        if($rootScope.isPilot){\r\n          $state.go('ocf.retailer.baseline.listOfSamplesPilot');\r\n        }\r\n        else{\r\n          $state.go('ocf.retailer.baseline.listOfSamples');\r\n        }\r\n      },\r\n    };\r\n  })\r\n\r\n\r\n  .factory('encode', function () {\r\n    var encode = this;\r\n\r\n    encode.encodeCredentials = function (credentials) {\r\n      return window.btoa(credentials.username + ':' + credentials.password);\r\n    };\r\n\r\n    encode.decodeCredentials = function (credentials) {\r\n      return undefined != credentials ? window.atob(credentials).split(\":\") : false;\r\n    };\r\n\r\n    encode.decodeCredentialsAsObject = function (credentials) {\r\n      var usr = encode.decodeCredentials(credentials);\r\n      return {\r\n        username: usr[0],\r\n        password: usr[1]\r\n      };\r\n    };\r\n\r\n    return encode;\r\n  })\r\n\r\n\r\n  .factory('LoadingService', function ($ionicLoading) {\r\n    var loading = null;\r\n\r\n    return {\r\n      // Trigger the loading indicator\r\n      show: function (message) {\r\n\r\n        // Show the loading overlay and text\r\n        loading = $ionicLoading.show({\r\n\r\n          // The text to display in the loading indicator\r\n          template: '<ion-spinner icon=\"lines\"></ion-spinner>' +\r\n          '<div>' + message || 'Loading' + '</div>',\r\n\r\n          // The animation to use\r\n          animation: 'fade-in'\r\n          //,\r\n          //\r\n          //// The delay in showing the indicator\r\n          //delay: 500\r\n        });\r\n      },\r\n\r\n      // Hide the loading indicator\r\n      hide: function () {\r\n        $ionicLoading.hide();\r\n      }\r\n    };\r\n\r\n  })\r\n\r\n  .factory('MessageService', function () {\r\n    var messages = {\r\n      information: [],\r\n      success: [],\r\n      warning: [],\r\n      error: []\r\n    };\r\n\r\n    var clear = function () {\r\n      messages.information.length = 0;\r\n      messages.success.length = 0;\r\n      messages.warning.length = 0;\r\n      messages.error.length = 0;\r\n    };\r\n\r\n    var addMessage = function (type, txt, clearPrevious) {\r\n      if (clearPrevious) {\r\n        clear();\r\n      }\r\n      messages[type].push(txt);\r\n    };\r\n\r\n    return {\r\n      getCurrentMessages: function () {\r\n        return messages;\r\n      },\r\n\r\n      clear: function () {\r\n        clear();\r\n      },\r\n\r\n      addSuccessMessage: function (txt, clearPrevious) {\r\n        addMessage('success', txt, clearPrevious);\r\n      },\r\n\r\n      addInformationMessage: function (txt, clearPrevious) {\r\n        addMessage('information', txt, clearPrevious);\r\n      },\r\n\r\n      addWarningMessage: function (txt, clearPrevious) {\r\n        addMessage('warning', txt, clearPrevious);\r\n      },\r\n\r\n      addErrorMessage: function (txt, clearPrevious) {\r\n        addMessage('error', txt, clearPrevious);\r\n      }\r\n    };\r\n  })\r\n\r\n\r\n  .factory('SessionService', function ($http, $resource, $state, $window, $q, $timeout, EnvironmentConfig,\r\n                                       SessionConfig, OCFConfig, URLManager, navigateTo, encode,\r\n                                       lodash, $rootScope) {\r\n\r\n    var Session = $resource(URLManager.getUrl('session'), {}, {\r\n      loginWS: {\r\n        method: 'GET',\r\n        timeout: EnvironmentConfig.requestTimeout\r\n      }\r\n    });\r\n\r\n    var SessionID = $resource(URLManager.getUrl('sessionID'), {}, {\r\n      request: {\r\n        method: 'GET',\r\n        timeout: EnvironmentConfig.requestTimeout\r\n      }\r\n    });\r\n\r\n    var Applications = $resource(URLManager.getUrl('applications'), {}, {\r\n      getApps: {\r\n        method: 'GET',\r\n        timeout: EnvironmentConfig.requestTimeout\r\n      }\r\n    });\r\n\r\n    Session.login = function (loginData) {\r\n      var q = $q.defer();\r\n\r\n      Session.setHeaderLogin(loginData)\r\n        .then(function (headerOk) {\r\n          function loginSuccess(userInformation) {\r\n            q.resolve(userInformation);\r\n          }\r\n\r\n          function loginFail(loginFail) {\r\n            var failMessage = {\r\n              status: loginFail.status,\r\n              message: loginFail.message,\r\n              type: 'login'\r\n            };\r\n\r\n            if (loginFail.status !== 0) {\r\n              // net::ERR_CONNECTION_TIMED_OUT\r\n              failMessage.message = \"Authentication failed. Please try again.\";\r\n              if (loginFail.data.message == \"java.lang.Exception: Credentials Expired. Contact System Support.\"){\r\n                failMessage.message = \"Credentials Expired. Contact System Support.\";\r\n              }\r\n            }\r\n\r\n            q.reject(failMessage);\r\n          }\r\n\r\n          Session.loginWS({appLocations: true}, loginSuccess, loginFail);\r\n\r\n        });\r\n      return q.promise;\r\n    };\r\n\r\n    Session.getSessionID = function (loginData, loginInfo) {\r\n      var q = $q.defer();\r\n\r\n      Session.setHeaderCommon()\r\n        .then(function (headerOk) {\r\n\r\n          function sessionSuccess(sessionID) {\r\n            q.resolve(sessionID);\r\n          }\r\n\r\n          function sessionFail(sessionFail) {\r\n            var failMessage = {\r\n              status: sessionFail.status,\r\n              message: sessionFail.message,\r\n              type: 'session'\r\n            };\r\n\r\n            if (sessionFail.status !== 0) {\r\n              // net::ERR_CONNECTION_TIMED_OUT\r\n              failMessage.message = \"Authentication failed. Please try again.\";\r\n            }\r\n\r\n            q.reject(failMessage);\r\n          }\r\n\r\n          SessionID.request({userID: loginInfo.id}, sessionSuccess, sessionFail);\r\n\r\n        });\r\n      return q.promise;\r\n    };\r\n\r\n    Session.sessionID = function () {\r\n      return JSON.parse($window.localStorage.getItem(\"sessionID\"));\r\n    };\r\n\r\n    Session.setSessionID = function (sessionID) {\r\n      $window.localStorage.setItem(\"sessionID\", JSON.stringify(sessionID));\r\n    };\r\n\r\n    // Deprecated\r\n    Session.setHeader = function (loginData) {\r\n      function setHeader(loginData) {\r\n        var encoded = encode.encodeCredentials(loginData);\r\n        $http.defaults.headers.common.Authorization = \"Basic \" + encoded;\r\n\r\n        return $http.defaults.headers.common.Authorization;\r\n      }\r\n\r\n      return $q.when(setHeader(loginData));\r\n    };\r\n\r\n    Session.setHeaderLogin = function (loginData) {\r\n      function setHeaderLogin(loginData) {\r\n        var encoded = encode.encodeCredentials(loginData);\r\n        $http.defaults.headers.common.ZestAppName = \"Shipping\";\r\n        $http.defaults.headers.common.Authorization = \"Basic \" + encoded;\r\n        $http.defaults.headers.common.ZestSessionId = undefined;\r\n\r\n        return $http.defaults.headers.common.Authorization;\r\n      }\r\n\r\n      return $q.when(setHeaderLogin(loginData));\r\n    };\r\n\r\n    Session.getZestSessionId = function () {\r\n      var userData = Session.getUserData($rootScope.user.id);\r\n      return userData.sessionId;\r\n    }\r\n\r\n    Session.setHeaderCommon = function () {\r\n      function setHeaderCommon() {\r\n\r\n        var userData = Session.getUserData($rootScope.user.id);\r\n\r\n        $http.defaults.headers.common.Authorization = undefined;\r\n        $http.defaults.headers.common.ZestAppName = \"Shipping\";\r\n        $http.defaults.headers.common.ZestSessionId = userData.sessionId;\r\n\r\n        return $http.defaults.headers.common.ZestSessionId;\r\n      }\r\n\r\n      return $q.when(setHeaderCommon());\r\n    };\r\n\r\n    Session.isSignedIn = function () {\r\n      return !!$window.localStorage[SessionConfig.cookieName];\r\n    };\r\n\r\n    Session.setLoggedUserId = function (userId) {\r\n      $window.localStorage.setItem(\"loggedUser\", JSON.stringify(userId));\r\n    };\r\n\r\n    Session.clearLoggedUser = function () {\r\n      $window.localStorage.setItem(\"loggedUser\", \"\");\r\n    };\r\n\r\n    Session.getLoggedUserId = function () {\r\n      return JSON.parse($window.localStorage.getItem(\"loggedUser\"));\r\n    };\r\n\r\n    Session.getApplicationsList = function () {\r\n      var q = $q.defer();\r\n\r\n      function appsSuccess(userApps) {\r\n        q.resolve(userApps.applications);\r\n      }\r\n\r\n      function appsFail(loginFail) {\r\n        //var failMessage = {\r\n        //  status: loginFail.status,\r\n        //  message: loginFail.message,\r\n        //  type: 'login'\r\n        //};\r\n        console.log(loginFail);\r\n        //if (loginFail.status !== 0) {\r\n        //  // net::ERR_CONNECTION_TIMED_OUT\r\n        //  failMessage.message = \"Authentication failed. Please try again.\";\r\n        //}\r\n\r\n        q.reject();\r\n      }\r\n\r\n      Applications.getApps(appsSuccess, appsFail);\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    Session.setUserApplications = function (appsList) {\r\n      var userData = Session.getUserData($rootScope.user.id);\r\n      userData.apps = appsList;\r\n      Session.setUserData(userData);\r\n    };\r\n\r\n    Session.getUserApplications = function (userId) {\r\n      return Session.getUserData(userId).apps;\r\n    };\r\n\r\n    Session.clearCredentials = function () {\r\n      var q = $q.defer();\r\n\r\n      function cleaner() {\r\n        $window.localStorage.removeItem(SessionConfig.cookieName);\r\n        //$window.localStorage.removeItem(SessionConfig.userInformation);\r\n        Session.clearLoggedUser()\r\n        return true;\r\n      }\r\n\r\n      q.resolve(cleaner());\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    //Session.securityCheck = function () {\r\n    //  if (!Session.isSignedIn()) {\r\n    //    Session.clearCredentials()\r\n    //      .then(function (success) {\r\n    //        navigateTo.login();\r\n    //      });\r\n    //\r\n    //  } else {\r\n    //    var sessionData = Session.getSessionData();\r\n    //    var loginData = encode.decodeCredentialsAsObject(sessionData);\r\n    //\r\n    //    if (angular.equals(pouchLocalDB.get(), {}) || typeof pouchLocalDB.get() !== \"undefined\") {\r\n    //      var adapter = window.sqlitePlugin ? {adapter: 'websql'} : {};\r\n    //      pouchLocalDB.set(new PouchDB('ocf', adapter));\r\n    //    }\r\n    //\r\n    //    Session.setHeader(loginData);\r\n    //  }\r\n    //};\r\n\r\n    Session.setCredentials = function (loginData, userInformation) {\r\n      var encoded = encode.encodeCredentials(loginData);\r\n      var sessionInfo = {\r\n        sessionId: encoded,\r\n        createdDate: Date.now(),\r\n        status: ''\r\n      };\r\n      //change the username to be able to push docs to couchdb\r\n      userInformation.username = loginData.username;\r\n\r\n      $window.localStorage.setItem(SessionConfig.cookieName, JSON.stringify(sessionInfo));\r\n      //$window.localStorage.setItem(SessionConfig.userInformation, JSON.stringify(userInfo));\r\n    };\r\n\r\n    Session.getSessionData = function () {\r\n      return JSON.parse($window.localStorage.getItem(SessionConfig.cookieName));\r\n    };\r\n\r\n    Session.getUserLocations = function (userId) {\r\n      var userData = Session.getUserData(userId);\r\n      if (userData) {\r\n        return userData.locations;\r\n      }\r\n    };\r\n\r\n    Session.getUserData = function (userId) {\r\n      var usersData = JSON.parse($window.localStorage.getItem(\"userInformation\"));\r\n      return lodash.find(usersData, function (userInfo) {\r\n        return userInfo.id == userId;\r\n      })\r\n    };\r\n\r\n    Session.setUserData = function (userData) {\r\n      var usersData = JSON.parse($window.localStorage.getItem(\"userInformation\"));\r\n      var foundUserIndex = lodash.findIndex(usersData, function (userInfo) {\r\n        return userInfo.id == userData.id;\r\n      });\r\n\r\n      if (foundUserIndex !== -1) {\r\n        usersData[foundUserIndex] = userData;\r\n      }\r\n      else {\r\n        if (usersData === null) {\r\n          usersData = [];\r\n        }\r\n        usersData.push(userData);\r\n      }\r\n\r\n      $window.localStorage.setItem(SessionConfig.userInformation, JSON.stringify(usersData));\r\n    };\r\n\r\n    Session.setSession = function (loginData) {\r\n      var encoded = encode.encodeCredentials(loginData);\r\n      var sessionInfo = {\r\n        sessionId: encoded,\r\n        createdDate: new Date().getTime(),\r\n        status: ''\r\n      };\r\n      $window.localStorage.setItem(SessionConfig.cookieName, JSON.stringify(sessionInfo));\r\n    };\r\n\r\n    Session.destroy = function () {\r\n      $window.localStorage.removeItem(SessionConfig.cookieName);\r\n    };\r\n\r\n    Session.updateSessionStatus = function (status) {\r\n      var sessionData = Session.getSessionData();\r\n      sessionData.status = status;\r\n      $window.localStorage[SessionConfig.cookieName] = JSON.stringify(sessionData);\r\n\r\n    };\r\n\r\n    Session.setLoggedOffline = function () {\r\n      Session.updateSessionStatus(\"loggedOffline\");\r\n    };\r\n\r\n    Session.setSessionExpired = function () {\r\n      Session.updateSessionStatus(\"sessionExpired\");\r\n    };\r\n\r\n    Session.setLoggedOnline = function () {\r\n      Session.updateSessionStatus(\"loggedOnline\");\r\n    };\r\n\r\n    Session.setLoggingOut = function () {\r\n      Session.updateSessionStatus(\"loggingOut\");\r\n    };\r\n\r\n    Session.setLoggedOut = function () {\r\n      Session.updateSessionStatus(\"loggedOut\");\r\n    };\r\n\r\n    //Session.offlineLogin = function (loginData) {\r\n    //  var q = $q.defer();\r\n    //  //TODO: implement a secure offline login mechanism\r\n    //  var userData = Session.getUserData();\r\n    //  var appConfig = Session.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId, $rootScope.appName);\r\n    //\r\n    //  //verify that the user exists in the device and that\r\n    //  if (!!userData) {\r\n    //    if (loginData.username.toUpperCase() == userData.userInfo.username.toUpperCase() && appConfig !== null) {\r\n    //      console.log(\"Offline login successful\");\r\n    //      Session.setSession(loginData);\r\n    //      Session.setLoggedOffline();\r\n    //      q.resolve(true);\r\n    //    } else {\r\n    //      var warnMsg = \"The current user is not the one related to the device or his data has changed. Online login is required\";\r\n    //      //TODO: implement a popup / message to inform that an online login is required.\r\n    //      q.reject(warnMsg);\r\n    //    }\r\n    //  } else {\r\n    //    q.reject(false);\r\n    //  }\r\n    //\r\n    //  return q.promise;\r\n    //};\r\n\r\n    Session.ocfManager = {\r\n      applicationConfig: function (loginData, appList, locationsList) {\r\n\r\n        var userData = Session.getUserData($rootScope.user.id);\r\n\r\n        var makeRequest = function (loginData, app, locationId) {\r\n          var q = $q.defer();\r\n          //var encodedData = encode.encodeCredentials(loginData);\r\n\r\n          var initialConfig = $resource(URLManager.getUrl('initialConfig'), {}, {\r\n            getConfigs: {\r\n              method: 'GET',\r\n              //headers: {'Authorization': \"Basic \" + encodedData}\r\n              headers: {\r\n                'ZestAppName': 'Shipping',\r\n                'ZestSessionId': userData.sessionId\r\n              }\r\n            }\r\n          });\r\n\r\n          function storeAppConfig(configObject) {\r\n            var configArray = JSON.parse($window.localStorage.getItem(OCFConfig.configObject));\r\n            if (configArray == null) {\r\n              configArray = [];\r\n              configArray.push(configObject);\r\n            }\r\n            else {\r\n              //check if there's already a config for the app and the location\r\n              var config = lodash.find(configArray, function (config) {\r\n                return config.appName == configObject.appName && config.locationId == locationId;\r\n              });\r\n              //if it exists, update it\r\n              if (config) {\r\n                var index = lodash.indexOf(configArray, config);\r\n                configArray[index] = angular.copy(configObject);\r\n              }\r\n              else {\r\n                configArray.push(configObject);\r\n              }\r\n            }\r\n            $window.localStorage.setItem(OCFConfig.configObject, JSON.stringify(configArray));\r\n            return configObject;\r\n          }\r\n\r\n          function appConfigSuccess(success) {\r\n            var appConfig = {\r\n              appName: app.appCacheName,\r\n              config: success,\r\n              locationId: locationId\r\n            };\r\n            return q.resolve(storeAppConfig(appConfig));\r\n          }\r\n\r\n          function appConfigFail(fail) {\r\n            var failMessage = {\r\n              status: fail.status,\r\n              message: \"Configurations: \",\r\n              type: 'appConfig'\r\n            };\r\n\r\n            if (fail.status === 0) {\r\n              // net::ERR_CONNECTION_TIMED_OUT\r\n              failMessage.message += \"Connection failed.\";\r\n            } else {\r\n              failMessage.message += fail.data.reason;\r\n            }\r\n\r\n            return q.reject(failMessage);\r\n          }\r\n\r\n          initialConfig.getConfigs({appId: app.appCacheName, locationId: locationId}, appConfigSuccess, appConfigFail);\r\n\r\n          return q.promise;\r\n        };\r\n\r\n        var promises = [];\r\n\r\n        if (!locationsList) {\r\n          var failMessage = {\r\n            status: 99,\r\n            message: \"User not assigned to any location.\",\r\n            type: 'location'\r\n          };\r\n\r\n          return $q.reject(failMessage);\r\n\r\n        }\r\n\r\n        for (var j = 0; j < locationsList.length; j++) {\r\n          var location = locationsList[j];\r\n          for (var i = 0; i < appList.length; i++) {\r\n            promises.push(makeRequest(loginData, appList[i], location.locationId))\r\n          }\r\n        }\r\n        return $q.allSettled(promises);\r\n\r\n      },\r\n\r\n      getApplicationConfig: function (locationId, appName) {\r\n        return lodash.find(JSON.parse($window.localStorage.getItem(OCFConfig.configObject)), function (config) {\r\n          return config.appName == appName.toLowerCase() && config.locationId == locationId;\r\n        });\r\n      }\r\n    };\r\n\r\n    Session.remoteStorage = {\r\n      userExist: function (loginData) {\r\n        loginData.username = loginData.username.toUpperCase();\r\n        var q = $q.defer();\r\n        var encodedData = encode.encodeCredentials(loginData);\r\n        var cdb = $resource(URLManager.getUrl('couchDbSession'), {}, {\r\n          checkSession: {\r\n            method: 'GET',\r\n            headers: {'Authorization': \"Basic \" + encodedData}\r\n          }\r\n        });\r\n\r\n        function sessionSuccess(success) {\r\n          return q.resolve(success);\r\n        }\r\n\r\n        function sessionFail(fail) {\r\n          var failMessage = {\r\n            status: fail.status,\r\n            message: \"Remote Storage: \",\r\n            type: 'remoteStorage'\r\n          };\r\n\r\n          if (fail.status === 0) {\r\n            // net::ERR_CONNECTION_TIMED_OUT\r\n            failMessage.message += \"Connection failed.\";\r\n          } else {\r\n            failMessage.message += fail.data.reason;\r\n          }\r\n\r\n          return q.reject(failMessage);\r\n        }\r\n\r\n\r\n        cdb.checkSession(sessionSuccess, sessionFail);\r\n\r\n\r\n        return q.promise;\r\n      },\r\n\r\n      userCanAccessDatabase: function (loginData, appList, orgId) {\r\n\r\n\r\n        var makeRequest = function (loginData, app, orgId) {\r\n          var organizationId = orgId;\r\n          var database;\r\n          database = app.appCacheName + '_' + organizationId;\r\n\r\n          var q = $q.defer();\r\n          var encodedData = encode.encodeCredentials(loginData);\r\n          var cDbHost = CouchDbConfig.host + database;\r\n\r\n          var cdb = $resource(cDbHost, {}, {\r\n            checkSession: {\r\n              method: 'GET',\r\n              headers: {'Authorization': \"Basic \" + encodedData}\r\n            }\r\n          });\r\n\r\n          function sessionSuccess(success) {\r\n            return q.resolve();\r\n          }\r\n\r\n          function sessionFail(fail) {\r\n            return q.resolve();\r\n          }\r\n\r\n          cdb.checkSession(sessionSuccess, sessionFail);\r\n\r\n          return q.promise;\r\n\r\n        };\r\n\r\n\r\n        var promises = [];\r\n\r\n        for (var i = 0; i < appList.length; i++) {\r\n          promises.push(makeRequest(loginData, appList[i], orgId))\r\n        }\r\n\r\n        return $q.allSettled(promises);\r\n\r\n      }\r\n    };\r\n\r\n    return Session;\r\n  })\r\n\r\n  .factory('pouchLocalDB', function ($q) {\r\n    var db = {\r\n      localDB: null\r\n    };\r\n    var deferred = $q.defer();\r\n\r\n    db.set = function (localDB) {\r\n      if (this.localDB === null) {\r\n        this.localDB = localDB;\r\n        deferred.resolve(\"success\");\r\n\r\n      } else {\r\n        deferred.reject(\"fail\");\r\n      }\r\n\r\n      return deferred.promise;\r\n    };\r\n\r\n    db.get = function () {\r\n      return this.localDB;\r\n    };\r\n\r\n    return db;\r\n  })\r\n\r\n  .factory('InitializationService', function ($q) {\r\n\r\n    //pouchLocalDB.set(pouchDB(PouchConfig.pouchdbName));\r\n    //\r\n    //var db = pouchLocalDB.get();\r\n\r\n    var initialization = {};\r\n\r\n    //initialization.getAllDocsFromPouch = function () {\r\n    //  return db.allDocs({\r\n    //    include_docs: true\r\n    //  });\r\n    //};\r\n\r\n    return initialization;\r\n\r\n\r\n  })\r\n\r\n\r\n  .factory('ReplicationService', function ($q, $rootScope, $timeout, CouchDbConfig, SessionService, PersistenceConfig,\r\n                                           pouchLocalDB) {\r\n    var ReplicationService = this;\r\n\r\n    ReplicationService.updateStatus = function (message) {\r\n      $timeout(function () {\r\n        $rootScope.$apply(function () {\r\n          $rootScope.isSynchronized = message;\r\n        });\r\n      });\r\n    };\r\n\r\n    ReplicationService.retryReplication = function (sessionData) {\r\n      var localDB = pouchLocalDB.get();\r\n      var sessionInformation = $rootScope.user;\r\n      var organizationId = sessionInformation.organizationId;\r\n\r\n      if (localDB._db_name) {\r\n        var cHost = CouchDbConfig.host.split(\"//\");\r\n        var cdb = cHost[0] + \"//\" + sessionInformation.username + \":\" + sessionData.password + \"@\" + cHost[1];\r\n        return localDB.replicate.to(cdb + \"lotqc_\" + organizationId);\r\n      }\r\n    };\r\n\r\n    ReplicationService.liveReplicate = function (sessionData) {\r\n      var localDB = pouchLocalDB.get();\r\n      var sessionInformation = $rootScope.user;\r\n      var organizationId = sessionInformation.organizationId;\r\n\r\n      if (localDB._db_name) {\r\n        var cHost = CouchDbConfig.host.split(\"//\");\r\n        var cdb = cHost[0] + \"//\" + sessionInformation.username + \":\" + sessionData.password + \"@\" + cHost[1];\r\n        return localDB.replicate.to(cdb + \"lotqc_\" + organizationId, {\r\n          live: true\r\n        });\r\n      }\r\n    };\r\n\r\n    //TODO:refactor this method to use the current DB\r\n    ReplicationService.sync = function (sessionData) {\r\n      var localDB = pouchLocalDB.get();\r\n      var sessionInformation = $rootScope.user;\r\n      var organizationId = sessionInformation.organizationId;\r\n\r\n      if (localDB._db_name) {\r\n        var cHost = CouchDbConfig.host.split(\"//\");\r\n        var cdb = cHost[0] + \"//\" + sessionInformation.username + \":\" + sessionData.password + \"@\" + cHost[1];\r\n        return localDB.sync(cdb + \"lotqc_\" + organizationId, {\r\n          live: true\r\n        });\r\n      }\r\n    };\r\n\r\n    ReplicationService.garbageCollector = function () {\r\n      // TODO: Implement a method to clear the MC of the tombstones that PouchDB creates.\r\n      console.log(\"Garbage collector called\");\r\n      var localDB = pouchLocalDB.get();\r\n      var deferred = $q.defer();\r\n\r\n      if (localDB._db_name) {\r\n        // Try to replicate the documents first\r\n        this.retryReplication();\r\n\r\n        // Then get all the documents from PouchDB and validate the updated/created date\r\n        localDB.allDocs({\r\n          include_docs: true,\r\n          descending: true\r\n        }, function (error, response) {\r\n          if (!error) {\r\n            var todayTime = Date.now();\r\n\r\n            response.rows.forEach(function (element) {\r\n              // By default use the date when document was created\r\n              var lastDocDate = element.doc.createDate;\r\n              // TODO: in case that the Business Logic uses the last updated date to decide if the document is old enough\r\n              //if(element.doc.modificationDate){\r\n              //    lastDocDate = element.doc.modificationDate;\r\n              //}\r\n              if (lastDocDate) {\r\n                var daysDiff = ( todayTime - lastDocDate) / (24 * 3600 * 1000);\r\n                // remove the document if the days diff exceeds the configuration setting\r\n                if (daysDiff >= PersistenceConfig.daysToLive) {\r\n\r\n                  localDB.remove(element.doc);\r\n\r\n                  console.log(\"Element removed\");\r\n                }\r\n              }\r\n            });\r\n            deferred.resolve(\"success\");\r\n          }\r\n\r\n          if (error) {\r\n            deferred.reject(error);\r\n          }\r\n        });\r\n      }\r\n\r\n      return deferred.promise;\r\n    };\r\n\r\n    return ReplicationService;\r\n  })\r\n\r\n  .factory('StagingConfigurationService', function ($q, EnvironmentConfig, URLManager, $resource, $log) {\r\n\r\n    var StagingConfigurationService = this;\r\n\r\n    StagingConfigurationService.getStagingConfiguration = function () {\r\n      var q = $q.defer();\r\n      var request = $resource(URLManager.getUrl('stagingConfiguration'), {}, {\r\n        getStagingConfiguration: {\r\n          method: 'GET',\r\n          timeout: EnvironmentConfig.requestTimeout\r\n        }\r\n      });\r\n\r\n      function success(configuration) {\r\n        $log.debug(\"Configuration retrieved\");\r\n        q.resolve(configuration);\r\n      }\r\n\r\n      function error(error) {\r\n        $log.error(\"Configuration retrieval failed \" + error);\r\n        q.reject(error);\r\n      }\r\n\r\n      request.getStagingConfiguration({}, success, error);\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    return StagingConfigurationService;\r\n  }).factory('UserPreferenceService', function ($q, EnvironmentConfig, URLManager, $resource, $log) {\r\n\r\n    var UserPreferenceService = this;\r\n\r\n    UserPreferenceService.getUserPreference = function (userId) {\r\n      var q = $q.defer();\r\n      var request = $resource(URLManager.getUrl('language'), {}, {\r\n        getUserPreference: {\r\n          method: 'GET',\r\n          timeout: EnvironmentConfig.requestTimeout\r\n        }\r\n      });\r\n\r\n      function success(configuration) {\r\n        $log.debug(\"User Configuration retrieved\");\r\n        q.resolve(configuration);\r\n      }\r\n\r\n      function error(error) {\r\n        $log.error(\"User Configuration retrieval failed \" + error);\r\n        q.reject(error);\r\n      }\r\n\r\n      request.getUserPreference({'userId':userId}, success, error);\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    UserPreferenceService.setUserPreference = function (userId, preferences) {\r\n      var q = $q.defer();\r\n      var request = $resource(URLManager.getUrl('language'), {'userId':userId}, {\r\n        setUserPreference: {\r\n          method: 'PUT',\r\n          timeout: EnvironmentConfig.requestTimeout\r\n        }\r\n      });\r\n\r\n      function success(configuration) {\r\n        $log.debug(\"User Configuration setted\");\r\n        q.resolve(configuration);\r\n      }\r\n\r\n      function error(error) {\r\n        $log.error(\"User Configuration setted failed \" + error);\r\n        q.reject(error);\r\n      }\r\n\r\n      request.setUserPreference(preferences, success, error);\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    return UserPreferenceService;\r\n  })\r\n  .factory('LoggingService', function (URLManager, EnvironmentConfig, $q, $log, $resource, $rootScope, $interval) {\r\n\r\n    var logMessageGrayLog = function (app, context, action, message, result, metadata) {\r\n\r\n      var data = {\r\n        version: \"1.1\",\r\n        host: EnvironmentConfig.env,\r\n        short_message: message,\r\n        //timestamp: (new Date()).toISOString(),\r\n        full_message: JSON.stringify(metadata),\r\n        action: action,\r\n        result: result,\r\n        _environment: app,\r\n        _facility: \"G10\",\r\n        _context: context\r\n      };\r\n\r\n      jQuery.ajax({\r\n        url: URLManager.getUrl('grayLogMessage'),\r\n        type: 'POST',\r\n        data: JSON.stringify(data),\r\n\r\n        success: function (response) {\r\n          $log.debug(\"Log successfully sent\");\r\n        },\r\n\r\n        error: function (response) {\r\n          $log.debug(\"Couldn't send log \" + JSON.stringify(data));\r\n        }\r\n      });\r\n    };\r\n\r\n    // metadata should be a list as [{\"key\":\"attribute\",\"value\":\"message\"},...]\r\n    var logMessage = function (data) {\r\n      var q = $q.defer();\r\n      var request = $resource(URLManager.getUrl('apiLogMessage'), {}, {\r\n        logMessage: {\r\n          method: 'POST',\r\n          timeout: EnvironmentConfig.requestTimeout\r\n        }\r\n      });\r\n\r\n      function success(response) {\r\n        $rootScope.logsBlocked = false;\r\n        $log.debug(\"Log saved\");\r\n        q.resolve(response);\r\n      }\r\n\r\n      function error(error) {\r\n        $rootScope.logsBlocked = false;\r\n        $log.debug(\"Error saving log \" + error);\r\n        q.reject(error);\r\n      }\r\n\r\n      request.logMessage(data, success, error);\r\n\r\n      return q.promise;\r\n    };\r\n\r\n    var saveLogToSend = function (app, context, action, message, result, metadata) {\r\n\r\n      if (!(Object.prototype.toString.call(metadata) === '[object Array]')) {\r\n        metadata = [];\r\n      }\r\n\r\n      if (window.cordova) {\r\n        var device = {\r\n          id: window.device.serial,\r\n          android: window.navigator.appVersion\r\n        };\r\n        var deviceMetadata = {\r\n          key: \"device\",\r\n          value: JSON.stringify(device)\r\n        };\r\n\r\n        metadata.push(deviceMetadata);\r\n      }\r\n\r\n      var appVersion = $rootScope.appVersion;\r\n\r\n      var appVersionMetadata = {\r\n        key: \"application_version\",\r\n        value: appVersion\r\n      };\r\n\r\n      metadata.push(appVersionMetadata);\r\n\r\n      metadata.push({\r\n        \"key\": \"message\",\r\n        \"value\": message\r\n      });\r\n\r\n      metadata.push({\r\n        \"key\": \"context\",\r\n        \"value\": context\r\n      });\r\n      var data = {\r\n        \"host\": EnvironmentConfig.env,\r\n        \"action\": action,\r\n        \"result\": result,\r\n        \"_environment\": app,\r\n        \"_facility\": \"OCF\",\r\n        \"full_message\": metadata\r\n      };\r\n\r\n      $rootScope.logsToSend.push(data);\r\n    };\r\n\r\n    var CONSTANTS = {\r\n      \"APP\": {\r\n        \"OCF_DATA_RECOVER\": \"OCF_Data_Recover\",\r\n        \"OCF_LOGIN\": \"OCF_Login\",\r\n        \"OCF_APP_SELECTOR\":\"OCF_App_Selector\",\r\n        \"OCF_LOCATION_SELECTOR\":\"OCF_Location_Selector\",\r\n        \"G10\":\"G10\",\r\n        \"G04\":\"G4\"\r\n      },\r\n      CONTEXT: {\r\n        \"ON_PAUSE\":\"On_Pause\",\r\n        \"ON_RESUME\":\"On_Resume\",\r\n        \"ON_DEVICE_READY\":\"On_Device_Ready\",\r\n        \"ON_DATA_RECOVERING\":\"On_Data_Recovering\",\r\n        \"LOGIN_CONTROLLER\":\"Login_Controller\",\r\n        \"LOCATION_CONTROLLER\":\"Location_Controller\",\r\n        \"TODAY_ORDER_CONTROLLER\" : \"Today_Order_Controller\",\r\n        \"FILL_ORDER_CONTROLLER\" : \"Fill_Order_Controller\",\r\n        \"ASSIGN_PALLET_POPUP\" : \"Assign_Pallet_Popup\",\r\n        \"REMOVE_PALLET_POPUP\" : \"Remove_Pallet_Popup\",\r\n        \"REOPEN_ORDER_POPUP\" : \"Reopen_Order_Popup\",\r\n        \"SELECT_ORDER_POPUP\" : \"Select_Order_Popup\",\r\n        \"EVENT_HANDLER_SERVICE\": \"Event_Handler_Service\",\r\n        \"PUT_AWAY_CONTROLLER\": \"Put_Away_Controller\"\r\n      }\r\n    };\r\n\r\n    if(!$rootScope.logsToSend) {\r\n      $rootScope.logsToSend = [];\r\n    }\r\n\r\n    $rootScope.logsBlocked = false;\r\n\r\n    if(sendLog) {\r\n      $interval.cancel(sendLog);\r\n    }\r\n\r\n    var sendLog = $interval(function () {\r\n\r\n      if(!$rootScope.logsBlocked && $rootScope.logsToSend.length > 0) {\r\n        $rootScope.logsBlocked = true;\r\n\r\n        // Send the first element of the array and remove it\r\n        logMessage($rootScope.logsToSend.shift());\r\n      }\r\n\r\n    }, 500);\r\n\r\n    return {\r\n      logMessageGrayLog: function (app, context, action, message, result, metadata) {\r\n        logMessageGrayLog(app, context, action, message, result, metadata);\r\n        $log.info(app + \" - \" + context + \" - \" + action + \" - \" + message + \" - \" + result + \" - \" + JSON.stringify(metadata));\r\n      },\r\n      logMessage: function (app, context, action, message, result, metadata, toZest) {\r\n\r\n        toZest = toZest != undefined ? toZest : true;\r\n\r\n        if(toZest) {\r\n          saveLogToSend(app, context, action, message, result, metadata);\r\n        }\r\n\r\n        console.log(app + \" - \" + context + \" - \" + action + \" - \" + message + \" - \" + result + \" - \" + JSON.stringify(metadata));\r\n      },\r\n      CONSTANTS: CONSTANTS\r\n    };\r\n  })\r\n  .factory('LockService', function($log) {\r\n    var _fields = {};\r\n    var _methods = {};\r\n\r\n    _fields.lockList = [];\r\n\r\n    _methods.lock = function(lock) {\r\n      if (!_methods.isLocked(lock)) {\r\n        $log.info('LockService | Locking with key [' + lock + ']');\r\n        _fields.lockList.push({ id: lock });\r\n      }\r\n      $log.info('LockService | Lock list [' + JSON.stringify(_fields.lockList) + ']');\r\n    };\r\n\r\n    _methods.release = function(lock) {\r\n      $log.info('LockService | Releasing lock with key [' + lock + ']');\r\n      for (var i = 0; i < _fields.lockList.length; i++) {\r\n        if (typeof _fields.lockList[i] == 'object' && typeof _fields.lockList[i].id != 'undefined' && _fields.lockList[i].id == lock) {\r\n          _fields.lockList.splice(i, 1);\r\n        }\r\n      }\r\n      $log.info('LockService | Lock list [' + JSON.stringify(_fields.lockList) + ']');\r\n    };\r\n\r\n    _methods.isLocked = function(lock) {\r\n      var lockItem = _.find(_fields.lockList, function(lockLookup) { return lockLookup.id == lock });\r\n      var isLocked = typeof lockItem == 'object' && typeof lockItem.id != 'undefined' && lockItem.id == lock;\r\n      $log.info('LockService | Verifying if key [' + lock + '] is locked | ' + lock + ' [' + isLocked.toString() + ']');\r\n      return isLocked;\r\n    };\r\n\r\n    _methods.areLocked = function(lockList) {\r\n      if (!_.isArray(lockList)) {\r\n        return false;\r\n      }\r\n      for (var i = 0; i < lockList.length; i++) {\r\n        if (!_methods.isLocked(lockList[i])) {\r\n          return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    return {\r\n      lock: _methods.lock,\r\n      release: _methods.release,\r\n      isLocked: _methods.isLocked,\r\n      areLocked: _methods.areLocked\r\n    };\r\n  })\r\n\r\n  .factory('EventHandlerService', function ($timeout, $log, LoggingService) {\r\n    /**\r\n     * event = {\r\n     *      trigger: function() {}, // it should return a promise to be used for the EH\r\n     *      execState: \"\"\r\n     * }\r\n     */\r\n\r\n    var _loggingStates = {\r\n      app: '',\r\n      context: ''\r\n    };\r\n    var _currentState;\r\n    var _queue = [];\r\n\r\n    _trigger();\r\n\r\n    return {\r\n      setCurrentState: function(currentState) {\r\n        _setCurrentState(currentState);\r\n      },\r\n      enqueue: function(event) {\r\n        _enqueue(event);\r\n      },\r\n      setLoggingState: function (app, context) {\r\n        _setLoggingState(app, context);\r\n      }\r\n    };\r\n\r\n    function _enqueue(event) {\r\n      $log.debug('_enqueue', JSON.stringify(event), JSON.stringify(_queue), JSON.stringify(_loggingStates));\r\n      if (event.agnostic) event.execState = _currentState;\r\n      _queue.push(event);\r\n    }\r\n\r\n    function _clearQueue() {\r\n      $log.debug('_clearQueue');\r\n      _queue = [];\r\n    }\r\n\r\n    function _setCurrentState(currentState) {\r\n      $log.debug('_setCurrentState', 'target:', currentState, 'current:', _currentState, JSON.stringify(_loggingStates));\r\n\r\n      if (currentState) {\r\n        _clearQueue();\r\n        _currentState = currentState;\r\n      }\r\n    }\r\n\r\n    function _trigger(value) {\r\n      var event = _queue.shift();\r\n\r\n      if (event && (angular.isArray(event.execState) && event.execState.indexOf(_currentState) != -1 || event.execState == _currentState)) {\r\n        $log.debug('before event.trigger()', JSON.stringify(event), JSON.stringify(_loggingStates));\r\n\r\n        event.trigger()\r\n          .then(_setCurrentState)\r\n          .catch(_setCurrentState)\r\n          .finally(_trigger);\r\n\r\n      } else {\r\n        $timeout(_trigger, 64);\r\n      }\r\n    }\r\n\r\n    function _setLoggingState(app, context) {\r\n      if (app && context) {\r\n        _loggingStates.app = LoggingService.CONSTANTS.APP[app];\r\n        _loggingStates.context = LoggingService.CONSTANTS.CONTEXT[context];\r\n\r\n      } else {\r\n        _loggingStates.app = '';\r\n        _loggingStates.context = '';\r\n      }\r\n    }\r\n  })\r\n\r\n  .factory('TimeoutLockService', function($log, toaster, $translate) {\r\n      var _fields = {};\r\n      var _methods = {};\r\n      var message = \"Application busy\";\r\n      $translate('OCF.APPLICATION_BUSY.MESSAGE').then(function (result) {\r\n        message = result;\r\n      });\r\n\r\n      _fields.serviceName = 'TimeoutLockService';\r\n      _fields.lastLock = 0;\r\n\r\n      _methods.now = function() {\r\n        return new Date().getTime();\r\n      };\r\n\r\n      _methods.getLockTimeout = function() {\r\n        /**\r\n         * Lock timeout in milliseconds\r\n         * @type {number}\r\n         */\r\n        var lockTimeout = 500;\r\n        //TODO: Get lock timeout from configuration\r\n\r\n        $log.info(_fields.serviceName + ' | Lock timeout read from configuration [' + lockTimeout + ']');\r\n\r\n        return lockTimeout;\r\n      };\r\n\r\n      _methods.lock = function() {\r\n        $log.info(_fields.serviceName + ' | Activating locking for ' + _methods.getLockTimeout() + ' milliseconds');\r\n        _fields.lastLock = _methods.now();\r\n      };\r\n\r\n      _methods.displayAppBusyToaster = function() {\r\n        $log.debug(_fields.serviceName + ' | Displaying toaster message');\r\n        $translate('OCF.APPLICATION_BUSY.MESSAGE').then(function (result) {\r\n          message = result;\r\n          toaster.pop({\r\n            type: 'error',\r\n            body: message,\r\n            timeout: 5000,\r\n            showCloseButton: true\r\n          });\r\n        });\r\n      };\r\n\r\n      _methods.isLocked = function() {\r\n        if ((_fields.lastLock + _methods.getLockTimeout()) >= _methods.now()) {\r\n          // Lock active\r\n          $log.info(_fields.serviceName + ' | Lock is active');\r\n          _methods.displayAppBusyToaster();\r\n          return true;\r\n        } else {\r\n          // Lock not active\r\n          $log.info(_fields.serviceName + ' | Lock is not active');\r\n          _methods.lock();\r\n          return false;\r\n        }\r\n      };\r\n\r\n      return {\r\n        isLocked: _methods.isLocked\r\n      };\r\n    })\r\n\r\n  .factory('OCFConfigurationService', function ($resource, $q, $rootScope, $window, $log, URLManager, EnvironmentConfig) {\r\n    var OCFConfigs = $resource(URLManager.getUrl('ocfConfigurations'), {}, {\r\n      getConfigs: {\r\n        method: 'GET',\r\n        timeout: EnvironmentConfig.requestTimeout\r\n      }\r\n    });\r\n\r\n    var configs = this;\r\n\r\n    configs.retrieveConfigs = _retrieveConfigs;\r\n    configs.getOcfConfigs = _getOcfConfigs;\r\n\r\n    return configs;\r\n\r\n    /////////////////////////////\r\n    function _retrieveConfigs() {\r\n      return $q(function (resolve, reject) {\r\n        OCFConfigs.getConfigs({}, _success, _fail);\r\n\r\n        function _success(ocfConfigs) {\r\n          $window.localStorage.setItem(\"ocfConfigs\", JSON.stringify(ocfConfigs));\r\n          resolve(ocfConfigs);\r\n        }\r\n\r\n        function _fail(error) {\r\n          $log.error(\"OCF Configuration Retrieve failed\", error);\r\n          resolve({});\r\n        }\r\n      });\r\n    }\r\n\r\n    function _getOcfConfigs() {\r\n      var ocfConfigs = $window.localStorage.getItem(\"ocfConfigs\");\r\n\r\n      return ocfConfigs ? JSON.parse(ocfConfigs) : {};\r\n    }\r\n  })\r\n\r\n  .factory('StorageService', function ($resource, URLManager,EnvironmentConfig){\r\n    var storageService = {\r\n      validStorageArea: validStorageArea\r\n    };\r\n    function validStorageArea(barCode){\r\n      var request = $resource(URLManager.getUrl('storageAreaValid'), {}, {\r\n        validateStorageArea: {\r\n          method: 'GET',\r\n          timeout: EnvironmentConfig.requestTimeout\r\n        }\r\n      });\r\n      var valid = request.validateStorageArea({'barCode':barCode});\r\n\r\n      return valid.$promise;\r\n    };\r\n    return storageService;\r\n  })\r\n\r\n  //\r\n  //.service('ScanService', function ($rootScope, $timeout) {\r\n  //\r\n  //  var ss = {};\r\n  //\r\n  //\r\n  //  //initializes the scan and sets the activity to send the intent to\r\n  //  ss.initialize = function (activityName) {\r\n  //\r\n  //    console.log(window.datawedge);\r\n  //\r\n  //    if (window.datawedge) {\r\n  //      var activity = activityName ? activityName : \"com.bluefletch.motorola.datawedge.ACTION\"; //default activity name\r\n  //\r\n  //      console.log(activityName);\r\n  //\r\n  //      datawedge.start();\r\n  //\r\n  //      $timeout(function () {\r\n  //        datawedge.registerForBarcode(function (data) {\r\n  //          console.log(\"dataWedgeScan - broadcast\");\r\n  //\r\n  //          $rootScope.$broadcast('dataWedgeScan', data.barcode);\r\n  //        });\r\n  //\r\n  //      }, 300)\r\n  //\r\n  //    }\r\n  //  };\r\n  //\r\n  //  return ss;\r\n  //})\r\n\r\n\r\n;\r\n\r\n","/**\n  * Created by FMG on 27/04/2016.\n  */\nangular.module('ocf.forgotPassword', ['ui.router'])\n\n  .config(function config($stateProvider) {\n    $stateProvider.state('ocf.forgotPassword', {\n      url: '/forgotPassword',\n      views: {\n        \"ocf\": {\n          controller: 'ForgotPasswordController',\n          templateUrl: 'passwordMgmt/forgotPassword/forgotPassword.html'\n        }\n      }\n    })\n  });\n","/**\n * Created by FMG on 27/04/2016.\n */\nangular.module('ocf.changePassword', ['ui.router'])\n\n  .config(function config($stateProvider) {\n    $stateProvider\n      .state('ocf.changePassword', {\n        url: '/changePassword',\n        views: {\n          \"ocf\": {\n            controller: 'ChangePasswordController',\n            templateUrl: 'passwordMgmt/changePassword/changePassword.html'\n          }\n        }\n      })\n  });\n","angular.module('ocf.login', [\n  'ui.router'\n])\n\n  .config(function config($stateProvider) {\n    $stateProvider.state('ocf.login', {\n      url: '/login',\n      views: {\n        \"ocf\": {\n          controller: 'LoginController',\n          templateUrl: 'login/templates/login.html'\n        }\n      },\n      resolve: {},\n      data: {}\n    })\n  })\n\n  .controller('LoginController', [\n    '$scope',\n    '$timeout',\n    '$rootScope',\n    'SessionService',\n    'navigateTo',\n    'ReplicationService',\n    'LoadingService',\n    'MessageService',\n    'CouchDbConfig',\n    'encode',\n    'URLManager',\n    '$resource',\n    '$q',\n    '$http',\n    'DataLayerService',\n    'StagingConfigurationService',\n    '$ionicPlatform',\n    'AutoLogoutPopupService',\n    '$log',\n    '$window',\n    'lodash',\n    'LoggingService',\n    'OCFConfigurationService',\n    'UserPreferenceService',\n    '$translate',\n    function ($scope,\n              $timeout,\n              $rootScope,\n              SessionService,\n              navigateTo,\n              ReplicationService,\n              LoadingService,\n              MessageService,\n              CouchDbConfig,\n              encode,\n              URLManager,\n              $resource,\n              $q,\n              $http,\n              DataLayerService,\n              StagingConfigurationService,\n              $ionicPlatform,\n              AutoLogoutPopupService,\n              $log,\n              $window,\n              _,\n              LoggingService,\n              OCFConfigurationService,\n              UserPreferenceService,\n              $translate) {\n\n      $scope.goToPreviousState = goToPreviousState;\n      var backupUsername = \"Username\";\n      var backupPassword = \"Password\";\n\n      $scope.form = {\n        username: backupUsername,\n        password: backupPassword\n\n      };\n\n      var deregisterGoToPreviousState;\n      $scope.heightScreen = $window.screen.height;\n\n      $scope.$on('$ionicView.beforeEnter', function () {\n        deregisterGoToPreviousState = $ionicPlatform.registerBackButtonAction(goToPreviousState, 501);\n        if ($window.localStorage.getItem('sessionExpired') === 'true') {\n          $scope.autoLogoutPopup = AutoLogoutPopupService;\n\n          $scope.autoLogoutPopup.create('', {scope: $scope})\n            .then(function (success) {\n              $log.debug(success);\n              LoadingService.hide();\n              $scope.autoLogoutPopup.open();\n            })\n            .catch(function (fail) {\n              $log.error(fail);\n            });\n        }\n\n        $translate([\n          'OCF.LOGIN.USERNAME_PLACEHOLDER',\n          'OCF.LOGIN.PASSWORD_PLACEHOLDER'\n        ]).then(function (placeholders) {\n          $scope.form.username = placeholders['OCF.LOGIN.USERNAME_PLACEHOLDER'];\n          $scope.form.backupUsername = placeholders['OCF.LOGIN.USERNAME_PLACEHOLDER'];\n          $scope.form.password = placeholders['OCF.LOGIN.PASSWORD_PLACEHOLDER'];\n          $scope.form.backupPassword = placeholders['OCF.LOGIN.PASSWORD_PLACEHOLDER'];\n        });\n      });\n\n      $scope.$on('$ionicView.beforeLeave', function () {\n        $log.debug('$ionicView.beforeLeave');\n        $ionicPlatform.offHardwareBackButton(goToPreviousState);\n      });\n\n      $scope.$on('$ionicView.afterEnter', function () {\n        if ($scope.heightScreen < 480) {\n          var usernameInputBlock = document.getElementById(\"usernameInput\").getBoundingClientRect(); // top, right, bottom, left, width\n          var passwordInputBlock = document.getElementById(\"passwordInput\").getBoundingClientRect();\n          var arrayInputs = [\"usernameInput\", \"passwordInput\"];\n\n          for (var i = 0; i < arrayInputs.length; i++) {\n            document.getElementById(arrayInputs[i]).addEventListener('touchend', function (element) {\n              var $element = $(element.target);\n              $timeout(function () {\n                if ($element.attr('id') == \"usernameInput\") delete $scope.form.username;\n                else delete $scope.form.password;\n              }, 100);\n            });\n          }\n\n          document.addEventListener('touchend', _onTouchEnd);\n\n          function _onTouchEnd(event) {\n            var touches = event.changedTouches[0]; // clientX, clientY\n\n            // username\n            if (_touchesInput(usernameInputBlock, touches)) {\n              delete $scope.form.username;\n            } else {\n              $scope.form.username = backupUsername;\n            }\n\n            // password\n            if (_touchesInput(passwordInputBlock, touches)) {\n              delete $scope.form.password;\n            } else {\n              $scope.form.password = backupPassword;\n            }\n          }\n\n          function _touchesInput(inputBoundaries, touches) {\n            return inputBoundaries.left <= touches.clientX && inputBoundaries.right >= touches.clientX\n              && inputBoundaries.top <= touches.clientY && inputBoundaries.bottom >= touches.clientY;\n          }\n        }\n      });\n\n      $scope.$on('$destroy', function () {\n        $log.debug(\"$destroy\");\n        deregisterGoToPreviousState();\n      });\n\n      /**\n       * Function that overrides the hardbackbutton behavior\n       */\n      function goToPreviousState(e) {\n        if (!!e) {\n          e.preventDefault();\n        }\n        return;\n      }\n\n      $scope.loginData = {};\n      $scope.appVersion = \"v\";\n      $scope.heightScreen = $window.screen.height;\n      $scope.forgotPassword = forgotPassword;\n\n      $rootScope.$on('appVersion', function (event, appVersion) {\n        $scope.appVersion += appVersion;\n      });\n\n      $scope.doLogin = function () {\n        MessageService.clear();\n        // User name should be always lower case.\n\n        if ($scope.loginData && $scope.loginData.username) {\n          $scope.loginData.username = $scope.loginData.username.toLowerCase();\n        }\n\n        var successLoginInfo;\n        var loginData = angular.copy($scope.loginData);\n\n        LoadingService.show(\"verifying credentials\");\n\n        SessionService.login(loginData)\n          .then(function (loginSuccess) {\n            successLoginInfo = loginSuccess;\n\n            //set the current user\n            $rootScope.user = loginSuccess;\n            $rootScope.userRecoverData = {};\n\n            // Only supplier user could login into the app\n            if ($rootScope.user.accountTypeId != 2) {\n              throw {\n                status: 500,\n                message: 'The user is not a supplier user.',\n                type: 'login'\n              };\n            }\n\n            $scope.locations = $rootScope.user.locations;\n\n            if (!$scope.locations || !$scope.locations[0].appLocations || $scope.locations[0].appLocations.length == 0) {\n              throw {\n                status: 500,\n                message: 'The user does not have access to any application.',\n                type: 'login'\n              };\n            }\n\n            loginSuccess.username = loginSuccess.username.toUpperCase();\n\n            LoadingService.hide();\n            console.log(\"Logged into Zest's WS\");\n\n            if (loginSuccess) {\n              SessionService.setUserData(loginSuccess);\n            }\n\n            LoggingService.logMessage(\n              LoggingService.CONSTANTS.APP.OCF_LOGIN,\n              LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n              'login',\n              'User successfully logged in',\n              'success',\n              [{'key': 'user', 'value': JSON.stringify(loginSuccess)}]\n            );\n          })\n          .then(function (applicationsSuccess) {\n            var userData = SessionService.getUserData($rootScope.user.id);\n\n            $scope.appsList = userData.locations;\n            $rootScope.stagingConfiguration = undefined;\n\n            return StagingConfigurationService.getStagingConfiguration();\n          })\n          .then(function (response) {\n            LoadingService.hide();\n            $rootScope.stagingConfiguration = response;\n\n            return SessionService.clearCredentials();\n          })\n          .then(function () {\n            SessionService.setCredentials(loginData, successLoginInfo);\n\n            console.log(\"setting logged user\");\n            SessionService.setLoggedUserId($rootScope.user.id);\n\n            //TODO: change the way to save this data\n            SessionService.setUserApplications($scope.appsList);\n\n            SessionService.setHeaderCommon();\n\n            //call the WS to retrieve the list of apps available for the user\n            return SessionService.getApplicationsList();\n\n          })\n          .then(function (applicationsSuccess) {\n            $rootScope.appsList = applicationsSuccess;\n            $rootScope.userRecoverData.appsList = $rootScope.appsList;\n            return UserPreferenceService.getUserPreference($rootScope.user.id);\n          })\n          .then(function (response) {\n            $rootScope.userConfiguration = response;\n\n            if ($rootScope.userConfiguration.preferences.language != undefined) {\n              $translate.use($rootScope.userConfiguration.preferences.language);\n              switch ($rootScope.userConfiguration.preferences.language) {\n                case 'es':\n                  $rootScope.selectedLanguage = \"Spanish\";\n                  break;\n                case 'en':\n                  $rootScope.selectedLanguage = \"English\";\n                  break;\n              }\n            } else {\n              $rootScope.selectedLanguage = \"English\";\n              $translate.use('en');\n            }\n            return OCFConfigurationService.retrieveConfigs();\n          })\n          .then(function (ocfConfigs) {\n            //Getting configuration\n            $rootScope.ocfConfigs = ocfConfigs;\n\n            $scope.checkDevice = !!ocfConfigs.filterAppListByDeviceModel;\n\n            $rootScope.checkDevice = $scope.checkDevice;\n            $rootScope.filterAppListByDeviceModel = $scope.filterAppListByDeviceModel;\n\n            if ($scope.locations.length == 1) {\n              $rootScope.selectedLocation = angular.copy($scope.locations[0]);\n\n              $scope.subApps = [\n                {\n                  appName: \"Shipping\",\n                  appCacheName: 'G10',\n                  supportedDevice: /^TC7.+/\n                },\n                {\n                  appName: \"PutAway\",\n                  appCacheName: 'G04',\n                  supportedDevice: /^MC92N0$/\n                }\n              ];\n\n              var supplierApps = [];\n\n              _.remove($scope.subApps, function (app) {\n                return !_.find($rootScope.appsList, {\"appName\": app.appCacheName});\n              });\n\n              supplierApps = _.map($scope.subApps, 'appCacheName');\n\n              $rootScope.apps = _.filter($rootScope.selectedLocation.appLocations, function (app) {\n                return supplierApps.indexOf(app.application) != -1;\n              });\n\n              _.forEach($rootScope.apps, function (app, index) {\n                var subApp = _.find($scope.subApps, {\"appCacheName\": app.application});\n                $rootScope.apps[index].supportedDevice = subApp.supportedDevice;\n              });\n\n              if (!$scope.deviceModel && window.device) {\n                $scope.deviceModel = window.device.model;\n              }\n\n              // Filters app that do not belong to the current Device\n              if ($scope.deviceModel && $scope.checkDevice) _.remove($rootScope.apps, function (app) {\n                var isValidApp = new RegExp(app.supportedDevice);\n                return !$scope.deviceModel.match(isValidApp);\n              });\n\n              if ($rootScope.apps.length != 1) {\n                if ($rootScope.apps.length) {\n                  $log.debug('Login Screen - More than an app, going to app selection screen', JSON.stringify($rootScope.apps));\n                  navigateTo.home();\n                } else {\n                  $log.debug('Login Screen - No apps available');\n                  navigateTo.login();\n                }\n\n              } else {\n                var availableApp = $rootScope.apps[0];\n                var appIndex = _.findIndex($scope.subApps, {\"appCacheName\": availableApp.application});\n\n                if (appIndex == -1) {\n                  $log.debug('Login Screen - No valid app available for the current user');\n                  $scope.userLogout();\n\n                } else {\n                  $scope.subApps[appIndex].selected = true;\n                  $rootScope.app = angular.copy($scope.subApps[appIndex]);\n                  $rootScope.app.appCacheName = $rootScope.app.appCacheName.toUpperCase();\n                  $rootScope.isPilot = $rootScope.app.appName == \"Shipping\";\n                  $rootScope.appLocationId = availableApp.idUUID;\n\n                  LoggingService.logMessage(\n                    LoggingService.CONSTANTS.APP.OCF_LOGIN,\n                    LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n                    'auto_select_location',\n                    'Only one location, skipping screen',\n                    'success',\n                    [{'key': 'location', 'value': JSON.stringify($rootScope.selectedLocation)}]\n                  );\n\n                  navigateTo[availableApp.application.toLowerCase()]();\n                }\n              }\n\n            } else {\n              LoggingService.logMessage(\n                LoggingService.CONSTANTS.APP.OCF_LOGIN,\n                LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n                'login',\n                'Going to location selector',\n                'success',\n                {}\n              );\n\n              navigateTo.locationSelector();\n            }\n          })\n          .catch(function (error) {\n            if (!(error.type === 'remoteStorage' && error.status == 401)) {\n              $log.error(error);\n\n              switch (error.status) {\n                case 0:\n                  MessageService.addErrorMessage(\"No connection available\", true);\n                  break;\n                case 99:\n                  MessageService.addErrorMessage(error.message, true);\n                  break;\n                default:\n                  var readableMessage = error.message + \" (code: \" + error.status + \")\";\n                  MessageService.addErrorMessage(readableMessage, true);\n                  break;\n              }\n\n              LoggingService.logMessage(\n                LoggingService.CONSTANTS.APP.OCF_LOGIN,\n                LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n                'login',\n                'Fail to login',\n                'error',\n                [\n                  {'key': 'error', 'value': JSON.stringify(error)}\n                ]\n              );\n            }\n          })\n          .finally(function () {\n            LoadingService.hide();\n            $scope.loginData = {};\n          });\n      };\n\n      function forgotPassword() {\n        LoggingService.logMessage(\n          LoggingService.CONSTANTS.APP.OCF_LOGIN,\n          LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n          'login',\n          'Going to forgot password screen',\n          'success',\n          {}\n        );\n        navigateTo.forgotPassword();\n      };\n\n      $rootScope.$on('dataRecover', function () {\n\n        var dataRecover = JSON.parse(window.localStorage.getItem(\"dataRecover\"));\n\n        var dataRecoverParam = dataRecover != undefined ? dataRecover : {};\n\n        LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING, 'onDataRecover callback',\n          'Checking if there is data to recover', 'success', [{\n            'key': 'dataRecover',\n            'value': JSON.stringify(dataRecoverParam)\n          }], false);\n\n        if (dataRecover && dataRecover.hasToRecover) {\n\n          dataRecover.hasToRecover = false;\n\n          var user = dataRecover.loginData.user;\n          var userRecoverData = dataRecover.loginData.userRecoverData;\n\n          if (user && userRecoverData) {\n\n            $rootScope.user = angular.copy(user);\n\n            user.username = user.username.toUpperCase();\n\n            SessionService.setUserData(user);\n\n            var currentTime = new Date().getTime();\n            var pausedDate = new Date(dataRecover.createdDateTime).getTime();\n            var logoutTimeoutMilliseconds = dataRecover.loginData.configuration.userInactivityTimeout;\n            var timeout = !!logoutTimeoutMilliseconds ? logoutTimeoutMilliseconds : 0;\n\n            $rootScope.stagingConfiguration = dataRecover.loginData.configuration;\n\n            timeout = pausedDate + timeout;\n\n            // User should be logged out as the timeout for background has ended.\n            if (currentTime >= timeout) {\n              LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING, 'onDataRecover callback',\n                'User should be logged out as the timeout for background has ended', 'success', [{\n                  'key': 'dataRecover',\n                  'value': JSON.stringify(dataRecover)\n                },\n                  {'key': 'logoutTimeoutMilliseconds', 'value': logoutTimeoutMilliseconds}], false);\n\n              window.localStorage.setItem(\"dataRecover\", JSON.stringify({}));\n\n              $rootScope.$emit('logout', true);\n            } else {\n              LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING, 'onDataRecover callback',\n                'Has to recover', 'success', [{'key': 'dataRecover', 'value': JSON.stringify(dataRecover)}], false);\n\n              var selectedLocation = dataRecover.loginData.selectedLocation;\n              var selectedApp = dataRecover.loginData.selectedApp;\n              var selectedLanguage = dataRecover.loginData.selectedLanguage;\n              var locations = dataRecover.loginData.locations;\n              var apps = dataRecover.loginData.apps;\n              var checkDevice = dataRecover.loginData.checkDevice;\n              var filterAppListByDeviceModel = dataRecover.loginData.filterAppListByDeviceModel;\n              var userConfiguration = dataRecover.loginData.userConfiguration;\n\n              delete dataRecover.loginData;\n              delete dataRecover.hasToRecover;\n              delete dataRecover.createdDateTime;\n\n              window.localStorage.setItem(\"dataRecover\", JSON.stringify(dataRecover));\n\n              $rootScope.userRecoverData = userRecoverData;\n              $rootScope.appsList = userRecoverData.appsList;\n              $rootScope.userConfiguration = userConfiguration;\n\n              $rootScope.ocfConfigs = {\n                filterAppListByDeviceModel: filterAppListByDeviceModel\n              };\n\n              SessionService.clearCredentials().then(function () {\n\n                var loginData = {\n                  username: user.username\n                };\n\n                SessionService.setCredentials(loginData, user);\n                SessionService.setLoggedUserId(user.id);\n                SessionService.setUserApplications(userRecoverData.appsList);\n                SessionService.setHeaderCommon();\n              });\n\n              $rootScope.selectedLanguage = selectedLanguage;\n\n              if (!selectedLanguage) {\n                $rootScope.selectedLanguage = \"English\";\n                $translate.use('en');\n              }\n\n              if (selectedLocation || locations.length == 1) {\n\n                var locToSelect = selectedLocation;\n\n                if (!selectedLocation) {\n                  locToSelect = locations[0];\n                }\n\n                $rootScope.selectedLocation = angular.copy(locToSelect);\n\n                $scope.subApps = [\n                  {\n                    appName: \"Shipping\",\n                    appCacheName: 'G10',\n                    supportedDevice: /^TC7.+/\n                  },\n                  {\n                    appName: \"PutAway\",\n                    appCacheName: 'G04',\n                    supportedDevice: /^MC92N0$/\n                  }\n                ];\n\n                var supplierApps = [];\n\n                _.remove($scope.subApps, function (app) {\n                  return !_.find($rootScope.appsList, {\"appName\": app.appCacheName});\n                });\n\n                supplierApps = _.map($scope.subApps, 'appCacheName');\n\n                $rootScope.apps = _.filter($rootScope.selectedLocation.appLocations, function (app) {\n                  return supplierApps.indexOf(app.application) != -1;\n                });\n\n                _.forEach($rootScope.apps, function (app, index) {\n                  var subApp = _.find($scope.subApps, {\"appCacheName\": app.application});\n                  $rootScope.apps[index].supportedDevice = subApp.supportedDevice;\n                });\n\n                if (!$scope.deviceModel && window.device) {\n                  $scope.deviceModel = window.device.model;\n                }\n\n                // Filters app that do not belong to the current Device\n                if ($scope.deviceModel && checkDevice) _.remove($rootScope.apps, function (app) {\n                  var isValidApp = new RegExp(app.supportedDevice);\n                  return !$scope.deviceModel.match(isValidApp);\n                });\n\n                if ($rootScope.apps.length != 1 && !selectedApp) {\n                  if ($rootScope.apps.length) {\n                    $log.debug('Login Screen - More than an app, going to app selection screen', JSON.stringify($rootScope.apps));\n                    navigateTo.home();\n                  } else {\n                    $log.debug('Login Screen - No apps available');\n                    navigateTo.login();\n                  }\n\n                } else {\n\n                  var selectedAppIndex = selectedApp != undefined ? _.findIndex($rootScope.apps, {\"application\": selectedApp.appCacheName}) : 0;\n\n                  if(selectedAppIndex != -1) {\n                    $rootScope.app = $rootScope.apps[selectedAppIndex];\n                  } else {\n                    $rootScope.app = $rootScope.apps[0];\n                  }\n\n                  var availableApp = $rootScope.app;\n                  var appIndex = _.findIndex($scope.subApps, {\"appCacheName\": availableApp.application});\n\n                  if (appIndex == -1) {\n                    $log.debug('Login Screen - No valid app available for the current user');\n                    $scope.userLogout();\n\n                  } else {\n                    $scope.subApps[appIndex].selected = true;\n                    $rootScope.app = angular.copy($scope.subApps[appIndex]);\n                    $rootScope.app.appCacheName = $rootScope.app.appCacheName.toUpperCase();\n                    $rootScope.isPilot = $rootScope.app.appName == \"Shipping\";\n                    $rootScope.appLocationId = availableApp.idUUID;\n\n                    LoggingService.logMessage(\n                      LoggingService.CONSTANTS.APP.OCF_LOGIN,\n                      LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n                      'auto_select_location',\n                      'Only one location, skipping screen',\n                      'success',\n                      [{'key': 'location', 'value': JSON.stringify($rootScope.selectedLocation)}]\n                    );\n\n                    navigateTo[availableApp.application.toLowerCase()]();\n                  }\n                }\n\n              } else {\n                LoggingService.logMessage(\n                  LoggingService.CONSTANTS.APP.OCF_LOGIN,\n                  LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,\n                  'login',\n                  'Going to location selector',\n                  'success',\n                  {}\n                );\n\n                navigateTo.locationSelector();\n              }\n            }\n          } else {\n            $rootScope.$broadcast('checkNewVersion');\n          }\n        } else {\n          $rootScope.$broadcast('checkNewVersion');\n        }\n      });\n\n    }\n  ])\n\n;\n","require = (function e(t, n, r) {\r\n  function s(o, u) {\r\n    if (!n[o]) {\r\n      if (!t[o]) {\r\n        var a = typeof require == \"function\" && require;\r\n        if (!u && a)return a(o, !0);\r\n        if (i)return i(o, !0);\r\n        throw new Error(\"Cannot find module '\" + o + \"'\")\r\n      }\r\n      var f = n[o] = {exports: {}};\r\n      t[o][0].call(f.exports, function (e) {\r\n        var n = t[o][1][e];\r\n        return s(n ? n : e)\r\n      }, f, f.exports, e, t, n, r)\r\n    }\r\n    return n[o].exports\r\n  }\r\n\r\n  var i = typeof require == \"function\" && require;\r\n  for (var o = 0; o < r.length; o++)s(r[o]);\r\n  return s\r\n})({\r\n  \"ZeJ/60\": [function (require, module, exports) {\r\n    /*\r\n     * coax\r\n     * https://github.com/jchris/coax\r\n     *\r\n     * Copyright (c) 2013 Chris Anderson\r\n     * Licensed under the Apache license.\r\n     */\r\n    var pax = require(\"pax\"),\r\n      hoax = require(\"hoax\");\r\n\r\n    var coaxPax = pax();\r\n\r\n    coaxPax.extend(\"getQuery\", function (params) {\r\n      params = JSON.parse(JSON.stringify(params));\r\n      var key, keys = [\"key\", \"startkey\", \"endkey\", \"start_key\", \"end_key\"];\r\n      for (var i = 0; i < keys.length; i++) {\r\n        key = keys[i];\r\n        if (params[key]) {\r\n          params[key] = JSON.stringify(params[key]);\r\n        }\r\n      }\r\n      return params;\r\n    });\r\n\r\n    var Coax = module.exports = hoax.makeHoax(coaxPax());\r\n\r\n    Coax.extend(\"changes\", function (opts, cb) {\r\n      if (typeof opts === \"function\") {\r\n        cb = opts;\r\n        opts = {};\r\n      }\r\n      var self = this;\r\n      opts = opts || {};\r\n\r\n\r\n      if (opts.feed == \"continuous\") {\r\n        var listener = self([\"_changes\", opts], function (err, ok) {\r\n          if (err && err.code == \"ETIMEDOUT\") {\r\n            return self.changes(opts, cb); // TODO retry limit?\r\n          } else if (err) {\r\n            return cb(err);\r\n          }\r\n        });\r\n        listener.on(\"data\", function (data) {\r\n          var sep = \"\\n\";\r\n\r\n          // re-emit chunked json data\r\n          eom = data.toString().indexOf(sep)\r\n          msg = data.toString().substring(0, eom)\r\n          remaining = data.toString().substring(eom + 1, data.length)\r\n          if (remaining.length > 0) {\r\n            // console.log(data.toString())\r\n            listener.emit(\"data\", remaining)\r\n          }\r\n\r\n          var json = JSON.parse(msg);\r\n          cb(false, json)\r\n        })\r\n        return listener;\r\n      } else {\r\n        opts.feed = \"longpoll\";\r\n        // opts.since = opts.since || 0;\r\n        // console.log(\"change opts \"+JSON.stringify(opts));\r\n        return self([\"_changes\", opts], function (err, ok) {\r\n          if (err && err.code == \"ETIMEDOUT\") {\r\n            return self.changes(opts, cb); // TODO retry limit?\r\n          } else if (err) {\r\n            return cb(err);\r\n          }\r\n          // console.log(\"changes\", ok)\r\n          ok.results.forEach(function (row) {\r\n            cb(null, row);\r\n          });\r\n          opts.since = ok.last_seq;\r\n          self.changes(opts, cb);\r\n        });\r\n      }\r\n    });\r\n\r\n    Coax.extend(\"forceSave\", function (doc, cb) {\r\n      var api = this(doc._id);\r\n      // console.log(\"forceSave \"+api.pax);\r\n      api.get(function (err, old) {\r\n        if (err && err.error !== \"not_found\") {\r\n          return cb(err);\r\n        }\r\n        if (!err) {\r\n          doc._rev = old._rev;\r\n        }\r\n        // console.log(\"forceSave put\", api.pax, doc._rev)\r\n        api.put(doc, cb);\r\n      });\r\n    });\r\n\r\n\r\n    Coax.extend(\"channels\", function (channels, opts) {\r\n      var self = this;\r\n      var opts = opts || {};\r\n\r\n      opts.filter = \"sync_gateway/bychannel\";\r\n      opts.feed = \"continuous\"\r\n      opts.channels = channels.join(',')\r\n\r\n      // console.log(self.pax.toString())\r\n      var x = function () {\r\n      };\r\n      x.request = true;\r\n      var changes = self(['_changes', opts], x);\r\n      changes.on(\"data\", function (data) {\r\n        var json;\r\n        try {\r\n          var json = JSON.parse(data.toString())\r\n        } catch (e) {\r\n          console.log(\"not json\", data.toString())\r\n        }\r\n        if (json) {\r\n          changes.emit(\"json\", json)\r\n        }\r\n      })\r\n      return changes;\r\n    });\r\n\r\n  }, {\"hoax\": 6, \"pax\": 3}], \"coax\": [function (require, module, exports) {\r\n    module.exports = require('ZeJ/60');\r\n  }, {}], 3: [function (require, module, exports) {\r\n    /*\r\n     * pax\r\n     * https://github.com/jchris/pax\r\n     *\r\n     * Copyright (c) 2013 Chris Anderson\r\n     * Licensed under the APL license.\r\n     */\r\n\r\n    function objToQuery(q) {\r\n      var k, ks = Object.keys(q), v, query = [];\r\n      for (k = 0; k < ks.length; k++) {\r\n        v = q[ks[k]];\r\n        query.push(encodeURIComponent(ks[k]) + '=' + encodeURIComponent(v.toString()));\r\n      }\r\n      return query.join('&');\r\n    }\r\n\r\n// if there is an object in the new path,\r\n// pluck it out and put it on the pax instance;\r\n\r\n    function processPath(path) {\r\n      var query;\r\n      if (path && path.pop && path.length) {\r\n        if (typeof path[path.length - 1] === 'object') {\r\n          path.query = path.pop();\r\n        }\r\n        return path;\r\n      } else if (typeof path === \"object\") { // options\r\n        var empty = [];\r\n        empty.query = path;\r\n        return empty;\r\n      } else if (path) { // string\r\n        return [path];\r\n      } else {\r\n        return [];\r\n      }\r\n    }\r\n\r\n    function merge(target, source) {\r\n      for (var key in source) {\r\n        if (source.hasOwnProperty(key)) {\r\n          target[key] = source[key];\r\n        }\r\n      }\r\n      return target;\r\n    }\r\n\r\n    function mergePaths(path, newPath) {\r\n      var k, merged = path.concat(newPath);\r\n      merged.methods = {};\r\n      if (path.query) {\r\n        merged.query = merge({}, path.query);\r\n      }\r\n      if (newPath.query) {\r\n        merged.query = merge(merged.query || {}, newPath.query);\r\n      }\r\n      if (typeof path.getQuery !== 'undefined') {\r\n        merged.getQuery = path.getQuery;\r\n      }\r\n      for (k in path.methods) {\r\n        merged.methods[k] = path.methods[k];\r\n      }\r\n\r\n      // if (typeof newPath.getQuery !== 'undefined') {\r\n      //   merged.getQuery = newPath.getQuery;\r\n      // }\r\n      return merged;\r\n    }\r\n\r\n    function makeToString(path) {\r\n      var first = true,\r\n        encoded = path.map(function (p) {\r\n          if (first) {\r\n            first = false;\r\n            if (/^http/.test(p)) {\r\n              if (/\\/$/.test(p)) {\r\n                return p.substring(0, p.length - 1);\r\n              } else {\r\n                return p;\r\n              }\r\n            }\r\n          }\r\n          return encodeURIComponent(p);\r\n        });\r\n\r\n      return function () {\r\n        if (path.query) {\r\n          var qobj;\r\n          if (path.getQuery || this.getQuery) {\r\n            qobj = (path.getQuery || this.getQuery)(path.query);\r\n          } else {\r\n            qobj = path.query;\r\n          }\r\n          return encoded.join('/') + '?' + objToQuery(qobj);\r\n        } else {\r\n          return encoded.join('/');\r\n        }\r\n      };\r\n    }\r\n\r\n    function extenderizer(path) {\r\n      path.methods = path.methods || {};\r\n      return function (name, fun) {\r\n        path.methods[name] = fun;\r\n        this[name] = fun;\r\n      };\r\n    }\r\n\r\n    function addExtensions(pax, path) {\r\n      var k;\r\n      for (k in path.methods) {\r\n        pax[k] = path.methods[k];\r\n      }\r\n    }\r\n\r\n    var growPax;\r\n\r\n    function makeNextPathFun(path) {\r\n      var nextPax = function (nextPath) {\r\n        // console.log(\"nextPax\",nextPax);\r\n        if (typeof nextPax.getQuery !== 'undefined') {\r\n          path.getQuery = nextPax.getQuery;\r\n        }\r\n        if (arguments.length > 1) {\r\n          return growPax(path, [].map.call(arguments, function (arg) {\r\n            return arg;\r\n          }));\r\n        } else {\r\n          return growPax(path, nextPath);\r\n        }\r\n      };\r\n      addExtensions(nextPax, path);\r\n      nextPax.extend = extenderizer(path);\r\n      // console.log([\"pax\", path, path.query]);\r\n      nextPax.toString = makeToString(path);\r\n      // console.log([\"paxs\", nextPax.toString()]);\r\n      return nextPax;\r\n    }\r\n\r\n    function growPax(path, newPath) {\r\n      newPath = processPath(newPath);\r\n      path = mergePaths(path, newPath);\r\n      return makeNextPathFun(path);\r\n    }\r\n\r\n    module.exports = makeNextPathFun([]);\r\n\r\n\r\n  }, {}], \"T81WCk\": [function (require, module, exports) {\r\n    /**\r\n     * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.\r\n     *\r\n     * @version 0.6.11\r\n     * @codingstandard ftlabs-jsv2\r\n     * @copyright The Financial Times Limited [All Rights Reserved]\r\n     * @license MIT License (see LICENSE.txt)\r\n     */\r\n\r\n    /*jslint browser:true, node:true*/\r\n    /*global define, Event, Node*/\r\n\r\n\r\n    /**\r\n     * Instantiate fast-clicking listeners on the specificed layer.\r\n     *\r\n     * @constructor\r\n     * @param {Element} layer The layer to listen on\r\n     */\r\n    function FastClick(layer) {\r\n      'use strict';\r\n      var oldOnClick, self = this;\r\n\r\n\r\n      /**\r\n       * Whether a click is currently being tracked.\r\n       *\r\n       * @type boolean\r\n       */\r\n      this.trackingClick = false;\r\n\r\n\r\n      /**\r\n       * Timestamp for when when click tracking started.\r\n       *\r\n       * @type number\r\n       */\r\n      this.trackingClickStart = 0;\r\n\r\n\r\n      /**\r\n       * The element being tracked for a click.\r\n       *\r\n       * @type EventTarget\r\n       */\r\n      this.targetElement = null;\r\n\r\n\r\n      /**\r\n       * X-coordinate of touch start event.\r\n       *\r\n       * @type number\r\n       */\r\n      this.touchStartX = 0;\r\n\r\n\r\n      /**\r\n       * Y-coordinate of touch start event.\r\n       *\r\n       * @type number\r\n       */\r\n      this.touchStartY = 0;\r\n\r\n\r\n      /**\r\n       * ID of the last touch, retrieved from Touch.identifier.\r\n       *\r\n       * @type number\r\n       */\r\n      this.lastTouchIdentifier = 0;\r\n\r\n\r\n      /**\r\n       * Touchmove boundary, beyond which a click will be cancelled.\r\n       *\r\n       * @type number\r\n       */\r\n      this.touchBoundary = 10;\r\n\r\n\r\n      /**\r\n       * The FastClick layer.\r\n       *\r\n       * @type Element\r\n       */\r\n      this.layer = layer;\r\n\r\n      if (!layer || !layer.nodeType) {\r\n        throw new TypeError('Layer must be a document node');\r\n      }\r\n\r\n      /** @type function() */\r\n      this.onClick = function () {\r\n        return FastClick.prototype.onClick.apply(self, arguments);\r\n      };\r\n\r\n      /** @type function() */\r\n      this.onMouse = function () {\r\n        return FastClick.prototype.onMouse.apply(self, arguments);\r\n      };\r\n\r\n      /** @type function() */\r\n      this.onTouchStart = function () {\r\n        return FastClick.prototype.onTouchStart.apply(self, arguments);\r\n      };\r\n\r\n      /** @type function() */\r\n      this.onTouchMove = function () {\r\n        return FastClick.prototype.onTouchMove.apply(self, arguments);\r\n      };\r\n\r\n      /** @type function() */\r\n      this.onTouchEnd = function () {\r\n        return FastClick.prototype.onTouchEnd.apply(self, arguments);\r\n      };\r\n\r\n      /** @type function() */\r\n      this.onTouchCancel = function () {\r\n        return FastClick.prototype.onTouchCancel.apply(self, arguments);\r\n      };\r\n\r\n      if (FastClick.notNeeded(layer)) {\r\n        return;\r\n      }\r\n\r\n      // Set up event handlers as required\r\n      if (this.deviceIsAndroid) {\r\n        layer.addEventListener('mouseover', this.onMouse, true);\r\n        layer.addEventListener('mousedown', this.onMouse, true);\r\n        layer.addEventListener('mouseup', this.onMouse, true);\r\n      }\r\n\r\n      layer.addEventListener('click', this.onClick, true);\r\n      layer.addEventListener('touchstart', this.onTouchStart, false);\r\n      layer.addEventListener('touchmove', this.onTouchMove, false);\r\n      layer.addEventListener('touchend', this.onTouchEnd, false);\r\n      layer.addEventListener('touchcancel', this.onTouchCancel, false);\r\n\r\n      // Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)\r\n      // which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick\r\n      // layer when they are cancelled.\r\n      if (!Event.prototype.stopImmediatePropagation) {\r\n        layer.removeEventListener = function (type, callback, capture) {\r\n          var rmv = Node.prototype.removeEventListener;\r\n          if (type === 'click') {\r\n            rmv.call(layer, type, callback.hijacked || callback, capture);\r\n          } else {\r\n            rmv.call(layer, type, callback, capture);\r\n          }\r\n        };\r\n\r\n        layer.addEventListener = function (type, callback, capture) {\r\n          var adv = Node.prototype.addEventListener;\r\n          if (type === 'click') {\r\n            adv.call(layer, type, callback.hijacked || (callback.hijacked = function (event) {\r\n                if (!event.propagationStopped) {\r\n                  callback(event);\r\n                }\r\n              }), capture);\r\n          } else {\r\n            adv.call(layer, type, callback, capture);\r\n          }\r\n        };\r\n      }\r\n\r\n      // If a handler is already declared in the element's onclick attribute, it will be fired before\r\n      // FastClick's onClick handler. Fix this by pulling out the user-defined handler function and\r\n      // adding it as listener.\r\n      if (typeof layer.onclick === 'function') {\r\n\r\n        // Android browser on at least 3.2 requires a new reference to the function in layer.onclick\r\n        // - the old one won't work if passed to addEventListener directly.\r\n        oldOnClick = layer.onclick;\r\n        layer.addEventListener('click', function (event) {\r\n          oldOnClick(event);\r\n        }, false);\r\n        layer.onclick = null;\r\n      }\r\n    }\r\n\r\n\r\n    /**\r\n     * Android requires exceptions.\r\n     *\r\n     * @type boolean\r\n     */\r\n    FastClick.prototype.deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0;\r\n\r\n\r\n    /**\r\n     * iOS requires exceptions.\r\n     *\r\n     * @type boolean\r\n     */\r\n    FastClick.prototype.deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent);\r\n\r\n\r\n    /**\r\n     * iOS 4 requires an exception for select elements.\r\n     *\r\n     * @type boolean\r\n     */\r\n    FastClick.prototype.deviceIsIOS4 = FastClick.prototype.deviceIsIOS && (/OS 4_\\d(_\\d)?/).test(navigator.userAgent);\r\n\r\n\r\n    /**\r\n     * iOS 6.0(+?) requires the target element to be manually derived\r\n     *\r\n     * @type boolean\r\n     */\r\n    FastClick.prototype.deviceIsIOSWithBadTarget = FastClick.prototype.deviceIsIOS && (/OS ([6-9]|\\d{2})_\\d/).test(navigator.userAgent);\r\n\r\n\r\n    /**\r\n     * Determine whether a given element requires a native click.\r\n     *\r\n     * @param {EventTarget|Element} target Target DOM element\r\n     * @returns {boolean} Returns true if the element needs a native click\r\n     */\r\n    FastClick.prototype.needsClick = function (target) {\r\n      'use strict';\r\n      switch (target.nodeName.toLowerCase()) {\r\n\r\n        // Don't send a synthetic click to disabled inputs (issue #62)\r\n        case 'button':\r\n        case 'select':\r\n        case 'textarea':\r\n          if (target.disabled) {\r\n            return true;\r\n          }\r\n\r\n          break;\r\n        case 'input':\r\n\r\n          // File inputs need real clicks on iOS 6 due to a browser bug (issue #68)\r\n          if ((this.deviceIsIOS && target.type === 'file') || target.disabled) {\r\n            return true;\r\n          }\r\n\r\n          break;\r\n        case 'label':\r\n        case 'video':\r\n          return true;\r\n      }\r\n\r\n      return (/\\bneedsclick\\b/).test(target.className);\r\n    };\r\n\r\n\r\n    /**\r\n     * Determine whether a given element requires a call to focus to simulate click into element.\r\n     *\r\n     * @param {EventTarget|Element} target Target DOM element\r\n     * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.\r\n     */\r\n    FastClick.prototype.needsFocus = function (target) {\r\n      'use strict';\r\n      switch (target.nodeName.toLowerCase()) {\r\n        case 'textarea':\r\n          return true;\r\n        case 'select':\r\n          return !this.deviceIsAndroid;\r\n        case 'input':\r\n          switch (target.type) {\r\n            case 'button':\r\n            case 'checkbox':\r\n            case 'file':\r\n            case 'image':\r\n            case 'radio':\r\n            case 'submit':\r\n              return false;\r\n          }\r\n\r\n          // No point in attempting to focus disabled inputs\r\n          return !target.disabled && !target.readOnly;\r\n        default:\r\n          return (/\\bneedsfocus\\b/).test(target.className);\r\n      }\r\n    };\r\n\r\n\r\n    /**\r\n     * Send a click event to the specified element.\r\n     *\r\n     * @param {EventTarget|Element} targetElement\r\n     * @param {Event} event\r\n     */\r\n    FastClick.prototype.sendClick = function (targetElement, event) {\r\n      'use strict';\r\n      var clickEvent, touch;\r\n\r\n      // On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)\r\n      if (document.activeElement && document.activeElement !== targetElement) {\r\n        document.activeElement.blur();\r\n      }\r\n\r\n      touch = event.changedTouches[0];\r\n\r\n      // Synthesise a click event, with an extra attribute so it can be tracked\r\n      clickEvent = document.createEvent('MouseEvents');\r\n      clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);\r\n      clickEvent.forwardedTouchEvent = true;\r\n      targetElement.dispatchEvent(clickEvent);\r\n    };\r\n\r\n    FastClick.prototype.determineEventType = function (targetElement) {\r\n      'use strict;'\r\n\r\n      //Issue #159: Android Chrome Select Box does not open with a synthetic click event\r\n      if (this.deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {\r\n        return 'mousedown';\r\n      }\r\n\r\n      return 'click';\r\n    }\r\n\r\n\r\n    /**\r\n     * @param {EventTarget|Element} targetElement\r\n     */\r\n    FastClick.prototype.focus = function (targetElement) {\r\n      'use strict';\r\n      var length;\r\n\r\n      // Issue #160: on iOS 7, some input elements (e.g. date datetime) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.\r\n      if (this.deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time') {\r\n        length = targetElement.value.length;\r\n        targetElement.setSelectionRange(length, length);\r\n      } else {\r\n        targetElement.focus();\r\n      }\r\n    };\r\n\r\n\r\n    /**\r\n     * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.\r\n     *\r\n     * @param {EventTarget|Element} targetElement\r\n     */\r\n    FastClick.prototype.updateScrollParent = function (targetElement) {\r\n      'use strict';\r\n      var scrollParent, parentElement;\r\n\r\n      scrollParent = targetElement.fastClickScrollParent;\r\n\r\n      // Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the\r\n      // target element was moved to another parent.\r\n      if (!scrollParent || !scrollParent.contains(targetElement)) {\r\n        parentElement = targetElement;\r\n        do {\r\n          if (parentElement.scrollHeight > parentElement.offsetHeight) {\r\n            scrollParent = parentElement;\r\n            targetElement.fastClickScrollParent = parentElement;\r\n            break;\r\n          }\r\n\r\n          parentElement = parentElement.parentElement;\r\n        } while (parentElement);\r\n      }\r\n\r\n      // Always update the scroll top tracker if possible.\r\n      if (scrollParent) {\r\n        scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;\r\n      }\r\n    };\r\n\r\n\r\n    /**\r\n     * @param {EventTarget} targetElement\r\n     * @returns {Element|EventTarget}\r\n     */\r\n    FastClick.prototype.getTargetElementFromEventTarget = function (eventTarget) {\r\n      'use strict';\r\n\r\n      // On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.\r\n      if (eventTarget.nodeType === Node.TEXT_NODE) {\r\n        return eventTarget.parentNode;\r\n      }\r\n\r\n      return eventTarget;\r\n    };\r\n\r\n\r\n    /**\r\n     * On touch start, record the position and scroll offset.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.onTouchStart = function (event) {\r\n      'use strict';\r\n      var targetElement, touch, selection;\r\n\r\n      // Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).\r\n      if (event.targetTouches.length > 1) {\r\n        return true;\r\n      }\r\n\r\n      targetElement = this.getTargetElementFromEventTarget(event.target);\r\n      touch = event.targetTouches[0];\r\n\r\n      if (this.deviceIsIOS) {\r\n\r\n        // Only trusted events will deselect text on iOS (issue #49)\r\n        selection = window.getSelection();\r\n        if (selection.rangeCount && !selection.isCollapsed) {\r\n          return true;\r\n        }\r\n\r\n        if (!this.deviceIsIOS4) {\r\n\r\n          // Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):\r\n          // when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched\r\n          // with the same identifier as the touch event that previously triggered the click that triggered the alert.\r\n          // Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an\r\n          // immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.\r\n          if (touch.identifier === this.lastTouchIdentifier) {\r\n            event.preventDefault();\r\n            return false;\r\n          }\r\n\r\n          this.lastTouchIdentifier = touch.identifier;\r\n\r\n          // If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:\r\n          // 1) the user does a fling scroll on the scrollable layer\r\n          // 2) the user stops the fling scroll with another tap\r\n          // then the event.target of the last 'touchend' event will be the element that was under the user's finger\r\n          // when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check\r\n          // is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).\r\n          this.updateScrollParent(targetElement);\r\n        }\r\n      }\r\n\r\n      this.trackingClick = true;\r\n      this.trackingClickStart = event.timeStamp;\r\n      this.targetElement = targetElement;\r\n\r\n      this.touchStartX = touch.pageX;\r\n      this.touchStartY = touch.pageY;\r\n\r\n      // Prevent phantom clicks on fast double-tap (issue #36)\r\n      if ((event.timeStamp - this.lastClickTime) < 200) {\r\n        event.preventDefault();\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n\r\n    /**\r\n     * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.touchHasMoved = function (event) {\r\n      'use strict';\r\n      var touch = event.changedTouches[0], boundary = this.touchBoundary;\r\n\r\n      if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n\r\n    /**\r\n     * Update the last position.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.onTouchMove = function (event) {\r\n      'use strict';\r\n      if (!this.trackingClick) {\r\n        return true;\r\n      }\r\n\r\n      // If the touch has moved, cancel the click tracking\r\n      if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {\r\n        this.trackingClick = false;\r\n        this.targetElement = null;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n\r\n    /**\r\n     * Attempt to find the labelled control for the given label element.\r\n     *\r\n     * @param {EventTarget|HTMLLabelElement} labelElement\r\n     * @returns {Element|null}\r\n     */\r\n    FastClick.prototype.findControl = function (labelElement) {\r\n      'use strict';\r\n\r\n      // Fast path for newer browsers supporting the HTML5 control attribute\r\n      if (labelElement.control !== undefined) {\r\n        return labelElement.control;\r\n      }\r\n\r\n      // All browsers under test that support touch events also support the HTML5 htmlFor attribute\r\n      if (labelElement.htmlFor) {\r\n        return document.getElementById(labelElement.htmlFor);\r\n      }\r\n\r\n      // If no for attribute exists, attempt to retrieve the first labellable descendant element\r\n      // the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label\r\n      return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');\r\n    };\r\n\r\n\r\n    /**\r\n     * On touch end, determine whether to send a click event at once.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.onTouchEnd = function (event) {\r\n      'use strict';\r\n      var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;\r\n\r\n      if (!this.trackingClick) {\r\n        return true;\r\n      }\r\n\r\n      // Prevent phantom clicks on fast double-tap (issue #36)\r\n      if ((event.timeStamp - this.lastClickTime) < 200) {\r\n        this.cancelNextClick = true;\r\n        return true;\r\n      }\r\n\r\n      // Reset to prevent wrong click cancel on input (issue #156).\r\n      this.cancelNextClick = false;\r\n\r\n      this.lastClickTime = event.timeStamp;\r\n\r\n      trackingClickStart = this.trackingClickStart;\r\n      this.trackingClick = false;\r\n      this.trackingClickStart = 0;\r\n\r\n      // On some iOS devices, the targetElement supplied with the event is invalid if the layer\r\n      // is performing a transition or scroll, and has to be re-detected manually. Note that\r\n      // for this to function correctly, it must be called *after* the event target is checked!\r\n      // See issue #57; also filed as rdar://13048589 .\r\n      if (this.deviceIsIOSWithBadTarget) {\r\n        touch = event.changedTouches[0];\r\n\r\n        // In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null\r\n        targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;\r\n        targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;\r\n      }\r\n\r\n      targetTagName = targetElement.tagName.toLowerCase();\r\n      if (targetTagName === 'label') {\r\n        forElement = this.findControl(targetElement);\r\n        if (forElement) {\r\n          this.focus(targetElement);\r\n          if (this.deviceIsAndroid) {\r\n            return false;\r\n          }\r\n\r\n          targetElement = forElement;\r\n        }\r\n      } else if (this.needsFocus(targetElement)) {\r\n\r\n        // Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.\r\n        // Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).\r\n        if ((event.timeStamp - trackingClickStart) > 100 || (this.deviceIsIOS && window.top !== window && targetTagName === 'input')) {\r\n          this.targetElement = null;\r\n          return false;\r\n        }\r\n\r\n        this.focus(targetElement);\r\n\r\n        // Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.\r\n        if (!this.deviceIsIOS4 || targetTagName !== 'select') {\r\n          this.targetElement = null;\r\n          event.preventDefault();\r\n        }\r\n\r\n        return false;\r\n      }\r\n\r\n      if (this.deviceIsIOS && !this.deviceIsIOS4) {\r\n\r\n        // Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled\r\n        // and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).\r\n        scrollParent = targetElement.fastClickScrollParent;\r\n        if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      // Prevent the actual click from going though - unless the target node is marked as requiring\r\n      // real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.\r\n      if (!this.needsClick(targetElement)) {\r\n        event.preventDefault();\r\n        this.sendClick(targetElement, event);\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n\r\n    /**\r\n     * On touch cancel, stop tracking the click.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    FastClick.prototype.onTouchCancel = function () {\r\n      'use strict';\r\n      this.trackingClick = false;\r\n      this.targetElement = null;\r\n    };\r\n\r\n\r\n    /**\r\n     * Determine mouse events which should be permitted.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.onMouse = function (event) {\r\n      'use strict';\r\n\r\n      // If a target element was never set (because a touch event was never fired) allow the event\r\n      if (!this.targetElement) {\r\n        return true;\r\n      }\r\n\r\n      if (event.forwardedTouchEvent) {\r\n        return true;\r\n      }\r\n\r\n      // Programmatically generated events targeting a specific element should be permitted\r\n      if (!event.cancelable) {\r\n        return true;\r\n      }\r\n\r\n      // Derive and check the target element to see whether the mouse event needs to be permitted;\r\n      // unless explicitly enabled, prevent non-touch click events from triggering actions,\r\n      // to prevent ghost/doubleclicks.\r\n      if (!this.needsClick(this.targetElement) || this.cancelNextClick) {\r\n\r\n        // Prevent any user-added listeners declared on FastClick element from being fired.\r\n        if (event.stopImmediatePropagation) {\r\n          event.stopImmediatePropagation();\r\n        } else {\r\n\r\n          // Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)\r\n          event.propagationStopped = true;\r\n        }\r\n\r\n        // Cancel the event\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n\r\n        return false;\r\n      }\r\n\r\n      // If the mouse event is permitted, return true for the action to go through.\r\n      return true;\r\n    };\r\n\r\n\r\n    /**\r\n     * On actual clicks, determine whether this is a touch-generated click, a click action occurring\r\n     * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or\r\n     * an actual click which should be permitted.\r\n     *\r\n     * @param {Event} event\r\n     * @returns {boolean}\r\n     */\r\n    FastClick.prototype.onClick = function (event) {\r\n      'use strict';\r\n      var permitted;\r\n\r\n      // It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.\r\n      if (this.trackingClick) {\r\n        this.targetElement = null;\r\n        this.trackingClick = false;\r\n        return true;\r\n      }\r\n\r\n      // Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.\r\n      if (event.target.type === 'submit' && event.detail === 0) {\r\n        return true;\r\n      }\r\n\r\n      permitted = this.onMouse(event);\r\n\r\n      // Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.\r\n      if (!permitted) {\r\n        this.targetElement = null;\r\n      }\r\n\r\n      // If clicks are permitted, return true for the action to go through.\r\n      return permitted;\r\n    };\r\n\r\n\r\n    /**\r\n     * Remove all FastClick's event listeners.\r\n     *\r\n     * @returns {void}\r\n     */\r\n    FastClick.prototype.destroy = function () {\r\n      'use strict';\r\n      var layer = this.layer;\r\n\r\n      if (this.deviceIsAndroid) {\r\n        layer.removeEventListener('mouseover', this.onMouse, true);\r\n        layer.removeEventListener('mousedown', this.onMouse, true);\r\n        layer.removeEventListener('mouseup', this.onMouse, true);\r\n      }\r\n\r\n      layer.removeEventListener('click', this.onClick, true);\r\n      layer.removeEventListener('touchstart', this.onTouchStart, false);\r\n      layer.removeEventListener('touchmove', this.onTouchMove, false);\r\n      layer.removeEventListener('touchend', this.onTouchEnd, false);\r\n      layer.removeEventListener('touchcancel', this.onTouchCancel, false);\r\n    };\r\n\r\n\r\n    /**\r\n     * Check whether FastClick is needed.\r\n     *\r\n     * @param {Element} layer The layer to listen on\r\n     */\r\n    FastClick.notNeeded = function (layer) {\r\n      'use strict';\r\n      var metaViewport;\r\n\r\n      // Devices that don't support touch don't need FastClick\r\n      if (typeof window.ontouchstart === 'undefined') {\r\n        return true;\r\n      }\r\n\r\n      if ((/Chrome\\/[0-9]+/).test(navigator.userAgent)) {\r\n\r\n        // Chrome on Android with user-scalable=\"no\" doesn't need FastClick (issue #89)\r\n        if (FastClick.prototype.deviceIsAndroid) {\r\n          metaViewport = document.querySelector('meta[name=viewport]');\r\n          if (metaViewport && metaViewport.content.indexOf('user-scalable=no') !== -1) {\r\n            return true;\r\n          }\r\n\r\n          // Chrome desktop doesn't need FastClick (issue #15)\r\n        } else {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      // IE10 with -ms-touch-action: none, which disables double-tap-to-zoom (issue #97)\r\n      if (layer.style.msTouchAction === 'none') {\r\n        return true;\r\n      }\r\n\r\n      return false;\r\n    };\r\n\r\n\r\n    /**\r\n     * Factory method for creating a FastClick object\r\n     *\r\n     * @param {Element} layer The layer to listen on\r\n     */\r\n    FastClick.attach = function (layer) {\r\n      'use strict';\r\n      return new FastClick(layer);\r\n    };\r\n\r\n\r\n    if (typeof define !== 'undefined' && define.amd) {\r\n\r\n      // AMD. Register as an anonymous module.\r\n      define(function () {\r\n        'use strict';\r\n        return FastClick;\r\n      });\r\n    } else if (typeof module !== 'undefined' && module.exports) {\r\n      module.exports = FastClick.attach;\r\n      module.exports.FastClick = FastClick;\r\n    } else {\r\n      window.FastClick = FastClick;\r\n    }\r\n\r\n  }, {}], \"fastclick\": [function (require, module, exports) {\r\n    module.exports = require('T81WCk');\r\n  }, {}], 6: [function (require, module, exports) {\r\n    var core = require(\"./hoax-core\"),\r\n      request = require(\"browser-request\");\r\n\r\n    request.log.debug = function () {\r\n    };\r\n\r\n    module.exports = core(request);\r\n\r\n  }, {\"./hoax-core\": 7, \"browser-request\": 8}], 7: [function (require, module, exports) {\r\n    /*\r\n     * hoax\r\n     * https://github.com/jchris/hoax\r\n     *\r\n     * Copyright (c) 2013 Chris Anderson\r\n     * Licensed under the Apache license.\r\n     */\r\n\r\n    module.exports = function (request) {\r\n      var pax = require(\"pax\");\r\n\r\n      function makeHoaxCallback(cb, verb) {\r\n        return function (err, res, body) {\r\n          // console.log(\"hoax cb\", verb||\"get\", err, res.statusCode, body);\r\n          if (err && err !== \"error\") {\r\n            cb(err, res, body);\r\n          } else {\r\n            if (res.statusCode >= 400 || err === \"error\") {\r\n              cb(body || res.statusCode, res);\r\n            } else {\r\n              cb(null, body);\r\n            }\r\n          }\r\n        };\r\n      }\r\n\r\n      function processArguments(myPax, urlOrOpts, data, cb, verb) {\r\n        var opts = {}, newPax = myPax;\r\n        if (typeof urlOrOpts === 'function') {\r\n          cb = urlOrOpts;\r\n          data = null;\r\n          urlOrOpts = null;\r\n        } else {\r\n          if (urlOrOpts.uri || urlOrOpts.url) {\r\n            newPax = myPax(urlOrOpts.uri || urlOrOpts.url);\r\n          } else {\r\n            if (typeof data === 'function') {\r\n              // we have only 2 args\r\n              // the first is data if it is not an array\r\n              // and the verb is put or post\r\n              cb = data;\r\n              data = null;\r\n              if ((verb === \"put\" || verb === \"post\") &&\r\n                (typeof urlOrOpts !== \"string\" &&\r\n                Object.prototype.toString.call(urlOrOpts) !== '[object Array]')) {\r\n                data = urlOrOpts;\r\n              } else {\r\n                newPax = myPax(urlOrOpts);\r\n              }\r\n            } else {\r\n              newPax = myPax(urlOrOpts);\r\n            }\r\n          }\r\n        }\r\n        opts.headers = {'content-type': 'application/json'};\r\n        opts.json = true;\r\n        opts.uri = newPax.toString();\r\n        if (data) {\r\n          opts.body = JSON.stringify(data);\r\n        }\r\n        return [opts, cb, newPax];\r\n      }\r\n\r\n      function extenderizer(oldHoax) {\r\n        return function (name, fun) {\r\n          this.methods = this.methods || {};\r\n          this.methods[name] = fun;\r\n          this[name] = fun;\r\n        };\r\n      }\r\n\r\n      function addExtensions(newHoax, oldHoax) {\r\n        if (oldHoax && oldHoax.methods) {\r\n          var k;\r\n          for (k in oldHoax.methods) {\r\n            newHoax[k] = oldHoax.methods[k];\r\n          }\r\n        }\r\n      }\r\n\r\n      function makeHoax(myPax, verb, oldHoax) {\r\n        var newHoax = function (opts, data, xcb) {\r\n          var args = processArguments(myPax, opts, data, xcb, verb),\r\n            reqOpts = args[0], // includes uri, body\r\n            cb = args[1],\r\n            newPax = args[2];\r\n          if (cb) {\r\n            // console.log([\"hoax\", verb||\"get\", reqOpts]);\r\n            if (verb) {\r\n              if (verb == \"del\") {\r\n                reqOpts.method = \"DELETE\";\r\n              } else {\r\n                reqOpts.method = verb.toUpperCase();\r\n              }\r\n              return request(reqOpts, makeHoaxCallback(cb, verb));\r\n            } else {\r\n              return request(reqOpts, makeHoaxCallback(cb));\r\n            }\r\n          } else {\r\n            // console.log(\"new hoax\", newPax);\r\n            return makeHoax(newPax, verb, newHoax);\r\n          }\r\n        };\r\n        if (!verb) {\r\n          \"get put post head del\".split(\" \").forEach(function (v) {\r\n            newHoax[v] = makeHoax(myPax, v, newHoax);\r\n          });\r\n        }\r\n        addExtensions(newHoax, oldHoax);\r\n        // should this be extenderizer(newHoax) ?\r\n        newHoax.extend = extenderizer(oldHoax);\r\n        newHoax.pax = myPax; // deprecated\r\n        newHoax.url = myPax;\r\n        return newHoax;\r\n      }\r\n\r\n      var Hoax = makeHoax(pax());\r\n      Hoax.makeHoax = makeHoax;\r\n\r\n      return Hoax;\r\n    };\r\n\r\n  }, {\"pax\": 9}], 8: [function (require, module, exports) {\r\n// Browser Request\r\n//\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n\r\n    var XHR = XMLHttpRequest\r\n    if (!XHR) throw new Error('missing XMLHttpRequest')\r\n\r\n    module.exports = request\r\n    request.log = {\r\n      'trace': noop, 'debug': noop, 'info': noop, 'warn': noop, 'error': noop\r\n    }\r\n\r\n    var DEFAULT_TIMEOUT = 3 * 60 * 1000 // 3 minutes\r\n\r\n//\r\n// request\r\n//\r\n\r\n    function request(options, callback) {\r\n      // The entry-point to the API: prep the options object and pass the real work to run_xhr.\r\n      if (typeof callback !== 'function')\r\n        throw new Error('Bad callback given: ' + callback)\r\n\r\n      if (!options)\r\n        throw new Error('No options given')\r\n\r\n      var options_onResponse = options.onResponse; // Save this for later.\r\n\r\n      if (typeof options === 'string')\r\n        options = {'uri': options};\r\n      else\r\n        options = JSON.parse(JSON.stringify(options)); // Use a duplicate for mutating.\r\n\r\n      options.onResponse = options_onResponse // And put it back.\r\n\r\n      if (options.verbose) request.log = getLogger();\r\n\r\n      if (options.url) {\r\n        options.uri = options.url;\r\n        delete options.url;\r\n      }\r\n\r\n      if (!options.uri && options.uri !== \"\")\r\n        throw new Error(\"options.uri is a required argument\");\r\n\r\n      if (typeof options.uri != \"string\")\r\n        throw new Error(\"options.uri must be a string\");\r\n\r\n      var unsupported_options = ['proxy', '_redirectsFollowed', 'maxRedirects', 'followRedirect']\r\n      for (var i = 0; i < unsupported_options.length; i++)\r\n        if (options[unsupported_options[i]])\r\n          throw new Error(\"options.\" + unsupported_options[i] + \" is not supported\")\r\n\r\n      options.callback = callback\r\n      options.method = options.method || 'GET';\r\n      options.headers = options.headers || {};\r\n      options.body = options.body || null\r\n      options.timeout = options.timeout || request.DEFAULT_TIMEOUT\r\n\r\n      if (options.headers.host)\r\n        throw new Error(\"Options.headers.host is not supported\");\r\n\r\n      if (options.json) {\r\n        options.headers.accept = options.headers.accept || 'application/json'\r\n        if (options.method !== 'GET')\r\n          options.headers['content-type'] = 'application/json'\r\n\r\n        if (typeof options.json !== 'boolean')\r\n          options.body = JSON.stringify(options.json)\r\n        else if (typeof options.body !== 'string')\r\n          options.body = JSON.stringify(options.body)\r\n      }\r\n\r\n      // If onResponse is boolean true, call back immediately when the response is known,\r\n      // not when the full request is complete.\r\n      options.onResponse = options.onResponse || noop\r\n      if (options.onResponse === true) {\r\n        options.onResponse = callback\r\n        options.callback = noop\r\n      }\r\n\r\n      // XXX Browsers do not like this.\r\n      //if(options.body)\r\n      //  options.headers['content-length'] = options.body.length;\r\n\r\n      // HTTP basic authentication\r\n      if (!options.headers.authorization && options.auth)\r\n        options.headers.authorization = 'Basic ' + b64_enc(options.auth.username + ':' + options.auth.password);\r\n\r\n      return run_xhr(options)\r\n    }\r\n\r\n    var req_seq = 0\r\n\r\n    function run_xhr(options) {\r\n      var xhr = new XHR\r\n        , timed_out = false\r\n        , is_cors = is_crossDomain(options.uri)\r\n        , supports_cors = ('withCredentials' in xhr)\r\n\r\n      req_seq += 1\r\n      xhr.seq_id = req_seq\r\n      xhr.id = req_seq + ': ' + options.method + ' ' + options.uri\r\n      xhr._id = xhr.id // I know I will type \"_id\" from habit all the time.\r\n\r\n      if (is_cors && !supports_cors) {\r\n        var cors_err = new Error('Browser does not support cross-origin request: ' + options.uri)\r\n        cors_err.cors = 'unsupported'\r\n        return options.callback(cors_err, xhr)\r\n      }\r\n\r\n      xhr.timeoutTimer = setTimeout(too_late, options.timeout)\r\n      function too_late() {\r\n        timed_out = true\r\n        var er = new Error('ETIMEDOUT')\r\n        er.code = 'ETIMEDOUT'\r\n        er.duration = options.timeout\r\n\r\n        request.log.error('Timeout', {'id': xhr._id, 'milliseconds': options.timeout})\r\n        return options.callback(er, xhr)\r\n      }\r\n\r\n      // Some states can be skipped over, so remember what is still incomplete.\r\n      var did = {'response': false, 'loading': false, 'end': false}\r\n\r\n      xhr.onreadystatechange = on_state_change\r\n      xhr.open(options.method, options.uri, true) // asynchronous\r\n      if (is_cors)\r\n        xhr.withCredentials = !!options.withCredentials\r\n      xhr.send(options.body)\r\n      return xhr\r\n\r\n      function on_state_change(event) {\r\n        if (timed_out)\r\n          return request.log.debug('Ignoring timed out state change', {'state': xhr.readyState, 'id': xhr.id})\r\n\r\n        request.log.debug('State change', {'state': xhr.readyState, 'id': xhr.id, 'timed_out': timed_out})\r\n\r\n        if (xhr.readyState === XHR.OPENED) {\r\n          request.log.debug('Request started', {'id': xhr.id})\r\n          for (var key in options.headers)\r\n            xhr.setRequestHeader(key, options.headers[key])\r\n        }\r\n\r\n        else if (xhr.readyState === XHR.HEADERS_RECEIVED)\r\n          on_response()\r\n\r\n        else if (xhr.readyState === XHR.LOADING) {\r\n          on_response()\r\n          on_loading()\r\n        }\r\n\r\n        else if (xhr.readyState === XHR.DONE) {\r\n          on_response()\r\n          on_loading()\r\n          on_end()\r\n        }\r\n      }\r\n\r\n      function on_response() {\r\n        if (did.response)\r\n          return\r\n\r\n        did.response = true\r\n        request.log.debug('Got response', {'id': xhr.id, 'status': xhr.status})\r\n        clearTimeout(xhr.timeoutTimer)\r\n        xhr.statusCode = xhr.status // Node request compatibility\r\n\r\n        // Detect failed CORS requests.\r\n        if (is_cors && xhr.statusCode == 0) {\r\n          var cors_err = new Error('CORS request rejected: ' + options.uri)\r\n          cors_err.cors = 'rejected'\r\n\r\n          // Do not process this request further.\r\n          did.loading = true\r\n          did.end = true\r\n\r\n          return options.callback(cors_err, xhr)\r\n        }\r\n\r\n        options.onResponse(null, xhr)\r\n      }\r\n\r\n      function on_loading() {\r\n        if (did.loading)\r\n          return\r\n\r\n        did.loading = true\r\n        request.log.debug('Response body loading', {'id': xhr.id})\r\n        // TODO: Maybe simulate \"data\" events by watching xhr.responseText\r\n      }\r\n\r\n      function on_end() {\r\n        if (did.end)\r\n          return\r\n\r\n        did.end = true\r\n        request.log.debug('Request done', {'id': xhr.id})\r\n\r\n        xhr.body = xhr.responseText\r\n        if (options.json) {\r\n          try {\r\n            xhr.body = JSON.parse(xhr.responseText)\r\n          }\r\n          catch (er) {\r\n            return options.callback(er, xhr)\r\n          }\r\n        }\r\n\r\n        options.callback(null, xhr, xhr.body)\r\n      }\r\n\r\n    } // request\r\n\r\n    request.withCredentials = false;\r\n    request.DEFAULT_TIMEOUT = DEFAULT_TIMEOUT;\r\n\r\n//\r\n// defaults\r\n//\r\n\r\n    request.defaults = function (options, requester) {\r\n      var def = function (method) {\r\n        var d = function (params, callback) {\r\n          if (typeof params === 'string')\r\n            params = {'uri': params};\r\n          else {\r\n            params = JSON.parse(JSON.stringify(params));\r\n          }\r\n          for (var i in options) {\r\n            if (params[i] === undefined) params[i] = options[i]\r\n          }\r\n          return method(params, callback)\r\n        }\r\n        return d\r\n      }\r\n      var de = def(request)\r\n      de.get = def(request.get)\r\n      de.post = def(request.post)\r\n      de.put = def(request.put)\r\n      de.head = def(request.head)\r\n      return de\r\n    }\r\n\r\n//\r\n// HTTP method shortcuts\r\n//\r\n\r\n    var shortcuts = ['get', 'put', 'post', 'head'];\r\n    shortcuts.forEach(function (shortcut) {\r\n      var method = shortcut.toUpperCase();\r\n      var func = shortcut.toLowerCase();\r\n\r\n      request[func] = function (opts) {\r\n        if (typeof opts === 'string')\r\n          opts = {'method': method, 'uri': opts};\r\n        else {\r\n          opts = JSON.parse(JSON.stringify(opts));\r\n          opts.method = method;\r\n        }\r\n\r\n        var args = [opts].concat(Array.prototype.slice.apply(arguments, [1]));\r\n        return request.apply(this, args);\r\n      }\r\n    })\r\n\r\n//\r\n// CouchDB shortcut\r\n//\r\n\r\n    request.couch = function (options, callback) {\r\n      if (typeof options === 'string')\r\n        options = {'uri': options}\r\n\r\n      // Just use the request API to do JSON.\r\n      options.json = true\r\n      if (options.body)\r\n        options.json = options.body\r\n      delete options.body\r\n\r\n      callback = callback || noop\r\n\r\n      var xhr = request(options, couch_handler)\r\n      return xhr\r\n\r\n      function couch_handler(er, resp, body) {\r\n        if (er)\r\n          return callback(er, resp, body)\r\n\r\n        if ((resp.statusCode < 200 || resp.statusCode > 299) && body.error) {\r\n          // The body is a Couch JSON object indicating the error.\r\n          er = new Error('CouchDB error: ' + (body.error.reason || body.error.error))\r\n          for (var key in body)\r\n            er[key] = body[key]\r\n          return callback(er, resp, body);\r\n        }\r\n\r\n        return callback(er, resp, body);\r\n      }\r\n    }\r\n\r\n//\r\n// Utility\r\n//\r\n\r\n    function noop() {\r\n    }\r\n\r\n    function getLogger() {\r\n      var logger = {}\r\n        , levels = ['trace', 'debug', 'info', 'warn', 'error']\r\n        , level, i\r\n\r\n      for (i = 0; i < levels.length; i++) {\r\n        level = levels[i]\r\n\r\n        logger[level] = noop\r\n        if (typeof console !== 'undefined' && console && console[level])\r\n          logger[level] = formatted(console, level)\r\n      }\r\n\r\n      return logger\r\n    }\r\n\r\n    function formatted(obj, method) {\r\n      return formatted_logger\r\n\r\n      function formatted_logger(str, context) {\r\n        if (typeof context === 'object')\r\n          str += ' ' + JSON.stringify(context)\r\n\r\n        return obj[method].call(obj, str)\r\n      }\r\n    }\r\n\r\n// Return whether a URL is a cross-domain request.\r\n    function is_crossDomain(url) {\r\n      var rurl = /^([\\w\\+\\.\\-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+))?)?/\r\n\r\n      // jQuery #8138, IE may throw an exception when accessing\r\n      // a field from window.location if document.domain has been set\r\n      var ajaxLocation\r\n      try {\r\n        ajaxLocation = location.href\r\n      }\r\n      catch (e) {\r\n        // Use the href attribute of an A element since IE will modify it given document.location\r\n        ajaxLocation = document.createElement(\"a\");\r\n        ajaxLocation.href = \"\";\r\n        ajaxLocation = ajaxLocation.href;\r\n      }\r\n\r\n      var ajaxLocParts = rurl.exec(ajaxLocation.toLowerCase()) || []\r\n        , parts = rurl.exec(url.toLowerCase())\r\n\r\n      var result = !!(\r\n        parts &&\r\n        (  parts[1] != ajaxLocParts[1]\r\n          || parts[2] != ajaxLocParts[2]\r\n          || (parts[3] || (parts[1] === \"http:\" ? 80 : 443)) != (ajaxLocParts[3] || (ajaxLocParts[1] === \"http:\" ? 80 : 443))\r\n        )\r\n      )\r\n\r\n      //console.debug('is_crossDomain('+url+') -> ' + result)\r\n      return result\r\n    }\r\n\r\n// MIT License from http://phpjs.org/functions/base64_encode:358\r\n    function b64_enc(data) {\r\n      // Encodes string using MIME base64 algorithm\r\n      var b64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\r\n      var o1, o2, o3, h1, h2, h3, h4, bits, i = 0, ac = 0, enc = \"\", tmp_arr = [];\r\n\r\n      if (!data) {\r\n        return data;\r\n      }\r\n\r\n      // assume utf8 data\r\n      // data = this.utf8_encode(data+'');\r\n\r\n      do { // pack three octets into four hexets\r\n        o1 = data.charCodeAt(i++);\r\n        o2 = data.charCodeAt(i++);\r\n        o3 = data.charCodeAt(i++);\r\n\r\n        bits = o1 << 16 | o2 << 8 | o3;\r\n\r\n        h1 = bits >> 18 & 0x3f;\r\n        h2 = bits >> 12 & 0x3f;\r\n        h3 = bits >> 6 & 0x3f;\r\n        h4 = bits & 0x3f;\r\n\r\n        // use hexets to index into b64, and append result to encoded string\r\n        tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\r\n      } while (i < data.length);\r\n\r\n      enc = tmp_arr.join('');\r\n\r\n      switch (data.length % 3) {\r\n        case 1:\r\n          enc = enc.slice(0, -2) + '==';\r\n          break;\r\n        case 2:\r\n          enc = enc.slice(0, -1) + '=';\r\n          break;\r\n      }\r\n\r\n      return enc;\r\n    }\r\n\r\n  }, {}], 9: [function (require, module, exports) {\r\n    module.exports = require(3)\r\n  }, {}], \"mustache\": [function (require, module, exports) {\r\n    module.exports = require('4JMXRT');\r\n  }, {}], \"4JMXRT\": [function (require, module, exports) {\r\n    /*!\r\n     * mustache.js - Logic-less {{mustache}} templates with JavaScript\r\n     * http://github.com/janl/mustache.js\r\n     */\r\n\r\n    /*global define: false*/\r\n\r\n    (function (root, factory) {\r\n      if (typeof exports === \"object\" && exports) {\r\n        module.exports = factory; // CommonJS\r\n      } else if (typeof define === \"function\" && define.amd) {\r\n        define(factory); // AMD\r\n      } else {\r\n        root.Mustache = factory; // <script>\r\n      }\r\n    }(this, (function () {\r\n\r\n      var exports = {};\r\n\r\n      exports.name = \"mustache.js\";\r\n      exports.version = \"0.7.2\";\r\n      exports.tags = [\"{{\", \"}}\"];\r\n\r\n      exports.Scanner = Scanner;\r\n      exports.Context = Context;\r\n      exports.Writer = Writer;\r\n\r\n      var whiteRe = /\\s*/;\r\n      var spaceRe = /\\s+/;\r\n      var nonSpaceRe = /\\S/;\r\n      var eqRe = /\\s*=/;\r\n      var curlyRe = /\\s*\\}/;\r\n      var tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\r\n\r\n      // Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\r\n      // See https://github.com/janl/mustache.js/issues/189\r\n      function testRe(re, string) {\r\n        return RegExp.prototype.test.call(re, string);\r\n      }\r\n\r\n      function isWhitespace(string) {\r\n        return !testRe(nonSpaceRe, string);\r\n      }\r\n\r\n      var isArray = Array.isArray || function (obj) {\r\n          return Object.prototype.toString.call(obj) === \"[object Array]\";\r\n        };\r\n\r\n      function escapeRe(string) {\r\n        return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, \"\\\\$&\");\r\n      }\r\n\r\n      var entityMap = {\r\n        \"&\": \"&amp;\",\r\n        \"<\": \"&lt;\",\r\n        \">\": \"&gt;\",\r\n        '\"': '&quot;',\r\n        \"'\": '&#39;',\r\n        \"/\": '&#x2F;'\r\n      };\r\n\r\n      function escapeHtml(string) {\r\n        return String(string).replace(/[&<>\"'\\/]/g, function (s) {\r\n          return entityMap[s];\r\n        });\r\n      }\r\n\r\n      // Export the escaping function so that the user may override it.\r\n      // See https://github.com/janl/mustache.js/issues/244\r\n      exports.escape = escapeHtml;\r\n\r\n      function Scanner(string) {\r\n        this.string = string;\r\n        this.tail = string;\r\n        this.pos = 0;\r\n      }\r\n\r\n      /**\r\n       * Returns `true` if the tail is empty (end of string).\r\n       */\r\n      Scanner.prototype.eos = function () {\r\n        return this.tail === \"\";\r\n      };\r\n\r\n      /**\r\n       * Tries to match the given regular expression at the current position.\r\n       * Returns the matched text if it can match, the empty string otherwise.\r\n       */\r\n      Scanner.prototype.scan = function (re) {\r\n        var match = this.tail.match(re);\r\n\r\n        if (match && match.index === 0) {\r\n          this.tail = this.tail.substring(match[0].length);\r\n          this.pos += match[0].length;\r\n          return match[0];\r\n        }\r\n\r\n        return \"\";\r\n      };\r\n\r\n      /**\r\n       * Skips all text until the given regular expression can be matched. Returns\r\n       * the skipped string, which is the entire tail if no match can be made.\r\n       */\r\n      Scanner.prototype.scanUntil = function (re) {\r\n        var match, pos = this.tail.search(re);\r\n\r\n        switch (pos) {\r\n          case -1:\r\n            match = this.tail;\r\n            this.pos += this.tail.length;\r\n            this.tail = \"\";\r\n            break;\r\n          case 0:\r\n            match = \"\";\r\n            break;\r\n          default:\r\n            match = this.tail.substring(0, pos);\r\n            this.tail = this.tail.substring(pos);\r\n            this.pos += pos;\r\n        }\r\n\r\n        return match;\r\n      };\r\n\r\n      function Context(view, parent) {\r\n        this.view = view;\r\n        this.parent = parent;\r\n        this.clearCache();\r\n      }\r\n\r\n      Context.make = function (view) {\r\n        return (view instanceof Context) ? view : new Context(view);\r\n      };\r\n\r\n      Context.prototype.clearCache = function () {\r\n        this._cache = {};\r\n      };\r\n\r\n      Context.prototype.push = function (view) {\r\n        return new Context(view, this);\r\n      };\r\n\r\n      Context.prototype.lookup = function (name) {\r\n        var value = this._cache[name];\r\n\r\n        if (!value) {\r\n          if (name === \".\") {\r\n            value = this.view;\r\n          } else {\r\n            var context = this;\r\n\r\n            while (context) {\r\n              if (name.indexOf(\".\") > 0) {\r\n                var names = name.split(\".\"), i = 0;\r\n\r\n                value = context.view;\r\n\r\n                while (value && i < names.length) {\r\n                  value = value[names[i++]];\r\n                }\r\n              } else {\r\n                value = context.view[name];\r\n              }\r\n\r\n              if (value != null) {\r\n                break;\r\n              }\r\n\r\n              context = context.parent;\r\n            }\r\n          }\r\n\r\n          this._cache[name] = value;\r\n        }\r\n\r\n        if (typeof value === \"function\") {\r\n          value = value.call(this.view);\r\n        }\r\n\r\n        return value;\r\n      };\r\n\r\n      function Writer() {\r\n        this.clearCache();\r\n      }\r\n\r\n      Writer.prototype.clearCache = function () {\r\n        this._cache = {};\r\n        this._partialCache = {};\r\n      };\r\n\r\n      Writer.prototype.compile = function (template, tags) {\r\n        var fn = this._cache[template];\r\n\r\n        if (!fn) {\r\n          var tokens = exports.parse(template, tags);\r\n          fn = this._cache[template] = this.compileTokens(tokens, template);\r\n        }\r\n\r\n        return fn;\r\n      };\r\n\r\n      Writer.prototype.compilePartial = function (name, template, tags) {\r\n        var fn = this.compile(template, tags);\r\n        this._partialCache[name] = fn;\r\n        return fn;\r\n      };\r\n\r\n      Writer.prototype.compileTokens = function (tokens, template) {\r\n        var fn = compileTokens(tokens);\r\n        var self = this;\r\n\r\n        return function (view, partials) {\r\n          if (partials) {\r\n            if (typeof partials === \"function\") {\r\n              self._loadPartial = partials;\r\n            } else {\r\n              for (var name in partials) {\r\n                self.compilePartial(name, partials[name]);\r\n              }\r\n            }\r\n          }\r\n\r\n          return fn(self, Context.make(view), template);\r\n        };\r\n      };\r\n\r\n      Writer.prototype.render = function (template, view, partials) {\r\n        return this.compile(template)(view, partials);\r\n      };\r\n\r\n      Writer.prototype._section = function (name, context, text, callback) {\r\n        var value = context.lookup(name);\r\n\r\n        switch (typeof value) {\r\n          case \"object\":\r\n            if (isArray(value)) {\r\n              var buffer = \"\";\r\n\r\n              for (var i = 0, len = value.length; i < len; ++i) {\r\n                buffer += callback(this, context.push(value[i]));\r\n              }\r\n\r\n              return buffer;\r\n            }\r\n\r\n            return value ? callback(this, context.push(value)) : \"\";\r\n          case \"function\":\r\n            var self = this;\r\n            var scopedRender = function (template) {\r\n              return self.render(template, context);\r\n            };\r\n\r\n            var result = value.call(context.view, text, scopedRender);\r\n            return result != null ? result : \"\";\r\n          default:\r\n            if (value) {\r\n              return callback(this, context);\r\n            }\r\n        }\r\n\r\n        return \"\";\r\n      };\r\n\r\n      Writer.prototype._inverted = function (name, context, callback) {\r\n        var value = context.lookup(name);\r\n\r\n        // Use JavaScript's definition of falsy. Include empty arrays.\r\n        // See https://github.com/janl/mustache.js/issues/186\r\n        if (!value || (isArray(value) && value.length === 0)) {\r\n          return callback(this, context);\r\n        }\r\n\r\n        return \"\";\r\n      };\r\n\r\n      Writer.prototype._partial = function (name, context) {\r\n        if (!(name in this._partialCache) && this._loadPartial) {\r\n          this.compilePartial(name, this._loadPartial(name));\r\n        }\r\n\r\n        var fn = this._partialCache[name];\r\n\r\n        return fn ? fn(context) : \"\";\r\n      };\r\n\r\n      Writer.prototype._name = function (name, context) {\r\n        var value = context.lookup(name);\r\n\r\n        if (typeof value === \"function\") {\r\n          value = value.call(context.view);\r\n        }\r\n\r\n        return (value == null) ? \"\" : String(value);\r\n      };\r\n\r\n      Writer.prototype._escaped = function (name, context) {\r\n        return exports.escape(this._name(name, context));\r\n      };\r\n\r\n      /**\r\n       * Low-level function that compiles the given `tokens` into a function\r\n       * that accepts three arguments: a Writer, a Context, and the template.\r\n       */\r\n      function compileTokens(tokens) {\r\n        var subRenders = {};\r\n\r\n        function subRender(i, tokens, template) {\r\n          if (!subRenders[i]) {\r\n            var fn = compileTokens(tokens);\r\n            subRenders[i] = function (writer, context) {\r\n              return fn(writer, context, template);\r\n            };\r\n          }\r\n\r\n          return subRenders[i];\r\n        }\r\n\r\n        return function (writer, context, template) {\r\n          var buffer = \"\";\r\n          var token, sectionText;\r\n\r\n          for (var i = 0, len = tokens.length; i < len; ++i) {\r\n            token = tokens[i];\r\n\r\n            switch (token[0]) {\r\n              case \"#\":\r\n                sectionText = template.slice(token[3], token[5]);\r\n                buffer += writer._section(token[1], context, sectionText, subRender(i, token[4], template));\r\n                break;\r\n              case \"^\":\r\n                buffer += writer._inverted(token[1], context, subRender(i, token[4], template));\r\n                break;\r\n              case \">\":\r\n                buffer += writer._partial(token[1], context);\r\n                break;\r\n              case \"&\":\r\n                buffer += writer._name(token[1], context);\r\n                break;\r\n              case \"name\":\r\n                buffer += writer._escaped(token[1], context);\r\n                break;\r\n              case \"text\":\r\n                buffer += token[1];\r\n                break;\r\n            }\r\n          }\r\n\r\n          return buffer;\r\n        };\r\n      }\r\n\r\n      /**\r\n       * Forms the given array of `tokens` into a nested tree structure where\r\n       * tokens that represent a section have two additional items: 1) an array of\r\n       * all tokens that appear in that section and 2) the index in the original\r\n       * template that represents the end of that section.\r\n       */\r\n      function nestTokens(tokens) {\r\n        var tree = [];\r\n        var collector = tree;\r\n        var sections = [];\r\n\r\n        var token;\r\n        for (var i = 0, len = tokens.length; i < len; ++i) {\r\n          token = tokens[i];\r\n          switch (token[0]) {\r\n            case '#':\r\n            case '^':\r\n              sections.push(token);\r\n              collector.push(token);\r\n              collector = token[4] = [];\r\n              break;\r\n            case '/':\r\n              var section = sections.pop();\r\n              section[5] = token[2];\r\n              collector = sections.length > 0 ? sections[sections.length - 1][4] : tree;\r\n              break;\r\n            default:\r\n              collector.push(token);\r\n          }\r\n        }\r\n\r\n        return tree;\r\n      }\r\n\r\n      /**\r\n       * Combines the values of consecutive text tokens in the given `tokens` array\r\n       * to a single token.\r\n       */\r\n      function squashTokens(tokens) {\r\n        var squashedTokens = [];\r\n\r\n        var token, lastToken;\r\n        for (var i = 0, len = tokens.length; i < len; ++i) {\r\n          token = tokens[i];\r\n          if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\r\n            lastToken[1] += token[1];\r\n            lastToken[3] = token[3];\r\n          } else {\r\n            lastToken = token;\r\n            squashedTokens.push(token);\r\n          }\r\n        }\r\n\r\n        return squashedTokens;\r\n      }\r\n\r\n      function escapeTags(tags) {\r\n        return [\r\n          new RegExp(escapeRe(tags[0]) + \"\\\\s*\"),\r\n          new RegExp(\"\\\\s*\" + escapeRe(tags[1]))\r\n        ];\r\n      }\r\n\r\n      /**\r\n       * Breaks up the given `template` string into a tree of token objects. If\r\n       * `tags` is given here it must be an array with two string values: the\r\n       * opening and closing tags used in the template (e.g. [\"<%\", \"%>\"]). Of\r\n       * course, the default is to use mustaches (i.e. Mustache.tags).\r\n       */\r\n      exports.parse = function (template, tags) {\r\n        template = template || '';\r\n        tags = tags || exports.tags;\r\n\r\n        if (typeof tags === 'string') tags = tags.split(spaceRe);\r\n        if (tags.length !== 2) {\r\n          throw new Error('Invalid tags: ' + tags.join(', '));\r\n        }\r\n\r\n        var tagRes = escapeTags(tags);\r\n        var scanner = new Scanner(template);\r\n\r\n        var sections = [];     // Stack to hold section tokens\r\n        var tokens = [];       // Buffer to hold the tokens\r\n        var spaces = [];       // Indices of whitespace tokens on the current line\r\n        var hasTag = false;    // Is there a {{tag}} on the current line?\r\n        var nonSpace = false;  // Is there a non-space char on the current line?\r\n\r\n        // Strips all whitespace tokens array for the current line\r\n        // if there was a {{#tag}} on it and otherwise only space.\r\n        function stripSpace() {\r\n          if (hasTag && !nonSpace) {\r\n            while (spaces.length) {\r\n              tokens.splice(spaces.pop(), 1);\r\n            }\r\n          } else {\r\n            spaces = [];\r\n          }\r\n\r\n          hasTag = false;\r\n          nonSpace = false;\r\n        }\r\n\r\n        var start, type, value, chr;\r\n        while (!scanner.eos()) {\r\n          start = scanner.pos;\r\n          value = scanner.scanUntil(tagRes[0]);\r\n\r\n          if (value) {\r\n            for (var i = 0, len = value.length; i < len; ++i) {\r\n              chr = value.charAt(i);\r\n\r\n              if (isWhitespace(chr)) {\r\n                spaces.push(tokens.length);\r\n              } else {\r\n                nonSpace = true;\r\n              }\r\n\r\n              tokens.push([\"text\", chr, start, start + 1]);\r\n              start += 1;\r\n\r\n              if (chr === \"\\n\") {\r\n                stripSpace(); // Check for whitespace on the current line.\r\n              }\r\n            }\r\n          }\r\n\r\n          start = scanner.pos;\r\n\r\n          // Match the opening tag.\r\n          if (!scanner.scan(tagRes[0])) {\r\n            break;\r\n          }\r\n\r\n          hasTag = true;\r\n          type = scanner.scan(tagRe) || \"name\";\r\n\r\n          // Skip any whitespace between tag and value.\r\n          scanner.scan(whiteRe);\r\n\r\n          // Extract the tag value.\r\n          if (type === \"=\") {\r\n            value = scanner.scanUntil(eqRe);\r\n            scanner.scan(eqRe);\r\n            scanner.scanUntil(tagRes[1]);\r\n          } else if (type === \"{\") {\r\n            var closeRe = new RegExp(\"\\\\s*\" + escapeRe(\"}\" + tags[1]));\r\n            value = scanner.scanUntil(closeRe);\r\n            scanner.scan(curlyRe);\r\n            scanner.scanUntil(tagRes[1]);\r\n            type = \"&\";\r\n          } else {\r\n            value = scanner.scanUntil(tagRes[1]);\r\n          }\r\n\r\n          // Match the closing tag.\r\n          if (!scanner.scan(tagRes[1])) {\r\n            throw new Error('Unclosed tag at ' + scanner.pos);\r\n          }\r\n\r\n          // Check section nesting.\r\n          if (type === '/') {\r\n            if (sections.length === 0) {\r\n              throw new Error('Unopened section \"' + value + '\" at ' + start);\r\n            }\r\n\r\n            var section = sections.pop();\r\n\r\n            if (section[1] !== value) {\r\n              throw new Error('Unclosed section \"' + section[1] + '\" at ' + start);\r\n            }\r\n          }\r\n\r\n          var token = [type, value, start, scanner.pos];\r\n          tokens.push(token);\r\n\r\n          if (type === '#' || type === '^') {\r\n            sections.push(token);\r\n          } else if (type === \"name\" || type === \"{\" || type === \"&\") {\r\n            nonSpace = true;\r\n          } else if (type === \"=\") {\r\n            // Set the tags for the next time around.\r\n            tags = value.split(spaceRe);\r\n\r\n            if (tags.length !== 2) {\r\n              throw new Error('Invalid tags at ' + start + ': ' + tags.join(', '));\r\n            }\r\n\r\n            tagRes = escapeTags(tags);\r\n          }\r\n        }\r\n\r\n        // Make sure there are no open sections when we're done.\r\n        var section = sections.pop();\r\n        if (section) {\r\n          throw new Error('Unclosed section \"' + section[1] + '\" at ' + scanner.pos);\r\n        }\r\n\r\n        return nestTokens(squashTokens(tokens));\r\n      };\r\n\r\n      // The high-level clearCache, compile, compilePartial, and render functions\r\n      // use this default writer.\r\n      var _writer = new Writer();\r\n\r\n      /**\r\n       * Clears all cached templates and partials in the default writer.\r\n       */\r\n      exports.clearCache = function () {\r\n        return _writer.clearCache();\r\n      };\r\n\r\n      /**\r\n       * Compiles the given `template` to a reusable function using the default\r\n       * writer.\r\n       */\r\n      exports.compile = function (template, tags) {\r\n        return _writer.compile(template, tags);\r\n      };\r\n\r\n      /**\r\n       * Compiles the partial with the given `name` and `template` to a reusable\r\n       * function using the default writer.\r\n       */\r\n      exports.compilePartial = function (name, template, tags) {\r\n        return _writer.compilePartial(name, template, tags);\r\n      };\r\n\r\n      /**\r\n       * Compiles the given array of tokens (the output of a parse) to a reusable\r\n       * function using the default writer.\r\n       */\r\n      exports.compileTokens = function (tokens, template) {\r\n        return _writer.compileTokens(tokens, template);\r\n      };\r\n\r\n      /**\r\n       * Renders the `template` with the given `view` and `partials` using the\r\n       * default writer.\r\n       */\r\n      exports.render = function (template, view, partials) {\r\n        return _writer.render(template, view, partials);\r\n      };\r\n\r\n      // This is here for backwards compatibility with 0.4.x.\r\n      exports.to_html = function (template, view, partials, send) {\r\n        var result = exports.render(template, view, partials);\r\n\r\n        if (typeof send === \"function\") {\r\n          send(result);\r\n        } else {\r\n          return result;\r\n        }\r\n      };\r\n\r\n      return exports;\r\n\r\n    }())));\r\n\r\n  }, {}]\r\n}, {}, [])\r\n;\r\n","/**\r\n * Created by PC040 on 03/05/2016.\r\n */\r\n\r\nangular.module('ocf.interceptors', [])\r\n\r\n.factory('httpRequestInterceptor', function ($q, $rootScope) {\r\n  return {\r\n    'responseError': function(rejection) {\r\n      // do something on error\r\n      if(rejection && rejection.data && rejection.data.message == 'Session Expired') {\r\n        $rootScope.$broadcast('logout', true);\r\n        rejection = 'Session Expired';\r\n      }\r\n\r\n      return $q.reject(rejection);\r\n    }\r\n  };\r\n});\r\n","angular.module('ocf.filters', [])\r\n\r\n  .filter('cutStringStart', function () {\r\n    return function (text, length, start) {\r\n      if (isNaN(length)) {\r\n        length = 4;\r\n      }\r\n\r\n      if (start === undefined) {\r\n        start = \"...\";\r\n      }\r\n\r\n      if (!text) {\r\n        return \"N/A\";\r\n      }\r\n      if (text.length <= length) {\r\n        return text;\r\n\r\n      } else {\r\n        return start + String(text).substr(-length, length);\r\n      }\r\n    };\r\n  })\r\n\r\n  .filter('cutEPCStart', function () {\r\n    return function (text, length, start) {\r\n      if (isNaN(length)) {\r\n        length = 4;\r\n      }\r\n\r\n      if (start === undefined) {\r\n        start = \"xx\";\r\n      }\r\n\r\n      if (!text) {\r\n        return \"N/A\";\r\n      }\r\n      if (text.length <= length) {\r\n        return text;\r\n\r\n      } else {\r\n        return start + String(text).substr(-length, length);\r\n      }\r\n    };\r\n  })\r\n\r\n  .filter('cutStringEnd', function () {\r\n    return function (text, length, end) {\r\n      if (isNaN(length)) {\r\n        length = 4;\r\n      }\r\n\r\n      if (end === undefined) {\r\n        end = \"...\";\r\n      }\r\n\r\n      if (!text) {\r\n        return \"N/A\";\r\n      }\r\n      if (text.length <= length) {\r\n        return text;\r\n\r\n      } else {\r\n        return String(text).substr(0, length) + end;\r\n      }\r\n    };\r\n  })\r\n\r\n\r\n  .filter('toTrusted', ['$sce', function ($sce) {\r\n    return function (text) {\r\n      return $sce.trustAsHtml(text);\r\n    };\r\n  }])\r\n\r\n  .filter('cutStringSize', function () {\r\n    return function (text, font, fontSize, maxSize) {\r\n      if (isNaN(fontSize)) {\r\n        fontSize = 12;\r\n      }\r\n      if (isNaN(maxSize)) {\r\n        maxSize = 50;\r\n      }\r\n      var end = \"...\";\r\n      if (font == null || font==undefined){\r\n        font = \"roboto\";\r\n      }\r\n      if (!text) {\r\n        return \"N/A\";\r\n      }\r\n      var canvas = document.createElement('canvas');\r\n      var ctx = canvas.getContext(\"2d\");\r\n      ctx.font = fontSize+\"px \"+font;\r\n      var width = ctx.measureText(text).width;\r\n\r\n      var newText = text;\r\n      var count = 0;\r\n      while(width >= maxSize){\r\n        newText = String(text).substr(0, newText.length - count++) + end;\r\n        width = ctx.measureText(newText).width;\r\n      }\r\n      return newText;\r\n    };\r\n  });\r\n\r\n;\r\n","angular.module('ocf.directives', [])\n\n  .directive('messages', function () {\n    return {\n      scope: {\n        messages: '='\n      },\n      restrict: 'E',\n      templateUrl: 'commons/templates/message-service.html',\n      link: function ($scope, iElm, iAttrs, controller) {\n      }\n    };\n  })\n\n  .directive('ionPager', function () {\n    return {\n      priority: 0,\n      link: function ($scope, $element, $attr, slideBox) {\n        var range = function (start, rangeLength) {\n          return Array.apply(null, Array(rangeLength)).map(function (_, i) {return i+start;})\n        };\n\n        $scope.currentPage = 1;\n\n        $scope.belongsToCurrentPage = function (index) {\n          var currPageRange = range(($scope.currentPage-1)*5, 5);\n          if (currPageRange.indexOf(index) !== -1) {\n            return true;\n          }\n        };\n\n        var selectImage = function (index) {\n          var i, j;\n          var children = $element[0].children[0].children;\n          var length = children.length;\n\n          for (i = 0, j = 1; i < length; i++) {\n            // applies the page location class\n            var pIndex = (i+1)%5 ? j : j++;\n\n            if (i == index) {\n              $scope.currentPage = pIndex;\n              children[i].classList.add('active');\n            } else {\n              children[i].classList.remove('active');\n            }\n          }\n        };\n\n        $scope.pagerClick = function (index) {\n          slideBox.onPagerClick(index);\n        };\n\n        $scope.numSlides = function () {\n          return new Array(slideBox.slidesCount());\n        };\n\n        $scope.$watch('currentSlide', function (v) {\n          selectImage(v);\n        });\n\n        $scope.isFirstPage = function () {\n          return ($scope.currentPage === 1);\n        };\n\n        $scope.isLastPage = function (total) {\n          return ($scope.currentPage === Math.ceil(total / 5));\n        };\n\n        $scope.prevGalleryPage = function () {\n          if (!$scope.isFirstPage()) {\n            $scope.currentPage--;\n          }\n        };\n\n        $scope.nextGalleryPage = function (total) {\n          if (!$scope.isLastPage(total)) {\n            $scope.currentPage++;\n          }\n        };\n      }\n    };\n\n  })\n\n  .directive('ngEnter', function() {\n    return function(scope, element, attrs) {\n      element.bind(\"keydown keypress\", function(event) {\n        if(event.which === 13) {\n          scope.$apply(function(){\n            scope.$eval(attrs.ngEnter);\n          });\n\n          event.preventDefault();\n        }\n      });\n    };\n  })\n\n  //.directive('newSampleSubHeader', function () {\n  //  return {\n  //    scope: {\n  //      productName: '=',\n  //      productCount: '='\n  //    },\n  //    restrict: 'E',\n  //    templateURL: 'apps/E30/Sample/templates/NewSampleSubHeader.html'\n  //  };\n  //})\n\n;\n","angular.module('ocf.constants', [])\n.constant('EnvironmentConfig', {\"host\":\"https://dev3.zestdataservices.com/\",\"apiPath\":\"api/1/\",\"version\":\"1.0.${env.BUILD_NUMBER}\",\"envName\":\"${ENV_NAME}\",\"requestTimeout\":30000,\"requestTimeoutLong\":120000})\n.constant('OCFConfig', {\"host\":\"https://dev3.zestdataservices.com/\",\"apiPath\":\"ocf-manager/1/\",\"servicePath\":\"services/\",\"configObject\":\"configObject\",\"applications\":\"applications/\",\"access\":\"access\"})\n.constant('SessionConfig', {\"cookieName\":\"zest_6220137ea63256c1ba1014724b94144c\",\"userInformation\":\"userInformation\",\"cookieLifeTime\":1,\"cookiePath\":\"/ocf\",\"userApplications\":\"userApplications\"})\n.constant('CouchDbConfig', {\"host\":\"https://dev3.zestdataservices.com:6985/\",\"name\":\"zest_ocf\"})\n.constant('CouchBaseConfig', {\"host\":\"https://dev3.zestdataservices.com:4986/\",\"name\":\"dev3\"})\n.constant('PersistenceConfig', {\"daysToLive\":2})\n.constant('PouchConfig', {\"pouchdbName\":\"pouch_ocf\",\"replicationRetries\":3})\n.constant('StagingConfig', {\"host\":\"https://dev3.zestdataservices.com/\",\"apiPath\":\"zest-order-staging-api/1/\",\"version\":\"1.0.${env.BUILD_NUMBER}\",\"envName\":\"${ENV_NAME}\",\"requestTimeout\":30000,\"requestTimeoutLong\":120000})\n.constant('PutAwayConfig', {\"host\":\"https://dev3.zestdataservices.com/\",\"apiPath\":\"fpms-put-away-process/1/\",\"version\":\"1.0.${env.BUILD_NUMBER}\",\"envName\":\"${ENV_NAME}\",\"requestTimeout\":30000,\"requestTimeoutLong\":120000});\n","// Ionic Starter App\nvar translateProvider;\n// angular.module is a global place for creating, registering and retrieving Angular modules\n// 'starter' is the name of this angular module example (also set in a <body> attribute in index.html)\n// the 2nd parameter is an array of 'requires'\n// 'starter.controllers' is found in controllers.js\nangular.module('ocf', [\n  'ionic',\n  'ngCordova',\n  'ngResource',\n  'ocf.templates',\n  'ocf.constants',\n  'ocf.services',\n  'ocf.directives',\n  'ocf.interceptors',\n  'ocf.filters',\n  'ocf.login',\n  'ocf.forgotPassword',\n  'ocf.changePassword',\n  'ocf.controllers',\n/*  'supplier.controllers',*/\n  /*'supplier.menu',*/\n  'ngLodash',\n  'pouchdb',\n  'pascalprecht.translate',\n  'limitStringFilter',\n  'ngMockE2E'\n  ])\n\n\n  .run(function ($rootScope,\n                 $state,\n                 $interval,\n                 $ionicPlatform,\n                 $cordovaKeyboard,\n                 EnvironmentConfig,\n                 LoadingService,\n                 SessionService,\n                 navigateTo,\n                 ScanService,\n                 $log,\n                 $translate,\n                 DataLayerService,\n                 $window,\n                 LoggingService,\n                 $httpBackend,\n                 StagingConfig,\n                 URLManager,\n                 EventHandlerService) {\n    EventHandlerService.setCurrentState('ocf.run');\n    var debugging = false;\n\n    if (debugging) {\n      var storageAreas = [\n        {\n          id: 1,\n          barcode: \"SA01\",\n          name: \"SA01\",\n          headerColor: \"#62a539\",\n          bodyColor: \"#6db33f\"\n        },\n        {\n          id: 2,\n          barcode: \"SA02\",\n          name: \"Storage Area 02\",\n          headerColor: \"#62a539\",\n          bodyColor: \"#6db33f\"\n\n        },\n        {\n          id: 3,\n          barcode: \"SA03\",\n          name: \"SA03\",\n          headerColor: \"#c4161c\",\n          bodyColor: \"#ed1c24\"\n        },\n        {\n          id: 4,\n          barcode: \"SA04\",\n          name: \"Storage Area 04\",\n          headerColor: \"darkorange\",\n          bodyColor: \"orange\"\n        },\n        {\n          id: 5,\n          barcode: \"SA05\",\n          name: \"Storage Area 05\",\n          headerColor: \"#2b0a4b\",\n          bodyColor: \"rebeccapurple\"\n        },\n        {\n          id: 6,\n          barcode: \"SA06\",\n          name: \"Storage Area 06\",\n          headerColor: \"#62a539\",\n          bodyColor: \"#6db33f\"\n        }\n      ];\n\n      var palletInfo = {\n        pallet: {\n          tagEpc: \"330C4DE26110028099998001\",\n          product: {\n            id: 23,\n            product: \"Romaine Lettuce\"\n          },\n          ziprCode: \"16-330\",\n          putAway: true,\n          storageArea: {}\n        },\n        storageAreaValidation: false\n      };\n\n      var restMessages = {\n        G04201: {code: 200, message: \"G04-201\"},\n        G04202: {code: 200, message: \"G04-202\"},\n        G04401: {status: 400, data: {defaultErrorMessage: \"\", errorCode: \"G04-401\"}},\n        G04402: {status: 400, data: {defaultErrorMessage: \"\", errorCode: \"G04-402\"}}\n      };\n\n      $httpBackend.whenGET(/.+storage\\/area\\/assign\\/pallet.+/).respond(function (method, url, data) {\n        var extract_epc_phId = /pallet\\/(.+)\\/packhouse\\/(.+)$/;\n        var epc_phId = extract_epc_phId.exec(url);\n\n        palletInfo.pallet.storageAreaValidation = epc_phId[1].indexOf(\"1111\") != -1;\n        palletInfo.pallet.tagEpc = epc_phId[1];\n        palletInfo.pallet.storageArea = storageAreas[Math.floor(Math.random() * 6)];\n\n        return [200, palletInfo];\n      });\n\n      $httpBackend.whenPOST(URLManager.getUrl('confirmSA')).respond(function (method, url, data) {\n        var obj = JSON.parse(data);\n\n        if (!navigator.onLine) return  [0, {}];\n\n        if (_(storageAreas).find({\"barcode\": obj.storageArea})) {\n          return [restMessages.G04201.code, restMessages.G04201];\n        } else {\n          return [restMessages.G04402.code, restMessages.G04402.data];\n        }\n      });\n\n      $httpBackend.whenPOST(URLManager.getUrl('unassignSA')).respond(function (method, url, data) {\n        var obj = JSON.parse(data);\n\n        if (obj.tagEpc) {\n          return [200, {code: 200, message: \"G04-202\"}];\n        } else {\n          return [400, {code: 400, message: \"G04-401\"}];\n        }\n      });\n    }\n\n    angular.forEach(['GET', 'DELETE', 'JSONP', 'HEAD', 'PUT', 'POST', 'PATCH'], function (method) {\n      $httpBackend.when(method).passThrough();\n    });\n\n    $ionicPlatform.ready(function () {\n      $rootScope.translateProvider = translateProvider;\n\n      $rootScope.$on('$translatePartialLoaderStructureChanged', function () {\n        $translate.refresh();\n      });\n\n      $translate.use('en'); // FORCES 'en' as default language, regarding the browser definition\n\n      if (window.StatusBar) {\n        StatusBar.hide();\n      }\n\n      if (window.cordova) {\n        window.addEventListener('native.keyboardshow', function(){\n          document.body.classList.add('keyboard-open');\n        });\n\n        var removeKeyboardOpen = function(){\n          setTimeout(function () {\n            document.body.classList.remove('keyboard-open');\n          }, 1000);\n        };\n\n        window.addEventListener('native.keyboardhide', removeKeyboardOpen);\n\n        $rootScope.$watch(function () {\n          return $cordovaKeyboard.isVisible();\n        }, function (value) {\n          $rootScope.$broadcast(\"keyboard.open\", value);\n        });\n\n        if (window.cordova.plugins && window.cordova.plugins.autoStart) {\n          window.cordova.plugins.autoStart.enable();\n        }\n\n        //initialize the native scanner on the TC-55 if it exists\n        ScanService.initialize();\n\n        if (window.hockeyapp) {\n          window.hockeyapp.start(function (message) {\n            $log.debug(message);\n          }, function (message) {\n            console.error(message);\n          }, \"9f3c70eff11ea8481da53c438fd2ec18\");\n        }\n\n        if (window.cordova.plugins.Keyboard) {\n          $cordovaKeyboard.hideAccessoryBar(true);\n        }\n\n        if (window.cordova.getAppVersion) {\n          window.cordova.getAppVersion(function (version) {\n            if (version == \"N/A\") {\n              version = \"Version Unavailable\";\n            }\n\n            $rootScope.appVersion = version;\n            $rootScope.$broadcast('appVersion', version);\n          });\n        }\n\n        if (window.cordova.plugins.backgroundMode) {\n          // Enable background mode\n          cordova.plugins.backgroundMode.enable();\n\n          var timer = 0;\n          var stop;\n\n          // Called when background mode has been activated\n          cordova.plugins.backgroundMode.onactivate = function () {\n            $log.debug(\"Went background\");\n\n            if ($rootScope.user && $rootScope.user.id) {\n              var timeout = $rootScope.stagingConfiguration.userInactivityTimeout;\n              timeout = !!timeout ? timeout : 0;\n\n              var today = new Date();\n              var now = today.getTime();\n\n              if (timeout) {\n                timeout = now + timeout;\n              }\n\n              var timeout_date = new Date(timeout);\n              $log.debug('Background Time: ' + today + ' Log out at: ' + timeout_date);\n\n              stop = $interval(function () {\n                var today_interval = new Date();\n                var now_interval = today_interval.getTime();\n\n                $log.debug('trying logout at date: ' + today_interval);\n                //check if it should be logged out\n                if (now_interval >= timeout) {\n                  //stop any ongoing replication if it exists\n                  if (!!$rootScope.replicationHandler) {\n                    $log.debug(\"Cancelling replication\");\n                    $rootScope.replicationHandler.cancel();\n                  }\n\n                  //force a logout\n                  SessionService.destroy();\n                  $log.debug(\"User logged out successfully\");\n                  $window.localStorage.setItem('sessionExpired', 'true');\n                  document.location = \"index.html\"; // forces memory data cleanup\n                  SessionService.clearCredentials();\n                  //navigateTo.login();\n                }\n              }, 10000);\n            }\n          };\n\n          cordova.plugins.backgroundMode.ondeactivate = function () {\n            $log.debug(\"Went foreground\");\n\n            $rootScope.$broadcast('background', true);\n\n            timer = 0;\n            $interval.cancel(stop);\n            stop = undefined;\n\n          };\n        }\n      }\n\n      if (window.StatusBar) {\n        StatusBar.styleDefault();\n        window.addEventListener('native.keyboardhide', function () {\n          window.StatusBar.hide();\n        });\n        window.addEventListener('native.keyboardshow', function () {\n          window.StatusBar.hide();\n        });\n      }\n\n      //The default status is online, as it is the login\n      $rootScope.isOnline = true;\n\n      //Network status indicators\n      document.addEventListener(\"online\",\n        function(){\n        $rootScope.isOnline = true;\n          $log.debug(\"Went Online\");\n        }, false);\n\n      document.addEventListener(\"offline\",\n        function(){\n          $rootScope.isOnline = false;\n          $log.debug(\"Went Offline\");\n        }, false);\n\n      $rootScope.onPauseEvent = function(event) {\n\n        if ($rootScope.user) {\n          var dataRecover = {};\n\n          if (window.localStorage.getItem(\"dataRecover\")) {\n            dataRecover = JSON.parse(window.localStorage.getItem(\"dataRecover\"));\n          }\n\n          var loginData = {\n            user: $rootScope.user,\n            configuration: $rootScope.stagingConfiguration,\n            userConfiguration: $rootScope.userConfiguration,\n            selectedLanguage: $rootScope.selectedLanguage,\n            checkDevice: $rootScope.checkDevice,\n            filterAppListByDeviceModel: $rootScope.filterAppListByDeviceModel,\n            selectedLocation: $rootScope.selectedLocation,\n            locations: $rootScope.user.locations,\n            selectedApp: $rootScope.app,\n            userRecoverData: $rootScope.userRecoverData\n          };\n\n          dataRecover.loginData = loginData;\n          dataRecover.hasToRecover = true;\n          dataRecover.createdDateTime = (new Date()).toISOString();\n\n          LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_PAUSE, 'onPause callback', 'Saving Data recover', 'success',\n            [{'key': 'dataRecover', 'value': JSON.stringify(dataRecover)}], $rootScope.user != undefined);\n\n          window.localStorage.setItem(\"dataRecover\", JSON.stringify(dataRecover));\n\n          /*if ($rootScope.onPause) {\n\n           LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_PAUSE, 'onPause callback', 'Calling onPause override method', 'success',\n           [], $rootScope.user != undefined);\n\n           $rootScope.onPause();\n           }*/\n        }\n      };\n\n      $rootScope.onResumeEvent = function(event) {\n\n        $rootScope.appResumed = true;\n\n        LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_RESUME, 'onResume callback', 'Checking Data recover', 'success',\n          [], $rootScope.user != undefined);\n\n        if ($rootScope.user) {\n\n          var dataRecover = undefined;\n\n          LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_RESUME, 'onResume callback', 'There is no data to recover', 'success',\n            [{'key': 'hasToRecover', 'value': false}], true);\n\n          if (window.localStorage.getItem(\"dataRecover\")) {\n            window.localStorage.setItem(\"dataRecover\", JSON.stringify({}));\n          }\n        } else {\n\n          LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_RESUME, 'onResume callback',\n            'There is data to recover, firing dataRecover event', 'success', [], false);\n\n          $rootScope.$broadcast(\"dataRecover\", event);\n        }\n\n      };\n\n      $rootScope.onDeviceReadyEvent = function() {\n        console.log('deviceready');\n\n        window.navigationbar.setUp(true);\n\n        LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_DEVICE_READY, 'onDeviceReady callback',\n          'checking Data recover', 'success', [], false);\n\n        if (!$rootScope.appResumed) {\n\n          LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER, LoggingService.CONSTANTS.CONTEXT.ON_DEVICE_READY, 'onDeviceReady callback',\n            'There is data to recover, firing dataRecover event', 'success', [], false);\n\n          $rootScope.$broadcast(\"dataRecover\", event);\n        }\n      };\n\n      //Add Pause event listener\n      document.addEventListener(\"pause\", $rootScope.onPauseEvent, false);\n\n      //Add Resume event listener for autolock\n      document.addEventListener(\"resume\", $rootScope.onResumeEvent, false);\n\n      document.addEventListener('deviceready', $rootScope.onDeviceReadyEvent, false);\n\n      var isMC = new RegExp(/^MC92N0$/);\n\n      if (window.device && window.device.model.match(isMC)){\n        document.addEventListener('touchcancel', function (cancelEvent) {\n          handleTouch(cancelEvent);\n        });\n\n        document.addEventListener('touchmove', function (moveEvent) {\n          handleTouch(moveEvent);\n        });\n      }\n\n      function handleTouch(event){\n        if ($rootScope.lastMove + 100 < event.timeStamp ){\n\n          var touch = event.changedTouches[0];\n          var Xpos = event.changedTouches[0].screenX;\n          var Ypos = event.changedTouches[0].screenY;\n\n          if ($(touch.target).is(\"input\")){\n            $(touch.target).focus();\n            cordova.plugins.Keyboard.show();\n          }else if($(touch.target).parent().is(\"input\")){\n            $(touch.target).parent().focus();\n            cordova.plugins.Keyboard.show();\n          }else if ($(touch.target).children().is(\"input\")){\n            $(touch.target).children().focus();\n            cordova.plugins.Keyboard.show();\n          }else if($(touch.target).is(\"button\")){\n            $(touch.target).click();\n            cordova.plugins.Keyboard.close();\n          }else if ($(document.elementFromPoint(Xpos , Ypos)).attr('ng-click') != undefined){\n            angular.element(document.elementFromPoint(Xpos , Ypos )).triggerHandler('click');\n            cordova.plugins.Keyboard.close();\n          } else if ($($(document.elementFromPoint(Xpos , Ypos)).parent()).attr('ng-click') != undefined){\n            angular.element($(document.elementFromPoint(Xpos , Ypos )).parent()).triggerHandler('click');\n            cordova.plugins.Keyboard.close();\n          }else if ($($(document.elementFromPoint(Xpos , Ypos)).children()).attr('ng-click') != undefined){\n            angular.element($(document.elementFromPoint(Xpos , Ypos )).children()).triggerHandler('click');\n            cordova.plugins.Keyboard.close();\n          }\n          if (event.type == \"touchcancel\"){\n            event.preventDefault();\n          }\n        }\n        $rootScope.lastMove = event.timeStamp;\n      }\n\n    });\n  })\n\n  .config(function ($stateProvider, $provide, $urlRouterProvider, $ionicConfigProvider, $compileProvider, $httpProvider, $translatePartialLoaderProvider, $translateProvider) {\n    translateProvider = $translateProvider;\n\n    $httpProvider.interceptors.push('httpRequestInterceptor');\n\n    $compileProvider.debugInfoEnabled(false);\n    $ionicConfigProvider.views.maxCache(2);\n    //this disables the iOS native swipeBack scrolling\n    $ionicConfigProvider.views.swipeBackEnabled(false);\n    $ionicConfigProvider.backButton.previousTitleText(false);\n    $ionicConfigProvider.tabs.style(\"standard\");\n    $ionicConfigProvider.tabs.position(\"bottom\");\n    $ionicConfigProvider.navBar.alignTitle('center');\n\n    // Translation configuration\n    $translatePartialLoaderProvider.addPart('ocf/locales');\n    $translateProvider\n      .useLoader('$translatePartialLoader', {\n        urlTemplate: '{part}/{lang}.json'\n      })\n      .registerAvailableLanguageKeys(['en', 'es'], {\n        'en_*': 'en',\n        'es_*': 'es'\n      })\n      .preferredLanguage('en')\n      .fallbackLanguage('en')\n      .determinePreferredLanguage();\n\n    //$q.allSettled implementation\n    //allows to wait for multiple promises and don't reject if one fails\n    $provide.decorator('$q', ['$delegate', function ($delegate) {\n      var $q = $delegate;\n\n      // Extention for q\n      $q.allSettled = $q.allSettled || function (promises) {\n          var deferred = $q.defer();\n          if (angular.isArray(promises)) {\n            var states = [];\n            var results = [];\n            var didAPromiseFail = false;\n\n            // First create an array for all promises setting their state to false (not completed)\n            angular.forEach(promises, function (promise, key) {\n              states[key] = false;\n            });\n\n            // Helper to check if all states are finished\n            var checkStates = function (states, results, deferred, failed) {\n              var allFinished = true;\n              angular.forEach(states, function (state, key) {\n                if (!state) {\n                  allFinished = false;\n                  return;\n                }\n              });\n              if (allFinished) {\n                if (failed) {\n                  deferred.reject(results);\n                } else {\n                  deferred.resolve(results);\n                }\n              }\n            };\n\n            // Loop through the promises\n            // a second loop to be sure that checkStates is called when all states are set to false first\n            angular.forEach(promises, function (promise, key) {\n              $q.when(promise).then(function (result) {\n                states[key] = true;\n                results[key] = result;\n                checkStates(states, results, deferred, didAPromiseFail);\n              }, function (reason) {\n                states[key] = true;\n                results[key] = reason;\n                didAPromiseFail = true;\n                checkStates(states, results, deferred, didAPromiseFail);\n              });\n            });\n          } else {\n            throw 'allSettled can only handle an array of promises (for now)';\n          }\n\n          return deferred.promise;\n        };\n\n      return $q;\n    }]);\n\n    $provide.decorator('ionPagerDirective', function ($delegate) {\n      var delegate = $delegate[0];\n\n      delegate.template = '' +\n        '<div class=\"slider-pager\">' +\n        ' <ul>' +\n        '   <li class=\"slider-pager-page\"' +\n        '       ng-repeat=\"slide in numSlides() track by $index\"' +\n        '       ng-class=\"{active: $index == currentSlide}\"' +\n        '       ng-click=\"pagerClick($index, numSlides().length)\"' +\n        '       ng-show=\"belongsToCurrentPage($index)\">' +\n        '     <div></div>' +\n        '   </li>' +\n        ' </ul>' +\n        ' <div class=\"gallery-nav-buttons bottom\">' +\n        '   <div class=\"nav-button left\" ng-click=\"prevGalleryPage()\" ng-if=\"!isFirstPage()\">' +\n        '     <i class=\"icon ion-chevron-left\"></i>' +\n        '   </div>' +\n        '   <div class=\"nav-button right\" ng-click=\"nextGalleryPage(numSlides().length)\" ng-if=\"!isLastPage(numSlides().length)\">' +\n        '     <i class=\"icon ion-chevron-right\"></i>' +\n        '   </div>' +\n        ' </div>' +\n        '</div>';\n      return $delegate;\n    });\n\n    // Removed default backdrop in modals\n    $provide.decorator('ionModalDirective', function ($delegate) {\n      var delegate = $delegate[0];\n      delegate.template = '' +\n        '<div class=\"modal-backdrop\">' +\n        ' <div class=\"modal-wrapper\" ng-transclude></div>' +\n        '</div>';\n      return $delegate;\n    });\n\n    $stateProvider\n    // Login screen\n      .state('ocf', {\n        url: \"\",\n        abstract: true,\n        template: '<ion-view view-title=\"OCF\"><ion-nav-view name=\"ocf\"></ion-nav-view></ion-view> ',\n        controller: 'AppCtrl'\n      });\n\n\n    // if none of the above states are matched, use this as the fallback\n    $urlRouterProvider.otherwise('/login');\n  })\n\n  .controller('AppCtrl', function ($rootScope,\n                                   $ionicHistory,\n                                   $scope,\n                                   encode,\n                                   $state,\n                                   $ionicModal,\n                                   $ionicPopup,\n                                   $ionicLoading,\n                                   $ionicSlideBoxDelegate,\n                                   $timeout,\n                                   $log,\n                                   SessionService,\n                                   SessionConfig,\n                                   ReplicationService,\n                                   navigateTo,\n                                   $q,\n                                   MessageService,\n                                   CouchDbConfig,\n                                   lodash,\n                                   InitializationService,\n                                   LoadingService,\n                                   $cordovaDialogs,\n                                   $cordovaBarcodeScanner,\n                                   $ionicViewSwitcher,\n                                   $ionicBackdrop,\n                                   DataLayerService,\n                                   $window,\n                                   NoConnectivityPopupService,\n                                   LanguageSelectorService) {\n\n    MessageService.clear();\n    $scope.messages = MessageService.getCurrentMessages();\n    $scope.scannerAllowed = window.cordova;\n    $rootScope.wasAtNewSample = false;\n    $scope.appVersion = \"v\";\n    $rootScope.selectedLanguage = \"English\";\n    $scope.changePassword = changePassword;\n    $scope.deviceModel = false;\n    $scope.checkDevice = false;\n\n    if ($window.device && $window.device.model) {\n      $scope.deviceModel = String($window.device.model);\n    }\n\n    $rootScope.$on('appVersion', function (event, appVersion) {\n      $scope.appVersion += appVersion;\n    });\n\n    $scope.isNewSample = function (path) {\n      var regexp = /newLotSample/;\n      return regexp.test(path);\n    };\n\n    $scope.saveState = function () {\n      if (!$scope.isNewSample($state.current.name)) {\n        $scope.savedState = angular.copy($state.current.name);\n      }\n\n      $scope.savedStateParams = angular.copy($state.params);\n    };\n\n    $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {\n      $log.debug('AppCtrl - $stateChangeStart to ' + toState.to + '- fired when the transition begins. toState,toParams : \\n', toState, toParams);\n      $scope.previousStateName = fromState.name;\n\n      var session = SessionService.getSessionData();\n\n      $scope.parseDate = function (date) {\n        var dateFormat = \"MM/DD/YY\";\n        if (!!$rootScope.selectedLocation.timezoneOffset) {\n          return moment(date).utcOffset($rootScope.selectedLocation.timezoneOffset / 60000).format(dateFormat);\n        }\n        return moment(date).format(dateFormat); // without offset\n      };\n\n      $scope.calculateTimeOffset = function (date) {\n        if (!!$rootScope.selectedLocation.timezoneOffset) {\n          return moment.utc(date).utcOffset($rootScope.selectedLocation.timezoneOffset / 60000)\n        } else {\n          return moment.utc(date); // without offset\n        }\n      };\n\n      $rootScope.getCurrentDate = function () {\n        return $scope.parseDate(new Date().getTime());\n      };\n\n      $scope.saveState();\n\n      setTimeout(function () {\n        $('ion-nav-bar').removeClass('hide');\n        $('ion-nav-back-button').removeClass('hide');\n        $('button').removeClass('hide');\n\n      }, 10);\n\n      if (session !== null) {\n        var sessionOver = (Date.now() - session.createdDate) / (1000 * 3600) > SessionConfig.cookieLifeTime;\n      }\n\n      if (!!session && session.status == \"loggedOffline\" && sessionOver) {\n        $log.debug(\"Session lifetime reached. Logging out\");\n        //try to replicate\n        $scope.userLogout();\n        navigateTo.login();\n        event.preventDefault();\n      }\n    });\n\n    $scope.userLogout = function (deferred, fromInterceptor) {\n      //force a logout\n      if(fromInterceptor) {\n        $window.localStorage.setItem('sessionExpired', 'true');\n      }\n\n      //navigateTo.login();\n      SessionService.destroy();\n      SessionService.clearCredentials();\n      //DataLayerService.stopSync();\n      $rootScope.user = null;\n      $rootScope.app = null;\n      $rootScope.selectedLocation = null;\n      $log.debug(\"User logged out successfully\");\n      document.location = \"index.html\"; // forces memory data cleanup\n    };\n\n    $rootScope.languagePopup = LanguageSelectorService;\n    $rootScope.languagePopup.create('', {scope: $rootScope})\n      .then(function (success) {\n        $log.debug(success);\n\n      })\n      .catch(function (fail) {\n        $log.error(fail);\n      });\n\n    document.addEventListener('backbutton', function(){\n      if($rootScope.languagePopup && $rootScope.languagePopup.isShown){\n        $rootScope.languagePopup.close();\n      }\n    });\n\n    $scope.selectLanguage = function () {\n      $scope.languagePopup.open();\n    };\n\n    function changePassword() {\n      navigateTo.changePassword();\n    }\n\n    $scope.previousStateName = '';\n\n    /**\n     * Methods for debugging purpose\n     */\n    $rootScope.$on('$stateChangeError', function (event, toState, toParams, fromState, fromParams, error) {\n      $log.debug('$stateChangeError - fired when an error occurs during transition.');\n      $log.debug(arguments);\n    });\n    $rootScope.$on('$stateChangeSuccess', function (event, toState, toParams, fromState, fromParams) {\n      $log.debug('$stateChangeSuccess to ' + toState.name + '- fired once the state transition is complete.');\n    });\n    $rootScope.$on('$viewContentLoading', function (event, viewConfig) {\n      // runs on individual scopes, so putting it in \"run\" doesn't work.\n      $log.debug('$viewContentLoading - view begins loading - dom not rendered', viewConfig);\n    });\n    $rootScope.$on('$viewContentLoaded', function (event) {\n      $log.debug('$viewContentLoaded - fired after dom rendered', event);\n    });\n    $rootScope.$on('$stateNotFound', function (event, unfoundState, fromState, fromParams) {\n      $log.debug('$stateNotFound ' + unfoundState.to + '  - fired when a state cannot be found by its name.');\n      $log.debug(unfoundState, fromState, fromParams);\n    });\n\n    $scope.$on('logout', $scope.userLogout);\n\n    $rootScope.noConnectivityPopup = NoConnectivityPopupService;\n\n    $rootScope.noConnectivityPopup.create('', {scope: $rootScope})\n      .then(function (success) {\n        $log.debug(success);\n      })\n      .catch(function(error){\n        $log.error(error);\n      });\n  })\n;\n"]}