function LanguageSelectorService($q,$ionicModal,lodash,$log,$rootScope,$ionicBackdrop,$translate,UserPreferenceService){function close(){lss.language.hide(),$ionicBackdrop.release(),$rootScope.$broadcast("languagePopupClose",!0)}function create(template,options,attributes){var q=$q.defer();return template=template||lss.languageTemplate,options&&lodash.merge(lss.languagePopupOptions,options),lss.selected="English",$ionicModal.fromTemplateUrl(template,lss.languagePopupOptions).then(function(popup){$log.debug("Language Popup created",popup),lss.language=popup,q.resolve("Popup Created")}).catch(function(fail){$log.language("Language Popup failed to load",fail),q.reject(fail)}),q.promise}function destroy(){lss.language.remove(),$log.debug("Error removed from DOM")}function open(){void 0!=$rootScope.userConfiguration&&void 0!=$rootScope.userConfiguration.preferences&&void 0!=$rootScope.userConfiguration.preferences.language?lss.selected=lodash.find(lss.lang,{value:$rootScope.userConfiguration.preferences.language}).key:lss.selected="English",lss.language.show(),$ionicBackdrop.retain(),$log.debug("Error Open button clicked")}function isShown(){return lss.language.isShown()}function selectLangf(language){lss.selected=language,$rootScope.selectedLanguage=language,$rootScope.userConfiguration.preferences.language=lodash.find(lss.lang,{key:language}).value;var preferences={preferences:{language:$rootScope.userConfiguration.preferences.language}};UserPreferenceService.setUserPreference($rootScope.user.id,preferences),$translate.use($rootScope.userConfiguration.preferences.language),lss.close()}var lss=this;return lss.selectLangf=selectLangf,lss.close=close,lss.create=create,lss.destroy=destroy,lss.open=open,lss.isShown=isShown,lss.selected=void 0,lss.language=void 0,lss.lang=[{key:"Spanish",value:"es"},{key:"English",value:"en"}],lss.languageTemplate="apps/supplier/commons/services/languageSelector/languageSelector.html",lss.languagePopupOptions={animation:"none",focusFirstInput:!1,backdropClickToClose:!1,hardwareBackButtonClose:!1},lss.languagePopupAttributes={message:""},lss}function ForgotPasswordService($q,$resource,URLManager){function recoverPassword(username){var q=$q.defer(),user={username:username},passwordRecover=$resource(URLManager.getUrl("passwordRecover"),{},{recover:{method:"POST",headers:{ZestSessionId:void 0}}});return passwordRecover.recover(user,q.resolve,q.reject),q.promise}var fps=this;return fps.recoverPassword=recoverPassword,fps}function ForgotPasswordController($scope,navigateTo,$ionicPlatform,ForgotPasswordService,LoadingService,$translate){function goToPreviousState(e){e&&e.preventDefault(),navigateTo.login()}function resetPassword(){$scope.pm.username&&(LoadingService.show("Processing username..."),ForgotPasswordService.recoverPassword($scope.pm.username).then(function(){$scope.pm.successPasswordRecover=!0}).catch(handleErrors).finally(resetFormStates))}function handleErrors(fail){412==fail.status&&($scope.pm.successPasswordRecover=!0),500==fail.status&&($scope.pm.genericError="Server Error."),0==fail.status&&($scope.pm.genericError="No connection available.")}function removeErrors(){$scope.pm.hasError=defaultPasswordManagement.hasError,$scope.pm.label=defaultPasswordManagement.label}function resetFormStates(){$scope.pm.username=defaultPasswordManagement.username,LoadingService.hide()}var deregisterGoToPreviousState,defaultPasswordManagement={username:"",label:"",hasError:!1,genericError:"",successPasswordRecover:!1};$scope.goToPreviousState=goToPreviousState,$scope.resetPassword=resetPassword,$scope.removeErrors=removeErrors,$scope.$on("$ionicView.beforeEnter",function(){deregisterGoToPreviousState=$ionicPlatform.registerBackButtonAction(goToPreviousState,501),$scope.heightScreen<480&&document.getElementById("changePasswordInput").addEventListener("touchend",function(){$("#changePasswordInput").attr("readonly","readonly"),$("#changePasswordInput").attr("disabled","true"),setTimeout(function(){$("#changePasswordInput").blur(),$("#changePasswordInput").removeAttr("readonly"),$("#changePasswordInput").removeAttr("disabled")},100)}),$translate("OCF.PASSWORD.FORGOT.USERNAME_PLACEHOLDER").then(function(placeholder){defaultPasswordManagement.label=placeholder,$scope.pm=angular.copy(defaultPasswordManagement)})}),$scope.$on("$destroy",deregisterGoToPreviousState)}function ChangePasswordSuccessController($scope,$state,$log,navigateTo,$window,$timeout,toaster,$ionicViewSwitcher,$ionicSideMenuDelegate,$ionicPlatform,ChangePasswordService){function goToPreviousState(){$ionicViewSwitcher.nextDirection("back"),$scope.cameFromStateName?$state.go($scope.cameFromStateName):navigateTo.home()}var deregisterGoToPreviousState;$scope.goToPreviousState=goToPreviousState,$scope.$on("$ionicView.beforeEnter",function(){ChangePasswordService.getPasswordRules().then(function(rules){$scope.pm.passwordRules=rules}).catch(function(fail){$log.error(fail.status,fail.message,fail.type)}),$ionicSideMenuDelegate.canDragContent(!0),deregisterGoToPreviousState=$ionicPlatform.registerBackButtonAction(goToPreviousState,501)}),$scope.$on("$destroy",deregisterGoToPreviousState)}function ChangePasswordService($q,$resource,$rootScope,EnvironmentConfig,URLManager,encode){function getPasswordRules(){function passRulesFail(passwordRulesFail){var failMessage={status:passwordRulesFail.status,message:passwordRulesFail.message,type:"passwordRules"};0!==passwordRulesFail.status&&(failMessage.message="No internet connection."),q.reject(failMessage)}var q=$q.defer(),passwordChange=$resource(URLManager.getUrl("passwordChange"),{},{passwordChangeRules:{method:"GET",timeout:EnvironmentConfig.requestTimeout}});return passwordChange.passwordChangeRules({organizationId:cps.info.organizationId},q.resolve,passRulesFail),q.promise}function setNewPassword(currentPassword,newPassword){var q=$q.defer(),encodedCredentials=encode.encodeCredentials({username:cps.info.currentUser,password:currentPassword}),userPassword={username:cps.info.currentUser,password:newPassword},passwordChange=$resource(URLManager.getUrl("passwordChange"),{},{setPassword:{method:"POST",headers:{Authorization:"Basic "+encodedCredentials,ZestSessionId:void 0}}});return passwordChange.setPassword(userPassword,q.resolve,q.reject),q.promise}var cps=this;return cps.info={currentUser:$rootScope.user.username||"",organizationId:$rootScope.user.organizationId||0},cps.getPasswordRules=getPasswordRules,cps.setNewPassword=setNewPassword,cps}function ChangePasswordController($scope,$state,$log,navigateTo,lodash,$ionicViewSwitcher,$ionicPlatform,$translate,ChangePasswordService,LoadingService,$window){function changePassword(){LoadingService.show(processing),$scope.pm.passwordRulesErrors=angular.copy(defaultPasswordManagement.passwordRulesErrors),$scope.pm.finalMessage=angular.copy($scope.pm.noErrorsFinalMessage),$scope.pm.hasError.newConfirm=$scope.pm.passwords.new!==$scope.pm.passwords.newConfirm,$scope.pm.hasError.newConfirm?(LoadingService.hide(),$scope.pm.passwords=angular.copy(defaultPasswordManagement.passwords),$scope.pm.labels.newConfirm=errorNoMatchPass):ChangePasswordService.setNewPassword($scope.pm.passwords.current,$scope.pm.passwords.new).then(function(){$scope.successPasswordChange=!0}).catch(handleErrors).finally(resetFormStates),$scope.heightScreen<480&&$("ion-content").css("height","auto"),$scope.heightScreen<480&&$("ion-content").css("height","auto")}function handleErrors(fail){if(412==fail.status){$scope.pm.hasError.new=!0,$scope.pm.labels.new=errorInvalidPass;var hasErrors=/length|uppercase|lowercase|digit|special|previously|dictionary.*'/g,errors=fail.data.message.match(hasErrors);if(errors.length)for(var i=0;i<errors.length;i++){var error=errors[i];error.indexOf("dictionary")!==-1?($scope.pm.passwordRulesErrors.dictionary=!0,$scope.pm.passwordRulesErrors.dictWord=error.split("'")[1],$translate("OCF.PASSWORD.CHANGE.LEGEND.DICT_WORD",{dictWord:$scope.pm.passwordRulesErrors.dictWord}).then(function(txt){$scope.dictWord.errorMessage=txt})):($scope.pm.passwordRulesErrors[error]=!0,error.indexOf("previously")==-1&&($scope.pm.finalMessage=$scope.pm.finalMessage.replace(error,"error")))}}401!=fail.status&&500!=fail.status||($scope.pm.hasError.current=!0,$scope.pm.labels.current=errorIncorrectPass),0==fail.status&&($scope.pm.passwordRulesErrors.genericError=errorNoConnection)}function goToPreviousState(e){return e&&e.preventDefault(),$ionicViewSwitcher.nextDirection("back"),!$scope.successPasswordChange&&void($scope.previousStateName?$state.go($scope.previousStateName,$scope.previousStateParams):navigateTo.home())}function removeErrors(password){"current"==password&&$scope.pm.hasError.current?($scope.pm.display.current=defaultPasswordManagement.display.current,$scope.pm.hasError.current=defaultPasswordManagement.hasError.current,$scope.pm.labels.current=defaultPasswordManagement.labels.current):"new"==password&&$scope.pm.hasError.new?($scope.pm.display.new=defaultPasswordManagement.display.new,$scope.pm.hasError.new=defaultPasswordManagement.hasError.new,$scope.pm.labels.new=defaultPasswordManagement.labels.new):"newConfirm"==password&&$scope.pm.hasError.newConfirm&&($scope.pm.display.newConfirm=defaultPasswordManagement.display.newConfirm,$scope.pm.hasError.newConfirm=defaultPasswordManagement.hasError.newConfirm,$scope.pm.labels.newConfirm=defaultPasswordManagement.labels.newConfirm)}function resetFormStates(){LoadingService.hide(),$scope.pm.passwords=angular.copy(defaultPasswordManagement.passwords),$scope.pm.display=angular.copy(defaultPasswordManagement.display)}function togglePasswordVisibility(password){"current"==password?$scope.pm.display.current=!$scope.pm.display.current:"new"==password?$scope.pm.display.new=!$scope.pm.display.new:"newConfirm"==password&&($scope.pm.display.newConfirm=!$scope.pm.display.newConfirm)}function buildRules(){function getPrepend(rule){var prepend="";switch($translate.use()){case"es":prepend="una ","minDigit"!==rule&&"minSpecial"!==rule||(prepend="un ");break;default:case"en":prepend="a ","minUppercase"===rule&&(prepend="an ")}return prepend}function finishStringBuild(event,txt){spanLength+=txt,spanLength+="</span>",message.push(spanLength),lodash.forEach($scope.pm.passwordRules,function(value,rule){if("minLength"!=rule&&value){var span='<span class="'+rule.split("min")[1].toLocaleLowerCase()+'">';if(value>1)span+=value+" "+rulesMessageMapper[rule]+"s";else{var prepend=getPrepend(rule);span+=prepend+rulesMessageMapper[rule]}span+="</span>",message.push(span)}}),message[1]=dynamicContainAtLeast+" "+message[1],message[message.length-1]=dynamicAnd+" "+message[message.length-1];var finalMessage=message.join(", ");finalMessage+=".",$scope.pm.finalMessage=finalMessage,$scope.pm.noErrorsFinalMessage=angular.copy(finalMessage)}var rulesMessageMapper={minDigit:dynamicMinDigit,minUppercase:dynamicMinUppercase,minLowercase:dynamicMinLowercase,minSpecial:dynamicMinSpecial},message=[],spanLength='<span class="length">';$scope.pm.passwordRules.minLength>1?$translate("OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_MULTIPLE",{number:$scope.pm.passwordRules.minLength}).then(function(txt){$scope.$broadcast("minLengthRetrieved",txt)}):$translate("OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_SINGLE").then(function(txt){$scope.$broadcast("minLengthRetrieved",txt)}),$scope.$on("minLengthRetrieved",finishStringBuild)}var deregisterGoToPreviousState,deregisterPasswordStrengthMeter,processing,legendMust,legendMustNot,legendUsed,dynamicMinDigit,dynamicMinUppercase,dynamicMinLowercase,dynamicMinSpecial,dynamicBeAtLeastMultiple,dynamicContainAtLeast,dynamicAnd,errorInvalidPass,errorIncorrectPass,errorNoMatchPass,errorNoConnection,defaultPasswordManagement={passwordRules:{minDigit:0,minLength:0,minLowercase:0,minSpecial:0,minUppercase:0},passwordRulesErrors:{digit:!1,length:!1,lowercase:!1,special:!1,uppercase:!1,previously:!1,dictionary:!1,dictWord:"",genericError:""},meter:{value:0,max:4,description:["","Weak","Fair","Fair","Strong"]},labels:{current:"Current Password",new:"New Password",newConfirm:"Confirm New Password"},passwords:{current:"",new:"",newConfirm:""},hasError:{current:!1,new:!1,newConfirm:!1},display:{current:!1,new:!1,newConfirm:!1}};$scope.heightScreen=$window.screen.height,$scope.changePassword=changePassword,$scope.goToPreviousState=goToPreviousState,$scope.removeErrors=removeErrors,$scope.togglePasswordVisibility=togglePasswordVisibility,$scope.$on("$ionicView.beforeEnter",function(){$scope.dictWord={errorMessage:""},$scope.pm=angular.copy(defaultPasswordManagement),$translate(["OCF.PASSWORD.CHANGE.STRENGTH_METER.WEAK","OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR","OCF.PASSWORD.CHANGE.STRENGTH_METER.STRONG"]).then(function(meter){$scope.pm.meter.description[1]=meter["OCF.PASSWORD.CHANGE.STRENGTH_METER.WEAK"],$scope.pm.meter.description[2]=meter["OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR"],$scope.pm.meter.description[3]=meter["OCF.PASSWORD.CHANGE.STRENGTH_METER.FAIR"],$scope.pm.meter.description[4]=meter["OCF.PASSWORD.CHANGE.STRENGTH_METER.STRONG"]}),$translate(["OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER","OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER","OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER"]).then(function(labels){$scope.pm.labels.current=labels["OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER"],$scope.pm.labels.new=labels["OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER"],$scope.pm.labels.newConfirm=labels["OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER"],defaultPasswordManagement.labels.current=labels["OCF.PASSWORD.CHANGE.CURRENT_PLACEHOLDER"],defaultPasswordManagement.labels.new=labels["OCF.PASSWORD.CHANGE.NEW_PLACEHOLDER"],defaultPasswordManagement.labels.newConfirm=labels["OCF.PASSWORD.CHANGE.CONFIRM_PLACEHOLDER"]}),$translate("OCF.PASSWORD.CHANGE.PROCESSING").then(function(loading){processing=loading}),$translate(["OCF.PASSWORD.CHANGE.LEGEND.MUST","OCF.PASSWORD.CHANGE.LEGEND.MUST_NOT","OCF.PASSWORD.CHANGE.LEGEND.USED"]).then(function(legend){legendMust=legend["OCF.PASSWORD.CHANGE.LEGEND.MUST"],legendMustNot=legend["OCF.PASSWORD.CHANGE.LEGEND.MUST_NOT"],legendUsed=legend["OCF.PASSWORD.CHANGE.LEGEND.USED"]}),$translate(["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_DIGIT","OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_UPPERCASE","OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_LOWERCASE","OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_SPECIAL","OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.CONTAIN_AT_LEAST","OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.AND"]).then(function(dynamic){dynamicMinDigit=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_DIGIT"],dynamicMinUppercase=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_UPPERCASE"],dynamicMinLowercase=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_LOWERCASE"],dynamicMinSpecial=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.MIN_SPECIAL"],dynamicContainAtLeast=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.CONTAIN_AT_LEAST"],dynamicAnd=dynamic["OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.AND"]}),$translate("OCF.PASSWORD.CHANGE.LEGEND.DYNAMIC.BE_AT_LEAST_MULTIPLE",{number:$scope.pm.passwordRules.minLength}).then(function(txt){dynamicBeAtLeastMultiple=txt}),$translate(["OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INVALID_PASSWORD","OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INCORRECT_PASSWORD","OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_MATCH_PASSWORD","OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_CONNECTION"]).then(function(errors){errorInvalidPass=errors["OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INVALID_PASSWORD"],errorIncorrectPass=errors["OCF.PASSWORD.CHANGE.LEGEND.ERRORS.INCORRECT_PASSWORD"],errorNoMatchPass=errors["OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_MATCH_PASSWORD"],errorNoConnection=errors["OCF.PASSWORD.CHANGE.LEGEND.ERRORS.NO_CONNECTION"]}),$scope.pm=angular.copy(defaultPasswordManagement),$scope.successPasswordChange=!1,$scope.heightScreen<480&&$("ion-content").css("height","auto"),ChangePasswordService.getPasswordRules().then(function(rules){$scope.pm.pR=JSON.parse(angular.toJson(rules)),$scope.pm.passwordRules={minDigit:$scope.pm.pR.minDigit,minLength:$scope.pm.pR.minLength,minUppercase:$scope.pm.pR.minUppercase,minLowercase:$scope.pm.pR.minLowercase,minSpecial:$scope.pm.pR.minSpecial},buildRules()}).catch(function(fail){$scope.pm.passwordRulesErrors.genericError=fail.message,$log.error(fail.status,fail.message,fail.type)}),deregisterGoToPreviousState=$ionicPlatform.registerBackButtonAction(goToPreviousState,501),deregisterPasswordStrengthMeter=$scope.$watch("pm.passwords.new",function(password){var strength=zxcvbn(password).score;$scope.pm.meter.value=strength?strength:password.length?1:0})}),$scope.$on("$ionicView.beforeLeave",function(){deregisterGoToPreviousState(),deregisterPasswordStrengthMeter(),$scope.pm=angular.copy(defaultPasswordManagement)})}function ScanService($rootScope,$timeout){function initialize(activityName){if(console.log(window.datawedge),window.datawedge){console.log(activityName),datawedge.start(),$timeout(function(){datawedge.registerForBarcode(function(data){console.log("dataWedgeScan - broadcast"),$rootScope.$broadcast("dataWedgeScan",data.barcode)})},300)}}var ss=this;return ss.initialize=initialize,ss}function SampleDefinitionService(lodash,SessionService,$rootScope){var cleanDataModel={isBulkInfo:!1,groups:[],screens:{pictures:{display:!1,title:""},dataContainer:[]}},dataModel={ds:angular.copy(cleanDataModel)};return dataModel.getSampleDefinitionId=function(product){var configObject=SessionService.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId,$rootScope.app.appCacheName).config;if(configObject.lots[0]&&configObject.lots[0]&&configObject.lots[0].profileLocation&&configObject.lots[0].profileLocation.length)var profileLocation=lodash.find(configObject.lots[0].profileLocation,function(pl){return pl.produceProfileId==product.id});if(profileLocation)return profileLocation.sampleDefinitionId},dataModel.dynamicDataStructure=function(product){function evalOptions(options){void 0!==options&&options.forEach(function(option){var opt=option.split(" ");"avg"!==opt[0]&&"mode"!==opt[0]||(mode=opt[0],s=opt[1]),"adjust"===opt[0]&&(adjustedValue=opt[1]),"percentage"===opt[0]&&(isPercentage=!0),"optional"===opt[0]&&(isOptional=!0)})}function addEnums(value,groupIndex,groupCategory,valueType,reference,default_value,adjustedValue,s){var data=angular.copy(dataObj);data.title=value,data.group=groupCategory,data.name=groupCategory+"_"+groupIndex,data.validity.type=valueType,data.reference=reference,data.default=default_value,void 0!==default_value&&(data.value=Number(default_value)),value===adjustedValue&&(data.adjusted=!0),dataModel.ds.data.push(data)}var configObject={};configObject=SessionService.ocfManager.getApplicationConfig($rootScope.selectedLocation.locationId,$rootScope.app.appCacheName).config;var gc=[];configObject.attributes.length&&(gc=lodash.find(configObject.attributes,function(attribute){return attribute.sampleDefinitionId==product.sampleDefinitionId}));var dataObj={title:"",group:"",name:"",value:"",screen:"",validity:{},reference:"",default:"",adjusted:!1,optional:!1},acceptedValidityTypes=["_enum","_limit","range","enum","Eol"],subgroupIndexer={};dataModel.ds.data=[];var screen=gc;if("undefined"==typeof screen.ispicturegroup)return void $rootScope.$broadcast("noAttributes");if(dataModel.ds.header={},!screen.ispicturegroup)for(var j=0;j<screen.values.length;j++){var value=screen.values[j],vType=value.type,_index=vType.indexOf("_"),valueType=_index!==-1?vType.substr(_index).toLocaleLowerCase():vType.toLocaleLowerCase(),data=angular.copy(dataObj),vName=value.name,reference=value.reference,default_value=value.default,options=value.options,s=void 0,adjustedValue=void 0,mode=void 0,isPercentage=!1,isOptional=!1;if(void 0!==options&&evalOptions(options),acceptedValidityTypes.indexOf(valueType)===-1)"undefined"==typeof subgroupIndexer[valueType]&&(subgroupIndexer[valueType]=0),data.title=vName,data.group=valueType,data.name=valueType+"_0",data.validity.type="relatives",data.default=default_value,data.optional=isOptional,"eol"==valueType&&(data.validity.type="enum",data.isEol=!0,data.eolChecked=!1,data.validity.options=[{value:"No"},{value:"Yes"}],data.reasons=value.descriptors,lodash.forEach(data.reasons,function(reason){reason.value==data.default&&(reason.selected=!0)})),void 0!==default_value&&(data.value=Number(default_value)),dataModel.ds.groups.indexOf(valueType)===-1&&this.ds.groups.push(valueType),dataModel.ds.data.push(data);else if(_index!==-1){var groupCategory=vType.substr(0,_index).toLocaleLowerCase();if("undefined"==typeof subgroupIndexer[groupCategory]&&(subgroupIndexer[groupCategory]=0),"_enum"===valueType)for(var k=0;k<value.descriptors.length;k++)addEnums(value.descriptors[k].value,++subgroupIndexer[groupCategory],groupCategory,valueType,reference,value.descriptors[k].default,adjustedValue,s);else data.title=vName,data.group=groupCategory,data.name=groupCategory+"_"+ ++subgroupIndexer[groupCategory],data.validity.type=valueType,data.reference=reference,data.default=default_value,data.optional=isOptional,void 0!==default_value&&(data.value=Number(default_value)),dataModel.ds.data.push(data)}else data.title=vName,data.group="",data.name=vName.toLocaleLowerCase(),data.validity.type=valueType,data.optional=isOptional,"enum"==valueType?(data.validity.options=value.descriptors,void 0!==default_value&&(data.value=default_value)):(void 0!==default_value&&(data.value=Number(default_value)),data.validity.percentage=isPercentage,data.validity.range=value.descriptors),dataModel.ds.data.push(data)}},dataModel.getInitialStructure=function(product){return this.dynamicDataStructure(product),dataModel.ds},dataModel.clearDataModel=function(){dataModel.ds=angular.copy(cleanDataModel)},dataModel}function InputValidationService(){function setParameters(tagMask,tagShortMask,tagValidFormat){this.tagMask=tagMask,this.tagShortMask=tagShortMask,this.tagValidFormat=tagValidFormat}function isValidInputTag(value){var isLongFormat=value&&24==value.length&&0==value.indexOf(this.tagMask),isShortFormat=value&&8==value.length;return"long"==this.tagValidFormat&&isLongFormat||"short"==this.tagValidFormat&&isShortFormat||"short-long"==this.tagValidFormat&&(isLongFormat||isShortFormat)}function isValidScannedTag(value){var isLongFormat=value&&24==value.length&&0==value.indexOf(this.tagMask),isShortFormat=value&&value.length==8+this.tagShortMask.length&&0==value.indexOf(this.tagShortMask);return"long"==this.tagValidFormat&&isLongFormat||"short"==this.tagValidFormat&&isShortFormat||"short-long"==this.tagValidFormat&&(isLongFormat||isShortFormat)}function setMask(value){var isScannedShortFormat=value&&value.length==8+this.tagShortMask.length&&0==value.indexOf(this.tagShortMask),isInputShortFormat=value&&8==value.length;return isInputShortFormat?this.tagMask+value:isScannedShortFormat?this.tagMask+this.removeMask(value):value}function removeMask(value){return value.substr(-8)}function isLongScan(value){return value&&24==value.length&&0==value.indexOf(this.tagMask)}function isShortScan(value){return value&&value.length==8+this.tagShortMask.length&&0==value.indexOf(this.tagShortMask)}var cs=this;return cs.isValidInputTag=isValidInputTag,cs.isValidScannedTag=isValidScannedTag,cs.setMask=setMask,cs.setParameters=setParameters,cs.removeMask=removeMask,cs.isLongScan=isLongScan,cs.isShortScan=isShortScan,cs.tagMask=void 0,cs.tagShortMask=void 0,cs.tagValidFormat=void 0,cs}function DataLayerService($q,ConfigurationService,$window,$log,CouchDbConfig,$rootScope,SessionService){function initialize(){function setupConfig(done){function setupDb(db,cb){db.get(function(err,res){return err?404!=err.status?cb(err):void db.put(function(err){return err?cb(err):void db.get(cb)}):cb(null,res)})}return $window.cblite?void cblite.getURL(function(err,url){if(err)return done(err);url=url.replace("localhost","127.0.0.1"),$window.server=coax(url);var db=coax([url,dls.dbName]);setupDb(db,function(err,info){return err?done(err):(dls.db=db,config.localServerUrl=url,config.localDbUrl=url+dls.dbName,done(null,info))})}):done("Couchbase Lite not installed")}var q=$q.defer();if(config&&config.dbName)if(dls.dbName=config.dbName+$rootScope.user.id,config.usePouchDB){if(angular.equals(dls.db,{})||"undefined"!=typeof dls.db){var adapter=$window.sqlitePlugin?{adapter:"websql"}:{};dls.db=new PouchDB(config.dbName,adapter),q.resolve()}}else setupConfig(function(err,info){return err?$log.debug("error: "+JSON.stringify(err)):($log.debug("Database created correctly"+info),q.resolve(),config.autoSync&&($log.debug("Sync enabled"),sync()),void 0)});else $log.debug("error: could not initialize db"),q.reject();return q.promise}function getAllDocuments(){var q=$q.defer();return config.usePouchDB?dls.db.allDocs({include_docs:!0}).then(function(docs){$log.debug("All docs retreived"),q.resolve(docs)}).catch(function(err){$log.debug("Error retreiving all docs"),q.reject(err)}):dls.db.get(["_all_docs",{include_docs:"true"}],function(err,docs){err?($log.debug("Error retreiving all docs"),q.reject(err)):($log.debug("All docs retreived"),q.resolve(docs))}),q.promise}function getDocument(documentId){var q=$q.defer();return dls.db.get(documentId,function(err,doc){err?q.reject(err):q.resolve(doc)}),q.promise}function addDocument(doc){var q=$q.defer();return dls.db.post(doc,function(err,ok){err?($log.debug("Error adding doc: "+err),q.reject(err)):($log.debug("Doc added: "+ok),q.resolve(ok.id))}),q.promise}function updateDocument(doc){var q=$q.defer();return config.usePouchDB?getDocument(doc._id).then(function(DBdoc){return dls.db.put(doc,DBdoc._id,DBdoc._rev)}).then(function(success){$log.debug("Updating doc success: "+success),q.resolve(success)}).catch(function(err){$log.debug("Updating doc failure: "+err),q.reject(err)}):dls.db.put(doc._id,doc,function(err,ok){err?($log.debug("Updating doc failure: "+err),q.reject(err)):($log.debug("Updating doc success: "+ok),q.resolve(ok))}),q.promise}function removeDocument(documentId){var q=$q.defer();return getDocument(documentId).then(function(doc){return doc._deleted=!0,updateDocument(doc)}).then(function(success){$log.debug("Removing doc success: "+success),q.resolve(success)}).catch(function(err){$log.debug("Removing doc failure: "+err),q.reject(err)}),q.promise}function addAttachment(documentId,attachment){var q=$q.defer();return dls.db.get(documentId,function(err,doc){doc._attachments=attachment,doc.last_revision=(new Date).getTime(),dls.db.put(documentId,doc,function(err,ok){err?($log.debug("Adding attachment failure: "+err),q.reject(err)):($log.debug("Adding attachment success: "+ok),q.resolve())})}),q.promise}function getAttachment(documentId){var q=$q.defer();return dls.db.get([documentId,{attachments:"true"}],function(err,doc){err?($log.debug("Retrieving attachment failure: "+err),q.reject(err)):($log.debug("Retrieving attachment success: "+doc),q.resolve(doc._attachments.attachment.data))}),q.promise}function getLocalUrl(){return config.localDbUrl||""}function removeAttachment(documentId,attachmentName){var q=$q.defer();return dls.db.get(documentId,function(err,doc){err?q.reject(err):(delete doc._attachments[attachmentName],updateDocument(doc).then(function(success){$log.debug("Removing attachment success: "+success),q.resolve()}).catch(function(error){$log.debug("Removing attachment failure: "+success),q.reject(error)}))}),q.promise}function compact(){var q=$q.defer();return config.usePouchDB?dls.db.compact().then(function(info){$log.debug("Compact result: "+info.toString()),q.resolve(info)}).catch(function(err){$log.debug("Compact failed: "+err.toString()),q.reject(err)}):dls.db.post(["_compact"],function(err,ok){err?($log.debug("Compact failed: "+err),q.reject(err)):($log.debug("Compact result: "+ok),q.resolve(ok))}),q.promise}function purge(){var q=$q.defer();return config.usePouchDB?($log.debug("Purge not available in PouchDB"),q.reject("Purge not available in PouchDB")):dls.db.post(["_purge"],function(err,ok){err?($log.debug("Purge failed: "+err),q.reject(err)):($log.debug("Purge result: "+ok),q.resolve(ok))}),q.promise}function sync(){function triggerSync(cb){var push={source:{url:dls.dbName},target:{url:config.syncUrl,headers:{Cookie:"SyncGatewaySession="+SessionService.getZestSessionId()}},continuous:!0},pull={target:dls.dbName,source:{url:config.syncUrl,headers:{Cookie:"SyncGatewaySession="+SessionService.getZestSessionId()}},continuous:!0};dls.pushSync=syncManager(config.localServerUrl,push),dls.pullSync=syncManager(config.localServerUrl,pull),dls.pushSync.on("error",function(err){$log.debug(err)}),dls.pushSync.on("connected",function(){dls.pullSync.start()}),dls.pullSync.on("error",function(err){$log.debug(err)}),dls.pullSync.on("connected",function(){cb(!0)}),dls.pushSync.start()}function syncManager(serverUrl,syncDefinition){function callHandlers(name,data){(handlers[name]||[]).forEach(function(h){h(data)})}function doCancelPost(cb){var cancelDef=JSON.parse(JSON.stringify(syncDefinition));cancelDef.cancel=!0,coax.post([serverUrl,"_replicate"],cancelDef,function(err,info){err?(callHandlers("error",err),cb&&cb(err,info)):(callHandlers("cancelled",info),cb&&cb(err,info))})}function doStartPost(){function pollForStatus(info,wait){wait&&setTimeout(function(){tooLate=!0},wait),processTaskInfo(info.session_id,function(done,err){done||tooLate?tooLate&&callHandlers("error","timeout"):setTimeout(function(){pollForStatus(info)},5e3)})}var tooLate,callBack;callBack=syncDefinition.continuous?function(err,info){err?callHandlers("error",err):(pollForStatus(info,1e4),callHandlers("started",info))}:function(err,info){err?401==info.status?(err.status=info.status,callHandlers("auth-challenge",err)):(err.status=info.status,callHandlers("error",err)):callHandlers("connected",info)},coax.post([serverUrl,"_replicate"],syncDefinition,callBack)}function processTaskInfo(id,cb){taskInfo(id,function(err,task){return err?cb(!0,err):angular.equals(task,{})?cb(!0,"no task"):(publicAPI.task=task,void(task.error&&400==task.error[0]?(cb(!0,task.error),callHandlers("error",{status:400,error:task.error[1]})):task.error&&401==task.error[0]?(cb(!0,task.error),callHandlers("auth-challenge",{status:401,error:task.error[1]})):task.error&&502==task.error[0]?(cb(!0,task.error),callHandlers("auth-challenge",{status:502,error:task.error[1]})):"Idle"==task.status||"Stopped"==task.status||/Processed/.test(task.status)&&!/Processed 0/.test(task.status)?(cb(!0),callHandlers("connected",task)):/Processed 0 \/ 0 changes/.test(task.status)?(cb(!1),callHandlers("connected",task)):($log.debug("not done"),cb(!1))))})}function taskInfo(id,cb){coax([serverUrl,"_active_tasks"],function(err,tasks){for(var me={},i=tasks.length-1;i>=0;i--)tasks[i].task==id&&(me=tasks[i]);cb(!1,me)})}var handlers={},publicAPI={start:doStartPost,cancel:doCancelPost,on:function(name,cb){handlers[name]=handlers[name]||[],handlers[name].push(cb)}};return publicAPI}if(config.usePouchDB&&dls.db.prefix&&"_pouch_"==dls.db.prefix)if(config.replicateToCouchDB){var cHost=CouchDbConfig.host.split("//"),cdb=cHost[0]+"//"+config.username+":"+config.password+"@"+cHost[1];dls.db.replicate.to(cdb+"lotqc_"+config.organizationId,{live:!0}).on("error",function(err){$log.debug("Error replicating to CouchDB: "+err)})}else dls.db.sync(config.syncUrl,{live:!0}).on("error",function(err){$log.debug("Error replicating to SG: "+err)});else triggerSync(function(res){$log.debug("Synced:"+res)})}function stopSync(){dls.pullSync&&dls.pushSync&&(dls.pullSync.cancel(),dls.pushSync.cancel())}var dls=this,config=ConfigurationService.getLoggedUserConfig(),coax=require("coax");dls.db={},dls.dbName="";var service={initialize:initialize,getAllDocuments:getAllDocuments,getDocument:getDocument,addDocument:addDocument,updateDocument:updateDocument,removeDocument:removeDocument,addAttachment:addAttachment,getAttachment:getAttachment,getLocalUrl:getLocalUrl,removeAttachment:removeAttachment,compact:compact,purge:purge,sync:sync,stopSync:stopSync};return service}function ConfigurationService($rootScope,CouchBaseConfig,URLManager,EnvironmentConfig){function setLoggedUserConfig(userId,configObject){}function getLoggedUserConfig(){
return{dbName:"user_",syncUrl:CouchBaseConfig.host+CouchBaseConfig.name,usePouchDB:!0,autoSync:!0,tagMask:["330C4DE261100280"]}}var cs=this;return cs.getLoggedUserConfig=getLoggedUserConfig,cs.setLoggedUserConfig=setLoggedUserConfig,cs}function ConfigureHomeController($stateProvider){$stateProvider.state("ocf.home",{url:"/home",views:{ocf:{controller:"HomeController",templateUrl:"home/ocfHome.html"}},resolve:{},data:{}})}function ConfigureLocationSelecion($stateProvider){$stateProvider.state("ocf.locationSelector",{url:"/locationSelector",views:{ocf:{controller:"LocationSelectorController",templateUrl:"commons/LocationSelector/locationSelector.html"}}})}function LocationSelectorController($scope,SessionService,navigateTo,$rootScope,_,$log,LoggingService,$translate,LoadingService){$scope.locations=SessionService.getUserLocations($rootScope.user.id),$scope.loadingMessage="loading",$scope.$on("$ionicView.beforeEnter",function(){$log.debug("Location Selector - $ionicView.beforeEnter"),$translate("OCF.MESSAGES.LOADING").then(function(result){$scope.loadingMessage=result}),LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOCATION_CONTROLLER,"entering_location_screen","Location screen displayed","success",{});var locationSelected=_.find($scope.locations,{selected:!0});locationSelected||($scope.locations[0].selected=!0),$scope.checkDevice=!!$rootScope.ocfConfigs.filterAppListByDeviceModel,1==$scope.locations.length&&$scope.selectLocation()}),$scope.selectLocation=function(){LoadingService.show($scope.loadingMessage),$rootScope.selectedLocation=_.find($scope.locations,{selected:!0}),$scope.subApps=[{appName:"Shipping",appCacheName:"G10",supportedDevice:/^TC7.+/},{appName:"PutAway",appCacheName:"G04",supportedDevice:/^MC92N0$/}];var supplierApps=[];if(_.remove($scope.subApps,function(app){return!_.find($rootScope.appsList,{appName:app.appCacheName})}),supplierApps=_.map($scope.subApps,"appCacheName"),$rootScope.apps=_.filter($rootScope.selectedLocation.appLocations,function(app){return supplierApps.indexOf(app.application)!=-1}),_.forEach($rootScope.apps,function(app,index){var subApp=_.find($scope.subApps,{appCacheName:app.application});$rootScope.apps[index].supportedDevice=subApp.supportedDevice}),!$scope.deviceModel&&window.device&&($scope.deviceModel=window.device.model),$scope.deviceModel&&$scope.checkDevice&&_.remove($rootScope.apps,function(app){var isValidApp=new RegExp(app.supportedDevice);return!$scope.deviceModel.match(isValidApp)}),1!=$rootScope.apps.length)$rootScope.apps.length?($log.debug("Location Selector - More than an app, going to app selection screen",JSON.stringify($rootScope.apps)),navigateTo.home()):($log.debug("Location Selector - No apps available"),$scope.userLogout());else{var availableApp=$rootScope.apps[0],appIndex=_.findIndex($scope.subApps,{appCacheName:availableApp.application});appIndex==-1?($log.debug("Location Selector - No valid app available for the current user"),$scope.userLogout()):($scope.subApps[appIndex].selected=!0,$rootScope.app=angular.copy($scope.subApps[appIndex]),$rootScope.app.appCacheName=$rootScope.app.appCacheName.toUpperCase(),$rootScope.isPilot="Shipping"==$rootScope.app.appName,$rootScope.appLocationId=availableApp.idUUID,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"auto_select_location","Only one location, skipping screen","success",[{key:"location",value:JSON.stringify($rootScope.selectedLocation)}]),navigateTo[availableApp.application.toLowerCase()]())}LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOCATION_CONTROLLER,"location_selection","Selected location","success",[{key:"location",value:JSON.stringify($rootScope.selectedLocation)}])},$scope.selectListLocationItem=function(item,list){for(var i=0;i<list.length;i++)list[i]==item?list[i].selected||(list[i].selected=!0):list[i].selected=!1}}function LimitString(input,limit){var inputString=input+"",prepend="&hellip;",inputLength=inputString.length,outputString=inputString;if(limit=limit.toString(),limit.indexOf("-")!=-1){var formatter=limit.split("-");limit=formatter[0],prepend=formatter[1]}return inputLength>limit?prepend+inputString.substring(inputLength-limit,inputLength):outputString}function NoConnectivityPopupService($q,$ionicModal,lodash,$log,$rootScope,$timeout,$ionicBackdrop,$translate){function close(){asps.noConnectivity.hide(),$timeout(function(){$ionicBackdrop.release(),$("body").removeClass("modal-open")},1e3),$rootScope.$broadcast("noConnectivityClose",!0),$log.debug("No Connectivity Close button clicked")}function retry(){asps.noConnectivity.hide(),$timeout(function(){$ionicBackdrop.release(),$("body").removeClass("modal-open")},1e3),$rootScope.$broadcast("noConnectivityRetry",!0),$log.debug("No Connectivity retry button clicked")}function create(template,options){var q=$q.defer();return template=template||asps.noConnectivityTemplate,options&&lodash.merge(asps.noConnectivityPopupOptions,options),$ionicModal.fromTemplateUrl(template,asps.noConnectivityPopupOptions).then(function(popup){$log.debug("No Connectivity Popup created",popup),asps.noConnectivity=popup,q.resolve("Popup Created")}).catch(function(fail){$log.error("No Connectivity Popup failed to load",fail),q.reject(fail)}),q.promise}function destroy(){$timeout(function(){$ionicBackdrop.release()},1e3),asps.noConnectivity.remove(),$log.debug("No Connectivity removed from DOM")}function open(){$timeout(function(){asps.noConnectivity.show(),$ionicBackdrop.retain()},1e3),$log.debug("No Connectivitye Open button clicked")}function isShown(){return asps.noConnectivity.isShown()}var asps=this;return asps.close=close,asps.retry=retry,asps.create=create,asps.destroy=destroy,asps.open=open,asps.isShown=isShown,asps.noConnectivity=void 0,asps.noConnectivityTemplate="noConnectivityPopUp/noConnectivityPopup.html",asps.noConnectivityPopupOptions={animation:"none",focusFirstInput:!1,backdropClickToClose:!1,hardwareBackButtonClose:!1},asps}function HomeController(SessionService,navigateTo,$rootScope,$scope,$ionicPlatform,$log,_,LoggingService,$ionicViewSwitcher,$ionicSideMenuDelegate,$translate,LoadingService){function goToPreviousState(){$ionicViewSwitcher.nextDirection("back"),$ionicSideMenuDelegate.isOpen()&&$ionicSideMenuDelegate.toggleRight(!1)}$scope.goToPreviousState=goToPreviousState;var deregisterGoToPreviousState;$scope.loadingMessage="loading",$scope.$on("$ionicView.beforeEnter",function(){LoadingService.hide()}),$scope.$on("$ionicView.beforeEnter",function(){$translate("OCF.MESSAGES.LOADING").then(function(result){$scope.loadingMessage=result}),$scope.checkDevice=!!$rootScope.ocfConfigs.filterAppListByDeviceModel,deregisterGoToPreviousState=$ionicPlatform.registerBackButtonAction(goToPreviousState,501),$rootScope.app=null,$rootScope.isPilot=!1,$scope.locations=SessionService.getUserLocations($rootScope.user.id),$scope.hideBackButton=1==$scope.locations.length,$scope.subApps=[{appName:"Shipping",appCacheName:"G10",selected:!1},{appName:"Put Away",appCacheName:"G04",selected:!1}];var appPosition=_.findIndex($scope.subApps,{appCacheName:$rootScope.lastApp});appPosition==-1?$scope.subApps[0].selected=!0:$scope.subApps[appPosition].selected=!0;var supplierApps=[];if(_.remove($scope.subApps,function(app){return!_.find($rootScope.appsList,{appName:app.appCacheName})}),supplierApps=_.map($scope.subApps,"appCacheName"),$rootScope.apps=_.filter($rootScope.selectedLocation.appLocations,function(app){return supplierApps.indexOf(app.application)!=-1}),_.forEach($rootScope.apps,function(app,index){var subApp=_.find($scope.subApps,{appCacheName:app.application});$rootScope.apps[index].supportedDevice=subApp.supportedDevice}),!$scope.deviceModel&&window.device&&($scope.deviceModel=window.device.model),$scope.deviceModel&&$scope.checkDevice&&_.remove($rootScope.apps,function(app){var isValidApp=new RegExp(app.supportedDevice);return!$scope.deviceModel.match(isValidApp)}),1==$rootScope.apps.length){var availableApp=$rootScope.apps[0],appIndex=_.findIndex($scope.subApps,{appCacheName:availableApp.application});$scope.subApps[appIndex].selected=!0,$rootScope.app=angular.copy($scope.subApps[appIndex]),$rootScope.app.appCacheName=$rootScope.app.appCacheName.toUpperCase(),$rootScope.isPilot="Shipping"==$rootScope.app.appName,$rootScope.appLocationId=availableApp.idUUID,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.OCF_APP_SELECTOR,"auto_select_application","Only one application, skipping screen","success",[{key:"application",value:JSON.stringify(availableApp)}]),navigateTo[availableApp.application.toLowerCase()]()}}),$scope.$on("$ionicView.beforeLeave",function(){$log.debug("$ionicView.beforeLeave"),$ionicPlatform.offHardwareBackButton(goToPreviousState)}),$scope.selectApp=function(){LoadingService.show($scope.loadingMessage),$rootScope.app=_.find($scope.subApps,{selected:!0});var availableApp=_.find($rootScope.selectedLocation.appLocations,{application:$rootScope.app.appCacheName});$rootScope.app.appCacheName=$rootScope.app.appCacheName.toUpperCase(),$rootScope.isPilot="Shipping"==$rootScope.app.appName,$rootScope.appLocationId=availableApp.idUUID,$rootScope.lastApp=$rootScope.app.appCacheName,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.OCF_APP_SELECTOR,"auto_select_application","Only one application, skipping screen","success",[{key:"application",value:JSON.stringify(availableApp)}]),navigateTo[availableApp.application.toLowerCase()]()},$scope.selectListAppItem=function(item,list){for(var i=0;i<list.length;i++)list[i]==item?list[i].selected||(list[i].selected=!0):list[i].selected=!1},$scope.$on("$destroy",function(){$log.debug("$destroy"),deregisterGoToPreviousState()})}function AutoLogoutPopupService($q,$ionicModal,lodash,$log,$rootScope,$ionicBackdrop,$window){function close(){asps.autoLogout.remove(),$ionicBackdrop.release(),$rootScope.$broadcast("autoLogoutClose",!0),$window.localStorage.setItem("sessionExpired","false")}function create(template,options){var q=$q.defer();return template=template||asps.autoLogoutTemplate,options&&lodash.merge(asps.autoLogoutPopupOptions,options),$ionicModal.fromTemplateUrl(template,asps.autoLogoutPopupOptions).then(function(popup){$log.debug("AutoLogout Popup created",popup),asps.autoLogout=popup,q.resolve("Popup Created")}).catch(function(fail){$log.error("AutoLogout Popup failed to load",fail),q.reject(fail)}),q.promise}function destroy(){asps.autoLogout.remove(),$log.debug("AutoLogout removed from DOM")}function open(){asps.autoLogout.show(),$ionicBackdrop.retain(),$log.debug("AutoLogout Open button clicked")}function isShown(){return asps.autoLogout.isShown()}var asps=this;return asps.close=close,asps.create=create,asps.destroy=destroy,asps.open=open,asps.isShown=isShown,asps.autoLogout=void 0,asps.autoLogoutTemplate="autoLogoutPopUp/autoLogoutPopup.html",asps.autoLogoutPopupOptions={animation:"none",focusFirstInput:!1,backdropClickToClose:!1,hardwareBackButtonClose:!1},asps}angular.module("ocf.services",["toaster"]).factory("URLManager",["$location","EnvironmentConfig","CouchDbConfig","OCFConfig","StagingConfig","PutAwayConfig",function($location,EnvironmentConfig,CouchDbConfig,OCFConfig,StagingConfig,PutAwayConfig){var environmentHost=EnvironmentConfig.host+EnvironmentConfig.apiPath,ocfHost=OCFConfig.host+OCFConfig.apiPath+OCFConfig.servicePath,stagingConfig=StagingConfig.host+StagingConfig.apiPath,putAwayConfig=PutAwayConfig.host+PutAwayConfig.apiPath,resources={session:environmentHost+"authentication/session",applications:ocfHost+"application/access",ocfConfigurations:ocfHost+"application/ocf/configurations",passwordChange:environmentHost+"resources/password_change/:organizationId",passwordRecover:environmentHost+"resources/password_recover",todayOrders:stagingConfig+"resource/staging/order/:packhouseId/:appLocationId/:isRefresh",selectOrders:stagingConfig+"resource/staging/selectedOrders",getSelectedOrders:stagingConfig+"resource/staging/product/order/:packhouseId/:appLocationId/:isRefresh",closeOrder:stagingConfig+"resource/staging/order/close/:packhouseId/:appLocationId/:orderId",removePallet:stagingConfig+"resource/staging/pallet/remove/:packhouseId/:appLocationId/:tagEpc/:reason",assignPallet:stagingConfig+"resource/staging/pallet/assign/:packhouseId/:appLocationId/:tagEpc/:assignRemovedPallet",unassignPallet:stagingConfig+"resource/staging/pallet/unassign",overridePallet:stagingConfig+"resource/staging/pallet/override/:packhouseId/:appLocationId/:tagEpc/:orderId",stagingConfiguration:stagingConfig+"resource/staging/configuration",pallet:stagingConfig+"resource/staging/pallet/:packhouseId/:appLocationId/:isRefresh",palletDetail:stagingConfig+"resource/staging/pallet/detail/:packhouseId/:appLocationId/:tagEpc",assignPOTag:stagingConfig+"resource/staging/order/assign/tag/:packhouseId/:appLocationId/:orderId/:tagEpc",reopenOrder:stagingConfig+"resource/staging/order/reopen",apiLogMessage:environmentHost+"resources/app_data_logging",grayLogMessage:"http://192.168.6.38:12201/gelf",putAwayConfigurations:putAwayConfig+"resource/pap/configurations",palletInfo:putAwayConfig+"resource/pap/storage/area/assign/pallet/:tagEpc/packhouse/:packhouseId",confirmSA:putAwayConfig+"resource/pap/storage/area/confirm",unassignSA:putAwayConfig+"resource/pap/storage/area/unassign/pallet",language:environmentHost+"resources/user/preferences/:userId",storageAreaValid:putAwayConfig+"resource/pap/storage/area/:barCode",unknown:environmentHost+"UNKNOWN_URL"};return{getUrl:function(resource){return resources[resource]?resources[resource]:resources.unknown}}}]).factory("navigateTo",["$state","$rootScope",function($state,$rootScope){return{login:function(){$state.go("ocf.login")},home:function(){$state.go("ocf.home")},forgotPassword:function(){$state.go("ocf.forgotPassword")},changePassword:function(){$state.go("ocf.changePassword")},gdc:function(){$state.go("ocf.retailer.gdcSelector",{},{reload:!0})},g10:function(){$state.go("ocf.supplier.staging.todayOrders",{},{reload:!0})},g04:function(){$state.go("ocf.supplier.g4.palletDetails",{},{reload:!0})},stagingFillOrders:function(){$state.go("ocf.supplier.staging.fillOrders",{},{reload:!0})},locationSelector:function(){$state.go("ocf.locationSelector",{},{reload:!0})},retailer:function(){$rootScope.isPilot?$state.go("ocf.retailer.baseline.listOfSamplesPilot"):$state.go("ocf.retailer.baseline.listOfSamples")}}}]).factory("encode",function(){var encode=this;return encode.encodeCredentials=function(credentials){return window.btoa(credentials.username+":"+credentials.password)},encode.decodeCredentials=function(credentials){return void 0!=credentials&&window.atob(credentials).split(":")},encode.decodeCredentialsAsObject=function(credentials){var usr=encode.decodeCredentials(credentials);return{username:usr[0],password:usr[1]}},encode}).factory("LoadingService",["$ionicLoading",function($ionicLoading){var loading=null;return{show:function(message){loading=$ionicLoading.show({template:'<ion-spinner icon="lines"></ion-spinner><div>'+message||"Loading</div>",animation:"fade-in"})},hide:function(){$ionicLoading.hide()}}}]).factory("MessageService",function(){var messages={information:[],success:[],warning:[],error:[]},clear=function(){messages.information.length=0,messages.success.length=0,messages.warning.length=0,messages.error.length=0},addMessage=function(type,txt,clearPrevious){clearPrevious&&clear(),messages[type].push(txt)};return{getCurrentMessages:function(){return messages},clear:function(){clear()},addSuccessMessage:function(txt,clearPrevious){addMessage("success",txt,clearPrevious)},addInformationMessage:function(txt,clearPrevious){addMessage("information",txt,clearPrevious)},addWarningMessage:function(txt,clearPrevious){addMessage("warning",txt,clearPrevious)},addErrorMessage:function(txt,clearPrevious){addMessage("error",txt,clearPrevious)}}}).factory("SessionService",["$http","$resource","$state","$window","$q","$timeout","EnvironmentConfig","SessionConfig","OCFConfig","URLManager","navigateTo","encode","lodash","$rootScope",function($http,$resource,$state,$window,$q,$timeout,EnvironmentConfig,SessionConfig,OCFConfig,URLManager,navigateTo,encode,lodash,$rootScope){var Session=$resource(URLManager.getUrl("session"),{},{loginWS:{method:"GET",timeout:EnvironmentConfig.requestTimeout}}),SessionID=$resource(URLManager.getUrl("sessionID"),{},{request:{method:"GET",timeout:EnvironmentConfig.requestTimeout}}),Applications=$resource(URLManager.getUrl("applications"),{},{getApps:{method:"GET",timeout:EnvironmentConfig.requestTimeout}});return Session.login=function(loginData){var q=$q.defer();return Session.setHeaderLogin(loginData).then(function(headerOk){function loginSuccess(userInformation){q.resolve(userInformation)}function loginFail(loginFail){var failMessage={status:loginFail.status,message:loginFail.message,type:"login"};0!==loginFail.status&&(failMessage.message="Authentication failed. Please try again.","java.lang.Exception: Credentials Expired. Contact System Support."==loginFail.data.message&&(failMessage.message="Credentials Expired. Contact System Support.")),q.reject(failMessage)}Session.loginWS({appLocations:!0},loginSuccess,loginFail)}),q.promise},Session.getSessionID=function(loginData,loginInfo){var q=$q.defer();return Session.setHeaderCommon().then(function(headerOk){function sessionSuccess(sessionID){q.resolve(sessionID)}function sessionFail(sessionFail){var failMessage={status:sessionFail.status,message:sessionFail.message,type:"session"};0!==sessionFail.status&&(failMessage.message="Authentication failed. Please try again."),q.reject(failMessage)}SessionID.request({userID:loginInfo.id},sessionSuccess,sessionFail)}),q.promise},Session.sessionID=function(){return JSON.parse($window.localStorage.getItem("sessionID"))},Session.setSessionID=function(sessionID){$window.localStorage.setItem("sessionID",JSON.stringify(sessionID))},Session.setHeader=function(loginData){function setHeader(loginData){var encoded=encode.encodeCredentials(loginData);return $http.defaults.headers.common.Authorization="Basic "+encoded,$http.defaults.headers.common.Authorization}return $q.when(setHeader(loginData))},Session.setHeaderLogin=function(loginData){function setHeaderLogin(loginData){var encoded=encode.encodeCredentials(loginData);return $http.defaults.headers.common.ZestAppName="Shipping",$http.defaults.headers.common.Authorization="Basic "+encoded,$http.defaults.headers.common.ZestSessionId=void 0,$http.defaults.headers.common.Authorization}return $q.when(setHeaderLogin(loginData))},Session.getZestSessionId=function(){var userData=Session.getUserData($rootScope.user.id);return userData.sessionId},Session.setHeaderCommon=function(){function setHeaderCommon(){var userData=Session.getUserData($rootScope.user.id);return $http.defaults.headers.common.Authorization=void 0,$http.defaults.headers.common.ZestAppName="Shipping",$http.defaults.headers.common.ZestSessionId=userData.sessionId,$http.defaults.headers.common.ZestSessionId}return $q.when(setHeaderCommon())},Session.isSignedIn=function(){return!!$window.localStorage[SessionConfig.cookieName]},Session.setLoggedUserId=function(userId){$window.localStorage.setItem("loggedUser",JSON.stringify(userId))},Session.clearLoggedUser=function(){$window.localStorage.setItem("loggedUser","")},Session.getLoggedUserId=function(){return JSON.parse($window.localStorage.getItem("loggedUser"))},Session.getApplicationsList=function(){function appsSuccess(userApps){q.resolve(userApps.applications)}function appsFail(loginFail){console.log(loginFail),q.reject()}var q=$q.defer();return Applications.getApps(appsSuccess,appsFail),q.promise},Session.setUserApplications=function(appsList){var userData=Session.getUserData($rootScope.user.id);userData.apps=appsList,Session.setUserData(userData)},Session.getUserApplications=function(userId){return Session.getUserData(userId).apps},Session.clearCredentials=function(){function cleaner(){return $window.localStorage.removeItem(SessionConfig.cookieName),Session.clearLoggedUser(),!0}var q=$q.defer();return q.resolve(cleaner()),q.promise},Session.setCredentials=function(loginData,userInformation){var encoded=encode.encodeCredentials(loginData),sessionInfo={sessionId:encoded,createdDate:Date.now(),status:""};userInformation.username=loginData.username,$window.localStorage.setItem(SessionConfig.cookieName,JSON.stringify(sessionInfo))},Session.getSessionData=function(){return JSON.parse($window.localStorage.getItem(SessionConfig.cookieName))},Session.getUserLocations=function(userId){var userData=Session.getUserData(userId);if(userData)return userData.locations},Session.getUserData=function(userId){var usersData=JSON.parse($window.localStorage.getItem("userInformation"));return lodash.find(usersData,function(userInfo){return userInfo.id==userId})},Session.setUserData=function(userData){var usersData=JSON.parse($window.localStorage.getItem("userInformation")),foundUserIndex=lodash.findIndex(usersData,function(userInfo){return userInfo.id==userData.id});foundUserIndex!==-1?usersData[foundUserIndex]=userData:(null===usersData&&(usersData=[]),usersData.push(userData)),$window.localStorage.setItem(SessionConfig.userInformation,JSON.stringify(usersData))},Session.setSession=function(loginData){var encoded=encode.encodeCredentials(loginData),sessionInfo={sessionId:encoded,createdDate:(new Date).getTime(),status:""};$window.localStorage.setItem(SessionConfig.cookieName,JSON.stringify(sessionInfo))},Session.destroy=function(){$window.localStorage.removeItem(SessionConfig.cookieName)},Session.updateSessionStatus=function(status){var sessionData=Session.getSessionData();sessionData.status=status,$window.localStorage[SessionConfig.cookieName]=JSON.stringify(sessionData)},Session.setLoggedOffline=function(){Session.updateSessionStatus("loggedOffline")},Session.setSessionExpired=function(){Session.updateSessionStatus("sessionExpired")},Session.setLoggedOnline=function(){Session.updateSessionStatus("loggedOnline")},Session.setLoggingOut=function(){Session.updateSessionStatus("loggingOut")},Session.setLoggedOut=function(){Session.updateSessionStatus("loggedOut")},Session.ocfManager={applicationConfig:function(loginData,appList,locationsList){var userData=Session.getUserData($rootScope.user.id),makeRequest=function(loginData,app,locationId){function storeAppConfig(configObject){var configArray=JSON.parse($window.localStorage.getItem(OCFConfig.configObject));if(null==configArray)configArray=[],configArray.push(configObject);else{var config=lodash.find(configArray,function(config){return config.appName==configObject.appName&&config.locationId==locationId});if(config){var index=lodash.indexOf(configArray,config);configArray[index]=angular.copy(configObject)}else configArray.push(configObject)}return $window.localStorage.setItem(OCFConfig.configObject,JSON.stringify(configArray)),configObject}function appConfigSuccess(success){var appConfig={appName:app.appCacheName,config:success,locationId:locationId};return q.resolve(storeAppConfig(appConfig))}function appConfigFail(fail){var failMessage={status:fail.status,message:"Configurations: ",type:"appConfig"};return 0===fail.status?failMessage.message+="Connection failed.":failMessage.message+=fail.data.reason,q.reject(failMessage)}var q=$q.defer(),initialConfig=$resource(URLManager.getUrl("initialConfig"),{},{getConfigs:{method:"GET",headers:{ZestAppName:"Shipping",ZestSessionId:userData.sessionId}}});return initialConfig.getConfigs({appId:app.appCacheName,locationId:locationId},appConfigSuccess,appConfigFail),q.promise},promises=[];if(!locationsList){var failMessage={status:99,message:"User not assigned to any location.",type:"location"};return $q.reject(failMessage)}for(var j=0;j<locationsList.length;j++)for(var location=locationsList[j],i=0;i<appList.length;i++)promises.push(makeRequest(loginData,appList[i],location.locationId));return $q.allSettled(promises)},getApplicationConfig:function(locationId,appName){return lodash.find(JSON.parse($window.localStorage.getItem(OCFConfig.configObject)),function(config){return config.appName==appName.toLowerCase()&&config.locationId==locationId})}},Session.remoteStorage={userExist:function(loginData){function sessionSuccess(success){return q.resolve(success)}function sessionFail(fail){var failMessage={status:fail.status,message:"Remote Storage: ",type:"remoteStorage"};return 0===fail.status?failMessage.message+="Connection failed.":failMessage.message+=fail.data.reason,q.reject(failMessage)}loginData.username=loginData.username.toUpperCase();var q=$q.defer(),encodedData=encode.encodeCredentials(loginData),cdb=$resource(URLManager.getUrl("couchDbSession"),{},{checkSession:{method:"GET",headers:{Authorization:"Basic "+encodedData}}});return cdb.checkSession(sessionSuccess,sessionFail),q.promise},userCanAccessDatabase:function(loginData,appList,orgId){for(var makeRequest=function(loginData,app,orgId){function sessionSuccess(success){return q.resolve()}function sessionFail(fail){return q.resolve()}var database,organizationId=orgId;database=app.appCacheName+"_"+organizationId;var q=$q.defer(),encodedData=encode.encodeCredentials(loginData),cDbHost=CouchDbConfig.host+database,cdb=$resource(cDbHost,{},{checkSession:{method:"GET",headers:{Authorization:"Basic "+encodedData}}});return cdb.checkSession(sessionSuccess,sessionFail),q.promise},promises=[],i=0;i<appList.length;i++)promises.push(makeRequest(loginData,appList[i],orgId));return $q.allSettled(promises)}},Session}]).factory("pouchLocalDB",["$q",function($q){var db={localDB:null},deferred=$q.defer();return db.set=function(localDB){return null===this.localDB?(this.localDB=localDB,deferred.resolve("success")):deferred.reject("fail"),deferred.promise},db.get=function(){return this.localDB},db}]).factory("InitializationService",["$q",function($q){var initialization={};return initialization}]).factory("ReplicationService",["$q","$rootScope","$timeout","CouchDbConfig","SessionService","PersistenceConfig","pouchLocalDB",function($q,$rootScope,$timeout,CouchDbConfig,SessionService,PersistenceConfig,pouchLocalDB){var ReplicationService=this;return ReplicationService.updateStatus=function(message){$timeout(function(){$rootScope.$apply(function(){$rootScope.isSynchronized=message})})},ReplicationService.retryReplication=function(sessionData){var localDB=pouchLocalDB.get(),sessionInformation=$rootScope.user,organizationId=sessionInformation.organizationId;if(localDB._db_name){var cHost=CouchDbConfig.host.split("//"),cdb=cHost[0]+"//"+sessionInformation.username+":"+sessionData.password+"@"+cHost[1];return localDB.replicate.to(cdb+"lotqc_"+organizationId)}},ReplicationService.liveReplicate=function(sessionData){var localDB=pouchLocalDB.get(),sessionInformation=$rootScope.user,organizationId=sessionInformation.organizationId;if(localDB._db_name){var cHost=CouchDbConfig.host.split("//"),cdb=cHost[0]+"//"+sessionInformation.username+":"+sessionData.password+"@"+cHost[1];return localDB.replicate.to(cdb+"lotqc_"+organizationId,{live:!0})}},ReplicationService.sync=function(sessionData){var localDB=pouchLocalDB.get(),sessionInformation=$rootScope.user,organizationId=sessionInformation.organizationId;if(localDB._db_name){var cHost=CouchDbConfig.host.split("//"),cdb=cHost[0]+"//"+sessionInformation.username+":"+sessionData.password+"@"+cHost[1];return localDB.sync(cdb+"lotqc_"+organizationId,{live:!0})}},ReplicationService.garbageCollector=function(){console.log("Garbage collector called");var localDB=pouchLocalDB.get(),deferred=$q.defer();return localDB._db_name&&(this.retryReplication(),localDB.allDocs({include_docs:!0,descending:!0},function(error,response){if(!error){var todayTime=Date.now();response.rows.forEach(function(element){var lastDocDate=element.doc.createDate;if(lastDocDate){var daysDiff=(todayTime-lastDocDate)/864e5;daysDiff>=PersistenceConfig.daysToLive&&(localDB.remove(element.doc),console.log("Element removed"))}}),deferred.resolve("success")}error&&deferred.reject(error)})),deferred.promise},ReplicationService}]).factory("StagingConfigurationService",["$q","EnvironmentConfig","URLManager","$resource","$log",function($q,EnvironmentConfig,URLManager,$resource,$log){var StagingConfigurationService=this;return StagingConfigurationService.getStagingConfiguration=function(){function success(configuration){$log.debug("Configuration retrieved"),q.resolve(configuration)}function error(error){$log.error("Configuration retrieval failed "+error),q.reject(error)}var q=$q.defer(),request=$resource(URLManager.getUrl("stagingConfiguration"),{},{getStagingConfiguration:{method:"GET",timeout:EnvironmentConfig.requestTimeout}});return request.getStagingConfiguration({},success,error),q.promise},StagingConfigurationService}]).factory("UserPreferenceService",["$q","EnvironmentConfig","URLManager","$resource","$log",function($q,EnvironmentConfig,URLManager,$resource,$log){var UserPreferenceService=this;return UserPreferenceService.getUserPreference=function(userId){function success(configuration){$log.debug("User Configuration retrieved"),q.resolve(configuration)}function error(error){$log.error("User Configuration retrieval failed "+error),q.reject(error)}var q=$q.defer(),request=$resource(URLManager.getUrl("language"),{},{getUserPreference:{method:"GET",timeout:EnvironmentConfig.requestTimeout}});return request.getUserPreference({userId:userId},success,error),q.promise},UserPreferenceService.setUserPreference=function(userId,preferences){function success(configuration){$log.debug("User Configuration setted"),q.resolve(configuration)}function error(error){$log.error("User Configuration setted failed "+error),q.reject(error)}var q=$q.defer(),request=$resource(URLManager.getUrl("language"),{userId:userId},{setUserPreference:{method:"PUT",timeout:EnvironmentConfig.requestTimeout}});return request.setUserPreference(preferences,success,error),q.promise},UserPreferenceService}]).factory("LoggingService",["URLManager","EnvironmentConfig","$q","$log","$resource","$rootScope","$interval",function(URLManager,EnvironmentConfig,$q,$log,$resource,$rootScope,$interval){var logMessageGrayLog=function(app,context,action,message,result,metadata){var data={version:"1.1",host:EnvironmentConfig.env,short_message:message,full_message:JSON.stringify(metadata),action:action,result:result,_environment:app,_facility:"G10",_context:context};jQuery.ajax({url:URLManager.getUrl("grayLogMessage"),type:"POST",data:JSON.stringify(data),success:function(response){$log.debug("Log successfully sent")},error:function(response){$log.debug("Couldn't send log "+JSON.stringify(data))}})},logMessage=function(data){function success(response){$rootScope.logsBlocked=!1,$log.debug("Log saved"),q.resolve(response)}function error(error){$rootScope.logsBlocked=!1,$log.debug("Error saving log "+error),q.reject(error)}var q=$q.defer(),request=$resource(URLManager.getUrl("apiLogMessage"),{},{logMessage:{method:"POST",timeout:EnvironmentConfig.requestTimeout}});return request.logMessage(data,success,error),q.promise},saveLogToSend=function(app,context,action,message,result,metadata){if("[object Array]"!==Object.prototype.toString.call(metadata)&&(metadata=[]),window.cordova){var device={id:window.device.serial,android:window.navigator.appVersion},deviceMetadata={key:"device",value:JSON.stringify(device)};metadata.push(deviceMetadata)}var appVersion=$rootScope.appVersion,appVersionMetadata={key:"application_version",value:appVersion};metadata.push(appVersionMetadata),metadata.push({key:"message",value:message}),metadata.push({key:"context",value:context});var data={host:EnvironmentConfig.env,action:action,result:result,_environment:app,_facility:"OCF",full_message:metadata};$rootScope.logsToSend.push(data)},CONSTANTS={APP:{OCF_DATA_RECOVER:"OCF_Data_Recover",OCF_LOGIN:"OCF_Login",OCF_APP_SELECTOR:"OCF_App_Selector",
OCF_LOCATION_SELECTOR:"OCF_Location_Selector",G10:"G10",G04:"G4"},CONTEXT:{ON_PAUSE:"On_Pause",ON_RESUME:"On_Resume",ON_DEVICE_READY:"On_Device_Ready",ON_DATA_RECOVERING:"On_Data_Recovering",LOGIN_CONTROLLER:"Login_Controller",LOCATION_CONTROLLER:"Location_Controller",TODAY_ORDER_CONTROLLER:"Today_Order_Controller",FILL_ORDER_CONTROLLER:"Fill_Order_Controller",ASSIGN_PALLET_POPUP:"Assign_Pallet_Popup",REMOVE_PALLET_POPUP:"Remove_Pallet_Popup",REOPEN_ORDER_POPUP:"Reopen_Order_Popup",SELECT_ORDER_POPUP:"Select_Order_Popup",EVENT_HANDLER_SERVICE:"Event_Handler_Service",PUT_AWAY_CONTROLLER:"Put_Away_Controller"}};$rootScope.logsToSend||($rootScope.logsToSend=[]),$rootScope.logsBlocked=!1,sendLog&&$interval.cancel(sendLog);var sendLog=$interval(function(){!$rootScope.logsBlocked&&$rootScope.logsToSend.length>0&&($rootScope.logsBlocked=!0,logMessage($rootScope.logsToSend.shift()))},500);return{logMessageGrayLog:function(app,context,action,message,result,metadata){logMessageGrayLog(app,context,action,message,result,metadata),$log.info(app+" - "+context+" - "+action+" - "+message+" - "+result+" - "+JSON.stringify(metadata))},logMessage:function(app,context,action,message,result,metadata,toZest){toZest=void 0==toZest||toZest,toZest&&saveLogToSend(app,context,action,message,result,metadata),console.log(app+" - "+context+" - "+action+" - "+message+" - "+result+" - "+JSON.stringify(metadata))},CONSTANTS:CONSTANTS}}]).factory("LockService",["$log",function($log){var _fields={},_methods={};return _fields.lockList=[],_methods.lock=function(lock){_methods.isLocked(lock)||($log.info("LockService | Locking with key ["+lock+"]"),_fields.lockList.push({id:lock})),$log.info("LockService | Lock list ["+JSON.stringify(_fields.lockList)+"]")},_methods.release=function(lock){$log.info("LockService | Releasing lock with key ["+lock+"]");for(var i=0;i<_fields.lockList.length;i++)"object"==typeof _fields.lockList[i]&&"undefined"!=typeof _fields.lockList[i].id&&_fields.lockList[i].id==lock&&_fields.lockList.splice(i,1);$log.info("LockService | Lock list ["+JSON.stringify(_fields.lockList)+"]")},_methods.isLocked=function(lock){var lockItem=_.find(_fields.lockList,function(lockLookup){return lockLookup.id==lock}),isLocked="object"==typeof lockItem&&"undefined"!=typeof lockItem.id&&lockItem.id==lock;return $log.info("LockService | Verifying if key ["+lock+"] is locked | "+lock+" ["+isLocked.toString()+"]"),isLocked},_methods.areLocked=function(lockList){if(!_.isArray(lockList))return!1;for(var i=0;i<lockList.length;i++)if(!_methods.isLocked(lockList[i]))return!1;return!0},{lock:_methods.lock,release:_methods.release,isLocked:_methods.isLocked,areLocked:_methods.areLocked}}]).factory("EventHandlerService",["$timeout","$log","LoggingService",function($timeout,$log,LoggingService){function _enqueue(event){$log.debug("_enqueue",JSON.stringify(event),JSON.stringify(_queue),JSON.stringify(_loggingStates)),event.agnostic&&(event.execState=_currentState),_queue.push(event)}function _clearQueue(){$log.debug("_clearQueue"),_queue=[]}function _setCurrentState(currentState){$log.debug("_setCurrentState","target:",currentState,"current:",_currentState,JSON.stringify(_loggingStates)),currentState&&(_clearQueue(),_currentState=currentState)}function _trigger(value){var event=_queue.shift();event&&(angular.isArray(event.execState)&&event.execState.indexOf(_currentState)!=-1||event.execState==_currentState)?($log.debug("before event.trigger()",JSON.stringify(event),JSON.stringify(_loggingStates)),event.trigger().then(_setCurrentState).catch(_setCurrentState).finally(_trigger)):$timeout(_trigger,64)}function _setLoggingState(app,context){app&&context?(_loggingStates.app=LoggingService.CONSTANTS.APP[app],_loggingStates.context=LoggingService.CONSTANTS.CONTEXT[context]):(_loggingStates.app="",_loggingStates.context="")}var _currentState,_loggingStates={app:"",context:""},_queue=[];return _trigger(),{setCurrentState:function(currentState){_setCurrentState(currentState)},enqueue:function(event){_enqueue(event)},setLoggingState:function(app,context){_setLoggingState(app,context)}}}]).factory("TimeoutLockService",["$log","toaster","$translate",function($log,toaster,$translate){var _fields={},_methods={},message="Application busy";return $translate("OCF.APPLICATION_BUSY.MESSAGE").then(function(result){message=result}),_fields.serviceName="TimeoutLockService",_fields.lastLock=0,_methods.now=function(){return(new Date).getTime()},_methods.getLockTimeout=function(){var lockTimeout=500;return $log.info(_fields.serviceName+" | Lock timeout read from configuration ["+lockTimeout+"]"),lockTimeout},_methods.lock=function(){$log.info(_fields.serviceName+" | Activating locking for "+_methods.getLockTimeout()+" milliseconds"),_fields.lastLock=_methods.now()},_methods.displayAppBusyToaster=function(){$log.debug(_fields.serviceName+" | Displaying toaster message"),$translate("OCF.APPLICATION_BUSY.MESSAGE").then(function(result){message=result,toaster.pop({type:"error",body:message,timeout:5e3,showCloseButton:!0})})},_methods.isLocked=function(){return _fields.lastLock+_methods.getLockTimeout()>=_methods.now()?($log.info(_fields.serviceName+" | Lock is active"),_methods.displayAppBusyToaster(),!0):($log.info(_fields.serviceName+" | Lock is not active"),_methods.lock(),!1)},{isLocked:_methods.isLocked}}]).factory("OCFConfigurationService",["$resource","$q","$rootScope","$window","$log","URLManager","EnvironmentConfig",function($resource,$q,$rootScope,$window,$log,URLManager,EnvironmentConfig){function _retrieveConfigs(){return $q(function(resolve,reject){function _success(ocfConfigs){$window.localStorage.setItem("ocfConfigs",JSON.stringify(ocfConfigs)),resolve(ocfConfigs)}function _fail(error){$log.error("OCF Configuration Retrieve failed",error),resolve({})}OCFConfigs.getConfigs({},_success,_fail)})}function _getOcfConfigs(){var ocfConfigs=$window.localStorage.getItem("ocfConfigs");return ocfConfigs?JSON.parse(ocfConfigs):{}}var OCFConfigs=$resource(URLManager.getUrl("ocfConfigurations"),{},{getConfigs:{method:"GET",timeout:EnvironmentConfig.requestTimeout}}),configs=this;return configs.retrieveConfigs=_retrieveConfigs,configs.getOcfConfigs=_getOcfConfigs,configs}]).factory("StorageService",["$resource","URLManager","EnvironmentConfig",function($resource,URLManager,EnvironmentConfig){function validStorageArea(barCode){var request=$resource(URLManager.getUrl("storageAreaValid"),{},{validateStorageArea:{method:"GET",timeout:EnvironmentConfig.requestTimeout}}),valid=request.validateStorageArea({barCode:barCode});return valid.$promise}var storageService={validStorageArea:validStorageArea};return storageService}]),angular.module("ocf.services").service("LanguageSelectorService",LanguageSelectorService),LanguageSelectorService.$inject=["$q","$ionicModal","lodash","$log","$rootScope","$ionicBackdrop","$translate","UserPreferenceService"],angular.module("ocf.forgotPassword",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("ocf.forgotPassword",{url:"/forgotPassword",views:{ocf:{controller:"ForgotPasswordController",templateUrl:"passwordMgmt/forgotPassword/forgotPassword.html"}}})}]),angular.module("ocf.services").service("ForgotPasswordService",ForgotPasswordService),ForgotPasswordService.$inject=["$q","$resource","URLManager"],angular.module("ocf.forgotPassword",[]).controller("ForgotPasswordController",ForgotPasswordController),ForgotPasswordController.$inject=["$scope","navigateTo","$ionicPlatform","ForgotPasswordService","LoadingService","$translate"],angular.module("ocf.changePassword.success",[]).controller("ChangePasswordSuccessController",ChangePasswordSuccessController),ChangePasswordSuccessController.$inject=["$scope","$state","$log","navigateTo","$window","$timeout","toaster","$ionicViewSwitcher","$ionicSideMenuDelegate","$ionicPlatform","ChangePasswordService"],angular.module("ocf.changePassword",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("ocf.changePassword",{url:"/changePassword",views:{ocf:{controller:"ChangePasswordController",templateUrl:"passwordMgmt/changePassword/changePassword.html"}}})}]),angular.module("ocf.services").factory("ChangePasswordService",ChangePasswordService),ChangePasswordService.$inject=["$q","$resource","$rootScope","EnvironmentConfig","URLManager","encode"],angular.module("ocf.changePassword").controller("ChangePasswordController",ChangePasswordController),ChangePasswordController.$inject=["$scope","$state","$log","navigateTo","lodash","$ionicViewSwitcher","$ionicPlatform","$translate","ChangePasswordService","LoadingService","$window"],angular.module("ocf.login",["ui.router"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("ocf.login",{url:"/login",views:{ocf:{controller:"LoginController",templateUrl:"login/templates/login.html"}},resolve:{},data:{}})}]).controller("LoginController",["$scope","$timeout","$rootScope","SessionService","navigateTo","ReplicationService","LoadingService","MessageService","CouchDbConfig","encode","URLManager","$resource","$q","$http","DataLayerService","StagingConfigurationService","$ionicPlatform","AutoLogoutPopupService","$log","$window","lodash","LoggingService","OCFConfigurationService","UserPreferenceService","$translate",function($scope,$timeout,$rootScope,SessionService,navigateTo,ReplicationService,LoadingService,MessageService,CouchDbConfig,encode,URLManager,$resource,$q,$http,DataLayerService,StagingConfigurationService,$ionicPlatform,AutoLogoutPopupService,$log,$window,_,LoggingService,OCFConfigurationService,UserPreferenceService,$translate){function goToPreviousState(e){e&&e.preventDefault()}function forgotPassword(){LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"login","Going to forgot password screen","success",{}),navigateTo.forgotPassword()}$scope.goToPreviousState=goToPreviousState;var backupUsername="Username",backupPassword="Password";$scope.form={username:backupUsername,password:backupPassword};var deregisterGoToPreviousState;$scope.heightScreen=$window.screen.height,$scope.$on("$ionicView.beforeEnter",function(){deregisterGoToPreviousState=$ionicPlatform.registerBackButtonAction(goToPreviousState,501),"true"===$window.localStorage.getItem("sessionExpired")&&($scope.autoLogoutPopup=AutoLogoutPopupService,$scope.autoLogoutPopup.create("",{scope:$scope}).then(function(success){$log.debug(success),LoadingService.hide(),$scope.autoLogoutPopup.open()}).catch(function(fail){$log.error(fail)})),$translate(["OCF.LOGIN.USERNAME_PLACEHOLDER","OCF.LOGIN.PASSWORD_PLACEHOLDER"]).then(function(placeholders){$scope.form.username=placeholders["OCF.LOGIN.USERNAME_PLACEHOLDER"],$scope.form.backupUsername=placeholders["OCF.LOGIN.USERNAME_PLACEHOLDER"],$scope.form.password=placeholders["OCF.LOGIN.PASSWORD_PLACEHOLDER"],$scope.form.backupPassword=placeholders["OCF.LOGIN.PASSWORD_PLACEHOLDER"]})}),$scope.$on("$ionicView.beforeLeave",function(){$log.debug("$ionicView.beforeLeave"),$ionicPlatform.offHardwareBackButton(goToPreviousState)}),$scope.$on("$ionicView.afterEnter",function(){function _onTouchEnd(event){var touches=event.changedTouches[0];_touchesInput(usernameInputBlock,touches)?delete $scope.form.username:$scope.form.username=backupUsername,_touchesInput(passwordInputBlock,touches)?delete $scope.form.password:$scope.form.password=backupPassword}function _touchesInput(inputBoundaries,touches){return inputBoundaries.left<=touches.clientX&&inputBoundaries.right>=touches.clientX&&inputBoundaries.top<=touches.clientY&&inputBoundaries.bottom>=touches.clientY}if($scope.heightScreen<480){for(var usernameInputBlock=document.getElementById("usernameInput").getBoundingClientRect(),passwordInputBlock=document.getElementById("passwordInput").getBoundingClientRect(),arrayInputs=["usernameInput","passwordInput"],i=0;i<arrayInputs.length;i++)document.getElementById(arrayInputs[i]).addEventListener("touchend",function(element){var $element=$(element.target);$timeout(function(){"usernameInput"==$element.attr("id")?delete $scope.form.username:delete $scope.form.password},100)});document.addEventListener("touchend",_onTouchEnd)}}),$scope.$on("$destroy",function(){$log.debug("$destroy"),deregisterGoToPreviousState()}),$scope.loginData={},$scope.appVersion="v",$scope.heightScreen=$window.screen.height,$scope.forgotPassword=forgotPassword,$rootScope.$on("appVersion",function(event,appVersion){$scope.appVersion+=appVersion}),$scope.doLogin=function(){MessageService.clear(),$scope.loginData&&$scope.loginData.username&&($scope.loginData.username=$scope.loginData.username.toLowerCase());var successLoginInfo,loginData=angular.copy($scope.loginData);LoadingService.show("verifying credentials"),SessionService.login(loginData).then(function(loginSuccess){if(successLoginInfo=loginSuccess,$rootScope.user=loginSuccess,$rootScope.userRecoverData={},2!=$rootScope.user.accountTypeId)throw{status:500,message:"The user is not a supplier user.",type:"login"};if($scope.locations=$rootScope.user.locations,!$scope.locations||!$scope.locations[0].appLocations||0==$scope.locations[0].appLocations.length)throw{status:500,message:"The user does not have access to any application.",type:"login"};loginSuccess.username=loginSuccess.username.toUpperCase(),LoadingService.hide(),console.log("Logged into Zest's WS"),loginSuccess&&SessionService.setUserData(loginSuccess),LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"login","User successfully logged in","success",[{key:"user",value:JSON.stringify(loginSuccess)}])}).then(function(applicationsSuccess){var userData=SessionService.getUserData($rootScope.user.id);return $scope.appsList=userData.locations,$rootScope.stagingConfiguration=void 0,StagingConfigurationService.getStagingConfiguration()}).then(function(response){return LoadingService.hide(),$rootScope.stagingConfiguration=response,SessionService.clearCredentials()}).then(function(){return SessionService.setCredentials(loginData,successLoginInfo),console.log("setting logged user"),SessionService.setLoggedUserId($rootScope.user.id),SessionService.setUserApplications($scope.appsList),SessionService.setHeaderCommon(),SessionService.getApplicationsList()}).then(function(applicationsSuccess){return $rootScope.appsList=applicationsSuccess,$rootScope.userRecoverData.appsList=$rootScope.appsList,UserPreferenceService.getUserPreference($rootScope.user.id)}).then(function(response){if($rootScope.userConfiguration=response,void 0!=$rootScope.userConfiguration.preferences.language)switch($translate.use($rootScope.userConfiguration.preferences.language),$rootScope.userConfiguration.preferences.language){case"es":$rootScope.selectedLanguage="Spanish";break;case"en":$rootScope.selectedLanguage="English"}else $rootScope.selectedLanguage="English",$translate.use("en");return OCFConfigurationService.retrieveConfigs()}).then(function(ocfConfigs){if($rootScope.ocfConfigs=ocfConfigs,$scope.checkDevice=!!ocfConfigs.filterAppListByDeviceModel,$rootScope.checkDevice=$scope.checkDevice,$rootScope.filterAppListByDeviceModel=$scope.filterAppListByDeviceModel,1==$scope.locations.length){$rootScope.selectedLocation=angular.copy($scope.locations[0]),$scope.subApps=[{appName:"Shipping",appCacheName:"G10",supportedDevice:/^TC7.+/},{appName:"PutAway",appCacheName:"G04",supportedDevice:/^MC92N0$/}];var supplierApps=[];if(_.remove($scope.subApps,function(app){return!_.find($rootScope.appsList,{appName:app.appCacheName})}),supplierApps=_.map($scope.subApps,"appCacheName"),$rootScope.apps=_.filter($rootScope.selectedLocation.appLocations,function(app){return supplierApps.indexOf(app.application)!=-1}),_.forEach($rootScope.apps,function(app,index){var subApp=_.find($scope.subApps,{appCacheName:app.application});$rootScope.apps[index].supportedDevice=subApp.supportedDevice}),!$scope.deviceModel&&window.device&&($scope.deviceModel=window.device.model),$scope.deviceModel&&$scope.checkDevice&&_.remove($rootScope.apps,function(app){var isValidApp=new RegExp(app.supportedDevice);return!$scope.deviceModel.match(isValidApp)}),1!=$rootScope.apps.length)$rootScope.apps.length?($log.debug("Login Screen - More than an app, going to app selection screen",JSON.stringify($rootScope.apps)),navigateTo.home()):($log.debug("Login Screen - No apps available"),navigateTo.login());else{var availableApp=$rootScope.apps[0],appIndex=_.findIndex($scope.subApps,{appCacheName:availableApp.application});appIndex==-1?($log.debug("Login Screen - No valid app available for the current user"),$scope.userLogout()):($scope.subApps[appIndex].selected=!0,$rootScope.app=angular.copy($scope.subApps[appIndex]),$rootScope.app.appCacheName=$rootScope.app.appCacheName.toUpperCase(),$rootScope.isPilot="Shipping"==$rootScope.app.appName,$rootScope.appLocationId=availableApp.idUUID,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"auto_select_location","Only one location, skipping screen","success",[{key:"location",value:JSON.stringify($rootScope.selectedLocation)}]),navigateTo[availableApp.application.toLowerCase()]())}}else LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"login","Going to location selector","success",{}),navigateTo.locationSelector()}).catch(function(error){if("remoteStorage"!==error.type||401!=error.status){switch($log.error(error),error.status){case 0:MessageService.addErrorMessage("No connection available",!0);break;case 99:MessageService.addErrorMessage(error.message,!0);break;default:var readableMessage=error.message+" (code: "+error.status+")";MessageService.addErrorMessage(readableMessage,!0)}LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"login","Fail to login","error",[{key:"error",value:JSON.stringify(error)}])}}).finally(function(){LoadingService.hide(),$scope.loginData={}})},$rootScope.$on("dataRecover",function(){var dataRecover=JSON.parse(window.localStorage.getItem("dataRecover")),dataRecoverParam=void 0!=dataRecover?dataRecover:{};if(LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING,"onDataRecover callback","Checking if there is data to recover","success",[{key:"dataRecover",value:JSON.stringify(dataRecoverParam)}],!1),dataRecover&&dataRecover.hasToRecover){dataRecover.hasToRecover=!1;var user=dataRecover.loginData.user,userRecoverData=dataRecover.loginData.userRecoverData;if(user&&userRecoverData){$rootScope.user=angular.copy(user),user.username=user.username.toUpperCase(),SessionService.setUserData(user);var currentTime=(new Date).getTime(),pausedDate=new Date(dataRecover.createdDateTime).getTime(),logoutTimeoutMilliseconds=dataRecover.loginData.configuration.userInactivityTimeout,timeout=logoutTimeoutMilliseconds?logoutTimeoutMilliseconds:0;if($rootScope.stagingConfiguration=dataRecover.loginData.configuration,timeout=pausedDate+timeout,currentTime>=timeout)LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING,"onDataRecover callback","User should be logged out as the timeout for background has ended","success",[{key:"dataRecover",value:JSON.stringify(dataRecover)},{key:"logoutTimeoutMilliseconds",value:logoutTimeoutMilliseconds}],!1),window.localStorage.setItem("dataRecover",JSON.stringify({})),$rootScope.$emit("logout",!0);else{LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_DATA_RECOVERING,"onDataRecover callback","Has to recover","success",[{key:"dataRecover",value:JSON.stringify(dataRecover)}],!1);var selectedLocation=dataRecover.loginData.selectedLocation,selectedApp=dataRecover.loginData.selectedApp,selectedLanguage=dataRecover.loginData.selectedLanguage,locations=dataRecover.loginData.locations,checkDevice=(dataRecover.loginData.apps,dataRecover.loginData.checkDevice),filterAppListByDeviceModel=dataRecover.loginData.filterAppListByDeviceModel,userConfiguration=dataRecover.loginData.userConfiguration;if(delete dataRecover.loginData,delete dataRecover.hasToRecover,delete dataRecover.createdDateTime,window.localStorage.setItem("dataRecover",JSON.stringify(dataRecover)),$rootScope.userRecoverData=userRecoverData,$rootScope.appsList=userRecoverData.appsList,$rootScope.userConfiguration=userConfiguration,$rootScope.ocfConfigs={filterAppListByDeviceModel:filterAppListByDeviceModel},SessionService.clearCredentials().then(function(){var loginData={username:user.username};SessionService.setCredentials(loginData,user),SessionService.setLoggedUserId(user.id),SessionService.setUserApplications(userRecoverData.appsList),SessionService.setHeaderCommon()}),$rootScope.selectedLanguage=selectedLanguage,selectedLanguage||($rootScope.selectedLanguage="English",$translate.use("en")),selectedLocation||1==locations.length){var locToSelect=selectedLocation;selectedLocation||(locToSelect=locations[0]),$rootScope.selectedLocation=angular.copy(locToSelect),$scope.subApps=[{appName:"Shipping",appCacheName:"G10",supportedDevice:/^TC7.+/},{appName:"PutAway",appCacheName:"G04",supportedDevice:/^MC92N0$/}];var supplierApps=[];if(_.remove($scope.subApps,function(app){return!_.find($rootScope.appsList,{appName:app.appCacheName})}),supplierApps=_.map($scope.subApps,"appCacheName"),$rootScope.apps=_.filter($rootScope.selectedLocation.appLocations,function(app){return supplierApps.indexOf(app.application)!=-1}),_.forEach($rootScope.apps,function(app,index){var subApp=_.find($scope.subApps,{appCacheName:app.application});$rootScope.apps[index].supportedDevice=subApp.supportedDevice}),!$scope.deviceModel&&window.device&&($scope.deviceModel=window.device.model),$scope.deviceModel&&checkDevice&&_.remove($rootScope.apps,function(app){var isValidApp=new RegExp(app.supportedDevice);return!$scope.deviceModel.match(isValidApp)}),1==$rootScope.apps.length||selectedApp){var selectedAppIndex=void 0!=selectedApp?_.findIndex($rootScope.apps,{application:selectedApp.appCacheName}):0;selectedAppIndex!=-1?$rootScope.app=$rootScope.apps[selectedAppIndex]:$rootScope.app=$rootScope.apps[0];var availableApp=$rootScope.app,appIndex=_.findIndex($scope.subApps,{appCacheName:availableApp.application});appIndex==-1?($log.debug("Login Screen - No valid app available for the current user"),$scope.userLogout()):($scope.subApps[appIndex].selected=!0,$rootScope.app=angular.copy($scope.subApps[appIndex]),$rootScope.app.appCacheName=$rootScope.app.appCacheName.toUpperCase(),$rootScope.isPilot="Shipping"==$rootScope.app.appName,$rootScope.appLocationId=availableApp.idUUID,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"auto_select_location","Only one location, skipping screen","success",[{key:"location",value:JSON.stringify($rootScope.selectedLocation)}]),navigateTo[availableApp.application.toLowerCase()]())}else $rootScope.apps.length?($log.debug("Login Screen - More than an app, going to app selection screen",JSON.stringify($rootScope.apps)),navigateTo.home()):($log.debug("Login Screen - No apps available"),navigateTo.login())}else LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_LOGIN,LoggingService.CONSTANTS.CONTEXT.LOGIN_CONTROLLER,"login","Going to location selector","success",{}),navigateTo.locationSelector()}}else $rootScope.$broadcast("checkNewVersion")}else $rootScope.$broadcast("checkNewVersion")})}]),angular.module("ocf.services").service("ScanService",ScanService),ScanService.$inject=["$rootScope","$timeout"],angular.module("ocf.services").service("SampleDefinitionService",SampleDefinitionService),SampleDefinitionService.$inject=["lodash","SessionService","$rootScope"],angular.module("ocf.services").service("InputValidationService",InputValidationService),InputValidationService.$inject=["$rootScope"],angular.module("ocf.services").service("DataLayerService",DataLayerService),DataLayerService.$inject=["$q","ConfigurationService","$window","$log","CouchDbConfig","$rootScope","SessionService"],angular.module("ocf.services").service("ConfigurationService",ConfigurationService),ConfigurationService.$inject=["$rootScope","CouchBaseConfig","URLManager","EnvironmentConfig"],angular.module("ocf.controllers",[]).config(ConfigureHomeController),ConfigureHomeController.$inject=["$stateProvider"],angular.module("ocf.controllers").config(ConfigureLocationSelecion),ConfigureLocationSelecion.$inject=["$stateProvider"],angular.module("ocf.controllers").controller("LocationSelectorController",LocationSelectorController),LocationSelectorController.$inject=["$scope","SessionService","navigateTo","$rootScope","lodash","$log","LoggingService","$translate","LoadingService"],require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({"ZeJ/60":[function(require,module,exports){var pax=require("pax"),hoax=require("hoax"),coaxPax=pax();coaxPax.extend("getQuery",function(params){params=JSON.parse(JSON.stringify(params));for(var key,keys=["key","startkey","endkey","start_key","end_key"],i=0;i<keys.length;i++)key=keys[i],params[key]&&(params[key]=JSON.stringify(params[key]));return params});var Coax=module.exports=hoax.makeHoax(coaxPax());Coax.extend("changes",function(opts,cb){"function"==typeof opts&&(cb=opts,opts={});var self=this;if(opts=opts||{},"continuous"==opts.feed){var listener=self(["_changes",opts],function(err,ok){return err&&"ETIMEDOUT"==err.code?self.changes(opts,cb):err?cb(err):void 0});return listener.on("data",function(data){var sep="\n";eom=data.toString().indexOf(sep),msg=data.toString().substring(0,eom),remaining=data.toString().substring(eom+1,data.length),remaining.length>0&&listener.emit("data",remaining);var json=JSON.parse(msg);cb(!1,json)}),listener}return opts.feed="longpoll",self(["_changes",opts],function(err,ok){return err&&"ETIMEDOUT"==err.code?self.changes(opts,cb):err?cb(err):(ok.results.forEach(function(row){cb(null,row)}),opts.since=ok.last_seq,void self.changes(opts,cb))})}),Coax.extend("forceSave",function(doc,cb){var api=this(doc._id);api.get(function(err,old){return err&&"not_found"!==err.error?cb(err):(err||(doc._rev=old._rev),void api.put(doc,cb))})}),Coax.extend("channels",function(channels,opts){var self=this,opts=opts||{};opts.filter="sync_gateway/bychannel",opts.feed="continuous",opts.channels=channels.join(",");var x=function(){};x.request=!0;var changes=self(["_changes",opts],x);return changes.on("data",function(data){var json;try{var json=JSON.parse(data.toString())}catch(e){console.log("not json",data.toString())}json&&changes.emit("json",json)}),changes})},{hoax:6,pax:3}],coax:[function(require,module,exports){module.exports=require("ZeJ/60")},{}],3:[function(require,module,exports){function objToQuery(q){var k,v,ks=Object.keys(q),query=[];for(k=0;k<ks.length;k++)v=q[ks[k]],query.push(encodeURIComponent(ks[k])+"="+encodeURIComponent(v.toString()));return query.join("&")}function processPath(path){if(path&&path.pop&&path.length)return"object"==typeof path[path.length-1]&&(path.query=path.pop()),path;if("object"==typeof path){var empty=[];return empty.query=path,empty}return path?[path]:[]}function merge(target,source){for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key]);return target}function mergePaths(path,newPath){var k,merged=path.concat(newPath);merged.methods={},path.query&&(merged.query=merge({},path.query)),newPath.query&&(merged.query=merge(merged.query||{},newPath.query)),"undefined"!=typeof path.getQuery&&(merged.getQuery=path.getQuery);for(k in path.methods)merged.methods[k]=path.methods[k];return merged}function makeToString(path){var first=!0,encoded=path.map(function(p){return first&&(first=!1,/^http/.test(p))?/\/$/.test(p)?p.substring(0,p.length-1):p:encodeURIComponent(p)});return function(){if(path.query){var qobj;return qobj=path.getQuery||this.getQuery?(path.getQuery||this.getQuery)(path.query):path.query,encoded.join("/")+"?"+objToQuery(qobj)}return encoded.join("/")}}function extenderizer(path){return path.methods=path.methods||{},function(name,fun){path.methods[name]=fun,this[name]=fun}}function addExtensions(pax,path){var k;for(k in path.methods)pax[k]=path.methods[k]}function makeNextPathFun(path){var nextPax=function(nextPath){return"undefined"!=typeof nextPax.getQuery&&(path.getQuery=nextPax.getQuery),arguments.length>1?growPax(path,[].map.call(arguments,function(arg){return arg})):growPax(path,nextPath)};return addExtensions(nextPax,path),nextPax.extend=extenderizer(path),nextPax.toString=makeToString(path),nextPax}function growPax(path,newPath){return newPath=processPath(newPath),path=mergePaths(path,newPath),makeNextPathFun(path)}var growPax;module.exports=makeNextPathFun([])},{}],T81WCk:[function(require,module,exports){function FastClick(layer){"use strict";var oldOnClick,self=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=layer,!layer||!layer.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(self,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(self,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(self,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(self,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(self,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(self,arguments)},FastClick.notNeeded(layer)||(this.deviceIsAndroid&&(layer.addEventListener("mouseover",this.onMouse,!0),layer.addEventListener("mousedown",this.onMouse,!0),layer.addEventListener("mouseup",this.onMouse,!0)),layer.addEventListener("click",this.onClick,!0),layer.addEventListener("touchstart",this.onTouchStart,!1),layer.addEventListener("touchmove",this.onTouchMove,!1),layer.addEventListener("touchend",this.onTouchEnd,!1),layer.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;"click"===type?rmv.call(layer,type,callback.hijacked||callback,capture):rmv.call(layer,type,callback,capture)},layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;"click"===type?adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){event.propagationStopped||callback(event)}),capture):adv.call(layer,type,callback,capture)}),"function"==typeof layer.onclick&&(oldOnClick=layer.onclick,layer.addEventListener("click",function(event){oldOnClick(event)},!1),layer.onclick=null))}FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(target){"use strict";switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===target.type||target.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(target.className);
},FastClick.prototype.needsFocus=function(target){"use strict";switch(target.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}},FastClick.prototype.sendClick=function(targetElement,event){"use strict";var clickEvent,touch;document.activeElement&&document.activeElement!==targetElement&&document.activeElement.blur(),touch=event.changedTouches[0],clickEvent=document.createEvent("MouseEvents"),clickEvent.initMouseEvent(this.determineEventType(targetElement),!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),clickEvent.forwardedTouchEvent=!0,targetElement.dispatchEvent(clickEvent)},FastClick.prototype.determineEventType=function(targetElement){"use strict;";return this.deviceIsAndroid&&"select"===targetElement.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(targetElement){"use strict";var length;this.deviceIsIOS&&targetElement.setSelectionRange&&0!==targetElement.type.indexOf("date")&&"time"!==targetElement.type?(length=targetElement.value.length,targetElement.setSelectionRange(length,length)):targetElement.focus()},FastClick.prototype.updateScrollParent=function(targetElement){"use strict";var scrollParent,parentElement;if(scrollParent=targetElement.fastClickScrollParent,!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement,targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}scrollParent&&(scrollParent.fastClickLastScrollTop=scrollParent.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){"use strict";return eventTarget.nodeType===Node.TEXT_NODE?eventTarget.parentNode:eventTarget},FastClick.prototype.onTouchStart=function(event){"use strict";var targetElement,touch,selection;if(event.targetTouches.length>1)return!0;if(targetElement=this.getTargetElementFromEventTarget(event.target),touch=event.targetTouches[0],this.deviceIsIOS){if(selection=window.getSelection(),selection.rangeCount&&!selection.isCollapsed)return!0;if(!this.deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier)return event.preventDefault(),!1;this.lastTouchIdentifier=touch.identifier,this.updateScrollParent(targetElement)}}return this.trackingClick=!0,this.trackingClickStart=event.timeStamp,this.targetElement=targetElement,this.touchStartX=touch.pageX,this.touchStartY=touch.pageY,event.timeStamp-this.lastClickTime<200&&event.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(event){"use strict";var touch=event.changedTouches[0],boundary=this.touchBoundary;return Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary},FastClick.prototype.onTouchMove=function(event){"use strict";return!this.trackingClick||((this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event))&&(this.trackingClick=!1,this.targetElement=null),!0)},FastClick.prototype.findControl=function(labelElement){"use strict";return void 0!==labelElement.control?labelElement.control:labelElement.htmlFor?document.getElementById(labelElement.htmlFor):labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(event){"use strict";var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick)return!0;if(event.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=event.timeStamp,trackingClickStart=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(touch=event.changedTouches[0],targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement,targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent),targetTagName=targetElement.tagName.toLowerCase(),"label"===targetTagName){if(forElement=this.findControl(targetElement)){if(this.focus(targetElement),this.deviceIsAndroid)return!1;targetElement=forElement}}else if(this.needsFocus(targetElement))return event.timeStamp-trackingClickStart>100||this.deviceIsIOS&&window.top!==window&&"input"===targetTagName?(this.targetElement=null,!1):(this.focus(targetElement),this.deviceIsIOS4&&"select"===targetTagName||(this.targetElement=null,event.preventDefault()),!1);return!(!this.deviceIsIOS||this.deviceIsIOS4||(scrollParent=targetElement.fastClickScrollParent,!scrollParent||scrollParent.fastClickLastScrollTop===scrollParent.scrollTop))||(this.needsClick(targetElement)||(event.preventDefault(),this.sendClick(targetElement,event)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(event){"use strict";return!this.targetElement||(!!event.forwardedTouchEvent||(!event.cancelable||(!(!this.needsClick(this.targetElement)||this.cancelNextClick)||(event.stopImmediatePropagation?event.stopImmediatePropagation():event.propagationStopped=!0,event.stopPropagation(),event.preventDefault(),!1))))},FastClick.prototype.onClick=function(event){"use strict";var permitted;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===event.target.type&&0===event.detail||(permitted=this.onMouse(event),permitted||(this.targetElement=null),permitted)},FastClick.prototype.destroy=function(){"use strict";var layer=this.layer;this.deviceIsAndroid&&(layer.removeEventListener("mouseover",this.onMouse,!0),layer.removeEventListener("mousedown",this.onMouse,!0),layer.removeEventListener("mouseup",this.onMouse,!0)),layer.removeEventListener("click",this.onClick,!0),layer.removeEventListener("touchstart",this.onTouchStart,!1),layer.removeEventListener("touchmove",this.onTouchMove,!1),layer.removeEventListener("touchend",this.onTouchEnd,!1),layer.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(layer){"use strict";var metaViewport;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(metaViewport=document.querySelector("meta[name=viewport]"),metaViewport&&metaViewport.content.indexOf("user-scalable=no")!==-1)return!0}return"none"===layer.style.msTouchAction},FastClick.attach=function(layer){"use strict";return new FastClick(layer)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick},{}],fastclick:[function(require,module,exports){module.exports=require("T81WCk")},{}],6:[function(require,module,exports){var core=require("./hoax-core"),request=require("browser-request");request.log.debug=function(){},module.exports=core(request)},{"./hoax-core":7,"browser-request":8}],7:[function(require,module,exports){module.exports=function(request){function makeHoaxCallback(cb,verb){return function(err,res,body){err&&"error"!==err?cb(err,res,body):res.statusCode>=400||"error"===err?cb(body||res.statusCode,res):cb(null,body)}}function processArguments(myPax,urlOrOpts,data,cb,verb){var opts={},newPax=myPax;return"function"==typeof urlOrOpts?(cb=urlOrOpts,data=null,urlOrOpts=null):urlOrOpts.uri||urlOrOpts.url?newPax=myPax(urlOrOpts.uri||urlOrOpts.url):"function"==typeof data?(cb=data,data=null,"put"!==verb&&"post"!==verb||"string"==typeof urlOrOpts||"[object Array]"===Object.prototype.toString.call(urlOrOpts)?newPax=myPax(urlOrOpts):data=urlOrOpts):newPax=myPax(urlOrOpts),opts.headers={"content-type":"application/json"},opts.json=!0,opts.uri=newPax.toString(),data&&(opts.body=JSON.stringify(data)),[opts,cb,newPax]}function extenderizer(oldHoax){return function(name,fun){this.methods=this.methods||{},this.methods[name]=fun,this[name]=fun}}function addExtensions(newHoax,oldHoax){if(oldHoax&&oldHoax.methods){var k;for(k in oldHoax.methods)newHoax[k]=oldHoax.methods[k]}}function makeHoax(myPax,verb,oldHoax){var newHoax=function(opts,data,xcb){var args=processArguments(myPax,opts,data,xcb,verb),reqOpts=args[0],cb=args[1],newPax=args[2];return cb?verb?("del"==verb?reqOpts.method="DELETE":reqOpts.method=verb.toUpperCase(),request(reqOpts,makeHoaxCallback(cb,verb))):request(reqOpts,makeHoaxCallback(cb)):makeHoax(newPax,verb,newHoax)};return verb||"get put post head del".split(" ").forEach(function(v){newHoax[v]=makeHoax(myPax,v,newHoax)}),addExtensions(newHoax,oldHoax),newHoax.extend=extenderizer(oldHoax),newHoax.pax=myPax,newHoax.url=myPax,newHoax}var pax=require("pax"),Hoax=makeHoax(pax());return Hoax.makeHoax=makeHoax,Hoax}},{pax:9}],8:[function(require,module,exports){function request(options,callback){if("function"!=typeof callback)throw new Error("Bad callback given: "+callback);if(!options)throw new Error("No options given");var options_onResponse=options.onResponse;if(options="string"==typeof options?{uri:options}:JSON.parse(JSON.stringify(options)),options.onResponse=options_onResponse,options.verbose&&(request.log=getLogger()),options.url&&(options.uri=options.url,delete options.url),!options.uri&&""!==options.uri)throw new Error("options.uri is a required argument");if("string"!=typeof options.uri)throw new Error("options.uri must be a string");for(var unsupported_options=["proxy","_redirectsFollowed","maxRedirects","followRedirect"],i=0;i<unsupported_options.length;i++)if(options[unsupported_options[i]])throw new Error("options."+unsupported_options[i]+" is not supported");if(options.callback=callback,options.method=options.method||"GET",options.headers=options.headers||{},options.body=options.body||null,options.timeout=options.timeout||request.DEFAULT_TIMEOUT,options.headers.host)throw new Error("Options.headers.host is not supported");return options.json&&(options.headers.accept=options.headers.accept||"application/json","GET"!==options.method&&(options.headers["content-type"]="application/json"),"boolean"!=typeof options.json?options.body=JSON.stringify(options.json):"string"!=typeof options.body&&(options.body=JSON.stringify(options.body))),options.onResponse=options.onResponse||noop,options.onResponse===!0&&(options.onResponse=callback,options.callback=noop),!options.headers.authorization&&options.auth&&(options.headers.authorization="Basic "+b64_enc(options.auth.username+":"+options.auth.password)),run_xhr(options)}function run_xhr(options){function too_late(){timed_out=!0;var er=new Error("ETIMEDOUT");return er.code="ETIMEDOUT",er.duration=options.timeout,request.log.error("Timeout",{id:xhr._id,milliseconds:options.timeout}),options.callback(er,xhr)}function on_state_change(event){if(timed_out)return request.log.debug("Ignoring timed out state change",{state:xhr.readyState,id:xhr.id});if(request.log.debug("State change",{state:xhr.readyState,id:xhr.id,timed_out:timed_out}),xhr.readyState===XHR.OPENED){request.log.debug("Request started",{id:xhr.id});for(var key in options.headers)xhr.setRequestHeader(key,options.headers[key])}else xhr.readyState===XHR.HEADERS_RECEIVED?on_response():xhr.readyState===XHR.LOADING?(on_response(),on_loading()):xhr.readyState===XHR.DONE&&(on_response(),on_loading(),on_end())}function on_response(){if(!did.response){if(did.response=!0,request.log.debug("Got response",{id:xhr.id,status:xhr.status}),clearTimeout(xhr.timeoutTimer),xhr.statusCode=xhr.status,is_cors&&0==xhr.statusCode){var cors_err=new Error("CORS request rejected: "+options.uri);return cors_err.cors="rejected",did.loading=!0,did.end=!0,options.callback(cors_err,xhr)}options.onResponse(null,xhr)}}function on_loading(){did.loading||(did.loading=!0,request.log.debug("Response body loading",{id:xhr.id}))}function on_end(){if(!did.end){if(did.end=!0,request.log.debug("Request done",{id:xhr.id}),xhr.body=xhr.responseText,options.json)try{xhr.body=JSON.parse(xhr.responseText)}catch(er){return options.callback(er,xhr)}options.callback(null,xhr,xhr.body)}}var xhr=new XHR,timed_out=!1,is_cors=is_crossDomain(options.uri),supports_cors="withCredentials"in xhr;if(req_seq+=1,xhr.seq_id=req_seq,xhr.id=req_seq+": "+options.method+" "+options.uri,xhr._id=xhr.id,is_cors&&!supports_cors){var cors_err=new Error("Browser does not support cross-origin request: "+options.uri);return cors_err.cors="unsupported",options.callback(cors_err,xhr)}xhr.timeoutTimer=setTimeout(too_late,options.timeout);var did={response:!1,loading:!1,end:!1};return xhr.onreadystatechange=on_state_change,xhr.open(options.method,options.uri,!0),is_cors&&(xhr.withCredentials=!!options.withCredentials),xhr.send(options.body),xhr}function noop(){}function getLogger(){var level,i,logger={},levels=["trace","debug","info","warn","error"];for(i=0;i<levels.length;i++)level=levels[i],logger[level]=noop,"undefined"!=typeof console&&console&&console[level]&&(logger[level]=formatted(console,level));return logger}function formatted(obj,method){function formatted_logger(str,context){return"object"==typeof context&&(str+=" "+JSON.stringify(context)),obj[method].call(obj,str)}return formatted_logger}function is_crossDomain(url){var ajaxLocation,rurl=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/;try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}var ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],parts=rurl.exec(url.toLowerCase()),result=!(!parts||parts[1]==ajaxLocParts[1]&&parts[2]==ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?80:443))==(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?80:443)));return result}function b64_enc(data){var o1,o2,o3,h1,h2,h3,h4,bits,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;do o1=data.charCodeAt(i++),o2=data.charCodeAt(i++),o3=data.charCodeAt(i++),bits=o1<<16|o2<<8|o3,h1=bits>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=63&bits,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);while(i<data.length);switch(enc=tmp_arr.join(""),data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"="}return enc}var XHR=XMLHttpRequest;if(!XHR)throw new Error("missing XMLHttpRequest");module.exports=request,request.log={trace:noop,debug:noop,info:noop,warn:noop,error:noop};var DEFAULT_TIMEOUT=18e4,req_seq=0;request.withCredentials=!1,request.DEFAULT_TIMEOUT=DEFAULT_TIMEOUT,request.defaults=function(options,requester){var def=function(method){var d=function(params,callback){params="string"==typeof params?{uri:params}:JSON.parse(JSON.stringify(params));for(var i in options)void 0===params[i]&&(params[i]=options[i]);return method(params,callback)};return d},de=def(request);return de.get=def(request.get),de.post=def(request.post),de.put=def(request.put),de.head=def(request.head),de};var shortcuts=["get","put","post","head"];shortcuts.forEach(function(shortcut){var method=shortcut.toUpperCase(),func=shortcut.toLowerCase();request[func]=function(opts){"string"==typeof opts?opts={method:method,uri:opts}:(opts=JSON.parse(JSON.stringify(opts)),opts.method=method);var args=[opts].concat(Array.prototype.slice.apply(arguments,[1]));return request.apply(this,args)}}),request.couch=function(options,callback){function couch_handler(er,resp,body){if(er)return callback(er,resp,body);if((resp.statusCode<200||resp.statusCode>299)&&body.error){er=new Error("CouchDB error: "+(body.error.reason||body.error.error));for(var key in body)er[key]=body[key];return callback(er,resp,body)}return callback(er,resp,body)}"string"==typeof options&&(options={uri:options}),options.json=!0,options.body&&(options.json=options.body),delete options.body,callback=callback||noop;var xhr=request(options,couch_handler);return xhr}},{}],9:[function(require,module,exports){module.exports=require(3)},{}],mustache:[function(require,module,exports){module.exports=require("4JMXRT")},{}],"4JMXRT":[function(require,module,exports){!function(root,factory){"object"==typeof exports&&exports?module.exports=factory:"function"==typeof define&&define.amd?define(factory):root.Mustache=factory}(this,function(){function testRe(re,string){return RegExp.prototype.test.call(re,string)}function isWhitespace(string){return!testRe(nonSpaceRe,string)}function escapeRe(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parent){this.view=view,this.parent=parent,this.clearCache()}function Writer(){this.clearCache()}function compileTokens(tokens){function subRender(i,tokens,template){if(!subRenders[i]){var fn=compileTokens(tokens);subRenders[i]=function(writer,context){return fn(writer,context,template)}}return subRenders[i]}var subRenders={};return function(writer,context,template){for(var token,sectionText,buffer="",i=0,len=tokens.length;i<len;++i)switch(token=tokens[i],token[0]){case"#":sectionText=template.slice(token[3],token[5]),buffer+=writer._section(token[1],context,sectionText,subRender(i,token[4],template));break;case"^":buffer+=writer._inverted(token[1],context,subRender(i,token[4],template));break;case">":buffer+=writer._partial(token[1],context);break;case"&":buffer+=writer._name(token[1],context);break;case"name":buffer+=writer._escaped(token[1],context);break;case"text":buffer+=token[1]}return buffer}}function nestTokens(tokens){for(var token,tree=[],collector=tree,sections=[],i=0,len=tokens.length;i<len;++i)switch(token=tokens[i],token[0]){case"#":case"^":sections.push(token),collector.push(token),collector=token[4]=[];break;case"/":var section=sections.pop();section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token)}return tree}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,len=tokens.length;i<len;++i)token=tokens[i],"text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(lastToken=token,squashedTokens.push(token));return squashedTokens}function escapeTags(tags){return[new RegExp(escapeRe(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRe(tags[1]))]}var exports={};exports.name="mustache.js",exports.version="0.7.2",exports.tags=["{{","}}"],exports.Scanner=Scanner,exports.Context=Context,exports.Writer=Writer;var whiteRe=/\s*/,spaceRe=/\s+/,nonSpaceRe=/\S/,eqRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/,isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};exports.escape=escapeHtml,Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);return match&&0===match.index?(this.tail=this.tail.substring(match[0].length),this.pos+=match[0].length,match[0]):""},Scanner.prototype.scanUntil=function(re){var match,pos=this.tail.search(re);switch(pos){case-1:match=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,pos),this.tail=this.tail.substring(pos),this.pos+=pos}return match},Context.make=function(view){return view instanceof Context?view:new Context(view)},Context.prototype.clearCache=function(){this._cache={}},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value=this._cache[name];if(!value){if("."===name)value=this.view;else for(var context=this;context;){if(name.indexOf(".")>0){var names=name.split("."),i=0;for(value=context.view;value&&i<names.length;)value=value[names[i++]]}else value=context.view[name];if(null!=value)break;context=context.parent}this._cache[name]=value}return"function"==typeof value&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this._cache={},this._partialCache={}},Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=exports.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template)}return fn},Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);return this._partialCache[name]=fn,fn},Writer.prototype.compileTokens=function(tokens,template){var fn=compileTokens(tokens),self=this;return function(view,partials){if(partials)if("function"==typeof partials)self._loadPartial=partials;else for(var name in partials)self.compilePartial(name,partials[name]);return fn(self,Context.make(view),template)}},Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)},Writer.prototype._section=function(name,context,text,callback){var value=context.lookup(name);switch(typeof value){case"object":if(isArray(value)){for(var buffer="",i=0,len=value.length;i<len;++i)buffer+=callback(this,context.push(value[i]));return buffer}return value?callback(this,context.push(value)):"";case"function":var self=this,scopedRender=function(template){return self.render(template,context)},result=value.call(context.view,text,scopedRender);return null!=result?result:"";default:if(value)return callback(this,context)}return""},Writer.prototype._inverted=function(name,context,callback){var value=context.lookup(name);return!value||isArray(value)&&0===value.length?callback(this,context):""},Writer.prototype._partial=function(name,context){name in this._partialCache||!this._loadPartial||this.compilePartial(name,this._loadPartial(name));var fn=this._partialCache[name];return fn?fn(context):""},Writer.prototype._name=function(name,context){var value=context.lookup(name);return"function"==typeof value&&(value=value.call(context.view)),null==value?"":String(value)},Writer.prototype._escaped=function(name,context){return exports.escape(this._name(name,context))},exports.parse=function(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)tokens.splice(spaces.pop(),1);else spaces=[];hasTag=!1,nonSpace=!1}if(template=template||"",tags=tags||exports.tags,"string"==typeof tags&&(tags=tags.split(spaceRe)),2!==tags.length)throw new Error("Invalid tags: "+tags.join(", "));for(var start,type,value,chr,tagRes=escapeTags(tags),scanner=new Scanner(template),sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(tagRes[0]))for(var i=0,len=value.length;i<len;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(start=scanner.pos,!scanner.scan(tagRes[0]))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type)value=scanner.scanUntil(eqRe),scanner.scan(eqRe),scanner.scanUntil(tagRes[1]);else if("{"===type){var closeRe=new RegExp("\\s*"+escapeRe("}"+tags[1]));value=scanner.scanUntil(closeRe),scanner.scan(curlyRe),scanner.scanUntil(tagRes[1]),type="&"}else value=scanner.scanUntil(tagRes[1]);if(!scanner.scan(tagRes[1]))throw new Error("Unclosed tag at "+scanner.pos);if("/"===type){if(0===sections.length)throw new Error('Unopened section "'+value+'" at '+start);var section=sections.pop();if(section[1]!==value)throw new Error('Unclosed section "'+section[1]+'" at '+start)}var token=[type,value,start,scanner.pos];if(tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("name"===type||"{"===type||"&"===type)nonSpace=!0;else if("="===type){if(tags=value.split(spaceRe),2!==tags.length)throw new Error("Invalid tags at "+start+": "+tags.join(", "));tagRes=escapeTags(tags)}}var section=sections.pop();if(section)throw new Error('Unclosed section "'+section[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))};var _writer=new Writer;return exports.clearCache=function(){return _writer.clearCache()},exports.compile=function(template,tags){return _writer.compile(template,tags)},exports.compilePartial=function(name,template,tags){return _writer.compilePartial(name,template,tags)},exports.compileTokens=function(tokens,template){return _writer.compileTokens(tokens,template)},exports.render=function(template,view,partials){return _writer.render(template,view,partials)},exports.to_html=function(template,view,partials,send){var result=exports.render(template,view,partials);return"function"!=typeof send?result:void send(result)},exports}())},{}]},{},[]),angular.module("limitStringFilter",[]).filter("limitString",function(){return LimitString}),angular.module("ocf.interceptors",[]).factory("httpRequestInterceptor",["$q","$rootScope",function($q,$rootScope){return{responseError:function(rejection){return rejection&&rejection.data&&"Session Expired"==rejection.data.message&&($rootScope.$broadcast("logout",!0),rejection="Session Expired"),$q.reject(rejection)}}}]),angular.module("ocf.filters",[]).filter("cutStringStart",function(){return function(text,length,start){return isNaN(length)&&(length=4),void 0===start&&(start="..."),text?text.length<=length?text:start+String(text).substr(-length,length):"N/A"}}).filter("cutEPCStart",function(){return function(text,length,start){return isNaN(length)&&(length=4),void 0===start&&(start="xx"),text?text.length<=length?text:start+String(text).substr(-length,length):"N/A"}}).filter("cutStringEnd",function(){return function(text,length,end){return isNaN(length)&&(length=4),void 0===end&&(end="..."),text?text.length<=length?text:String(text).substr(0,length)+end:"N/A"}}).filter("toTrusted",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]).filter("cutStringSize",function(){return function(text,font,fontSize,maxSize){isNaN(fontSize)&&(fontSize=12),isNaN(maxSize)&&(maxSize=50);var end="...";if(null!=font&&void 0!=font||(font="roboto"),!text)return"N/A";var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");ctx.font=fontSize+"px "+font;for(var width=ctx.measureText(text).width,newText=text,count=0;width>=maxSize;)newText=String(text).substr(0,newText.length-count++)+end,width=ctx.measureText(newText).width;return newText}}),angular.module("ocf.directives",[]).directive("messages",function(){return{scope:{messages:"="},restrict:"E",templateUrl:"commons/templates/message-service.html",link:function($scope,iElm,iAttrs,controller){}}}).directive("ionPager",function(){return{priority:0,link:function($scope,$element,$attr,slideBox){var range=function(start,rangeLength){return Array.apply(null,Array(rangeLength)).map(function(_,i){return i+start})};$scope.currentPage=1,$scope.belongsToCurrentPage=function(index){var currPageRange=range(5*($scope.currentPage-1),5);if(currPageRange.indexOf(index)!==-1)return!0};var selectImage=function(index){var i,j,children=$element[0].children[0].children,length=children.length;for(i=0,j=1;i<length;i++){var pIndex=(i+1)%5?j:j++;i==index?($scope.currentPage=pIndex,children[i].classList.add("active")):children[i].classList.remove("active")}};$scope.pagerClick=function(index){slideBox.onPagerClick(index)},$scope.numSlides=function(){return new Array(slideBox.slidesCount())},$scope.$watch("currentSlide",function(v){selectImage(v)}),$scope.isFirstPage=function(){return 1===$scope.currentPage},$scope.isLastPage=function(total){return $scope.currentPage===Math.ceil(total/5)},$scope.prevGalleryPage=function(){$scope.isFirstPage()||$scope.currentPage--},$scope.nextGalleryPage=function(total){$scope.isLastPage(total)||$scope.currentPage++}}}}).directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}}),angular.module("ocf.constants",[]).constant("EnvironmentConfig",{host:"https://dev3.zestdataservices.com/",apiPath:"api/1/",version:"1.0.${env.BUILD_NUMBER}",envName:"${ENV_NAME}",requestTimeout:3e4,requestTimeoutLong:12e4}).constant("OCFConfig",{host:"https://dev3.zestdataservices.com/",apiPath:"ocf-manager/1/",servicePath:"services/",configObject:"configObject",applications:"applications/",access:"access"}).constant("SessionConfig",{cookieName:"zest_6220137ea63256c1ba1014724b94144c",userInformation:"userInformation",cookieLifeTime:1,cookiePath:"/ocf",userApplications:"userApplications"}).constant("CouchDbConfig",{host:"https://dev3.zestdataservices.com:6985/",name:"zest_ocf"}).constant("CouchBaseConfig",{host:"https://dev3.zestdataservices.com:4986/",name:"dev3"}).constant("PersistenceConfig",{daysToLive:2}).constant("PouchConfig",{pouchdbName:"pouch_ocf",replicationRetries:3}).constant("StagingConfig",{host:"https://dev3.zestdataservices.com/",apiPath:"zest-order-staging-api/1/",version:"1.0.${env.BUILD_NUMBER}",envName:"${ENV_NAME}",requestTimeout:3e4,requestTimeoutLong:12e4}).constant("PutAwayConfig",{host:"https://dev3.zestdataservices.com/",apiPath:"fpms-put-away-process/1/",version:"1.0.${env.BUILD_NUMBER}",envName:"${ENV_NAME}",requestTimeout:3e4,requestTimeoutLong:12e4}),angular.module("ocf.services").service("NoConnectivityPopupService",NoConnectivityPopupService),NoConnectivityPopupService.$inject=["$q","$ionicModal","lodash","$log","$rootScope","$timeout","$ionicBackdrop","$translate"],angular.module("ocf.controllers").controller("HomeController",HomeController),HomeController.$inject=["SessionService","navigateTo","$rootScope","$scope","$ionicPlatform","$log","lodash","LoggingService","$ionicViewSwitcher","$ionicSideMenuDelegate","$translate","LoadingService"],angular.module("ocf.services").service("AutoLogoutPopupService",AutoLogoutPopupService),AutoLogoutPopupService.$inject=["$q","$ionicModal","lodash","$log","$rootScope","$ionicBackdrop","$window"];var translateProvider;angular.module("ocf",["ionic","ngCordova","ngResource","ocf.templates","ocf.constants","ocf.services","ocf.directives","ocf.interceptors","ocf.filters","ocf.login","ocf.forgotPassword","ocf.changePassword","ocf.controllers","ngLodash","pouchdb","pascalprecht.translate","limitStringFilter","ngMockE2E"]).run(["$rootScope","$state","$interval","$ionicPlatform","$cordovaKeyboard","EnvironmentConfig","LoadingService","SessionService","navigateTo","ScanService","$log","$translate","DataLayerService","$window","LoggingService","$httpBackend","StagingConfig","URLManager","EventHandlerService",function($rootScope,$state,$interval,$ionicPlatform,$cordovaKeyboard,EnvironmentConfig,LoadingService,SessionService,navigateTo,ScanService,$log,$translate,DataLayerService,$window,LoggingService,$httpBackend,StagingConfig,URLManager,EventHandlerService){EventHandlerService.setCurrentState("ocf.run");var debugging=!1;if(debugging){var storageAreas=[{id:1,barcode:"SA01",name:"SA01",headerColor:"#62a539",bodyColor:"#6db33f"},{id:2,barcode:"SA02",name:"Storage Area 02",headerColor:"#62a539",bodyColor:"#6db33f"},{id:3,barcode:"SA03",name:"SA03",headerColor:"#c4161c",bodyColor:"#ed1c24"},{id:4,barcode:"SA04",name:"Storage Area 04",headerColor:"darkorange",bodyColor:"orange"},{id:5,barcode:"SA05",name:"Storage Area 05",headerColor:"#2b0a4b",bodyColor:"rebeccapurple"},{id:6,barcode:"SA06",name:"Storage Area 06",headerColor:"#62a539",bodyColor:"#6db33f"}],palletInfo={pallet:{tagEpc:"330C4DE26110028099998001",product:{id:23,product:"Romaine Lettuce"},ziprCode:"16-330",putAway:!0,storageArea:{}},storageAreaValidation:!1},restMessages={G04201:{code:200,message:"G04-201"},G04202:{code:200,message:"G04-202"},G04401:{status:400,data:{defaultErrorMessage:"",errorCode:"G04-401"}},G04402:{status:400,data:{defaultErrorMessage:"",errorCode:"G04-402"}}};$httpBackend.whenGET(/.+storage\/area\/assign\/pallet.+/).respond(function(method,url,data){
var extract_epc_phId=/pallet\/(.+)\/packhouse\/(.+)$/,epc_phId=extract_epc_phId.exec(url);return palletInfo.pallet.storageAreaValidation=epc_phId[1].indexOf("1111")!=-1,palletInfo.pallet.tagEpc=epc_phId[1],palletInfo.pallet.storageArea=storageAreas[Math.floor(6*Math.random())],[200,palletInfo]}),$httpBackend.whenPOST(URLManager.getUrl("confirmSA")).respond(function(method,url,data){var obj=JSON.parse(data);return navigator.onLine?_(storageAreas).find({barcode:obj.storageArea})?[restMessages.G04201.code,restMessages.G04201]:[restMessages.G04402.code,restMessages.G04402.data]:[0,{}]}),$httpBackend.whenPOST(URLManager.getUrl("unassignSA")).respond(function(method,url,data){var obj=JSON.parse(data);return obj.tagEpc?[200,{code:200,message:"G04-202"}]:[400,{code:400,message:"G04-401"}]})}angular.forEach(["GET","DELETE","JSONP","HEAD","PUT","POST","PATCH"],function(method){$httpBackend.when(method).passThrough()}),$ionicPlatform.ready(function(){function handleTouch(event){if($rootScope.lastMove+100<event.timeStamp){var touch=event.changedTouches[0],Xpos=event.changedTouches[0].screenX,Ypos=event.changedTouches[0].screenY;$(touch.target).is("input")?($(touch.target).focus(),cordova.plugins.Keyboard.show()):$(touch.target).parent().is("input")?($(touch.target).parent().focus(),cordova.plugins.Keyboard.show()):$(touch.target).children().is("input")?($(touch.target).children().focus(),cordova.plugins.Keyboard.show()):$(touch.target).is("button")?($(touch.target).click(),cordova.plugins.Keyboard.close()):void 0!=$(document.elementFromPoint(Xpos,Ypos)).attr("ng-click")?(angular.element(document.elementFromPoint(Xpos,Ypos)).triggerHandler("click"),cordova.plugins.Keyboard.close()):void 0!=$($(document.elementFromPoint(Xpos,Ypos)).parent()).attr("ng-click")?(angular.element($(document.elementFromPoint(Xpos,Ypos)).parent()).triggerHandler("click"),cordova.plugins.Keyboard.close()):void 0!=$($(document.elementFromPoint(Xpos,Ypos)).children()).attr("ng-click")&&(angular.element($(document.elementFromPoint(Xpos,Ypos)).children()).triggerHandler("click"),cordova.plugins.Keyboard.close()),"touchcancel"==event.type&&event.preventDefault()}$rootScope.lastMove=event.timeStamp}if($rootScope.translateProvider=translateProvider,$rootScope.$on("$translatePartialLoaderStructureChanged",function(){$translate.refresh()}),$translate.use("en"),window.StatusBar&&StatusBar.hide(),window.cordova){window.addEventListener("native.keyboardshow",function(){document.body.classList.add("keyboard-open")});var removeKeyboardOpen=function(){setTimeout(function(){document.body.classList.remove("keyboard-open")},1e3)};if(window.addEventListener("native.keyboardhide",removeKeyboardOpen),$rootScope.$watch(function(){return $cordovaKeyboard.isVisible()},function(value){$rootScope.$broadcast("keyboard.open",value)}),window.cordova.plugins&&window.cordova.plugins.autoStart&&window.cordova.plugins.autoStart.enable(),ScanService.initialize(),window.hockeyapp&&window.hockeyapp.start(function(message){$log.debug(message)},function(message){console.error(message)},"9f3c70eff11ea8481da53c438fd2ec18"),window.cordova.plugins.Keyboard&&$cordovaKeyboard.hideAccessoryBar(!0),window.cordova.getAppVersion&&window.cordova.getAppVersion(function(version){"N/A"==version&&(version="Version Unavailable"),$rootScope.appVersion=version,$rootScope.$broadcast("appVersion",version)}),window.cordova.plugins.backgroundMode){cordova.plugins.backgroundMode.enable();var stop,timer=0;cordova.plugins.backgroundMode.onactivate=function(){if($log.debug("Went background"),$rootScope.user&&$rootScope.user.id){var timeout=$rootScope.stagingConfiguration.userInactivityTimeout;timeout=timeout?timeout:0;var today=new Date,now=today.getTime();timeout&&(timeout=now+timeout);var timeout_date=new Date(timeout);$log.debug("Background Time: "+today+" Log out at: "+timeout_date),stop=$interval(function(){var today_interval=new Date,now_interval=today_interval.getTime();$log.debug("trying logout at date: "+today_interval),now_interval>=timeout&&($rootScope.replicationHandler&&($log.debug("Cancelling replication"),$rootScope.replicationHandler.cancel()),SessionService.destroy(),$log.debug("User logged out successfully"),$window.localStorage.setItem("sessionExpired","true"),document.location="index.html",SessionService.clearCredentials())},1e4)}},cordova.plugins.backgroundMode.ondeactivate=function(){$log.debug("Went foreground"),$rootScope.$broadcast("background",!0),timer=0,$interval.cancel(stop),stop=void 0}}}window.StatusBar&&(StatusBar.styleDefault(),window.addEventListener("native.keyboardhide",function(){window.StatusBar.hide()}),window.addEventListener("native.keyboardshow",function(){window.StatusBar.hide()})),$rootScope.isOnline=!0,document.addEventListener("online",function(){$rootScope.isOnline=!0,$log.debug("Went Online")},!1),document.addEventListener("offline",function(){$rootScope.isOnline=!1,$log.debug("Went Offline")},!1),$rootScope.onPauseEvent=function(event){if($rootScope.user){var dataRecover={};window.localStorage.getItem("dataRecover")&&(dataRecover=JSON.parse(window.localStorage.getItem("dataRecover")));var loginData={user:$rootScope.user,configuration:$rootScope.stagingConfiguration,userConfiguration:$rootScope.userConfiguration,selectedLanguage:$rootScope.selectedLanguage,checkDevice:$rootScope.checkDevice,filterAppListByDeviceModel:$rootScope.filterAppListByDeviceModel,selectedLocation:$rootScope.selectedLocation,locations:$rootScope.user.locations,selectedApp:$rootScope.app,userRecoverData:$rootScope.userRecoverData};dataRecover.loginData=loginData,dataRecover.hasToRecover=!0,dataRecover.createdDateTime=(new Date).toISOString(),LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_PAUSE,"onPause callback","Saving Data recover","success",[{key:"dataRecover",value:JSON.stringify(dataRecover)}],void 0!=$rootScope.user),window.localStorage.setItem("dataRecover",JSON.stringify(dataRecover))}},$rootScope.onResumeEvent=function(event){if($rootScope.appResumed=!0,LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_RESUME,"onResume callback","Checking Data recover","success",[],void 0!=$rootScope.user),$rootScope.user){LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_RESUME,"onResume callback","There is no data to recover","success",[{key:"hasToRecover",value:!1}],!0),window.localStorage.getItem("dataRecover")&&window.localStorage.setItem("dataRecover",JSON.stringify({}))}else LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_RESUME,"onResume callback","There is data to recover, firing dataRecover event","success",[],!1),$rootScope.$broadcast("dataRecover",event)},$rootScope.onDeviceReadyEvent=function(){console.log("deviceready"),window.navigationbar.setUp(!0),LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_DEVICE_READY,"onDeviceReady callback","checking Data recover","success",[],!1),$rootScope.appResumed||(LoggingService.logMessage(LoggingService.CONSTANTS.APP.OCF_DATA_RECOVER,LoggingService.CONSTANTS.CONTEXT.ON_DEVICE_READY,"onDeviceReady callback","There is data to recover, firing dataRecover event","success",[],!1),$rootScope.$broadcast("dataRecover",event))},document.addEventListener("pause",$rootScope.onPauseEvent,!1),document.addEventListener("resume",$rootScope.onResumeEvent,!1),document.addEventListener("deviceready",$rootScope.onDeviceReadyEvent,!1);var isMC=new RegExp(/^MC92N0$/);window.device&&window.device.model.match(isMC)&&(document.addEventListener("touchcancel",function(cancelEvent){handleTouch(cancelEvent)}),document.addEventListener("touchmove",function(moveEvent){handleTouch(moveEvent)}))})}]).config(["$stateProvider","$provide","$urlRouterProvider","$ionicConfigProvider","$compileProvider","$httpProvider","$translatePartialLoaderProvider","$translateProvider",function($stateProvider,$provide,$urlRouterProvider,$ionicConfigProvider,$compileProvider,$httpProvider,$translatePartialLoaderProvider,$translateProvider){translateProvider=$translateProvider,$httpProvider.interceptors.push("httpRequestInterceptor"),$compileProvider.debugInfoEnabled(!1),$ionicConfigProvider.views.maxCache(2),$ionicConfigProvider.views.swipeBackEnabled(!1),$ionicConfigProvider.backButton.previousTitleText(!1),$ionicConfigProvider.tabs.style("standard"),$ionicConfigProvider.tabs.position("bottom"),$ionicConfigProvider.navBar.alignTitle("center"),$translatePartialLoaderProvider.addPart("ocf/locales"),$translateProvider.useLoader("$translatePartialLoader",{urlTemplate:"{part}/{lang}.json"}).registerAvailableLanguageKeys(["en","es"],{"en_*":"en","es_*":"es"}).preferredLanguage("en").fallbackLanguage("en").determinePreferredLanguage(),$provide.decorator("$q",["$delegate",function($delegate){var $q=$delegate;return $q.allSettled=$q.allSettled||function(promises){var deferred=$q.defer();if(!angular.isArray(promises))throw"allSettled can only handle an array of promises (for now)";var states=[],results=[],didAPromiseFail=!1;angular.forEach(promises,function(promise,key){states[key]=!1});var checkStates=function(states,results,deferred,failed){var allFinished=!0;angular.forEach(states,function(state,key){if(!state)return void(allFinished=!1)}),allFinished&&(failed?deferred.reject(results):deferred.resolve(results))};return angular.forEach(promises,function(promise,key){$q.when(promise).then(function(result){states[key]=!0,results[key]=result,checkStates(states,results,deferred,didAPromiseFail)},function(reason){states[key]=!0,results[key]=reason,didAPromiseFail=!0,checkStates(states,results,deferred,didAPromiseFail)})}),deferred.promise},$q}]),$provide.decorator("ionPagerDirective",["$delegate",function($delegate){var delegate=$delegate[0];return delegate.template='<div class="slider-pager"> <ul>   <li class="slider-pager-page"       ng-repeat="slide in numSlides() track by $index"       ng-class="{active: $index == currentSlide}"       ng-click="pagerClick($index, numSlides().length)"       ng-show="belongsToCurrentPage($index)">     <div></div>   </li> </ul> <div class="gallery-nav-buttons bottom">   <div class="nav-button left" ng-click="prevGalleryPage()" ng-if="!isFirstPage()">     <i class="icon ion-chevron-left"></i>   </div>   <div class="nav-button right" ng-click="nextGalleryPage(numSlides().length)" ng-if="!isLastPage(numSlides().length)">     <i class="icon ion-chevron-right"></i>   </div> </div></div>',$delegate}]),$provide.decorator("ionModalDirective",["$delegate",function($delegate){var delegate=$delegate[0];return delegate.template='<div class="modal-backdrop"> <div class="modal-wrapper" ng-transclude></div></div>',$delegate}]),$stateProvider.state("ocf",{url:"",abstract:!0,template:'<ion-view view-title="OCF"><ion-nav-view name="ocf"></ion-nav-view></ion-view> ',controller:"AppCtrl"}),$urlRouterProvider.otherwise("/login")}]).controller("AppCtrl",["$rootScope","$ionicHistory","$scope","encode","$state","$ionicModal","$ionicPopup","$ionicLoading","$ionicSlideBoxDelegate","$timeout","$log","SessionService","SessionConfig","ReplicationService","navigateTo","$q","MessageService","CouchDbConfig","lodash","InitializationService","LoadingService","$cordovaDialogs","$cordovaBarcodeScanner","$ionicViewSwitcher","$ionicBackdrop","DataLayerService","$window","NoConnectivityPopupService","LanguageSelectorService",function($rootScope,$ionicHistory,$scope,encode,$state,$ionicModal,$ionicPopup,$ionicLoading,$ionicSlideBoxDelegate,$timeout,$log,SessionService,SessionConfig,ReplicationService,navigateTo,$q,MessageService,CouchDbConfig,lodash,InitializationService,LoadingService,$cordovaDialogs,$cordovaBarcodeScanner,$ionicViewSwitcher,$ionicBackdrop,DataLayerService,$window,NoConnectivityPopupService,LanguageSelectorService){function changePassword(){navigateTo.changePassword()}MessageService.clear(),$scope.messages=MessageService.getCurrentMessages(),$scope.scannerAllowed=window.cordova,$rootScope.wasAtNewSample=!1,$scope.appVersion="v",$rootScope.selectedLanguage="English",$scope.changePassword=changePassword,$scope.deviceModel=!1,$scope.checkDevice=!1,$window.device&&$window.device.model&&($scope.deviceModel=String($window.device.model)),$rootScope.$on("appVersion",function(event,appVersion){$scope.appVersion+=appVersion}),$scope.isNewSample=function(path){var regexp=/newLotSample/;return regexp.test(path)},$scope.saveState=function(){$scope.isNewSample($state.current.name)||($scope.savedState=angular.copy($state.current.name)),$scope.savedStateParams=angular.copy($state.params)},$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$log.debug("AppCtrl - $stateChangeStart to "+toState.to+"- fired when the transition begins. toState,toParams : \n",toState,toParams),$scope.previousStateName=fromState.name;var session=SessionService.getSessionData();if($scope.parseDate=function(date){var dateFormat="MM/DD/YY";return $rootScope.selectedLocation.timezoneOffset?moment(date).utcOffset($rootScope.selectedLocation.timezoneOffset/6e4).format(dateFormat):moment(date).format(dateFormat)},$scope.calculateTimeOffset=function(date){return $rootScope.selectedLocation.timezoneOffset?moment.utc(date).utcOffset($rootScope.selectedLocation.timezoneOffset/6e4):moment.utc(date)},$rootScope.getCurrentDate=function(){return $scope.parseDate((new Date).getTime())},$scope.saveState(),setTimeout(function(){$("ion-nav-bar").removeClass("hide"),$("ion-nav-back-button").removeClass("hide"),$("button").removeClass("hide")},10),null!==session)var sessionOver=(Date.now()-session.createdDate)/36e5>SessionConfig.cookieLifeTime;session&&"loggedOffline"==session.status&&sessionOver&&($log.debug("Session lifetime reached. Logging out"),$scope.userLogout(),navigateTo.login(),event.preventDefault())}),$scope.userLogout=function(deferred,fromInterceptor){fromInterceptor&&$window.localStorage.setItem("sessionExpired","true"),SessionService.destroy(),SessionService.clearCredentials(),$rootScope.user=null,$rootScope.app=null,$rootScope.selectedLocation=null,$log.debug("User logged out successfully"),document.location="index.html"},$rootScope.languagePopup=LanguageSelectorService,$rootScope.languagePopup.create("",{scope:$rootScope}).then(function(success){$log.debug(success)}).catch(function(fail){$log.error(fail)}),document.addEventListener("backbutton",function(){$rootScope.languagePopup&&$rootScope.languagePopup.isShown&&$rootScope.languagePopup.close()}),$scope.selectLanguage=function(){$scope.languagePopup.open()},$scope.previousStateName="",$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){$log.debug("$stateChangeError - fired when an error occurs during transition."),$log.debug(arguments)}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$log.debug("$stateChangeSuccess to "+toState.name+"- fired once the state transition is complete.")}),$rootScope.$on("$viewContentLoading",function(event,viewConfig){$log.debug("$viewContentLoading - view begins loading - dom not rendered",viewConfig)}),$rootScope.$on("$viewContentLoaded",function(event){$log.debug("$viewContentLoaded - fired after dom rendered",event)}),$rootScope.$on("$stateNotFound",function(event,unfoundState,fromState,fromParams){$log.debug("$stateNotFound "+unfoundState.to+"  - fired when a state cannot be found by its name."),$log.debug(unfoundState,fromState,fromParams)}),$scope.$on("logout",$scope.userLogout),$rootScope.noConnectivityPopup=NoConnectivityPopupService,$rootScope.noConnectivityPopup.create("",{scope:$rootScope}).then(function(success){$log.debug(success)}).catch(function(error){$log.error(error)})}]);
//# sourceMappingURL=ocf-main.js.map
